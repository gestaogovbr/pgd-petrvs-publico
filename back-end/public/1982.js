"use strict";(self.webpackChunkpetrvs=self.webpackChunkpetrvs||[]).push([[1982],{3814:(te,Y,u)=>{u.d(Y,{A:()=>X});var n=u(3308),z=u(8832),E=u(5611),D=u(3214),v=u(9276),I=u(5917),k=u(4468),y=u(2464),m=u(3279),N=u(6610),P=u(2034),U=u(5852),S=u(114),e=u(7072),G=u(6073);function F(g,C){if(1&g&&(m.j41(0,"strong",12),m.EFF(1),m.k0s()),2&g){const l=m.XpG().row;m.R7$(),m.JRh((null==l.tipo_tarefa?null:l.tipo_tarefa.nome)||"")}}function R(g,C){if(1&g&&(m.DNE(0,F,2,1,"strong",11),m.EFF(1)),2&g){const l=C.row;m.Y8G("ngIf",null==l.tipo_tarefa||null==l.tipo_tarefa.nome?null:l.tipo_tarefa.nome.length),m.R7$(),m.SpI(" ",l.descricao," ")}}function O(g,C){1&g&&m.nrm(0,"documentos-badge",14),2&g&&m.Y8G("documento",C.row.documento)}function q(g,C){if(1&g&&(m.j41(0,"column",13),m.DNE(1,O,1,1,"ng-template",null,2,m.C5r),m.k0s()),2&g){const l=m.sdS(2);m.Y8G("template",l)}}function j(g,C){1&g&&m.nrm(0,"i",18)}function $(g,C){if(1&g&&(m.j41(0,"div",16),m.DNE(1,j,1,0,"i",17),m.k0s()),2&g){const l=C.row;m.R7$(),m.Y8G("ngIf",l.data_conclusao)}}function B(g,C){if(1&g&&m.nrm(0,"input-switch",19),2&g){const l=m.XpG(2);m.Y8G("size",12)("control",l.formEdit.controls.concluido)}}function H(g,C){if(1&g&&(m.j41(0,"column",15),m.DNE(1,$,2,1,"ng-template",null,3,m.C5r)(3,B,1,2,"ng-template",null,4,m.C5r),m.k0s()),2&g){const l=m.sdS(2),c=m.sdS(4),d=m.XpG();m.Y8G("align","center")("template",l)("columnEditTemplate",c)("canEdit",d.canConcluidoEdit.bind(d))("edit",d.editable?d.onColumnConcluidoEdit.bind(d):void 0)("save",d.editable?d.onColumnConcluidoSave.bind(d):void 0)}}function L(g,C){if(1&g&&m.nrm(0,"comentarios-widget",20),2&g){const l=C.row,c=m.XpG();m.Y8G("entity",l)("noPersist",c.isPersist?void 0:"true")("selectable",c.selectable)("grid",c.grid)("save",c.addComentarioResult.bind(c))}}function M(g,C){if(1&g&&m.nrm(0,"column",21),2&g){const l=m.XpG();m.Y8G("dynamicButtons",l.dynamicButtons.bind(l))}}let X=(()=>{class g extends k.V{set atividade(l){this._atividade!=l&&(this._atividade=l,this.isPersist&&l?.tarefas&&this.control.setValue(l?.tarefas))}get atividade(){return this._atividade}constructor(l){var c;super(l),c=this,this.injector=l,this.control=new z.MJ,this.disabled=!1,this.editable=!0,this.selectable=!1,this.id_processo=0,this.consolidacao=!0,this.canAdd=!1,this.addComentarioButton={icon:"bi bi-plus-circle",hint:"Incluir coment\xe1rio"},this.editTarefa=function(){var d=(0,n.A)(function*(f){c.go.navigate({route:["gestao","atividade","tarefa"]},{metadata:{tarefa:f,atividade:c.atividade},modalClose:_=>{_&&(0,n.A)(function*(){const T=c.control.value,w=T.findIndex(V=>V.id==f.id);if(w>=0){if(_._status="ADD"==_._status?"ADD":"EDIT",c.isPersist&&c.atividade?.tarefas){c.grid.error=void 0;try{c.dialog.showSppinerOverlay("Salvando dados do formul\xe1rio"),_=yield c.dao.save(_,c.join)}catch(V){c.grid.error=V.message?V.message:V,_=void 0}finally{c.dialog.closeSppinerOverlay()}}_&&(T[w]=_,c.control.setValue(T))}c.cdRef.detectChanges()})()}})});return function(f){return d.apply(this,arguments)}}(),this.dao=l.get(D.U),this.atividadeService=l.get(y.h),this.allPages=l.get(v.v),this.formEdit=this.fh.FormBuilder({concluido:{default:!1}}),this.join=["tipo_tarefa","comentarios.usuario"]}ngOnInit(){super.ngOnInit(),""!=this.atividade?.descricao&&(this.canAdd=!0),this.queryParams?.id_processo&&(this.id_processo=this.queryParams?.id_processo),this.isPersist&&this.atividade?.tarefas&&this.control.setValue(this.atividade?.tarefas)}ngAfterViewInit(){super.ngAfterViewInit(),this.id_processo&&(this.loading=!0,this.dao.query({where:[["id_processo","==",this.id_processo]]}).asPromise().then(l=>{this.control.setValue(l||[]),this.cdRef.detectChanges()}).finally(()=>{this.loading=!1}))}get isPersist(){return null!=this.persist}addTarefa(){var l=this;return(0,n.A)(function*(){const c=new I.N;c.id=l.dao.generateUuid(),c.usuario=l.auth.usuario,c.usuario_id=l.auth.usuario.id,c.atividade_id=l.atividade?.id||"",c.comentarios=[],c._status="ADD",l.go.navigate({route:["gestao","atividade","tarefa"]},{metadata:{tarefa:c,atividade:l.atividade},modalClose:d=>{d&&(0,n.A)(function*(){const f=l.control.value||[];if(l.isPersist&&l.atividade?.tarefas){l.grid.error=void 0;try{l.dialog.showSppinerOverlay("Salvando dados do formul\xe1rio"),d=yield l.dao.save(d,l.join)}catch(_){l.grid.error=_.message?_.message:_,d=void 0}finally{l.dialog.closeSppinerOverlay()}}d&&(f.push(d),l.control.setValue(f)),l.cdRef.detectChanges()})()}})})()}deleteTarefa(l){var c=this;return(0,n.A)(function*(){const d=yield c.dialog.confirm("Exclui ?","Deseja realmente excluir?");if(c.grid.error=void 0,d)try{if(c.isPersist&&c.atividade?.tarefas||"ADD"==l._status){const f=c.control.value,_=f.findIndex(T=>T.id==l.id);c.isPersist&&c.atividade?.tarefas&&(yield c.dao.delete(l)),_>=0&&(f.splice(_,1),c.control.setValue(f))}else l._status="DELETE";c.dialog.alert("Sucesso","Registro exclu\xeddo com sucesso!"),c.cdRef.detectChanges()}catch(f){c.grid.error=f?.message?f?.message:f}})()}onColumnConcluidoEdit(l){var c=this;return(0,n.A)(function*(){c.formEdit.controls.concluido.setValue(!!l.data_conclusao)})()}onColumnConcluidoSave(l){var c=this;return(0,n.A)(function*(){try{const d=c.formEdit.controls.concluido.value?c.auth.hora:null,f=yield c.dao.update(l.id,{data_conclusao:d});return l.concluido=c.formEdit.controls.concluido.value,l.data_conclusao=l.concluido?d:null,!!f}catch{return!1}})()}addComentarioResult(l){if(l)if(this.isPersist)this.dao.getById(l.id,this.join).then(c=>{if(c){const d=this.control.value||[],f=d.findIndex(_=>_.id=c.id);f>=0&&(d[f]=c,this.control.setValue(d),this.cdRef.detectChanges())}});else{const c=l.comentarios.filter(d=>["ADD","EDIT","DELETE"].includes(d._status||"")).length>0;l._status=c&&!["ADD","EDIT","DELETE"].includes(l._status||"")?"EDIT":l._status}}dynamicButtons(l){let c=[],d=l,f=this.atividadeService.lastConsolidacao(this.atividade.metadados.consolidacoes);return(!f||"INCLUIDO"==f.status||this.util.asTimestamp(f.data_conclusao)<this.util.asTimestamp(d.created_at))&&(c.push({label:"Alterar",icon:"bi bi-pencil-square",hint:"Alterar",color:"btn-outline-info",onClick:this.editTarefa.bind(this)}),c.push({label:"Excluir",icon:"bi bi-trash",hint:"Excluir",color:"btn-outline-danger",onClick:this.deleteTarefa.bind(this)})),c}canConcluidoEdit(l){let c=l,d=this.atividadeService.lastConsolidacao(this.atividade.metadados.consolidacoes);return!d||"INCLUIDO"==d.status||this.util.asTimestamp(d.data_conclusao)<this.util.asTimestamp(c.data_conclusao)}static{this.\u0275fac=function(c){return new(c||g)(m.rXU(m.zZn))}}static{this.\u0275cmp=m.VBU({type:g,selectors:[["atividade-list-tarefa"]],viewQuery:function(c,d){if(1&c&&m.GBs(E._,5),2&c){let f;m.mGM(f=m.lsd())&&(d.grid=f.first)}},inputs:{control:"control",persist:"persist",disabled:"disabled",editable:"editable",selectable:"selectable",id_processo:"id_processo",consolidacao:"consolidacao",atividade:"atividade"},features:[m.Vt3],decls:11,vars:14,consts:[["tipoTarefaDescricao",""],["tarefaComentarios",""],["documento",""],["concluido",""],["editConcluido",""],[3,"control","add","disabled","minHeight","hasEdit","hasDelete","editable","hasAdd"],[3,"title","template"],["title","Documento",3,"template",4,"ngIf"],["title","Conclu\xeddo",3,"align","template","columnEditTemplate","canEdit","edit","save",4,"ngIf"],["title","Informa\xe7\xf5es adicionais",3,"template"],["type","options",3,"dynamicButtons",4,"ngIf"],["class","d-block",4,"ngIf"],[1,"d-block"],["title","Documento",3,"template"],[3,"documento"],["title","Conclu\xeddo",3,"align","template","columnEditTemplate","canEdit","edit","save"],[1,"text-center"],["class","bi bi-check-circle",4,"ngIf"],[1,"bi","bi-check-circle"],["controlName","concluido",3,"size","control"],["origem","ATIVIDADE_TAREFA",3,"entity","noPersist","selectable","grid","save"],["type","options",3,"dynamicButtons"]],template:function(c,d){if(1&c&&(m.j41(0,"grid",5)(1,"columns")(2,"column",6),m.DNE(3,R,2,2,"ng-template",null,0,m.C5r),m.k0s(),m.DNE(5,q,3,1,"column",7)(6,H,5,6,"column",8),m.j41(7,"column",9),m.DNE(8,L,1,5,"ng-template",null,1,m.C5r),m.k0s(),m.DNE(10,M,1,1,"column",10),m.k0s()()),2&c){const f=m.sdS(4),_=m.sdS(9);m.Y8G("control",d.control)("add",d.addTarefa.bind(d))("disabled",d.disabled?"true":void 0)("minHeight",50)("hasEdit",!1)("hasDelete",!1)("editable",d.editable?"true":void 0)("hasAdd",d.canAdd),m.R7$(2),m.Y8G("title",d.lex.translate("Tipo de Tarefa")+" e Descri\xe7\xe3o")("template",f),m.R7$(3),m.Y8G("ngIf",d.consolidacao),m.R7$(),m.Y8G("ngIf",d.consolidacao),m.R7$(),m.Y8G("template",_),m.R7$(3),m.Y8G("ngIf",d.editable&&!d.selectable&&!d.id_processo)}},dependencies:[N.bT,E._,P.T,U.I,S.S,e.c,G.s]})}}return g})()},9601:(te,Y,u)=>{u.r(Y),u.d(Y,{AtividadeModule:()=>ma});var n=u(6610),z=u(8069),E=u(1620),D=u(6819),v=u(3308),I=u(1641),k=u(24),y=u(336),m=u(4407),N=u(5624),P=u(9047),U=u(6807),S=u(2220),e=u(3279),G=u(114),F=u(9226),R=u(5524),O=u(3678),q=u(314),j=u(8857),$=u(368),B=u(5121),H=u(2119),L=u(5362),M=u(9276),X=u(4795),g=u(4402),C=u(16);const l=["numeroProcesso"],c=["numeroDocumento"],d=["tipoProcesso"],f=["tipoDocumento"];function _(s,h){if(1&s){const t=e.RV6();e.j41(0,"editable-form",5),e.nrm(1,"separator",6),e.j41(2,"separator",7)(3,"div",8)(4,"input-button",9,0),e.bIt("buttonClick",function(a){e.eBV(t);const o=e.XpG();return e.Njj(o.onNumeroProcessoClick(a))}),e.k0s(),e.nrm(6,"input-search",10,1),e.k0s(),e.j41(8,"div",8)(9,"input-button",11,2),e.bIt("buttonClick",function(a){e.eBV(t);const o=e.XpG();return e.Njj(o.onNumeroDocumentoClick(a))}),e.k0s(),e.nrm(11,"input-search",12,3),e.k0s(),e.j41(13,"div",8),e.nrm(14,"input-text",13),e.k0s()()()}if(2&s){const t=e.XpG();e.Y8G("form",t.form),e.R7$(4),e.Y8G("size",4)("control",t.form.controls.numero_processo)("disabled",!t.gb.isEmbedded||null!=t.form.controls.numero_documento.value&&t.form.controls.numero_documento.value.length?"true":void 0),e.R7$(2),e.Y8G("label",t.lex.translate("Tipo de Processo"))("size",8)("dao",t.tipoProcessoDao),e.R7$(3),e.Y8G("size",4)("control",t.form.controls.numero_requisicao)("disabled",t.gb.isEmbedded?void 0:"true"),e.R7$(2),e.Y8G("label",t.lex.translate("Tipo de Documento"))("size",8)("dao",t.tipoDocumentoDao),e.R7$(3),e.Y8G("size",12)("control",t.form.controls.titulo_documento),e.BMQ("maxlength",250)}}let T=(()=>{class s extends X.g{set documento(t){this._entity!=t&&(this._entity=t,t&&this.loadData(t))}get documento(){if(this._entity){this.loadEntity(this.form.value);const t=!!this._entity.link?.id_processo;return this._entity._status=t||"ADD"==this._entity._status?t&&!this._entity._status?"EDIT":this._entity._status:"DEL",t||"ADD"!=this._entity._status?this._entity:void 0}}set sei(t){this._sei!=t&&(this._sei=t,t&&(this.form?.controls.id_processo.setValue(t.id_processo||0),this.form?.controls.numero_processo.setValue(t.numero_processo||""),this.form?.controls.id_documento.setValue(t.id_documento||0),this.form?.controls.numero_documento.setValue(t.numero_documento||""),t.numero_documento?this.onNumeroDocumentoClick(new Event("click")):t.numero_processo&&this.onNumeroProcessoClick(new Event("click"))))}get sei(){return this._sei}constructor(t){super(t),this.injector=t,this.validate=(i,a)=>null,this.documentoDao=t.get(H.c),this._entity=new S.j({tipo:"LINK",especie:"SEI",link:{tipo:"SEI",id_processo:null,numero_processo:"",id_documento:null,numero_documento:"",titulo_documento:""},_status:"ADD"}),this.allPages=t.get(M.v),this.tipoDocumentoDao=t.get(P.Y),this.tipoProcessoDao=t.get(L.W),this.form=this.fh.FormBuilder({tipo:{default:"URL"},url:{default:""},id_processo:{default:0},numero_processo:{default:""},id_documento:{default:0},numero_documento:{default:""},tipo_processo_id:{default:null},tipo_documento_id:{default:null},titulo_documento:{default:""}},this.cdRef,this.validate)}loadData(t){t&&(t.tipo="LINK"),this.form.patchValue(t?.link||{})}loadEntity(t){this.util.fillForm(this._entity.link,t)}get isSei(){return"SEI"==this._entity?.tipo}isEmpty(){let t=this.form.value;return!this.form.valid||"URL"==t.tipo&&!t.url?.length||"SEI"==t.tipo&&(!t.numero_processo?.length||!t.numero_processo?.length)}onNumeroDocumentoClick(t){var i=this;return(0,v.A)(function*(){const a=i.form?.controls.numero_documento?.value;if(a?.length){i.numeroDocumento.loading=!0;try{let o=yield i.allPages.getDadosDocumento(a);if(!o)throw new Error("Documento n\xe3o encontrado");{let r=null,p=null;if(o.processo?.tipo_processo){const b=yield i.tipoProcessoDao.query({where:[["codigo","=",o.processo?.tipo_processo]]}).asPromise();b[0]&&(i.tipoProcesso?.loadSearch(b[0]),r=b[0].id)}if(o.documento?.tipo_documento){const b=yield i.tipoDocumentoDao.query({where:[["nome","=",o.documento?.tipo_documento]]}).asPromise();b[0]&&(i.tipoDocumento?.loadSearch(b[0]),p=b[0].id)}Object.assign(i._entity.link,{id_processo:o.processo?.id_processo,numero_processo:o.processo?.numero_processo,id_documento:o.documento?.id_documento,numero_documento:o.documento?.numero_documento,tipo_processo_id:r,tipo_documento_requisicao_id:p,titulo_documento:o.documento?.titulo_documento}),i._entity.titulo=o.documento?.titulo_documento,i.loadData(i._entity)}}catch{i.dialog.alert("Error","Imposs\xedvel encontrar o documento informado. Tente incluir diretamente pelo bot\xe3o 'Incluir atividade' acessando o documento no Sei!")}finally{i.numeroDocumento.loading=!1}}})()}onNumeroProcessoClick(t){var i=this;return(0,v.A)(function*(){const a=i.form?.controls.numero_processo?.value;if(a?.length){i.numeroProcesso.loading=!0;try{let o=yield i.allPages.getDadosProcesso(a);if(!o)throw new Error("Processo n\xe3o encontrado");{let r=null;if(o.processo?.tipo_processo){const p=yield i.tipoProcessoDao.query({where:[["codigo","=",o.processo?.tipo_processo]]}).asPromise();p[0]&&(i.tipoProcesso?.loadSearch(p[0]),r=p[0].id)}Object.assign(i._entity.link,{id_processo:o.processo?.id_processo,numero_processo:o.processo?.numero_processo,id_documento:0,numero_documento:"",tipo_processo_id:r,tipo_documento_requisicao_id:null,titulo_documento:""}),i._entity.title="Processo "+o.processo?.numero_processo,i.loadData(i._entity)}}catch{i.dialog.alert("Error","Imposs\xedvel encontrar o processo informado. Tente incluir diretamente pelo bot\xe3o 'Incluir atividade' acessando o processo no Sei!")}finally{i.numeroProcesso.loading=!1}}})()}static{this.\u0275fac=function(i){return new(i||s)(e.rXU(e.zZn))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["documento-link"]],viewQuery:function(i,a){if(1&i&&(e.GBs(I.Q,5),e.GBs(l,5),e.GBs(c,5),e.GBs(d,5),e.GBs(f,5)),2&i){let o;e.mGM(o=e.lsd())&&(a.editableForm=o.first),e.mGM(o=e.lsd())&&(a.numeroProcesso=o.first),e.mGM(o=e.lsd())&&(a.numeroDocumento=o.first),e.mGM(o=e.lsd())&&(a.tipoProcesso=o.first),e.mGM(o=e.lsd())&&(a.tipoDocumento=o.first)}},inputs:{documento:"documento",sei:"sei"},features:[e.Vt3],decls:1,vars:1,consts:[["numeroProcesso",""],["tipoProcesso",""],["numeroDocumento",""],["tipoDocumento",""],["noButtons","","confirmLabel","Assinar",3,"form",4,"ngIf"],["noButtons","","confirmLabel","Assinar",3,"form"],["title","Sei"],["transparent","","bottom",""],[1,"row"],["label","N\xfamero Processo","controlName","numero_processo","labelInfo","N\xfamero do processo, com a formata\xe7\xe3o de origem",3,"buttonClick","size","control","disabled"],["controlName","tipo_processo_id","disabled","",3,"label","size","dao"],["label","'N\xfamero Documento","controlName","numero_documento","labelInfo","Numero do documento, caso seja o Sei \xe9 o numero Sei",3,"buttonClick","size","control","disabled"],["controlName","tipo_documento_id","disabled","",3,"label","size","dao"],["label","T\xedtulo do documento","controlName","titulo_documento","disabled","","labelInfo","T\xedtulo do documento no Sei",3,"size","control"]],template:function(i,a){1&i&&e.DNE(0,_,15,16,"editable-form",4),2&i&&e.Y8G("ngIf",a.isSei||a.gb.isEmbedded)},dependencies:[n.bT,I.Q,F.O,g.E,C.H,j.F]})}}return s})();var w=u(3814);const V=["tipoAtividade"],Ee=["docEntregue"];function De(s,h){if(1&s&&(e.j41(0,"div",6),e.nrm(1,"input-number",15)(2,"input-datetime",16),e.k0s()),2&s){const t=e.XpG();e.R7$(),e.Y8G("size",6)("decimals",2),e.R7$(),e.Y8G("size",6)("label",t.lex.translate("Prazo de entrega"))("control",t.form.controls.data_estipulada_entrega)("labelInfo","Data estipulada para entrega da "+t.lex.translate("atividade"))}}function Ce(s,h){if(1&s&&(e.j41(0,"div",6),e.nrm(1,"input-timer",17)(2,"input-number",15)(3,"input-datetime",18),e.k0s()),2&s){const t=e.XpG();e.R7$(),e.Y8G("size",4)("label",t.lex.translate("Esfor\xe7o"))("control",t.form.controls.esforco),e.R7$(),e.Y8G("size",4)("decimals",2),e.R7$(),e.Y8G("size",4)("label",t.lex.translate("Prazo de entrega"))("control",t.form.controls.data_estipulada_entrega)("labelInfo","Data estipulada para entrega da "+t.lex.translate("atividade"))}}function Ie(s,h){if(1&s){const t=e.RV6();e.j41(0,"div",6),e.nrm(1,"input-datetime",19),e.j41(2,"input-datetime",20),e.bIt("change",function(a){e.eBV(t);const o=e.XpG();return e.Njj(o.onDataEntregaChange(a))}),e.k0s()()}if(2&s){const t=e.XpG();e.R7$(),e.Y8G("size",6)("control",t.form.controls.data_inicio)("labelInfo","Data em que o usu\xe1rio iniciou a "+t.lex.translate("atividade")),e.R7$(),e.Y8G("size",6)("control",t.form.controls.data_entrega)("labelInfo","Data da conclus\xe3o da "+t.lex.translate("atividade"))}}function Te(s,h){if(1&s){const t=e.RV6();e.j41(0,"div",6),e.nrm(1,"input-datetime",19),e.j41(2,"input-datetime",21),e.bIt("change",function(a){e.eBV(t);const o=e.XpG();return e.Njj(o.onDataEntregaChange(a))}),e.k0s(),e.nrm(3,"input-timer",22),e.k0s()}if(2&s){const t=e.XpG();e.R7$(),e.Y8G("size",4)("control",t.form.controls.data_inicio)("labelInfo","Data em que o usu\xe1rio iniciou a "+t.lex.translate("atividade")),e.R7$(),e.Y8G("size",4)("control",t.form.controls.data_entrega)("labelInfo","Data da conclus\xe3o da "+t.lex.translate("atividade")),e.R7$(),e.Y8G("size",4)("control",t.form.controls.tempo_despendido)("labelInfo","Calculado no fim da "+t.lex.translate("atividade")+", sendo o tempo l\xedquido (considerando pausas)")}}function Ae(s,h){if(1&s&&(e.j41(0,"separator",23),e.nrm(1,"calendar-efemerides",24),e.k0s()),2&s){const t=e.XpG();e.R7$(),e.Y8G("efemerides",t.efemerides)}}let Fe=(()=>{class s extends k.n{constructor(t){super(t,m.Y,y.R),this.injector=t,this.modalWidth=800,this.entregas=[],this.validate=(i,a)=>{let o=null;return("plano_trabalho_entrega_id"==a&&!i.value?.length||"data_entrega"==a&&!this.util.isDataValid(i.value))&&(o="Obrigat\xf3rio"),o},this.tipoAtividadeDao=t.get(U.f),this.tipoDocumentoDao=t.get(P.Y),this.calendar=t.get(N.I),this.title="Conclus\xe3o de "+this.lex.translate("atividade"),this.form=this.fh.FormBuilder({tipo_atividade_id:{default:null},data_distribuicao:{default:null},esforco:{default:0},progresso:{default:0},data_estipulada_entrega:{default:null},data_inicio:{default:null},tempo_despendido:{default:0},data_entrega:{default:null},arquivar:{default:!1},descricao_tecnica:{default:""},documento_entrega:{default:new S.j},documento_entrega_id:{default:null},plano_trabalho_entrega_id:{default:null}},this.cdRef,this.validate),this.join=["plano_trabalho.tipo_modalidade","unidade","plano_trabalho.entregas.plano_entrega_entrega:id,descricao"]}loadData(t,i){var a=this;return(0,v.A)(function*(){let o=Object.assign({},i.value);o=a.util.fillForm(o,t),o.data_entrega=a.auth.hora,o.progresso=100,yield a.tipoAtividade.loadSearch(t.tipo_atividade||o.tipo_atividade_id),t.unidade_id!=a.auth.unidade.id&&(yield a.auth.selecionaUnidade(t.unidade_id)),a.entregas=t.plano_trabalho?.entregas?.map(r=>Object.assign({},{key:r.id,value:r.descricao+(r.plano_entrega_entrega?" ("+r.plano_entrega_entrega?.descricao+")":""),data:r}))||[],o.arquivar=!1,i.patchValue(o),a.onDataEntregaChange()})()}initializeData(t){var i=this;return(0,v.A)(function*(){i.entity=yield i.dao.getAtividade(i.urlParams.get("id")),yield i.loadData(i.entity,t)})()}onDataEntregaChange(t){const i=this.form.controls.data_entrega.value,a=this.entity.data_inicio,o=this.entity.carga_horaria,r=this.entity.unidade,p=this.entity.pausas||[],b=this.entity.usuario?.afastamentos||[];this.efemerides=this.util.isDataValid(i)?this.calendar.calculaDataTempoUnidade(a,i,o,r,"ENTREGA",p,b):void 0,this.efemerides&&(this.form.controls.tempo_despendido.setValue(this.efemerides.tempoUtil),this.cdRef.detectChanges())}onTipoAtividadeSelect(t){const i=t.entity;this.form.controls.esforco.setValue(i?.esforco||0),this.cdRef.detectChanges()}saveData(t){return new Promise((i,a)=>{let o=this.util.fill(new m.Y,this.entity);o=this.util.fillForm(o,this.form.value),o.id=this.entity.id,o.descricao_tecnica=this.form.controls.descricao_tecnica.value,o.data_arquivamento=this.form.controls.arquivar.value?new Date:null,o.progresso=this.form.controls.progresso.value,o.produtividade=this.entity?.plano_trabalho?.tipo_modalidade?.atividade_tempo_despendido?this.calendar.produtividade(o.esforco,o.tempo_despendido):null,this.dao.concluir(o).then(r=>i(r)).catch(a)})}static{this.\u0275fac=function(i){return new(i||s)(e.rXU(e.zZn))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["app-atividade-form-concluir"]],viewQuery:function(i,a){if(1&i&&(e.GBs(V,5),e.GBs(Ee,5),e.GBs(I.Q,5)),2&i){let o;e.mGM(o=e.lsd())&&(a.tipoAtividade=o.first),e.mGM(o=e.lsd())&&(a.docEntregue=o.first),e.mGM(o=e.lsd())&&(a.editableForm=o.first)}},features:[e.Vt3],decls:19,vars:23,consts:[["tipoAtividade",""],["entrega",""],["comEsforco",""],["comTempoDespendido",""],["initialFocus","tipo_atividade_id",3,"submit","cancel","form","disabled"],[3,"documento"],[1,"row"],["controlName","tipo_atividade_id",3,"select","label","emptyValue","size","dao"],["controlName","plano_trabalho_entrega_id","required","",3,"label","size","control","items","labelInfo"],["label","Arquivar","controlName","arquivar","labelInfo","Arquivar automaticamente ap\xf3s a conclus\xe3o (Somente se o plano dispensar avalia\xe7\xe3o)",3,"size","control"],["collapse","",3,"title","collapsed"],["persist","",3,"atividade"],["class","row",4,"ngIf","ngIfElse"],["title","Conclus\xe3o"],["title","C\xe1lculos das horas","collapse","",4,"ngIf"],["label","Progresso","disabled","","sufix","%","icon","bi bi-clock","controlName","progresso","labelInfo","Progresso de execu\xe7\xe3o (% Conclu\xeddo). Sempre ser\xe1 100% na conclus\xe3o!",3,"size","decimals"],["noIcon","","controlName","data_estipulada_entrega",3,"size","label","control","labelInfo"],["icon","bi bi-stopwatch","onlyHours","","controlName","esforco","labelInfo","Tempo estimado de execu\xe7\xe3o",3,"size","label","control"],["noIcon","","disabled","","controlName","data_estipulada_entrega",3,"size","label","control","labelInfo"],["noIcon","","label","Inicio","controlName","data_inicio","disabled","",3,"size","control","labelInfo"],["noIcon","","label","Conclus\xe3o","controlName","data_entrega","required","",3,"change","size","control","labelInfo"],["noIcon","","label","Conclus\xe3o","controlName","data_entrega",3,"change","size","control","labelInfo"],["label","Tempo despendido","icon","bi bi-hourglass-bottom","controlName","tempo_despendido","disabled","",3,"size","control","labelInfo"],["title","C\xe1lculos das horas","collapse",""],[3,"efemerides"]],template:function(i,a){if(1&i){const o=e.RV6();e.j41(0,"editable-form",4),e.bIt("submit",function(){return e.eBV(o),e.Njj(a.onSaveData())})("cancel",function(){return e.eBV(o),e.Njj(a.onCancel())}),e.nrm(1,"documento-link",5),e.j41(2,"div",6)(3,"input-search",7,0),e.bIt("select",function(p){return e.eBV(o),e.Njj(a.onTipoAtividadeSelect(p))}),e.k0s(),e.nrm(5,"input-select",8,1)(7,"input-switch",9),e.k0s(),e.j41(8,"separator",10),e.nrm(9,"atividade-list-tarefa",11),e.k0s(),e.DNE(10,De,3,6,"div",12)(11,Ce,4,9,"ng-template",null,2,e.C5r),e.j41(13,"separator",13),e.DNE(14,Ie,3,6,"div",12)(15,Te,4,9,"ng-template",null,3,e.C5r),e.nrm(17,"documento-link",5),e.k0s(),e.DNE(18,Ae,2,1,"separator",14),e.k0s()}if(2&i){const o=e.sdS(12),r=e.sdS(16);e.Y8G("form",a.form)("disabled",a.formDisabled),e.R7$(),e.Y8G("documento",a.form.controls.documento_entrega.value),e.R7$(2),e.Y8G("label","Tipo de"+a.lex.translate("Atividade"))("emptyValue",null)("size",5)("dao",a.tipoAtividadeDao),e.R7$(2),e.Y8G("label",a.lex.translate("Entrega do plano"))("size",5)("control",a.form.controls.plano_trabalho_entrega_id)("items",a.entregas)("labelInfo",a.lex.translate("Entrega do plano")+" que a "+a.lex.translate("atividade")+" \xe9 referente"),e.R7$(2),e.Y8G("size",2)("control",a.form.controls.arquivar),e.R7$(),e.Y8G("title","Tarefa da "+a.lex.translate("atividade"))("collapsed",!1),e.R7$(),e.Y8G("atividade",a.entity),e.R7$(),e.Y8G("ngIf",!(null!=a.entity&&null!=a.entity.plano_trabalho&&null!=a.entity.plano_trabalho.tipo_modalidade&&a.entity.plano_trabalho.tipo_modalidade.atividade_esforco))("ngIfElse",o),e.R7$(4),e.Y8G("ngIf",!(null!=a.entity&&null!=a.entity.plano_trabalho&&null!=a.entity.plano_trabalho.tipo_modalidade&&a.entity.plano_trabalho.tipo_modalidade.atividade_tempo_despendido))("ngIfElse",r),e.R7$(3),e.Y8G("documento",a.form.controls.documento_entrega.value),e.R7$(),e.Y8G("ngIf",a.efemerides&&(null==a.entity||null==a.entity.plano_trabalho||null==a.entity.plano_trabalho.tipo_modalidade?null:a.entity.plano_trabalho.tipo_modalidade.atividade_tempo_despendido))}},dependencies:[n.bT,I.Q,G.S,F.O,R.r,O.K,q.r,j.F,$.n,B.D,T,w.A]})}}return s})();var ke=u(6395),ye=u(3214),ae=u(5917),Ge=u(3609),ie=u(5623),Q=u(158),W=u(2075),J=u(6774),Re=u(9089);const je=["documento"],Oe=["comentarios"],Se=["tipoTarefa"];let oe=(()=>{class s extends k.n{constructor(t){super(t,ae.N,ye.U),this.injector=t,this.modalWidth=800,this.validate=(i,a)=>{let o=null;return["descricao"].includes(a)&&!i.value?.length&&(o="Obrigat\xf3rio"),o},this.formValidation=i=>{const a=i.value;return a.tipo_tarefa_id?.length&&!this.tipoTarefa?.selectedEntity?"Aguarde o carregamento "+this.lex.translate("tipo de tarefa")+". Caso demore, selecione novamente!":a.concluido&&this.tipoTarefa?.selectedEntity?.documental&&this.documento?.isEmpty()?this.gb.isEmbedded?"Obrigat\xf3rio selecionar um arquivo para a tarefa selecionada!":"Utilize o sistema como extens\xe3o para concluir!":void 0},this.tipoTarefaDao=t.get(ke.h),this.tipoDocumentoDao=t.get(P.Y),this.tipoProcessoDao=t.get(L.W),this.allPages=t.get(M.v),this.comentario=t.get(ie.D),this.title=this.lex.translate("Tarefa da atividade"),this.form=this.fh.FormBuilder({descricao:{default:""},tipo_tarefa_id:{default:null},tempo_estimado:{default:0},concluido:{default:!0},id_processo:{default:0},numero_processo:{default:""},documento:{default:null},comentarios:{default:[]}},this.cdRef,this.validate)}ngOnInit(){super.ngOnInit();const t=(this.url?this.url[this.url.length-1]?.path:"")||"";this.action="comentar"==t?t:this.action}loadData(t,i){var a=this;return(0,v.A)(function*(){let o=Object.assign({},i.value);o=a.util.fillForm(o,t),yield a.tipoTarefa?.loadSearch(t.tipo_tarefa||o.tipo_tarefa_id),o.comentarios=a.comentario.orderComentarios(o.comentarios||[]),i.patchValue(o)})()}initializeData(t){var i=this;return(0,v.A)(function*(){i.entity=i.metadata.tarefa,i.atividade=i.metadata.atividade,i.sei=i.metadata.sei,yield i.loadData(i.entity,t)})()}saveData(t){var i=this;return(0,v.A)(function*(){return i.comentarios?.confirm(),i.util.fillForm(i.entity,i.form.value),i.entity.tipo_tarefa=i.tipoTarefa?.selectedEntity,i.entity.data_conclusao=i.form.controls.concluido.value&&!i.entity.data_conclusao?i.auth.hora:i.entity.data_conclusao,new Ge.p(i.entity)})()}onTipoTarefaSelect(t){const i=t.entity;this.form.controls.tempo_estimado.setValue(i?.tempo_estimado||0)}static{this.\u0275fac=function(i){return new(i||s)(e.rXU(e.zZn))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["app-atividade-form-tarefa"]],viewQuery:function(i,a){if(1&i&&(e.GBs(I.Q,5),e.GBs(je,5),e.GBs(Oe,5),e.GBs(Se,5)),2&i){let o;e.mGM(o=e.lsd())&&(a.editableForm=o.first),e.mGM(o=e.lsd())&&(a.documento=o.first),e.mGM(o=e.lsd())&&(a.comentarios=o.first),e.mGM(o=e.lsd())&&(a.tipoTarefa=o.first)}},features:[e.Vt3],decls:15,vars:16,consts:[["tipoTarefa",""],["documento",""],["comentarios",""],["initialFocus","descricao",3,"submit","cancel","form","disabled"],["display","","right","",3,"title"],["key","TAREFA",3,"label"],[1,"row"],["label","Descri\xe7\xe3o","controlName","descricao","required","",3,"size","rows","control"],["controlName","tipo_tarefa_id",3,"select","label","size","control","dao"],["label","Conclu\xeddo","controlName","concluido","labelInfo","Se foi conclu\xedda",3,"size","control"],[3,"sei","documento"],["key","COMENTARIOS","label","Comentarios"],["clss","row"],["origem","ATIVIDADE_TAREFA",3,"control"]],template:function(i,a){if(1&i){const o=e.RV6();e.j41(0,"editable-form",3),e.bIt("submit",function(){return e.eBV(o),e.Njj(a.onSaveData())})("cancel",function(){return e.eBV(o),e.Njj(a.onCancel())}),e.j41(1,"tabs",4)(2,"tab",5)(3,"div",6),e.nrm(4,"input-textarea",7),e.k0s(),e.j41(5,"div",6)(6,"input-search",8,0),e.bIt("select",function(p){return e.eBV(o),e.Njj(a.onTipoTarefaSelect(p))}),e.k0s(),e.nrm(8,"input-switch",9),e.k0s(),e.nrm(9,"documento-link",10,1),e.k0s(),e.j41(11,"tab",11)(12,"div",12),e.nrm(13,"comentarios",13,2),e.k0s()()()()}2&i&&(e.Y8G("form",a.form)("disabled",a.formDisabled),e.R7$(),e.Y8G("title",a.isModal?"":a.title),e.R7$(),e.Y8G("label",a.lex.translate("Tarefa da Atividade")),e.R7$(2),e.Y8G("size",12)("rows",2)("control",a.form.controls.descricao),e.R7$(2),e.Y8G("label",a.lex.translate("Tipo de Tarefa"))("size",10)("control",a.form.controls.tipo_tarefa_id)("dao",a.tipoTarefaDao),e.R7$(2),e.Y8G("size",2)("control",a.form.controls.concluido),e.R7$(),e.Y8G("sei",a.sei)("documento",a.form.controls.documento.value),e.R7$(4),e.Y8G("control",a.form.controls.comentarios))},dependencies:[I.Q,G.S,F.O,Q.S,W.O,J.j,Re.a,T],styles:['@charset "UTF-8";.comentario-table[_ngcontent-%COMP%]{width:100%}.comentario-user[_ngcontent-%COMP%]{width:50px;vertical-align:top;padding:8px}.comentario-container[_ngcontent-%COMP%]{padding-left:10px;width:auto;border-left:var(--bs-gray-400) 2px solid;position:relative}.comentario-user-indicator[_ngcontent-%COMP%]{content:"";position:absolute;width:0px;height:0px;top:0;left:-12px;border-top:.75rem solid var(--bs-gray-400);border-left:.75rem solid transparent;border-bottom:none;border-right:none}.comentario-level[_ngcontent-%COMP%]{color:var(--bs-gray)}.comentario-message-title[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:.7em;color:var(--bs-gray)}.comentario-message-title[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:before{content:" \\2022  "}']})}}return s})();var ne=u(5413),se=u(6867);const Ne=["usuario"],Pe=["planoTrabalho"],$e=["planejado"],Ve=()=>["planos_trabalho.tipo_modalidade:id,nome","planos_trabalho.entregas.entrega:id,nome"];let Ye=(()=>{class s extends k.n{get labelInfoSuspender(){const t=this.lex.translate(this.iniciadas.length>1?"tarefas":"tarefa"),i=1==this.iniciadas.length?"":"s",a=1==this.iniciadas.length?"":" "+this.iniciadas.length.toString();return this.iniciadas.length?`Suspender a${i}${a} ${t} j\xe1 iniciada${i}?`:"N\xe3o h\xe1 outras atividades iniciadas pelo usu\xe1rio!"}constructor(t){super(t,m.Y,y.R),this.injector=t,this.modalWidth=600,this.iniciadas=[],this.planoTrabalhoSelecionado=null,this.planosTrabalhos=[],this.planosTrabalhosEntregas=[],this.planoTrabalhoJoin=["entregas.plano_entrega_entrega:id,descricao","tipo_modalidade:id,nome"],this.validate=(i,a)=>{let o=null;return(["usuario_id","plano_trabalho_id","plano_trabalho_entrega_id"].includes(a)&&!i.value?.length||"data_inicio"==a&&!i.value)&&(o="Obrigat\xf3rio"),o},this.formValidation=i=>{let a;return this.planoTrabalhoSelecionado&&(this.util.asTimestamp(this.form.controls.data_inicio.value)<this.util.asTimestamp(this.planoTrabalhoSelecionado.data_inicio)||this.util.asTimestamp(this.form.controls.data_inicio.value)>this.util.asTimestamp(this.planoTrabalhoSelecionado.data_fim))&&(a="Data de in\xedcio fora do per\xedodo do plano de trabalho ("+this.util.getDateFormatted(this.planoTrabalhoSelecionado.data_inicio)+" at\xe9 "+this.util.getDateFormatted(this.planoTrabalhoSelecionado.data_fim)+") [RN_ATV_6]"),a},this.usuarioDao=t.get(ne._),this.planoTrabalhoDao=t.get(se.x),this.calendar=t.get(N.I),this.form=this.fh.FormBuilder({usuario_id:{default:void 0},plano_trabalho_id:{default:void 0},plano_trabalho_entrega_id:{default:void 0},data_distribuicao:{default:new Date},data_estipulada_entrega:{default:new Date},carga_horaria:{default:0},tempo_planejado:{default:0},esforco:{default:0},data_inicio:{default:null},suspender:{default:!1}},this.cdRef,this.validate),this.join=["unidade","atividade","usuario.planos_trabalho.tipo_modalidade"]}loadIniciadas(t){this.iniciadas=[],t?.length&&this.dao.iniciadas(t).then(i=>{this.iniciadas=i,this.cdRef.detectChanges()})}onUsuarioSelect(t){this.planosTrabalhos=(t.entity?.planos_trabalho||[]).filter(o=>o.unidade_id==this.entity.unidade_id).map(o=>({key:o.id,value:(o.tipo_modalidade?.nome||"")+" - "+this.dao.getDateFormatted(o.data_inicio)+" \xe0 "+this.dao.getDateFormatted(o.data_fim),data:o})),this.cdRef.detectChanges(),!this.form.controls.plano_trabalho_id.value?.length&&1==this.planosTrabalhos.length&&this.form.controls.plano_trabalho_id.setValue(this.planosTrabalhos[0].key),this.cdRef.detectChanges()}onPlanoChange(t){var i=this;(0,v.A)(function*(){if(i.entity&&i.planoTrabalho?.selectedItem?.data){const a=i.planoTrabalho?.selectedItem?.data;i.planoTrabalhoSelecionado?.id!=a.id&&(i.planoTrabalhoSelecionado=yield i.planoTrabalhoDao.getById(a.id,i.planoTrabalhoJoin));const o=a?.carga_horaria||i.calendar.expedienteMedio(i.entity.unidade),r=i.calendar.horasUteis(i.form.controls.data_distribuicao.value,i.form.controls.data_estipulada_entrega.value,o,i.entity.unidade,"DISTRIBUICAO");i.form.controls.carga_horaria.setValue(o),i.form.controls.tempo_planejado.setValue(r),i.form.controls.esforco.setValue(i.form.controls.esforco.value||i.entity?.tipo_atividade?.esforco||0);const p=i.form.controls.plano_trabalho_entrega_id.value;i.planosTrabalhosEntregas=i.planoTrabalhoSelecionado?.entregas?.map(b=>Object.assign({},{key:b.id,value:b.descricao+(b.plano_entrega_entrega?" ("+b.plano_entrega_entrega?.descricao+")":""),data:b}))||[],i.cdRef.detectChanges(),i.form.controls.plano_trabalho_entrega_id.setValue(!p?.length&&i.planosTrabalhos.length>0?i.planosTrabalhos[0].key:p)}})()}loadData(t,i){var a=this;return(0,v.A)(function*(){let o=Object.assign({},i.value);o=a.util.fillForm(o,t),o.usuario_id?.length||(o.usuario_id=a.auth.usuario?.id),o.data_inicio=o.data_inicio||a.util.setStrTime(new Date,a.auth.unidadeHora),yield a.usuario.loadSearch(t.usuario||o.usuario_id),a.loadIniciadas(o.usuario_id),t.unidade_id!=a.auth.unidade.id&&(yield a.auth.selecionaUnidade(t.unidade_id)),i.patchValue(o),a.onPlanoChange(new Event("change"))})()}initializeData(t){var i=this;return(0,v.A)(function*(){i.entity=yield i.dao.getById(i.urlParams.get("id"),i.join),yield i.loadData(i.entity,t)})()}saveData(t){return new Promise((i,a)=>{let o=this.util.fill(new m.Y,this.entity);o=this.util.fillForm(o,this.form.value),o.id=this.entity.id,o.suspender=this.form.controls.suspender.value,this.dao.iniciar(o).then(r=>i(r)).catch(a)})}static{this.\u0275fac=function(i){return new(i||s)(e.rXU(e.zZn))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["app-atividade-form-iniciar"]],viewQuery:function(i,a){if(1&i&&(e.GBs(I.Q,5),e.GBs(Ne,5),e.GBs(Pe,5),e.GBs($e,5)),2&i){let o;e.mGM(o=e.lsd())&&(a.editableForm=o.first),e.mGM(o=e.lsd())&&(a.usuario=o.first),e.mGM(o=e.lsd())&&(a.planoTrabalho=o.first),e.mGM(o=e.lsd())&&(a.planejado=o.first)}},features:[e.Vt3],decls:17,vars:28,consts:[["usuario",""],["planoTrabalho",""],["entrega",""],["initialFocus","data_distribuicao",3,"submit","cancel","form","disabled"],[1,"row"],["controlName","data_distribuicao","disabled","","labelInfo","Data de cadastro da atividade",3,"size","label","control"],["controlName","data_estipulada_entrega","disabled","","labelInfo","Data estipulada para entrega da atividade",3,"size","label","control"],["label","Respons\xe1vel","controlName","usuario_id","labelInfo","Respons\xe1vel por executar a atividade","required","",3,"select","size","dao","join"],["controlName","plano_trabalho_id","required","",3,"change","label","size","control","items","labelInfo"],["controlName","plano_trabalho_entrega_id","required","",3,"label","size","control","items","labelInfo"],["label","Inicio","controlName","data_inicio","labelInfo","Data em que o usu\xe1rio iniciou a atividade","required","",3,"size","control"],["label","Suspender as demais","controlName","suspender",3,"size","control","disabled","labelInfo"]],template:function(i,a){if(1&i){const o=e.RV6();e.j41(0,"editable-form",3),e.bIt("submit",function(){return e.eBV(o),e.Njj(a.onSaveData())})("cancel",function(){return e.eBV(o),e.Njj(a.onCancel())}),e.j41(1,"div",4),e.nrm(2,"input-datetime",5)(3,"input-datetime",6),e.k0s(),e.nrm(4,"separator"),e.j41(5,"div",4)(6,"input-search",7,0),e.bIt("select",function(p){return e.eBV(o),e.Njj(a.onUsuarioSelect(p))}),e.k0s()(),e.j41(8,"div",4)(9,"input-select",8,1),e.bIt("change",function(p){return e.eBV(o),e.Njj(a.onPlanoChange(p))}),e.k0s(),e.nrm(11,"input-select",9,2),e.k0s(),e.nrm(13,"separator"),e.j41(14,"div",4),e.nrm(15,"input-datetime",10)(16,"input-switch",11),e.k0s()()}2&i&&(e.Y8G("form",a.form)("disabled",a.formDisabled),e.R7$(2),e.Y8G("size",6)("label",a.lex.translate("Data de distribui\xe7\xe3o"))("control",a.form.controls.data_distribuicao),e.R7$(),e.Y8G("size",6)("label",a.lex.translate("Prazo de entrega"))("control",a.form.controls.data_estipulada_entrega),e.R7$(3),e.Y8G("size",12)("dao",a.usuarioDao)("join",e.lJ4(27,Ve)),e.R7$(3),e.Y8G("label",a.lex.translate("Plano de trabalho"))("size",7)("control",a.form.controls.plano_trabalho_id)("items",a.planosTrabalhos)("labelInfo",a.lex.translate("Plano de trabalho")),e.R7$(2),e.Y8G("label",a.lex.translate("Entrega do plano"))("size",5)("control",a.form.controls.plano_trabalho_entrega_id)("items",a.planosTrabalhosEntregas)("labelInfo",a.lex.translate("Entrega")+" do "+a.lex.translate("plano de trabalho")+" que a "+a.lex.translate("atividade")+" \xe9 referente"),e.R7$(4),e.Y8G("size",6)("control",a.form.controls.data_inicio),e.R7$(),e.Y8G("size",6)("control",a.form.controls.suspender)("disabled",a.iniciadas.length?void 0:"")("labelInfo",a.labelInfoSuspender))},dependencies:[I.Q,G.S,F.O,R.r,O.K,j.F]})}}return s})();var ze=u(9209);function Ue(s,h){1&s&&e.nrm(0,"top-alert",5)}function qe(s,h){if(1&s&&(e.j41(0,"div",3),e.nrm(1,"input-datetime",6),e.k0s()),2&s){const t=e.XpG();e.R7$(),e.Y8G("size",12)("control",t.form.controls.data_inicio)}}let Be=(()=>{class s extends k.n{constructor(t){super(t,m.Y,y.R),this.injector=t,this.reiniciar=!1,this.modalWidth=400,this.validate=(i,a)=>{let o=null,r=this.entity?.pausas?.find(p=>!p.data_fim);return"data"==a&&(this.reiniciar&&!r?o="N\xe3o \xe1 pausa!":this.util.isDataValid(i.value)?r&&this.entity&&i.value.getTime()<this.entity.data_inicio.getTime()&&(o="Menor que in\xedcio!"):o="Obrigat\xf3rio"),o},this.form=this.fh.FormBuilder({data_inicio:{default:void 0},data:{default:new Date}},this.cdRef,this.validate)}ngAfterViewInit(){this.reiniciar=!!this.queryParams?.reiniciar,this.title=this.reiniciar?"Reiniciar":"Suspender",super.ngAfterViewInit()}loadData(t,i){var a=this;return(0,v.A)(function*(){let o=a.entity?.pausas?.find(p=>!p.data_fim);a.reiniciar&&!o&&a.error("N\xe3o h\xe1 pausa ativa para ser reiniciada.");let r={inicio:a.reiniciar?o?.data_inicio:void 0,data:a.util.setStrTime(new Date,a.auth.unidadeHora)};t.unidade_id!=a.auth.unidade.id&&(yield a.auth.selecionaUnidade(t.unidade_id)),i.patchValue(r)})()}initializeData(t){var i=this;return(0,v.A)(function*(){i.entity=yield i.dao.getAtividade(i.urlParams.get("id")),yield i.loadData(i.entity,t)})()}saveData(t){return new Promise((i,a)=>{let o={atividade_id:this.entity.id,data:this.form.controls.data.value};this.reiniciar?this.dao.reiniciar(o).then(r=>i(r)).catch(a):this.dao.pausar(o).then(r=>i(r)).catch(a)})}static{this.\u0275fac=function(i){return new(i||s)(e.rXU(e.zZn))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["app-atividade-form-pausar"]],viewQuery:function(i,a){if(1&i&&e.GBs(I.Q,5),2&i){let o;e.mGM(o=e.lsd())&&(a.editableForm=o.first)}},features:[e.Vt3],decls:5,vars:8,consts:[["type","warning","message","Dica: N\xe3o \xe9 necess\xe1rio suspender a tarefa entre as jornadas de trabalho!",4,"ngIf"],["initialFocus","data",3,"submit","cancel","form","disabled"],["class","row",4,"ngIf"],[1,"row"],["controlName","data","required","",3,"size","label","control","labelInfo"],["type","warning","message","Dica: N\xe3o \xe9 necess\xe1rio suspender a tarefa entre as jornadas de trabalho!"],["label","In\xedcio da pausa","controlName","data_inicio","disabled","","labelInfo","Data de in\xedcio da \xfaltima pausa",3,"size","control"]],template:function(i,a){1&i&&(e.DNE(0,Ue,1,0,"top-alert",0),e.j41(1,"editable-form",1),e.bIt("submit",function(){return a.onSaveData()})("cancel",function(){return a.onCancel()}),e.DNE(2,qe,2,2,"div",2),e.j41(3,"div",3),e.nrm(4,"input-datetime",4),e.k0s()()),2&i&&(e.Y8G("ngIf",!a.reiniciar),e.R7$(),e.Y8G("form",a.form)("disabled",a.formDisabled),e.R7$(),e.Y8G("ngIf",a.reiniciar),e.R7$(2),e.Y8G("size",12)("label",a.reiniciar?"Data de rein\xedcio":"Data da pausa")("control",a.form.controls.data)("labelInfo",a.reiniciar?"Data e hora do rein\xedcio da atividade":"Data e hora do in\xedcio da pausa/suspens\xe3o"))},dependencies:[n.bT,I.Q,R.r,ze.P]})}}return s})(),Le=(()=>{class s extends k.n{constructor(t){super(t,m.Y,y.R),this.injector=t,this.modalWidth=400,this.validate=(i,a)=>{let o=null;return"data_estipulada_entrega"==a&&(this.util.isDataValid(i.value)?this.entity?.data_distribuicao&&i.value.getTime()<this.entity.data_distribuicao.getTime()&&(o="Menor que distribui\xe7\xe3o!"):o="Obrigat\xf3rio"),o},this.form=this.fh.FormBuilder({data_distribuicao:{default:new Date},data_estipulada_entrega:{default:new Date}},this.cdRef,this.validate)}loadData(t,i){var a=this;return(0,v.A)(function*(){let o={data_distribuicao:t.data_distribuicao,data_estipulada_entrega:t.data_estipulada_entrega};t.unidade_id!=a.auth.unidade.id&&(yield a.auth.selecionaUnidade(t.unidade_id)),i.patchValue(o)})()}initializeData(t){var i=this;return(0,v.A)(function*(){i.entity=yield i.dao.getAtividade(i.urlParams.get("id")),yield i.loadData(i.entity,t)})()}saveData(t){return new Promise((i,a)=>{this.dao.prorrogar({id:this.entity.id,data_estipulada_entrega:this.form.controls.data_estipulada_entrega.value}).then(r=>i(r)).catch(a)})}static{this.\u0275fac=function(i){return new(i||s)(e.rXU(e.zZn))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["app-atividade-form-prorrogar"]],viewQuery:function(i,a){if(1&i&&e.GBs(I.Q,5),2&i){let o;e.mGM(o=e.lsd())&&(a.editableForm=o.first)}},features:[e.Vt3],decls:5,vars:7,consts:[["initialFocus","data_estipulada_entrega",3,"submit","cancel","form","disabled"],[1,"row"],["label","Data da distribui\xe7\xe3o","controlName","data_distribuicao","disabled","","labelInfo","Data de distribui\xe7\xe3o da atividade",3,"size","control"],["controlName","data_estipulada_entrega","labelInfo","Prazo para entrega da atividade","required","",3,"size","label","control"]],template:function(i,a){1&i&&(e.j41(0,"editable-form",0),e.bIt("submit",function(){return a.onSaveData()})("cancel",function(){return a.onCancel()}),e.j41(1,"div",1),e.nrm(2,"input-datetime",2),e.k0s(),e.j41(3,"div",1),e.nrm(4,"input-datetime",3),e.k0s()()),2&i&&(e.Y8G("form",a.form)("disabled",a.formDisabled),e.R7$(2),e.Y8G("size",12)("control",a.form.controls.data_distribuicao),e.R7$(2),e.Y8G("size",12)("label",a.lex.translate("Prazo de entrega"))("control",a.form.controls.data_estipulada_entrega))},dependencies:[I.Q,R.r]})}}return s})();var Me=u(3535),we=u(2464),He=u(976);const Xe=["etiqueta"],xe=["tipoAtividade"],Ke=["planoTrabalho"],Qe=["unidade"],We=["usuario"],Je=["comentarios"],Ze=["requisicao"];function et(s,h){if(1&s&&e.nrm(0,"input-switch",23),2&s){const t=e.XpG();e.Y8G("size",1)("disabled",t.form.controls.concluido.value?"true":void 0)}}function tt(s,h){if(1&s){const t=e.RV6();e.j41(0,"input-switch",24),e.bIt("change",function(a){e.eBV(t);const o=e.XpG();return e.Njj(o.onConcluidoChange(a))}),e.k0s()}2&s&&e.Y8G("size",1)}function at(s,h){if(1&s){const t=e.RV6();e.j41(0,"div",12)(1,"input-datetime",25),e.bIt("change",function(a){e.eBV(t);const o=e.XpG();return e.Njj(o.onDataDistribuicaoChange(a))}),e.k0s(),e.nrm(2,"input-number",26),e.j41(3,"input-datetime",27),e.bIt("change",function(a){e.eBV(t);const o=e.XpG();return e.Njj(o.onPrazoEntregaChange(a))}),e.k0s()()}if(2&s){const t=e.XpG();e.R7$(),e.Y8G("size",4)("label",t.lex.translate("Data de distribui\xe7\xe3o"))("control",t.form.controls.data_distribuicao),e.R7$(),e.Y8G("size",4)("decimals",2),e.R7$(),e.Y8G("size",4)("label",t.lex.translate("Prazo de entrega"))("control",t.form.controls.data_estipulada_entrega)}}function it(s,h){if(1&s){const t=e.RV6();e.j41(0,"div",12)(1,"input-datetime",25),e.bIt("change",function(a){e.eBV(t);const o=e.XpG();return e.Njj(o.onDataDistribuicaoChange(a))}),e.k0s(),e.nrm(2,"input-timer",28)(3,"input-number",26),e.j41(4,"input-datetime",27),e.bIt("change",function(a){e.eBV(t);const o=e.XpG();return e.Njj(o.onPrazoEntregaChange(a))}),e.k0s()()}if(2&s){const t=e.XpG();e.R7$(),e.Y8G("size",3)("label",t.lex.translate("Data de distribui\xe7\xe3o"))("control",t.form.controls.data_distribuicao),e.R7$(),e.Y8G("size",3)("label",t.lex.translate("Esfor\xe7o"))("control",t.form.controls.esforco),e.R7$(),e.Y8G("size",3)("decimals",2),e.R7$(),e.Y8G("size",3)("label",t.lex.translate("Prazo de entrega"))("control",t.form.controls.data_estipulada_entrega)}}function ot(s,h){if(1&s&&(e.j41(0,"div",12),e.nrm(1,"input-datetime",31)(2,"input-datetime",32)(3,"input-datetime",33),e.k0s()),2&s){const t=e.XpG(2);e.R7$(),e.Y8G("size",4)("control",t.form.controls.data_inicio),e.R7$(),e.Y8G("size",4)("control",t.form.controls.data_entrega),e.R7$(),e.Y8G("size",4)("control",t.form.controls.data_inicio)}}function nt(s,h){if(1&s&&(e.j41(0,"div",12),e.nrm(1,"input-datetime",31)(2,"input-datetime",32)(3,"input-timer",34)(4,"input-datetime",33),e.k0s()),2&s){const t=e.XpG(2);e.R7$(),e.Y8G("size",4)("control",t.form.controls.data_inicio),e.R7$(),e.Y8G("size",4)("control",t.form.controls.data_entrega),e.R7$(),e.Y8G("size",4)("control",t.form.controls.tempo_despendido),e.R7$(),e.Y8G("size",4)("control",t.form.controls.data_inicio)}}function st(s,h){if(1&s&&(e.j41(0,"separator",29),e.DNE(1,ot,4,6,"div",21)(2,nt,5,8,"ng-template",null,7,e.C5r),e.nrm(4,"documento-link",30),e.k0s()),2&s){const t=e.sdS(3),i=e.XpG(),a=e.sdS(18);e.R7$(),e.Y8G("ngIf",!(null!=a&&null!=a.selectedItem&&null!=a.selectedItem.data&&null!=a.selectedItem.data.tipo_modalidade&&a.selectedItem.data.tipo_modalidade.atividade_tempo_despendido))("ngIfElse",t),e.R7$(3),e.Y8G("documento",i.form.controls.documento_entrega.value)}}let x=(()=>{class s extends k.n{constructor(t){super(t,m.Y,y.R),this.injector=t,this.etiquetas=[],this.checklist=[],this.planosTrabalhos=[],this.planoTrabalhoJoin=["entregas.plano_entrega_entrega:id,descricao","tipo_modalidade:id,nome"],this.planoTrabalhoSelecionado=null,this.usuarioJoin=["planos_trabalho.entregas.plano_entrega_entrega:id,descricao","planos_trabalho.tipo_modalidade:id,nome"],this.entregas=[],this.validateChecklist=(a,o)=>null,this.validate=(a,o)=>{let r=null;if(["unidade_id","descricao"].includes(o)&&!a?.value?.length)r="Obrigat\xf3rio";else if("tipo_atividade_id"!=o||a?.value?.length||this.auth.hasPermissionTo("MOD_ATV_TIPO_ATV_VAZIO"))if(["data_distribuicao","data_estipulada_entrega"].includes(o)){let p=this.form?.controls.data_estipulada_entrega?.value,b=this.form?.controls.data_distribuicao?.value;this.util.isDataValid(a.value)?"data_distribuicao"==o&&a.value&&this.util.isDataValid(p)&&a.value.getTime()>p.getTime()?r="Maior que entrega":"data_estipulada_entrega"==o&&a.value&&this.util.isDataValid(b)&&a.value.getTime()<b.getTime()&&(r="Menor que distribui\xe7\xe3o"):r="Data inv\xe1lida"}else"plano_trabalho_id"==o&&!a.value?.length&&this.form?.controls?.usuario_id.value?.length?r="Obrigat\xf3rio":"plano_trabalho_entrega_id"==o&&(this.form?.controls?.plano_trabalho_id.value?.length&&!a.value?.length?r="Obrigat\xf3rio":a.value?.length&&!this.entregas.find(p=>p.key==a.value)&&(r="Selecione"));else r="Obrigat\xf3rio";return r},this.formValidation=a=>{let o;if(this.loadEtiquetas(),this.form.controls.tipo_atividade_id.value){let A=this.tipoAtividade?.selectedEntity.checklist;A&&this.form.controls.checklist.value.length==A.length&&this.loadChecklist()}const r=this.etiquetas.map(A=>A.key),p=this.checklist.map(A=>A.id),b=(this.form.controls.etiquetas.value||[]).find(A=>!r.includes(A.key)),K=(this.form.controls.checklist.value||[]).find(A=>!p.includes(A.id)&&A.checked);return b&&(o="Etiqueta "+b.value+"n\xe3o pode ser utilizada!"),K&&(o="Checklist "+K.texto+"n\xe3o pode ser utilizado!"),this.planoTrabalhoSelecionado&&(this.util.asTimestamp(this.form.controls.data_distribuicao.value)<this.util.asTimestamp(this.planoTrabalhoSelecionado.data_inicio)||this.util.asTimestamp(this.form.controls.data_estipulada_entrega.value)>this.util.asTimestamp(this.planoTrabalhoSelecionado.data_fim))&&(o="A atividade dever\xe1 ter per\xeddo compat\xedvel com o do plano de trabalho ("+this.util.getDateFormatted(this.planoTrabalhoSelecionado.data_inicio)+" at\xe9 "+this.util.getDateFormatted(this.planoTrabalhoSelecionado.data_fim)+") [RN_ATV_5]"),o};const i=this.auth.hora;this.tipoAtividadeDao=t.get(U.f),this.unidadeDao=t.get(Me.s),this.usuarioDao=t.get(ne._),this.planoTrabalhoDao=t.get(se.x),this.atividadeService=t.get(we.h),this.unidadeService=t.get(He.S),this.calendar=t.get(N.I),this.comentario=t.get(ie.D),this.title="Inclus\xe3o de "+this.lex.translate("Atividade"),this.form=this.fh.FormBuilder({numero:{default:0},descricao:{default:""},data_distribuicao:{default:i},carga_horaria:{default:0},tempo_planejado:{default:0},data_estipulada_entrega:{default:i},data_inicio:{default:null},data_entrega:{default:null},esforco:{default:0},tempo_despendido:{default:0},data_arquivamento:{default:null},etiquetas:{default:[]},checklist:{default:[]},prioridade:{default:0},progresso:{default:0},plano_trabalho_id:{default:null},plano_trabalho_entrega_id:{default:null},tipo_atividade_id:{default:null},demandante_id:{default:""},usuario_id:{default:null},unidade_id:{default:""},documento_requisicao_id:{default:null},documento_entrega_id:{default:null},comentarios:{default:[]},pausas:{default:[]},etiqueta:{default:""},tarefas:{default:[]},iniciado:{default:!1},concluido:{default:!1},documento_requisicao:{default:void 0},documento_entrega:{default:void 0}},this.cdRef,this.validate),this.formChecklist=this.fh.FormBuilder({id:{default:""},texto:{default:""},checked:{default:!1}},this.cdRef,this.validateChecklist),this.join=["usuario.planos_trabalho.tipo_modalidade:id,nome","pausas","tipo_atividade","unidade","comentarios.usuario","tarefas.tipo_tarefa","tarefas.comentarios.usuario","documento_requisicao","documento_entrega"]}ngOnInit(){super.ngOnInit();const t=(this.url?this.url[this.url.length-1]?.path:"")||"";this.action=["comentar","clonar"].includes(t)?t:this.action}get isClonar(){return"clonar"==this.action}get titleAtividade(){return this.form?.controls.numero?.value?"#"+this.form?.controls.numero?.value:""}addItemHandleEtiquetas(){let t;if(this.etiqueta&&this.etiqueta.selectedItem){const i=this.etiqueta.selectedItem,a=i.key?.length?i.key:this.util.textHash(i.value);this.util.validateLookupItem(this.form.controls.etiquetas.value,a)&&(t={key:a,value:i.value,color:i.color,icon:i.icon},this.form.controls.etiqueta.setValue(""))}return t}onUnidadeChange(t){this.loadEtiquetas()}onDataDistribuicaoChange(t){this.loadUsuario(this.usuario?.selectedEntity),this.form?.controls.data_estipulada_entrega.updateValueAndValidity()}onPrazoEntregaChange(t){this.form?.controls.data_distribuicao.updateValueAndValidity()}onPlanoTrabalhoChange(t){var i=this;(0,v.A)(function*(){if(i.entity){const a=i.usuario?.selectedEntity?.planos_trabalho?.find(o=>o.id==i.form.controls.plano_trabalho_id.value);if(a){if(i.planoTrabalhoSelecionado?.id!=a.id&&(i.planoTrabalhoSelecionado=yield i.planoTrabalhoDao.getById(a.id,i.planoTrabalhoJoin)),i.form.controls.unidade_id.value!=a.unidade_id){const r=yield i.unidadeDao.getById(a.unidade_id);r&&(yield i.unidade?.loadSearch(r),yield i.auth.selecionaUnidade(r.id))}const o=i.form.controls.plano_trabalho_entrega_id.value;i.entregas=i.planoTrabalhoSelecionado?.entregas?.map(r=>Object.assign({},{key:r.id,value:r.descricao+(r.plano_entrega_entrega?" ("+r.plano_entrega_entrega?.descricao+")":""),data:r}))||[],i.cdRef.detectChanges(),i.form.controls.plano_trabalho_entrega_id.setValue(!o?.length&&i.entregas.length>0?i.entregas[0].key:o)}else i.entregas=[],i.form.controls.plano_trabalho_entrega_id.setValue(null)}})()}loadEtiquetas(){this.etiquetas=this.atividadeService.buildEtiquetas(this.unidade?.selectedEntity,this.tipoAtividade?.selectedEntity)}loadChecklist(){const t=this.tipoAtividade?.selectedEntity;let i=t.checklist?.map(a=>({id:a.key,texto:a.value,checked:!1}));this.checklist=i||[],this.form.controls.checklist.setValue(i),this.atividadeService.buildChecklist(t,this.form.controls.checklist)}loadTipoAtividade(t){t?(this.loadEtiquetas(),this.loadChecklist()):(this.etiquetas=[],this.form.controls.esforco.setValue(0),this.form.controls.tempo_planejado.setValue(0)),this.cdRef.detectChanges()}getPlanosTrabalhos(t,i,a){return t.planos_trabalho?.filter(o=>o.id==a||this.util.between(i,{start:o.data_inicio,end:o.data_fim})&&"ATIVO"==o.status).map(o=>Object.assign({key:o.id,value:(o.tipo_modalidade?.nome||"")+" - "+this.usuarioDao.getDateFormatted(o.data_inicio)+" a "+this.usuarioDao.getDateFormatted(o.data_fim),data:o}))||[]}loadUsuario(t){if(t){const i=this.form.controls.plano_trabalho_id.value;this.planosTrabalhos=this.getPlanosTrabalhos(t,this.form.controls.data_distribuicao.value||new Date,i),this.hasUsuarioActionNew&&this.auth.usuario.id==this.form.controls.usuario_id.value&&this.form.controls.iniciado.setValue(!0),this.cdRef.detectChanges(),this.form.controls.plano_trabalho_id.setValue(!i?.length&&this.planosTrabalhos.length>0?this.planosTrabalhos[0].key:i)}else this.planosTrabalhos=[],this.form.controls.plano_trabalho_id.setValue(null);this.cdRef.detectChanges()}get hasUsuarioActionNew(){return this.form?.controls.usuario_id?.value?.length&&"new"==this.action}onTipoAtividadeSelect(t){const i=t.entity;this.loadTipoAtividade(i),this.atividadeService.comentarioAtividade(i,this.form.controls.comentarios),this.cdRef.detectChanges()}onTipoAtividadeChange(t){this.form?.controls.tipo_atividade_id.value?.length||this.loadTipoAtividade(void 0)}onUsuarioSelect(t){this.loadUsuario(t.entity)}onUsuarioChange(t){this.form?.controls.usuario_id.value?.length||this.loadUsuario(void 0)}onConcluidoChange(t){this.hasUsuarioActionNew&&this.form.controls.concluido.value?(this.form.controls.iniciado.setValue(!0),this.form.controls.progresso.setValue(100)):this.form.controls.progresso.setValue(0)}orderPausas(t){return t.sort((i,a)=>i.data_inicio<a.data_inicio?-1:1)}loadData(t,i){var a=this;return(0,v.A)(function*(){let o=Object.assign({},i.value);o=a.util.fillForm(o,t),a.planoTrabalhoSelecionado=t.plano_trabalho,yield Promise.all([a.unidade?.loadSearch(t.unidade||o.unidade_id,!1),a.usuario?.loadSearch(t.usuario||o.usuario_id,!1),a.tipoAtividade?.loadSearch(t.tipo_atividade||o.tipo_atividade_id,!1)]),i.patchValue(o,{emitEvent:!1}),t.usuario&&a.loadUsuario(t.usuario),t.tipo_atividade&&a.loadTipoAtividade(t.tipo_atividade),t.unidade_id!=a.auth.unidade.id&&(yield a.auth.selecionaUnidade(t.unidade_id)),t.comentarios=a.comentario.orderComentarios(t.comentarios||[]),t.pausas=a.orderPausas(t.pausas||[]),i.patchValue(a.util.fillForm(o,a.form.value)),a.loadEtiquetas()})()}initializeData(t){var i=this;return(0,v.A)(function*(){if(i.isClonar){const a=yield i.dao.getAtividade(i.urlParams.get("id"));i.entity=new m.Y,Object.assign(i.entity,{tipo_atividade:a.tipo_atividade,unidade:a.unidade,usuario:a.usuario,plano_trabalho:a.plano_trabalho,descricao:a.descricao,data_distribuicao:a.data_distribuicao,tempo_planejado:a.tempo_planejado,carga_horaria:a.carga_horaria,data_estipulada_entrega:a.data_estipulada_entrega,esforco:a.esforco,tipo_atividade_id:a.tipo_atividade_id,demandante_id:i.auth.usuario?.id,usuario_id:a.usuario_id,unidade_id:a.unidade_id,plano_trabalho_id:a.plano_trabalho_id,etiquetas:a.etiquetas,checklist:a.checklist,metadados:a.metadados,plano_trabalho_entrega_id:a.plano_trabalho_entrega_id,progresso:a.progresso,tarefas:(a.tarefas||[]).map(o=>new ae.N(Object.assign({},o,{id:i.dao.generateUuid(),comentarios:[],_status:"ADD"}))),documento_requisicao:a.documento_requisicao?Object.assign({},new S.j(Object.assign({},a.documento_requisicao,{id:i.dao.generateUuid(),_status:"ADD"}))):void 0,documento_entrega:a.documento_entrega?Object.assign({},new S.j(Object.assign({},a.documento_entrega,{id:i.dao.generateUuid(),_status:"ADD"}))):void 0})}else if(i.sei=i.metadata?.sei,i.entity=new m.Y,i.entity.data_distribuicao=i.auth.hora,i.entity.data_estipulada_entrega=i.entity.data_distribuicao,i.entity.demandante_id=i.auth.usuario?.id||"",i.entity.unidade_id=i.auth.unidade?.id||"",i.entity.unidade=i.auth.unidade,i.entity.metadados={atrasado:!1,tempo_despendido:0,tempo_atraso:0,pausado:!1,iniciado:!1,concluido:!1,avaliado:!1,arquivado:!1,produtividade:0,consolidacoes:[]},!i.unidadeService.isGestorUnidade(i.entity.unidade_id)){let a=yield i.usuarioDao.getById(i.auth.usuario.id,i.usuarioJoin);i.entity.usuario_id=a?.id||null,i.entity.usuario=a||void 0}yield i.loadData(i.entity,t)})()}saveData(t){return new Promise((i,a)=>{let o=this.util.fill(new m.Y,this.entity);if(this.comentarios?.confirm(),o=this.util.fillForm(o,this.form.value),this.hasUsuarioActionNew&&this.form.controls.iniciado.value&&(o.data_inicio=o.data_distribuicao,o.status="INICIADO",this.form.controls.concluido.value)){let r=this.calendar.calculaDataTempoUnidade(o.data_inicio,o.data_estipulada_entrega,this.planoTrabalhoSelecionado.carga_horaria,this.unidade?.selectedEntity,"ENTREGA");o.data_entrega=o.data_estipulada_entrega,o.progresso=100,o.tempo_despendido=r?.tempoUtil||0,o.status="CONCLUIDO"}o.documento_requisicao=this.requisicao?.documento,o.comentarios=o.comentarios.filter(r=>["ADD","EDIT","DELETE"].includes(r._status||"")&&r.texto?.length),o.tarefas=o.tarefas.filter(r=>(r.comentarios=r.comentarios.filter(p=>["ADD","EDIT","DELETE"].includes(p._status||"")&&p.texto?.length),["ADD","EDIT","DELETE"].includes(r._status||""))),i(o)})}static{this.\u0275fac=function(i){return new(i||s)(e.rXU(e.zZn))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["app-atividade-form"]],viewQuery:function(i,a){if(1&i&&(e.GBs(I.Q,5),e.GBs(Xe,5),e.GBs(xe,5),e.GBs(Ke,5),e.GBs(Qe,5),e.GBs(We,5),e.GBs(Je,5),e.GBs(Ze,5)),2&i){let o;e.mGM(o=e.lsd())&&(a.editableForm=o.first),e.mGM(o=e.lsd())&&(a.etiqueta=o.first),e.mGM(o=e.lsd())&&(a.tipoAtividade=o.first),e.mGM(o=e.lsd())&&(a.planoTrabalho=o.first),e.mGM(o=e.lsd())&&(a.unidade=o.first),e.mGM(o=e.lsd())&&(a.usuario=o.first),e.mGM(o=e.lsd())&&(a.comentarios=o.first),e.mGM(o=e.lsd())&&(a.requisicao=o.first)}},features:[e.Vt3],decls:26,vars:38,consts:[["requisicao",""],["unidade",""],["tipoAtividade",""],["usuario",""],["planoTrabalho",""],["entrega",""],["comEsforco",""],["comTempoDespendido",""],["initialFocus","descricao",3,"submit","cancel","form","disabled"],["display","","right","",3,"title"],["key","ATIVIDADE",3,"label"],[3,"sei","documento"],[1,"row"],["label","Descri\xe7\xe3o","controlName","descricao","required","",3,"size","rows","control"],["controlName","unidade_id","required","",3,"change","label","size","dao"],["controlName","tipo_atividade_id",3,"select","change","label","emptyValue","size","dao","labelInfo","required"],["label","Iniciado","controlName","iniciado",3,"size","disabled",4,"ngIf"],["label","Conclu\xeddo","controlName","concluido",3,"size","change",4,"ngIf"],["controlName","usuario_id","labelInfo","Participante respons\xe1vel pela execu\xe7\xe3o",3,"select","change","label","size","emptyValue","dao","join"],["controlName","plano_trabalho_id",3,"change","label","size","control","items","labelInfo"],["controlName","plano_trabalho_entrega_id",3,"label","size","control","items","labelInfo"],["class","row",4,"ngIf","ngIfElse"],["title","Conclus\xe3o",4,"ngIf"],["label","Iniciado","controlName","iniciado",3,"size","disabled"],["label","Conclu\xeddo","controlName","concluido",3,"change","size"],["noIcon","","controlName","data_distribuicao","labelInfo","Data de inclus\xe3o/distribui\xe7\xe3o/lan\xe7amento",3,"change","size","label","control"],["label","Progresso","disabled","","sufix","%","icon","bi bi-clock","controlName","progresso","labelInfo","Progresso de execu\xe7\xe3o (% Conclu\xeddo)",3,"size","decimals"],["noIcon","","controlName","data_estipulada_entrega","labelInfo","Data estipulada para entrega da atividade",3,"change","size","label","control"],["icon","bi bi-stopwatch","onlyHours","","controlName","esforco","labelInfo","Tempo estimado de execu\xe7\xe3o",3,"size","label","control"],["title","Conclus\xe3o"],[3,"documento"],["noIcon","","label","Inicio","controlName","data_inicio","disabled","","labelInfo","Data em que o usu\xe1rio iniciou a atividade",3,"size","control"],["noIcon","","label","Conclus\xe3o","controlName","data_entrega","disabled","","labelInfo","Data da conclus\xe3o da atividade",3,"size","control"],["label","Data de arquivamento","controlName","data_arquivamento","disabled","","labelInfo","Data de arquivamento da atividade",3,"size","control"],["label","Tempo despendido","icon","bi bi-hourglass-bottom","controlName","tempo_despendido","disabled","","labelInfo","Calculado no fim da atividade, sendo o tempo l\xedquido (considerando pausas)",3,"size","control"]],template:function(i,a){if(1&i){const o=e.RV6();e.j41(0,"editable-form",8),e.bIt("submit",function(){return e.eBV(o),e.Njj(a.onSaveData())})("cancel",function(){return e.eBV(o),e.Njj(a.onCancel())}),e.j41(1,"tabs",9)(2,"tab",10),e.nrm(3,"documento-link",11,0),e.j41(5,"div",12),e.nrm(6,"input-textarea",13),e.k0s(),e.j41(7,"div",12)(8,"input-search",14,1),e.bIt("change",function(p){return e.eBV(o),e.Njj(a.onUnidadeChange(p))}),e.k0s(),e.j41(10,"input-search",15,2),e.bIt("select",function(p){return e.eBV(o),e.Njj(a.onTipoAtividadeSelect(p))})("change",function(p){return e.eBV(o),e.Njj(a.onTipoAtividadeChange(p))}),e.k0s(),e.DNE(12,et,1,2,"input-switch",16)(13,tt,1,1,"input-switch",17),e.k0s(),e.j41(14,"div",12)(15,"input-search",18,3),e.bIt("select",function(p){return e.eBV(o),e.Njj(a.onUsuarioSelect(p))})("change",function(p){return e.eBV(o),e.Njj(a.onUsuarioChange(p))}),e.k0s(),e.j41(17,"input-select",19,4),e.bIt("change",function(p){return e.eBV(o),e.Njj(a.onPlanoTrabalhoChange(p))}),e.k0s()(),e.j41(19,"div",12),e.nrm(20,"input-select",20,5),e.k0s(),e.DNE(22,at,4,8,"div",21)(23,it,5,11,"ng-template",null,6,e.C5r)(25,st,5,3,"separator",22),e.k0s()()()}if(2&i){const o=e.sdS(18),r=e.sdS(24);e.Y8G("form",a.form)("disabled",a.formDisabled),e.R7$(),e.Y8G("title",a.titleAtividade),e.R7$(),e.Y8G("label",a.lex.translate("Atividade")),e.R7$(),e.Y8G("sei",a.sei)("documento",a.form.controls.documento_requisicao.value),e.R7$(3),e.Y8G("size",12)("rows",2)("control",a.form.controls.descricao),e.R7$(2),e.Y8G("label",a.lex.translate("Unidade"))("size",a.hasUsuarioActionNew?5:6)("dao",a.unidadeDao),e.R7$(2),e.Y8G("label","Tipo de "+a.lex.translate("atividade"))("emptyValue",null)("size",a.hasUsuarioActionNew?5:6)("dao",a.tipoAtividadeDao)("labelInfo",a.lex.translate("Tipo de atividade")+" utilizado para classificar a atividade")("required",a.auth.hasPermissionTo("MOD_ATV_TIPO_ATV_VAZIO")?void 0:"true"),e.R7$(2),e.Y8G("ngIf",a.hasUsuarioActionNew),e.R7$(),e.Y8G("ngIf",a.hasUsuarioActionNew),e.R7$(2),e.Y8G("label",a.lex.translate("Respons\xe1vel"))("size",6)("emptyValue",null)("dao",a.usuarioDao)("join",a.usuarioJoin),e.R7$(2),e.Y8G("label",a.lex.translate("Plano de trabalho"))("size",6)("control",a.form.controls.plano_trabalho_id)("items",a.planosTrabalhos)("labelInfo",a.lex.translate("Plano de trabalho")),e.R7$(3),e.Y8G("label",a.lex.translate("Entrega")+" (Descri\xe7\xe3o dos trabalhos)")("size",12)("control",a.form.controls.plano_trabalho_entrega_id)("items",a.entregas)("labelInfo",a.lex.translate("Entrega")+a.lex.translate(" plano de trabalho")+" que a "+a.lex.translate("atividade")+" \xe9 referente"),e.R7$(2),e.Y8G("ngIf",!(null!=o&&null!=o.selectedItem&&null!=o.selectedItem.data&&null!=o.selectedItem.data.tipo_modalidade&&o.selectedItem.data.tipo_modalidade.atividade_esforco))("ngIfElse",r),e.R7$(3),e.Y8G("ngIf",a.form.controls.data_entrega.value)}},dependencies:[n.bT,I.Q,G.S,F.O,Q.S,R.r,O.K,q.r,W.O,J.j,j.F,$.n,T]})}}return s})();var Z=u(4282),re=u(4468);function rt(s,h){if(1&s&&e.nrm(0,"atividade-list-grid",7),2&s){const t=e.XpG();e.Y8G("snapshot",t.snapshot||t.modalRoute||t.route.snapshot)("minhas",!t.eGestor)}}function lt(s,h){if(1&s&&e.nrm(0,"atividade-list-kanban",7),2&s){const t=e.XpG();e.Y8G("snapshot",t.snapshot||t.modalRoute||t.route.snapshot)("minhas",!t.eGestor)}}function dt(s,h){if(1&s&&e.nrm(0,"atividade-dashboard",9),2&s){const t=e.XpG(2);e.Y8G("snapshot",t.snapshot||t.modalRoute||t.route.snapshot)}}function ct(s,h){if(1&s&&(e.j41(0,"tab",8),e.DNE(1,dt,1,1,"ng-template",null,2,e.C5r),e.k0s()),2&s){const t=e.sdS(2);e.Y8G("template",t)}}let le=(()=>{class s extends re.V{constructor(t){super(t),this.injector=t,this.activeTab="TABELA",this.eGestor=this.auth.unidadeGestor(),this.title=this.lex.translate("Atividades"),this.code="MOD_DMD"}ngOnInit(){super.ngOnInit(),this.activeTab=this.usuarioConfig.active_tab||"TABELA"}onSelectTab(t){var i=this;return(0,v.A)(function*(){i.activeTab=t.key,i.viewInit&&i.saveUsuarioConfig({active_tab:i.activeTab})})()}static{this.\u0275fac=function(i){return new(i||s)(e.rXU(e.zZn))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["app-atividade-list"]],features:[e.Vt3],decls:8,vars:6,consts:[["grid",""],["kanban",""],["dashboard",""],["right","",3,"title","select","active"],["key","TABELA","icon","bi bi-table","label","Lista",3,"template"],["key","KANBAN","icon","bi bi-card-heading","label","Quadro",3,"template"],["key","DASHBOARD","icon","bi bi-file-earmark-bar-graph","label","Dashboard",3,"template",4,"ngIf"],[3,"snapshot","minhas"],["key","DASHBOARD","icon","bi bi-file-earmark-bar-graph","label","Dashboard",3,"template"],[3,"snapshot"]],template:function(i,a){if(1&i&&(e.j41(0,"tabs",3)(1,"tab",4),e.DNE(2,rt,1,2,"ng-template",null,0,e.C5r),e.k0s(),e.j41(4,"tab",5),e.DNE(5,lt,1,2,"ng-template",null,1,e.C5r),e.k0s(),e.DNE(7,ct,3,1,"tab",6),e.k0s()),2&i){const o=e.sdS(3),r=e.sdS(6);e.Y8G("title",a.isModal?"":a.title)("select",a.onSelectTab.bind(a))("active",a.activeTab),e.R7$(),e.Y8G("template",o),e.R7$(3),e.Y8G("template",r),e.R7$(3),e.Y8G("ngIf",!1)}}})}}return s})();var ut=u(1928),ee=u(5201),de=u(3881),mt=u(3292);const ce=()=>[];function pt(s,h){if(1&s&&e.nrm(0,"planejamento-show",10),2&s){const t=e.XpG(2);e.Y8G("planejamento",t.atividade.planejamento)}}function _t(s,h){if(1&s&&(e.j41(0,"div",11)(1,"h6"),e.EFF(2,"Cadeia de valor:"),e.k0s(),e.j41(3,"h4"),e.EFF(4),e.k0s()()),2&s){const t=e.XpG(2);e.R7$(4),e.JRh(t.atividade.cadeiaValor.nome)}}function ft(s,h){1&s&&(e.qex(0),e.nrm(1,"i",15),e.bVm())}function ht(s,h){if(1&s&&(e.j41(0,"div")(1,"div",14),e.DNE(2,ft,2,0,"ng-container",13),e.j41(3,"h5"),e.EFF(4),e.k0s()()()),2&s){const t=h.$implicit,i=h.index;e.R7$(2),e.Y8G("ngForOf",e.lJ4(2,ce).constructor(i)),e.R7$(2),e.JRh(t.nome)}}function gt(s,h){if(1&s&&(e.j41(0,"div",12)(1,"h6"),e.EFF(2,"Objetivos:"),e.k0s(),e.DNE(3,ht,5,3,"div",13),e.k0s()),2&s){const t=e.XpG(2);e.R7$(3),e.Y8G("ngForOf",t.atividade.objetivos)}}function bt(s,h){if(1&s&&(e.j41(0,"div")(1,"h5"),e.EFF(2),e.k0s()()),2&s){const t=h.$implicit;e.R7$(2),e.JRh(t.nome)}}function vt(s,h){if(1&s&&(e.j41(0,"div",16)(1,"h6"),e.EFF(2,"Processos:"),e.k0s(),e.DNE(3,bt,3,1,"div",13),e.k0s()),2&s){const t=e.XpG(2);e.R7$(3),e.Y8G("ngForOf",t.atividade.processos)}}function Et(s,h){1&s&&(e.qex(0),e.nrm(1,"i",15),e.bVm())}function Dt(s,h){if(1&s&&(e.j41(0,"div")(1,"div",14),e.DNE(2,Et,2,0,"ng-container",13),e.j41(3,"div",18)(4,"h5",8),e.EFF(5),e.k0s(),e.j41(6,"div",19)(7,"span",20)(8,"b",21),e.EFF(9,"Meta:"),e.k0s(),e.nrm(10,"badge",22),e.k0s(),e.j41(11,"span",23)(12,"b",21),e.EFF(13,"Realizado:"),e.k0s(),e.nrm(14,"badge",24),e.k0s(),e.j41(15,"span",25)(16,"b",26),e.EFF(17,"Progresso:"),e.k0s(),e.nrm(18,"progress-bar",27),e.k0s()()()(),e.nrm(19,"hr"),e.k0s()),2&s){const t=h.$implicit,i=h.index,a=e.XpG(3);e.R7$(2),e.Y8G("ngForOf",e.lJ4(6,ce).constructor(i)),e.R7$(3),e.SpI(" ",t.descricao," "),e.R7$(5),e.Y8G("label",a.planoEntregaService.getValorMeta(t)),e.R7$(4),e.Y8G("label",a.planoEntregaService.getValorRealizado(t)),e.R7$(4),e.Y8G("value",t.progresso_realizado)("goal",t.progresso_esperado)}}function Ct(s,h){if(1&s&&(e.j41(0,"div",17)(1,"h6"),e.EFF(2,"Entrega do plano de entregas:"),e.k0s(),e.DNE(3,Dt,20,7,"div",13),e.k0s()),2&s){const t=e.XpG(2);e.R7$(3),e.Y8G("ngForOf",t.atividade.entregasPlanoEntrega)}}function It(s,h){if(1&s&&(e.qex(0),e.j41(1,"div",1),e.DNE(2,pt,1,1,"planejamento-show",2)(3,_t,5,1,"div",3),e.k0s(),e.j41(4,"div",1),e.DNE(5,gt,4,1,"div",4)(6,vt,4,1,"div",5),e.k0s(),e.DNE(7,Ct,4,1,"div",6),e.j41(8,"div",7)(9,"h6"),e.EFF(10,"Aloca\xe7\xe3o:"),e.k0s(),e.j41(11,"h5",8),e.EFF(12),e.k0s(),e.j41(13,"p"),e.EFF(14,"For\xe7a de trabalho: "),e.j41(15,"b"),e.EFF(16),e.k0s()()(),e.j41(17,"div",9)(18,"h6"),e.EFF(19,"Atividade:"),e.k0s(),e.j41(20,"h5",8),e.EFF(21),e.k0s(),e.j41(22,"p"),e.EFF(23,"Data estipulada para entrega: "),e.j41(24,"b"),e.EFF(25),e.k0s()()(),e.bVm()),2&s){const t=e.XpG();e.R7$(2),e.Y8G("ngIf",t.atividade.planejamento),e.R7$(),e.Y8G("ngIf",t.atividade.cadeiaValor),e.R7$(2),e.Y8G("ngIf",t.atividade.objetivos),e.R7$(),e.Y8G("ngIf",null==t.atividade.processos?null:t.atividade.processos.length),e.R7$(),e.Y8G("ngIf",t.atividade.entregasPlanoEntrega),e.R7$(5),e.JRh(t.atividade.entregaPlanoTrabalho.descricao),e.R7$(4),e.SpI("",t.atividade.entregaPlanoTrabalho.forca_trabalho,"%"),e.R7$(5),e.JRh(t.atividade.atividade.descricao),e.R7$(4),e.JRh(t.util.getDateTimeFormatted(t.atividade.atividade.data_estipulada_entrega))}}const At=[{path:"",component:le,canActivate:[E.q],resolve:{config:D.L},data:{title:"Atividades"}},{path:"grid",component:Z.b,canActivate:[E.q],resolve:{config:D.L},data:{title:"Atividades"}},{path:"new",component:x,canActivate:[E.q],resolve:{config:D.L},data:{title:"",modal:!0}},{path:"tarefa",component:oe,canActivate:[E.q],resolve:{config:D.L},data:{title:"Tarefa da Atividade",modal:!0}},{path:"tarefa/concluir",component:w.A,canActivate:[E.q],resolve:{config:D.L},data:{title:"Concluir Tarefa",modal:!0}},{path:"tarefa/:tarefa_id/comentar",component:oe,canActivate:[E.q],resolve:{config:D.L},data:{title:"Coment\xe1rios",modal:!0}},{path:":id/edit",component:x,canActivate:[E.q],resolve:{config:D.L},data:{title:"Edi\xe7\xe3o da Atividade",modal:!0}},{path:":id/consult",component:x,canActivate:[E.q],resolve:{config:D.L},data:{title:"Consulta a Atividade",modal:!0}},{path:":id/clonar",component:x,canActivate:[E.q],resolve:{config:D.L},data:{title:"Clone de Atividade",modal:!0}},{path:":id/iniciar",component:Ye,canActivate:[E.q],resolve:{config:D.L},data:{title:"In\xedcio de Atividade",modal:!0}},{path:":id/concluir",component:Fe,canActivate:[E.q],resolve:{config:D.L},data:{title:"Conclus\xe3o de Atividade",modal:!0}},{path:":id/pausar",component:Be,canActivate:[E.q],resolve:{config:D.L},data:{title:"Suspens\xe3o de Atividade",modal:!0}},{path:":id/prorrogar",component:Le,canActivate:[E.q],resolve:{config:D.L},data:{title:"Prorroga\xe7\xe3o de Atividade",modal:!0}},{path:":id/comentar",component:x,canActivate:[E.q],resolve:{config:D.L},data:{title:"Coment\xe1rios de Atividade",modal:!0}},{path:":id/hierarquia",component:(()=>{class s extends re.V{constructor(t){super(t),this.injector=t,this.atividadeDao=t.get(y.R),this.planoEntregaService=t.get(ut.C)}ngOnInit(){super.ngOnInit(),this.urlParams.get("id")&&this.loadAtividade(this.urlParams.get("id"))}loadAtividade(t){var i=this;return(0,v.A)(function*(){const a=yield i.atividadeDao.getHierarquia(t);a&&(i.atividade=a)})()}static{this.\u0275fac=function(i){return new(i||s)(e.rXU(e.zZn))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["atividade-hierarquia"]],features:[e.Vt3],decls:1,vars:1,consts:[[4,"ngIf"],[1,"d-flex","align-items-stretch"],[3,"planejamento",4,"ngIf"],["class","cadeiaValor arrow_box first-box w-100 ms-3",4,"ngIf"],["class","objetivos arrow_box w-100",4,"ngIf"],["class","procesos arrow_box w-100 ms-3",4,"ngIf"],["class","plano_entrega_entrega arrow_box",4,"ngIf"],[1,"plano_trabalho_entrega","arrow_box"],[1,"mb-2"],[1,"atividade","arrow_box"],[3,"planejamento"],[1,"cadeiaValor","arrow_box","first-box","w-100","ms-3"],[1,"objetivos","arrow_box","w-100"],[4,"ngFor","ngForOf"],[1,"d-flex","justify-content-start","align-items-center"],[1,"bi","bi-chevron-right"],[1,"procesos","arrow_box","w-100","ms-3"],[1,"plano_entrega_entrega","arrow_box"],[1,"ms-3","flex-grow-1","d-flex","flex-column"],[1,"d-flex","justify-content-start","align-items-center","m-0"],[1,"text-center"],[1,"d-block"],["icon","bi bi-graph-up-arrow","color","light",3,"label"],[1,"text-center","ms-3"],["icon","bi bi-check-lg","color","light",3,"label"],[1,"ms-3","flex-fill"],[1,""],["color","success",3,"value","goal"]],template:function(i,a){1&i&&e.DNE(0,It,26,9,"ng-container",0),2&i&&e.Y8G("ngIf",a.atividade)},dependencies:[n.Sq,n.bT,ee.n,de.a,mt.r],styles:["h6[_ngcontent-%COMP%]{border-bottom:1px solid rgba(194,225,245,.14);padding-bottom:5px;color:var(--bs-body-color)}h5[_ngcontent-%COMP%]{color:var(--bs-body-color);font-weight:300;margin:0}"]})}}return s})(),canActivate:[E.q],resolve:{config:D.L},data:{title:"Hierarquia da Atividade",modal:!0}}];let Ft=(()=>{class s{static{this.\u0275fac=function(i){return new(i||s)}}static{this.\u0275mod=e.$C({type:s})}static{this.\u0275inj=e.G2t({imports:[z.iI.forChild(At),z.iI]})}}return s})();var kt=u(9455),yt=u(3756),ue=u(9050);const Gt=["filterRef"],Rt=["kanbanEtiquetas"],jt=["dockerNaoIniciado"],Ot=["dockerPausado"],St=["dockerIniciado"],Nt=["dockerConcluido"],Pt=["planoEntrega"],$t=["planoEntregaEntrega"];function Vt(s,h){if(1&s){const t=e.RV6();e.j41(0,"badge",40),e.bIt("click",function(){e.eBV(t);const a=e.XpG().card,o=e.XpG();return e.Njj(o.onEntregaClick(a.data))}),e.k0s()}if(2&s){const t=e.XpG().card,i=e.XpG();e.Y8G("icon",i.entityService.getIcon("Entrega"))("label",t.data.plano_trabalho_entrega.descricao)}}function Yt(s,h){if(1&s&&(e.j41(0,"div"),e.nrm(1,"profile-picture",41),e.k0s()),2&s){const t=e.XpG().card;e.R7$(),e.Y8G("url",t.data.usuario.url_foto)("hint","Respons\xe1vel: "+((null==t.data.usuario?null:t.data.usuario.nome)||"N\xe3o atribuido a nenhum usu\xe1rio"))}}function zt(s,h){if(1&s&&e.nrm(0,"badge",49),2&s){const t=h.$implicit,i=e.XpG(3);e.Y8G("color",t.color)("label",t.label)("icon",t.icon)("data",t)("click",t.data.filter?i.onStatusClick.bind(i):void 0)}}function Ut(s,h){if(1&s&&e.nrm(0,"badge",49),2&s){const t=h.$implicit,i=e.XpG(3);e.Y8G("color",t.color)("label",t.value)("icon",t.icon)("data",t)("click",i.onEtiquetaClick.bind(i))}}function qt(s,h){1&s&&e.nrm(0,"separator",50)}function Bt(s,h){1&s&&e.nrm(0,"i",54)}function Lt(s,h){if(1&s&&(e.j41(0,"tr")(1,"td"),e.DNE(2,Bt,1,0,"i",52),e.k0s(),e.j41(3,"td",53),e.EFF(4),e.k0s()()),2&s){const t=h.$implicit;e.R7$(2),e.Y8G("ngIf",t.checked),e.R7$(2),e.JRh(t.texto)}}function Mt(s,h){if(1&s&&(e.j41(0,"table"),e.DNE(1,Lt,5,2,"tr",51),e.k0s()),2&s){const t=e.XpG(2).card;e.R7$(),e.Y8G("ngForOf",t.data.checklist)}}function wt(s,h){if(1&s&&(e.j41(0,"small"),e.EFF(1),e.k0s()),2&s){const t=h.$implicit;e.R7$(),e.JRh(t.descricao)}}function Ht(s,h){if(1&s&&(e.j41(0,"separator",55),e.DNE(1,wt,2,1,"small",51),e.k0s()),2&s){const t=e.XpG(2).card;e.Y8G("title","Tarefas ("+(null==t.data.tarefas?null:t.data.tarefas.length)+")")("collapsed",!0),e.R7$(),e.Y8G("ngForOf",t.data.tarefas)}}function Xt(s,h){if(1&s&&(e.qex(0),e.j41(1,"div",42),e.nrm(2,"documentos-badge",43),e.DNE(3,zt,1,5,"badge",44)(4,Ut,1,5,"badge",44),e.k0s(),e.DNE(5,qt,1,0,"separator",45)(6,Mt,2,1,"table",39),e.nrm(7,"reaction",46),e.DNE(8,Ht,2,3,"separator",47),e.nrm(9,"comentarios-widget",48),e.bVm()),2&s){const t=e.XpG().card,i=e.XpG();e.R7$(2),e.Y8G("documento",t.data.documento_requisicao),e.R7$(),e.Y8G("ngForOf",i.atividadeService.getStatus(t.data)),e.R7$(),e.Y8G("ngForOf",t.data.etiquetas),e.R7$(),e.Y8G("ngIf",null==t.data.checklist?null:t.data.checklist.length),e.R7$(),e.Y8G("ngIf",null==t.data.checklist?null:t.data.checklist.length),e.R7$(),e.Y8G("entity",t.data),e.R7$(),e.Y8G("ngIf",null==t.data.tarefas?null:t.data.tarefas.length),e.R7$(),e.Y8G("entity",t.data)("selectable",!1)("query",i.query)}}function xt(s,h){if(1&s&&(e.DNE(0,Vt,1,2,"badge",30),e.j41(1,"div",31)(2,"div",32)(3,"div",33)(4,"span",34),e.EFF(5),e.k0s(),e.j41(6,"span",34),e.nrm(7,"i",35),e.EFF(8),e.k0s(),e.j41(9,"span",36),e.nrm(10,"i"),e.EFF(11),e.k0s()(),e.j41(12,"span",37),e.nrm(13,"i",38),e.EFF(14),e.k0s()(),e.DNE(15,Yt,2,2,"div",39),e.k0s(),e.DNE(16,Xt,10,10,"ng-container",39)),2&s){const t=h.card,i=e.XpG();e.Y8G("ngIf",t.data.plano_trabalho_entrega),e.R7$(5),e.SpI(" #",t.data.numero," "),e.R7$(3),e.SpI(" ",t.data.unidade.sigla," "),e.R7$(),e.Mz_("title","Respons\xe1vel: ",(null==t.data.usuario?null:t.data.usuario.nome)||"N\xe3o atribuido a nenhum usu\xe1rio",""),e.R7$(),e.HbH("bi "+(null!=t.data.usuario&&null!=t.data.usuario.nome&&t.data.usuario.nome.length?"bi-person-check":"bi-person-x")),e.R7$(),e.SpI(" ",i.util.apelidoOuNome(t.data.usuario,!0)||"(N\xe3o atribu\xeddo)"," "),e.R7$(),e.Mz_("title","Demandante: ",(null==t.data.demandante?null:t.data.demandante.nome)||"Desconhecido",""),e.R7$(2),e.SpI(" ",i.util.apelidoOuNome(t.data.demandante,!0)||"Desconhecido"," "),e.R7$(),e.Y8G("ngIf",t.data.usuario),e.R7$(),e.Y8G("ngIf",!(null!=i.filter&&null!=i.filter.controls&&null!=i.filter.controls.resumido&&i.filter.controls.resumido.value))}}function Kt(s,h){if(1&s&&e.nrm(0,"input-select",56),2&s){const t=e.XpG();e.Y8G("size",12)("control",t.formEdit.controls.etiqueta)("items",t.etiquetasEdit)}}function Qt(s,h){1&s&&(e.j41(0,"div",57)(1,"div",31)(2,"div",32)(3,"h5",58),e.nrm(4,"span",59),e.k0s()(),e.j41(5,"div",60)(6,"button",61),e.nrm(7,"i",62),e.k0s()()(),e.j41(8,"h6",63),e.nrm(9,"span",64),e.k0s(),e.j41(10,"p",65),e.nrm(11,"span",66)(12,"span",67)(13,"span",67)(14,"span",59)(15,"span",64),e.k0s()())}function Wt(s,h){if(1&s&&(e.j41(0,"kanban",68)(1,"swimlane"),e.nrm(2,"docker",69,8),e.k0s(),e.j41(4,"swimlane"),e.nrm(5,"docker",70,9)(7,"docker",71,10),e.k0s(),e.j41(9,"swimlane"),e.nrm(10,"docker",72,11),e.k0s()()),2&s){const t=e.XpG(),i=e.sdS(22),a=e.sdS(26);e.Y8G("template",i)("placeholderTemplate",a)("loading",t.loading)("dragSwimlanes",!1),e.R7$(2),e.Y8G("collapse",t.cardsConfig.naoIniciado)("toggle",t.onDockerCollapse.bind(t))("menu",t.menuDockerNaoIniciado)("dragged",t.onDragged.bind(t))("drop",t.onDrop.bind(t))("dropIf",t.canDrop(t.DOCKERS[t.NAOINICIADO]))("cards",t.cards[t.NAOINICIADO]),e.R7$(3),e.Y8G("collapse",t.cardsConfig.iniciado)("toggle",t.onDockerCollapse.bind(t))("dragged",t.onDragged.bind(t))("drop",t.onDrop.bind(t))("dropIf",t.canDrop(t.DOCKERS[t.INICIADO]))("cards",t.cards[t.INICIADO]),e.R7$(2),e.Y8G("collapse",t.cardsConfig.pausado)("toggle",t.onDockerCollapse.bind(t))("dragged",t.onDragged.bind(t))("drop",t.onDrop.bind(t))("dropIf",t.canDrop(t.DOCKERS[t.PAUSADO]))("cards",t.cards[t.PAUSADO]),e.R7$(3),e.Y8G("collapse",t.cardsConfig.concluido)("toggle",t.onDockerCollapse.bind(t))("dragged",t.onDragged.bind(t))("drop",t.onDrop.bind(t))("dropIf",t.canDrop(t.DOCKERS[t.CONCLUIDO]))("cards",t.cards[t.CONCLUIDO])}}function Jt(s,h){if(1&s&&e.nrm(0,"kanban",73,12),2&s){const t=e.XpG(),i=e.sdS(22),a=e.sdS(24),o=e.sdS(26);e.Y8G("dockers",t.labels)("template",i)("placeholderTemplate",o)("loading",t.loading)("swimlaneDrop",t.onSwimlaneDrop.bind(t))("dockerDragged",t.onDragged.bind(t))("dockerDrop",t.onDrop.bind(t))("dockerEditTemplate",a)("dockerToggle",t.onDockerCollapse.bind(t))("dockerEdit",t.editEtiquetas.bind(t))("dockerSave",t.saveEtiquetas.bind(t))("dockerDelete",t.deleteEtiquetas.bind(t))("dockerCancel",t.cancelEtiquetas.bind(t))("dockerColorStyle",t.getLabelStyle)}}let me=(()=>{class s extends ue.p{constructor(t){var i,a;super(t),i=this,this.injector=t,this.minhas=!1,this.TITLE_OUTRAS="Outras",this.NAOINICIADO=0,this.PAUSADO=1,this.INICIADO=2,this.CONCLUIDO=3,this.AVALIADO=4,this.DOCKERS=["NAOINICIADO","PAUSADO","INICIADO","CONCLUIDO"],this.cards=[[],[],[],[]],this.cardsConfig={naoIniciado:!1,pausado:!1,iniciado:!1,concluido:!1},this.labels=[],this.cardsVersion=0,this.dragDrop={},this.rowsLimit=500,this.kanbanQueryOptions={},this.etiquetasEdit=[],this.planosEntregas=[],this.planosEntregasEntregas=[],this.toolbarButtons=[{icon:"bi bi-search",label:"Filtros",onClick:()=>this.filterRef?.toggle()},{icon:"bi bi-plus-circle",color:"btn-outline-success",label:"Incluir",onClick:(a=(0,v.A)(function*(){return yield i.add()}),function(){return a.apply(this,arguments)})}],this.outrasButtons=[{icon:"bi bi-plus-circle",color:"btn-outline-success",hint:"Incluir nova lista a direita",onClick:this.incluirLista.bind(this)}],this.etiquetasButtons=[{icon:"bi bi-plus-circle",color:"btn-outline-success",hint:"Incluir nova lista a direita",onClick:this.incluirLista.bind(this)}],this.menuDockerNaoIniciado=[{icon:"bi bi-plus-circle",color:"btn-outline-primary",hint:"Incluir",onClick:function(){var a=(0,v.A)(function*(){return yield i.add()});return function(){return a.apply(this,arguments)}}()}],this.filterWhere=a=>{let o=this.fixedFilter||[],r=a.value;return r.somente_unidade_atual&&r.unidade_id!=this.auth.unidade?.id&&(a.controls.unidade_id.setValue(this.auth.unidade?.id),r.unidade_id=this.auth.unidade?.id),r.atribuidas_para_mim&&r.usuario_id!=this.auth.usuario?.id&&(a.controls.usuario_id.setValue(this.auth.usuario?.id),r.usuario_id=this.auth.usuario.id),r.usuario_id?.length&&o.push(["usuario_id","==",r.usuario_id]),r.unidade_id?.length&&o.push(["unidade_id","==",r.unidade_id]),r.unidades_subordinadas&&o.push(["unidades_subordinadas","==",!0]),r.etiquetas?.length&&o.push(["etiquetas","in",r.etiquetas.map(p=>p.value)]),r.numero_processo?.length&&o.push(["numero_processo","==",r.numero_processo]),r.status?.length&&!o.find(p=>"status"==p[0])&&o.push(["status","==",r.status]),r.plano_entrega_id?.length&&o.push(["plano_entrega_id","==",r.plano_entrega_id]),r.plano_entrega_entrega_id?.length&&o.push(["plano_entrega_entrega_id","==",r.plano_entrega_entrega_id]),o.push(["data_arquivamento","==",null]),o},this.code="MOD_DMD",this.filter=this.fh.FormBuilder({atribuidas_para_mim:{default:this.minhas},usuario_id:{default:""},somente_unidade_atual:{default:!1},unidades_subordinadas:{default:!1},unidade_id:{default:""},numero_processo:{default:""},status:{default:""},usarEtiquetas:{default:!!this.usuarioConfig?.kanban_usar_etiquetas},resumido:{default:!!this.usuarioConfig?.kanban_resumido},etiquetas:{default:[]},plano_entrega_id:{default:null},plano_entrega_entrega_id:{default:null}}),this.formEdit=this.fh.FormBuilder({etiqueta:{default:null}}),this.cardsConfig=Object.assign(this.cardsConfig,this.usuarioConfig?.kanban_status_dockers),this.groupBy=[],this.loadEtiquetas(),this.loadLabel()}defaultUsuarioConfig(){return Object.assign(super.defaultUsuarioConfig(),{active_tab:"TABELA",kanban_resumido:!1,kanban_usar_etiquetas:!1,kanban_status_dockers:{naoIniciado:!1,pausado:!1,iniciado:!1,concluido:!1},kanban_etiquetas_dockers:[]})}ngAfterViewInit(){super.ngAfterViewInit(),this.minhas?(this.filter?.controls.atribuidas_para_mim.setValue(!0),this.filter?.controls.usuario_id.setValue(this.auth.usuario?.id)):this.filter?.controls.unidade_id.setValue(this.auth.unidade?.id),this.query.onLoadingChange=t=>{this.loading=t,this.cdRef.detectChanges()},this.loading=this.query.loading,this.query.subject.asObservable().subscribe(this.onQueryLoad.bind(this)),this.cdRef.detectChanges()}isOutras(t){return t.title==this.TITLE_OUTRAS&&!t.labels.length}loadLabel(){const t=[...this.usuarioConfig?.kanban_etiquetas_dockers||[]];t.find(this.isOutras.bind(this))||t.splice(0,0,{title:this.TITLE_OUTRAS,labels:[],collapse:!1}),this.labels=t.reduce((i,a)=>(i.find(o=>o.title?.length&&o.title==a.title||o.labels?.length&&a.labels?.length&&o.labels[0].key==a.labels[0].key)||i.push({labels:this.isOutras(a)?[]:a.labels,title:a.title,menu:this.isOutras(a)?this.outrasButtons:this.etiquetasButtons,cards:[],editing:!1,collapse:a.collapse}),i),[])}get isEtiquetas(){return!!this.filter?.controls?.usarEtiquetas?.value}onUsarEtiquetasChange(t){this.saveUsuarioConfig({kanban_usar_etiquetas:this.filter.controls.usarEtiquetas.value}),this.query&&this.onQueryLoad(this.query.rows)}incluirLista(t){this.labels.splice(t.key+1,0,{labels:[],menu:this.etiquetasButtons,cards:[],editing:!0,collapse:!1}),this.kanbanEtiquetas?.refreshDoubleScrollbar(),this.cdRef.detectChanges()}onResumidoChange(t){this.saveUsuarioConfig({kanban_resumido:this.filter.controls.resumido.value}),this.cdRef.detectChanges()}loadEtiquetas(){this.etiquetas=this.util.merge(this.etiquetas,this.auth.usuario.config?.etiquetas,(t,i)=>t.key==i.key)}getLabelStyle(t){return`border-color: ${1==t.labels.length&&t.labels[0].color||"#000000"} !important;`}onDockerCollapse(t,i){this.isEtiquetas?(this.labels[t.key].collapse=i,this.saveEtiquetasUsuarioConfig()):(this.cardsConfig={naoIniciado:!!this.dockerNaoIniciado?.collapse,pausado:!!this.dockerPausado?.collapse,iniciado:!!this.dockerIniciado?.collapse,concluido:!!this.dockerConcluido?.collapse},this.saveUsuarioConfig({kanban_status_dockers:this.cardsConfig})),this.kanbanEtiquetas?.refreshDoubleScrollbar()}editEtiquetas(t){var i=this;return(0,v.A)(function*(){const a=i.labels[t.key],o=i.labels.reduce((r,p,b)=>(p.labels.length&&b!=t.key&&r.push(p.labels[0].key),r),[]);i.etiquetasEdit=i.etiquetas.filter(r=>!o.includes(r.key)),i.formEdit.controls.etiqueta.setValue(a.labels.length?a.labels[0].key:null)})()}saveEtiquetasUsuarioConfig(){const t=this.labels.reduce((i,a)=>(i.find(o=>o.title?.length&&o.title==a.title||o.labels?.length&&a.labels?.length&&o.labels[0].key==a.labels[0].key)||i.push({title:a.title,labels:a.labels,collapse:a.collapse}),i),[]);this.saveUsuarioConfig({kanban_etiquetas_dockers:t})}saveEtiquetas(t){var i=this;return(0,v.A)(function*(){const a=i.formEdit.controls.etiqueta.value;if(a?.length){const o=i.labels[t.key],r=i.etiquetasEdit.find(p=>p.key==a);return r&&(o.labels=[r]),i.query&&i.onQueryLoad(i.query.rows),i.saveEtiquetasUsuarioConfig(),!0}return!1})()}cancelEtiquetas(t){var i=this;return(0,v.A)(function*(){i.labels[t.key].labels?.length||(i.labels.splice(t.key,1),i.kanbanEtiquetas?.refreshDoubleScrollbar())})()}deleteEtiquetas(t){var i=this;return(0,v.A)(function*(){i.labels.splice(t.key,1),i.kanbanEtiquetas?.refreshDoubleScrollbar(),i.query&&i.onQueryLoad(i.query.rows),i.saveEtiquetasUsuarioConfig()})()}getNomes(t){return Object.getOwnPropertyNames(t.filter.controls||{}).join(",")}modalRefreshId(t){return{modal:!0,modalClose:i=>{const a=this.dragDrop.destination,o=this.dragDrop.source;i&&(a&&o&&(a.list.splice(a.index,0,a.card),o.list.splice(o.index,1)),(this.grid?.query||this.query).refreshId(t.id)),this.dragDrop={}}}}mergeEtiqueta(t){this.etiquetas.find(i=>i.key==t.key)||this.etiquetas.push(t)}filterSubmit(t){return super.filterSubmit(t),this.cards=[[],[],[],[]],this.labels.forEach(i=>i.cards=[]),this.queryOptions}onQueryLoad(t){if(super.onGridLoad(t),this.cardsVersion++,this.filter?.controls?.usarEtiquetas?.value){const i=this.labels.findIndex(this.isOutras.bind(this));t?.forEach(a=>{let r,o=a;o.etiquetas=o.etiquetas||[];for(let p=0;p<o.etiquetas.length;p++){for(let b=1;b<this.labels.length&&!r;b++)this.labels[b].labels[0].key==o.etiquetas[p].key&&(r=this.labels[b]);this.etiquetas.some(b=>b.key==o.etiquetas[p].key)||this.etiquetas.push(o.etiquetas[p])}this.putCard(r?.cards||this.labels[i]?.cards||[],o)});for(let a of this.labels.map(o=>o.cards||[]))for(let o=0;o<a.length;a[o].version!=this.cardsVersion?a.splice(o,1):o++);}else{t?.forEach(i=>{const a=i;switch(this.lookup.ATIVIDADE_STATUS.find(r=>r.key==a.status)?.key||"INCLUIDO"){case"PAUSADO":this.putCard(this.cards[this.PAUSADO],a);break;case"INICIADO":this.putCard(this.cards[this.INICIADO],a);break;case"CONCLUIDO":this.putCard(this.cards[this.CONCLUIDO],a);break;default:this.putCard(this.cards[this.NAOINICIADO],a)}});for(let i of this.cards)for(let a=0;a<i.length;i[a].version!=this.cardsVersion?i.splice(a,1):a++);}this.cdRef.detectChanges()}putCard(t,i){const a=t.findIndex(r=>r.id==i.id),o={id:i.id,title:i.tipo_atividade?.nome||"("+this.lex.translate("Atividade")+" sem tipo de registro de execu\xe7\xe3o atribu\xeddo)",subTitle:i.descricao||"",data:i,version:this.cardsVersion,menu:void 0,dynamicMenu:this.dynamicCardMenu.bind(this)};a>=0?t[a]=Object.assign(t[a],o):t.push(o)}dynamicCardMenu(t){const i=this.atividadeService.dynamicButtons.bind(this)(t.data,this.optionsMetadata);return i.push({icon:"bi bi-three-dots",hint:"Op\xe7\xf5es",dynamicItems:this.cardDynamicOptions.bind(this)}),(!t.menu||t.menu.map(a=>a.hint).join()!=i.map(a=>a.hint).join())&&(t.menu=i),t.menu}cardDynamicOptions(t){const i=t.menu?.find(a=>"Op\xe7\xf5es"==a.hint);if(i){const a=this.atividadeService.dynamicOptions.bind(this)(t.data,this.optionsMetadata);(!i.items||i?.items.map(o=>o.label).join()!=a.map(o=>o.label).join())&&(i.items=a)}return i?.items}canDrop(t){let i=this;return a=>!!i.isEtiquetas||!!i.atividadeService.dynamicOptions.bind(i)(a.data,i.optionsMetadata).find(r=>r.id==t)}updateEtiquetasAtividade(t){const i=this.labels.find(r=>r.cards==t.source.list)?.labels[0],a=this.labels.find(r=>r.cards==t.destination.list)?.labels[0],o=t.destination.atividade;i&&a&&i.key==a.key||(i&&o.etiquetas.splice(o.etiquetas.findIndex(r=>r.key==i.key),1),a&&o.etiquetas.unshift(a),this.loading=!0,this.dao.update(o.id,{etiquetas:o.etiquetas}).then(r=>this.modalRefreshId(r).modalClose.bind(this)(r.id)).finally(()=>this.loading=!1))}onDragged(t,i,a){if(["copy","move"].includes(a)){const o=i.indexOf(t);this.dragDrop.source={list:i,index:o},this.isEtiquetas&&this.updateEtiquetasAtividade(this.dragDrop)}}onDrop(t,i){if(i&&["copy","move"].includes(t.dropEffect)){const a=t.data.data;if(this.dragDrop={destination:{list:i,index:typeof t.index>"u"?i.length:t.index,card:t.data,atividade:a}},!this.isEtiquetas){const p=this.atividadeService.dynamicOptions.bind(this)(a,this.optionsMetadata),b=this.cards.indexOf(i);if(b>=0){const K=p.find(A=>A.id==this.DOCKERS[b]);K?.onClick&&K?.onClick(a)}}}}onStatusClick(t){this.filter?.controls.status.setValue(t.data?.status),this.filterCollapsed=!1,this.filterRef?.onButtonFilterClick(),this.cdRef.detectChanges()}onEtiquetaClick(t){let i=this.filter.controls.etiquetas.value;i.push(t),this.filter?.controls.etiquetas.setValue(i),this.filterCollapsed=!1,this.filterRef?.onButtonFilterClick(),this.cdRef.detectChanges()}filterClear(t){this.filter.controls.atribuidas_para_mim.setValue(!1),this.filter.controls.usuario_id.setValue(""),this.filter.controls.somente_unidade_atual.setValue(!1),this.filter.controls.unidades_subordinadas.setValue(!1),this.filter.controls.unidade_id.setValue(""),this.filter.controls.numero_processo.setValue(""),this.filter.controls.plano_entrega_id.setValue(null),this.filter.controls.plano_entrega_entrega_id.setValue(null),(!this.fixedFilter?.length||!this.fixedFilter.find(i=>"status"==i[0]))&&this.filter.controls.status.setValue(null),this.filter.controls.etiquetas.setValue([]),super.filterClear(t)}onSwimlaneDrop(t,i){const a=this.labels[i],o=i<t.index?t.index-1:t.index;this.labels.splice(i,1),this.labels.splice(o,0,a),this.saveEtiquetasUsuarioConfig()}onEntregaClick(t){this.go.navigate({route:["gestao","atividade",t.id,"hierarquia"]},{metadata:{atividade:t}})}onUnidadeChange(t){var i=this;return(0,v.A)(function*(){let a=yield i.unidadeDao.getById(i.filter?.controls.unidade_id.value,["planos_entrega"]);i.planosEntregas=a?.planos_entrega?.map(o=>Object.assign({key:o.id,value:o.nome}))||[]})()}onPlanoEntregaChange(t){var i=this;return(0,v.A)(function*(){let a=[];(yield i.unidadeDao.getById(i.filter?.controls.unidade_id.value,["planos_entrega.entregas"]))?.planos_entrega?.forEach(r=>{r.id==i.filter.controls.plano_entrega_id.value&&a.push(r.entregas)}),i.planosEntregasEntregas=a[0].map(r=>Object.assign({key:r.id,value:r.descricao}))||[]})()}static{this.\u0275fac=function(i){return new(i||s)(e.rXU(e.zZn))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["atividade-list-kanban"]],viewQuery:function(i,a){if(1&i&&(e.GBs(Gt,5),e.GBs(Rt,5),e.GBs(jt,5),e.GBs(Ot,5),e.GBs(St,5),e.GBs(Nt,5),e.GBs(Pt,5),e.GBs($t,5)),2&i){let o;e.mGM(o=e.lsd())&&(a.filterRef=o.first),e.mGM(o=e.lsd())&&(a.kanbanEtiquetas=o.first),e.mGM(o=e.lsd())&&(a.dockerNaoIniciado=o.first),e.mGM(o=e.lsd())&&(a.dockerPausado=o.first),e.mGM(o=e.lsd())&&(a.dockerIniciado=o.first),e.mGM(o=e.lsd())&&(a.dockerConcluido=o.first),e.mGM(o=e.lsd())&&(a.planoEntrega=o.first),e.mGM(o=e.lsd())&&(a.planoEntregaEntrega=o.first)}},inputs:{snapshot:"snapshot",fixedFilter:"fixedFilter",minhas:"minhas"},features:[e.Vt3],decls:29,vars:52,consts:[["filterRef",""],["usuario",""],["unidade",""],["planoEntrega",""],["planoEntregaEntrega",""],["ticket",""],["editDocker",""],["placeholder",""],["dockerNaoIniciado",""],["dockerIniciado",""],["dockerPausado",""],["dockerConcluido",""],["kanbanEtiquetas",""],[3,"buttons"],["labelPosition","left","label","Resumido","controlName","resumido",3,"change","size","control"],["labelPosition","left","label","Usar etiquetas","controlName","usarEtiquetas",1,"me-2",3,"change","size","control"],[3,"deleted","form","where","query","submit","clear","collapseChange","collapsed"],[1,"row"],["label","Minhas","controlName","atribuidas_para_mim",3,"change","size","control"],["controlName","usuario_id",3,"size","label","control","disabled","dao"],["label","Atual","controlName","somente_unidade_atual","labelInfo","Somente as atividades da unidade selecionada",3,"change","size","control"],["maskFormat","00000.000000/0000-00","controlName","numero_processo","labelInfo","Pesquisa no documento de requisi\xe7\xe3o, conclus\xe3o e nos documentos das tarefas",3,"size","label","control"],["label","Status","itemTodos","- Todos -","controlName","status",3,"size","valueTodos","disabled","control","items"],["controlName","unidade_id",3,"change","size","label","control","disabled","dao"],["label","Sub.","controlName","unidades_subordinadas","labelInfo","Incluir as unidades subordinadas",3,"size","control"],["itemTodos","- Todos -","controlName","plano_entrega_id",3,"change","size","label","valueTodos","control","items"],["itemTodos","- Todos -","controlName","plano_entrega_entrega_id",3,"size","label","valueTodos","control","items"],["noForm","","noBox","","label","Etiquetas","controlName","etiquetas",3,"size","control"],["useCardData","",3,"template","placeholderTemplate","loading","dragSwimlanes",4,"ngIf"],["useCardData","",3,"dockers","template","placeholderTemplate","loading","swimlaneDrop","dockerDragged","dockerDrop","dockerEditTemplate","dockerToggle","dockerEdit","dockerSave","dockerDelete","dockerCancel","dockerColorStyle",4,"ngIf"],["color","info","role","button",3,"icon","label","click",4,"ngIf"],[1,"d-flex","w-100"],[1,"flex-fill"],[1,"text-nowrap"],[1,"badge","bg-light","text-dark"],[1,"bi","bi-briefcase"],["data-bs-toggle","tooltip","data-bs-placement","top",1,"badge","bg-light","text-dark",3,"title"],["data-bs-toggle","tooltip","data-bs-placement","top",1,"badge","bg-light","text-dark","fw-light",3,"title"],[1,"bi","bi-cursor"],[4,"ngIf"],["color","info","role","button",3,"click","icon","label"],[3,"url","hint"],[1,"card-status-container"],[3,"documento"],["class","ms-1",3,"color","label","icon","data","click",4,"ngFor","ngForOf"],["small","","title","Checklist",4,"ngIf"],["origem","ATIVIDADE",3,"entity"],["collapse","",3,"title","collapsed",4,"ngIf"],["origem","ATIVIDADE",3,"entity","selectable","query"],[1,"ms-1",3,"color","label","icon","data","click"],["small","","title","Checklist"],[4,"ngFor","ngForOf"],["class","bi bi-check-circle",4,"ngIf"],[1,"micro-text","fw-ligh"],[1,"bi","bi-check-circle"],["collapse","",3,"title","collapsed"],["controlName","etiqueta",3,"size","control","items"],[1,"card-body"],[1,"card-title","placeholder-glow"],[1,"placeholder","col-6"],["role","group","aria-label","Basic outlined example",1,"btn-group"],["type","button",1,"btn","btn-sm","btn-outline-secondary","disabled","placeholder"],[1,"bi","bi-question"],[1,"card-subtitle","mb-2","text-muted","placeholder-glow"],[1,"placeholder","col-8"],[1,"card-text","placeholder-glow"],[1,"placeholder","col-7"],[1,"placeholder","col-4"],["useCardData","",3,"template","placeholderTemplate","loading","dragSwimlanes"],["icon","bi bi-hourglass-split","title","N\xe3o iniciado","color","border-warning",3,"collapse","toggle","menu","dragged","drop","dropIf","cards"],["icon","bi bi-play-circle","title","Iniciadas","color","border-info",3,"collapse","toggle","dragged","drop","dropIf","cards"],["icon","bi bi-pause-circle","title","Pausadas","color","border-danger",3,"collapse","toggle","dragged","drop","dropIf","cards"],["icon","bi bi-check-circle","title","Conclu\xeddas","color","border-primary",3,"collapse","toggle","dragged","drop","dropIf","cards"],["useCardData","",3,"dockers","template","placeholderTemplate","loading","swimlaneDrop","dockerDragged","dockerDrop","dockerEditTemplate","dockerToggle","dockerEdit","dockerSave","dockerDelete","dockerCancel","dockerColorStyle"]],template:function(i,a){if(1&i){const o=e.RV6();e.j41(0,"toolbar",13)(1,"input-switch",14),e.bIt("change",function(p){return e.eBV(o),e.Njj(a.onResumidoChange(p))}),e.k0s(),e.j41(2,"input-switch",15),e.bIt("change",function(p){return e.eBV(o),e.Njj(a.onUsarEtiquetasChange(p))}),e.k0s()(),e.j41(3,"filter",16,0)(5,"div",17)(6,"input-switch",18),e.bIt("change",function(p){return e.eBV(o),e.Njj(a.onAtribuidasParaMimChange(p))}),e.k0s(),e.nrm(7,"input-search",19,1),e.j41(9,"input-switch",20),e.bIt("change",function(p){return e.eBV(o),e.Njj(a.onSomenteUnidadeAtualChange(p))}),e.k0s(),e.nrm(10,"input-text",21)(11,"input-select",22),e.k0s(),e.j41(12,"div",17)(13,"input-search",23,2),e.bIt("change",function(p){return e.eBV(o),e.Njj(a.onUnidadeChange(p))}),e.k0s(),e.nrm(15,"input-switch",24),e.j41(16,"input-select",25,3),e.bIt("change",function(p){return e.eBV(o),e.Njj(a.onPlanoEntregaChange(p))}),e.k0s(),e.nrm(18,"input-select",26,4)(20,"input-multiselect",27),e.k0s()(),e.DNE(21,xt,17,13,"ng-template",null,5,e.C5r)(23,Kt,1,3,"ng-template",null,6,e.C5r)(25,Qt,16,0,"ng-template",null,7,e.C5r)(27,Wt,12,29,"kanban",28)(28,Jt,2,14,"kanban",29)}2&i&&(e.Y8G("buttons",a.toolbarButtons),e.R7$(),e.Y8G("size",2)("control",a.filter.controls.resumido),e.R7$(),e.Y8G("size",2)("control",a.filter.controls.usarEtiquetas),e.R7$(),e.Y8G("deleted",a.auth.hasPermissionTo("MOD_AUDIT_DEL"))("form",a.filter)("where",a.filterWhere)("query",a.query)("submit",a.filterSubmit.bind(a))("clear",a.filterClear.bind(a))("collapseChange",a.filterCollapseChange.bind(a))("collapsed",a.filterCollapsed),e.R7$(3),e.Y8G("size",1)("control",a.filter.controls.atribuidas_para_mim),e.R7$(),e.Y8G("size",4)("label",a.lex.translate("Usu\xe1rio"))("control",a.filter.controls.usuario_id)("disabled",a.filter.controls.atribuidas_para_mim.value?"true":void 0)("dao",a.usuarioDao),e.R7$(2),e.Y8G("size",1)("control",a.filter.controls.somente_unidade_atual),e.R7$(),e.Y8G("size",3)("label","N\xba "+a.lex.translate("Processo")+" (Sei)")("control",a.filter.controls.numero_processo),e.BMQ("maxlength",250),e.R7$(),e.Y8G("size",3)("valueTodos",null)("disabled",null!=a.fixedFilter&&a.fixedFilter.length&&"status"==a.fixedFilter[0][0]?"true":void 0)("control",a.filter.controls.status)("items",a.lookup.ATIVIDADE_STATUS),e.R7$(2),e.Y8G("size",3)("label",a.lex.translate("Unidade"))("control",a.filter.controls.unidade_id)("disabled",a.filter.controls.somente_unidade_atual.value?"true":void 0)("dao",a.unidadeDao),e.R7$(2),e.Y8G("size",1)("control",a.filter.controls.unidades_subordinadas),e.R7$(),e.Y8G("size",3)("label",a.lex.translate("Plano de Entrega"))("valueTodos",null)("control",a.filter.controls.plano_entrega_id)("items",a.planosEntregas),e.R7$(2),e.Y8G("size",2)("label",a.lex.translate("Entrega do Plano de Entrega"))("valueTodos",null)("control",a.filter.controls.plano_entrega_entrega_id)("items",a.planosEntregasEntregas),e.R7$(2),e.Y8G("size",3)("control",a.filter.controls.etiquetas),e.R7$(7),e.Y8G("ngIf",!a.isEtiquetas),e.R7$(),e.Y8G("ngIf",a.isEtiquetas))},styles:[".comentario-badge[data-expanded=true][_ngcontent-%COMP%]   .comentario-title[_ngcontent-%COMP%]{display:initial;white-space:normal}.comentario-badge[data-expanded=true][_ngcontent-%COMP%]   .comentario-text[_ngcontent-%COMP%]{font-size:12px;height:auto;display:block;max-width:290px;white-space:initial}.atividade-atividade[_ngcontent-%COMP%], .atividade-descricao[_ngcontent-%COMP%]{height:auto;display:block;max-width:200px;white-space:initial}.comentario-badge[_ngcontent-%COMP%]{white-space:nowrap;display:block;background-color:#ffe69c!important;margin-bottom:1px;text-align:left}.comentario-badge[_ngcontent-%COMP%]   .comentario-title[_ngcontent-%COMP%]{display:none}.comentario-badge[_ngcontent-%COMP%]   .comentario-text[_ngcontent-%COMP%]{display:inline-block;max-width:290px;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;font-size:12px}.docker-border[_ngcontent-%COMP%]{border-width:1px}.card-status-container[_ngcontent-%COMP%]{width:330px}"]})}}return s})();var Zt=u(5739),pe=u(5611);const ea=["programa"],ta=["unidadesSubordinadas"];let aa=(()=>{class s extends ue.p{constructor(t){super(t),this.injector=t,this.validate=(i,a)=>null,this.title=this.lex.translate("Atividades"),this.code="MOD_DMD",this.fh=this.injector.get(Zt.s),this.cdRef=t.get(e.gRc),this.filter=this.fh.FormBuilder({programa_id:{default:""},unidadesSubordinadas:{default:!1}},this.cdRef,this.validate)}ngOnInit(){super.ngOnInit()}static{this.\u0275fac=function(i){return new(i||s)(e.rXU(e.zZn))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["atividade-dashboard"]],viewQuery:function(i,a){if(1&i&&(e.GBs(pe._,5),e.GBs(ea,5),e.GBs(ta,5)),2&i){let o;e.mGM(o=e.lsd())&&(a.grid=o.first),e.mGM(o=e.lsd())&&(a.programa=o.first),e.mGM(o=e.lsd())&&(a.unidadesSubordinadas=o.first)}},inputs:{snapshot:"snapshot",fixedFilter:"fixedFilter"},features:[e.Vt3],decls:0,vars:0,template:function(i,a){}})}}return s})();var ia=u(4401),oa=u(2034),na=u(5852),_e=u(7772),fe=u(2305),sa=u(6764),he=u(1230),ra=u(9898),ge=u(8311),be=u(7072),ve=u(6073),la=u(1681),da=u(6923),ca=u(9787),ua=u(5825);let ma=(()=>{class s{static{this.\u0275fac=function(i){return new(i||s)}}static{this.\u0275mod=e.$C({type:s})}static{this.\u0275inj=e.G2t({imports:[n.MD,Ft,kt.h,yt.UteisModule,ia.ux]})}}return s})();e.wjB(le,[n.bT,W.O,J.j,Z.b,aa,me],[]),e.wjB(Z.b,[n.Sq,n.bT,pe._,oa.T,na.I,_e.i,fe.H,sa.e,G.S,F.O,C.H,Q.S,R.r,O.K,he.b,j.F,ra.Y,ee.n,de.a,$.n,ge.T,B.D,be.c,ve.s,w.A],[]),e.wjB(me,[n.Sq,n.bT,_e.i,fe.H,G.S,F.O,C.H,O.K,he.b,j.F,la.L,da.K,ca.k,ee.n,ua.r,ge.T,be.c,ve.s],[])},5121:(te,Y,u)=>{u.d(Y,{D:()=>C});var n=u(3279),z=u(2342),E=u(568),D=u(6610),v=u(8857);function I(l,c){1&l&&(n.qex(0),n.EFF(1," [DAP]=[HA]+[HP]-([HA]\u2229[HP]) "),n.j41(2,"small"),n.EFF(3,"(Uni\xe3o da quantidade de dias que t\xeam ao menos um Afastamento [HA] ou uma Pausa [HP])"),n.k0s(),n.nrm(4,"br"),n.bVm())}function k(l,c){if(1&l&&(n.qex(0),n.EFF(1," [DU]=[HU]/[CH] "),n.j41(2,"small"),n.EFF(3,"(Dias \xfateis necess\xe1rios)"),n.k0s(),n.nrm(4,"br"),n.DNE(5,I,5,0,"ng-container",6),n.EFF(6),n.bVm()),2&l){const d=n.XpG(2);n.R7$(5),n.Y8G("ngIf",d.partial),n.R7$(),n.Lme(" [F]=[I]+[DU]",d.partial?"+[DAP]":"","",d.useCorridos?"":"+[FER]+[FDS]"," ")}}function y(l,c){1&l&&(n.qex(0),n.EFF(1," [HAP]=[HA]+[HP]-([HA]\u2229[HP]) "),n.j41(2,"small"),n.EFF(3,"(Uni\xe3o das horas de afastamentos e/ou pausas)"),n.k0s(),n.nrm(4,"br"),n.bVm())}function m(l,c){if(1&l&&(n.EFF(0," [EX]=[HFE]-[HIE]-[TIN]"),n.nrm(1,"br"),n.EFF(2," [HD]=MIN([EX], [CH]) "),n.j41(3,"small"),n.EFF(4,"(Horas por dia, ser\xe1 o menor valor entre: [EX] e [CH])"),n.k0s(),n.nrm(5,"br"),n.EFF(6," [IE]=[HFE]-[HD] "),n.j41(7,"small"),n.EFF(8,"(In\xedcio do expediente para o servidor, para encerrar o dia exatamente no [HFE])"),n.k0s(),n.nrm(9,"br"),n.EFF(10," [SHI]=[I]-[IE] "),n.j41(11,"small"),n.EFF(12,"(Saldo inicial, horas a partir do in\xedcio do expediente [IE] at\xe9 a data e hora inicial [I])"),n.k0s(),n.nrm(13,"br"),n.DNE(14,y,5,0,"ng-container",6),n.EFF(15),n.j41(16,"small"),n.EFF(17,"(Quantidade de dias \xfateis necess\xe1rios, sendo arredondado sempre para cima, ex: 3.2 = 4)"),n.k0s(),n.nrm(18,"br"),n.EFF(19),n.j41(20,"small"),n.EFF(21,"(Saldo final, diferen\xe7a do [DF] que estamos buscando at\xe9 o final do expediente [HFE], em horas)"),n.k0s(),n.nrm(22,"br"),n.EFF(23),n.j41(24,"small"),n.EFF(25,"(Data e hor\xe1rio final at\xe9 o cumprimento das [HU])"),n.k0s(),n.nrm(26,"br")),2&l){const d=n.XpG(2);n.R7$(14),n.Y8G("ngIf",d.partial),n.R7$(),n.SpI(" [QDU]=([HU]",d.partial?"+[HAP]":"","+[SHI])/[HD] "),n.R7$(4),n.SpI(" [SHF]=([HD]*[QDU])-([HU]",d.partial?"+[HAP]":"","+[SHI]) "),n.R7$(4),n.SpI(" [DF]=[QDU]",d.useCorridos?"":"+[FER]+[FDS]","+[HFE]-[SHF] ")}}function N(l,c){if(1&l&&(n.j41(0,"div",9),n.nrm(1,"i",10),n.EFF(2," A data final [F] \xe9 obtida atrav\xe9s do c\xe1lculo:"),n.nrm(3,"br")(4,"br"),n.DNE(5,k,7,3,"ng-container",4)(6,m,27,4,"ng-template",null,1,n.C5r),n.k0s()),2&l){const d=n.sdS(7),f=n.XpG();n.R7$(5),n.Y8G("ngIf",f.useDias)("ngIfElse",d)}}function P(l,c){1&l&&(n.qex(0),n.EFF(1," [DAP]=[HA]+[HP]-([HA]\u2229[HP]) "),n.j41(2,"small"),n.EFF(3,"(Uni\xe3o da quantidade de dias que t\xeam ao menos um Afastamento [HA] ou uma Pausa [HP])"),n.k0s(),n.nrm(4,"br"),n.bVm())}function U(l,c){if(1&l&&(n.qex(0),n.EFF(1," [DC]=[F]-[I] "),n.DNE(2,P,5,0,"ng-container",6),n.EFF(3),n.j41(4,"small"),n.EFF(5,"(Dias \xfateis)"),n.k0s(),n.nrm(6,"br"),n.EFF(7," [HU]=[CH]*[DU] "),n.bVm()),2&l){const d=n.XpG(2);n.R7$(2),n.Y8G("ngIf",d.partial),n.R7$(),n.Lme(" [DU]=[DC]",d.useCorridos?"":"-[FER]-[FDS]","",d.partial?"-[DAP]":""," ")}}function S(l,c){1&l&&(n.qex(0),n.EFF(1," [HAP]=[HA]+[HP]-([HA]\u2229[HP]) "),n.j41(2,"small"),n.EFF(3,"(Uni\xe3o das horas de afastamentos e/ou pausas)"),n.k0s(),n.nrm(4,"br"),n.bVm())}function e(l,c){if(1&l&&(n.EFF(0," [EX]=[HFE]-[HIE]-[TIN]"),n.nrm(1,"br"),n.EFF(2," [SHI]=[I]-[IE] "),n.j41(3,"small"),n.EFF(4,"(Saldo inicial, horas a partir do in\xedcio do expediente [IE] at\xe9 a data e hora inicial [I])"),n.k0s(),n.nrm(5,"br"),n.EFF(6," [SHF]=[HFE]-[F] "),n.j41(7,"small"),n.EFF(8,"(Saldo final, horas a partir da data e hora final [F] at\xe9 o fim do expediente [HFE])"),n.k0s(),n.nrm(9,"br"),n.DNE(10,S,5,0,"ng-container",6),n.EFF(11," [DU]=[DC](-[FER]-[FDS])"),n.nrm(12,"br"),n.EFF(13)),2&l){const d=n.XpG(2);n.R7$(10),n.Y8G("ngIf",d.partial),n.R7$(3),n.SpI(" [HU]=[CH]*[DU](-[SHI]-[SHF])",d.partial?"-[HAP]":""," ")}}function G(l,c){if(1&l&&(n.j41(0,"div",9),n.nrm(1,"i",10),n.EFF(2," As horas s\xe3o obtidas atrav\xe9s do c\xe1lculo:"),n.nrm(3,"br")(4,"br"),n.DNE(5,U,8,3,"ng-container",4)(6,e,14,2,"ng-template",null,2,n.C5r),n.k0s()),2&l){const d=n.sdS(7),f=n.XpG();n.R7$(5),n.Y8G("ngIf",f.useDias)("ngIfElse",d)}}function F(l,c){1&l&&(n.qex(0),n.EFF(1," * O c\xe1lculo para dias corridos n\xe3o considera feriados nem fins de semana e levar\xe1 em considera\xe7\xe3o o expediente da unidade "),n.bVm())}function R(l,c){if(1&l&&n.DNE(0,F,2,0,"ng-container",6),2&l){const d=n.XpG(2);n.Y8G("ngIf",d.useCorridos)}}function O(l,c){1&l&&n.DNE(0,R,1,1,"ng-template")}function q(l,c){1&l&&(n.qex(0),n.EFF(1," * O c\xe1lculo para horas corridas N\xc3O considera o expediente da unidade, APENAS leva em considera\xe7\xe3o afastamentos [HA] e pausas [HP] "),n.bVm())}function j(l,c){if(1&l&&n.DNE(0,q,2,0,"ng-container",6),2&l){const d=n.XpG();n.Y8G("ngIf",d.useCorridos)}}function $(l,c){if(1&l&&(n.j41(0,"span",11),n.EFF(1),n.k0s()),2&l){const d=c.$implicit;n.R7$(),n.JRh(d)}}function B(l,c){if(1&l&&(n.j41(0,"span"),n.EFF(1),n.nrm(2,"br"),n.k0s()),2&l){const d=c.$implicit,f=n.XpG(2);n.R7$(),n.E5c(" De ",f.util.getDateTimeFormatted(d.data_inicio)," at\xe9 ",f.util.getDateTimeFormatted(d.data_fim)," - ",d.observacoes,"")}}function H(l,c){if(1&l&&(n.j41(0,"span"),n.EFF(1),n.nrm(2,"br"),n.k0s()),2&l){const d=c.$implicit,f=n.XpG(2);n.R7$(),n.Lme(" De ",f.util.getDateTimeFormatted(d.data_inicio)," - ",d.data_fim?"at\xe9 "+f.util.getDateTimeFormatted(d.data_fim):"em aberto","")}}function L(l,c){if(1&l&&(n.qex(0),n.j41(1,"strong"),n.EFF(2),n.k0s(),n.nrm(3,"br"),n.DNE(4,B,3,3,"span",7),n.j41(5,"strong"),n.EFF(6),n.k0s(),n.nrm(7,"br"),n.DNE(8,H,3,2,"span",7),n.bVm()),2&l){const d=n.XpG();n.R7$(2),n.SpI("[HA] Afastamento(s) (",null==d.efemerides||null==d.efemerides.afastamentos?null:d.efemerides.afastamentos.length,"):"),n.R7$(2),n.Y8G("ngForOf",d.efemerides.afastamentos),n.R7$(2),n.SpI("[HP] Pausa(s) (",null==d.efemerides||null==d.efemerides.pausas?null:d.efemerides.pausas.length,"):"),n.R7$(2),n.Y8G("ngForOf",d.efemerides.pausas)}}function M(l,c){if(1&l&&(n.j41(0,"span"),n.EFF(1),n.nrm(2,"br"),n.k0s()),2&l){const d=c.$implicit;n.R7$(),n.Lme(" ",d[0]," - ",d[1],"")}}function X(l,c){if(1&l&&(n.j41(0,"span"),n.EFF(1),n.nrm(2,"br"),n.k0s()),2&l){const d=c.$implicit;n.R7$(),n.Lme(" ",d[0]," - ",d[1],"")}}function g(l,c){if(1&l&&(n.j41(0,"span")(1,"b"),n.EFF(2),n.k0s(),n.EFF(3),n.nrm(4,"br"),n.EFF(5),n.nrm(6,"br"),n.EFF(7),n.nrm(8,"br")(9,"br"),n.k0s()),2&l){const d=c.$implicit,f=n.XpG();n.R7$(2),n.JRh(d.diaSemana),n.R7$(),n.E5c(" - In\xedcio: ",f.util.getDateTimeFormatted(f.data(d.tInicio))," - Fim: ",f.util.getDateTimeFormatted(f.data(d.tFim))," - Total: ",+d.hExpediente.toFixed(2),"h"),n.R7$(2),n.Lme(" Intervalos: Qde(",d.intervalos.length,") - Total de horas(",f.totalHoras(d.intervalos),"h)"),n.R7$(2),n.SpI(" Qde. horas contabilizadas: ",+d.hExpediente.toFixed(2)-f.totalHoras(d.intervalos),"")}}let C=(()=>{class l{constructor(d,f){this.util=d,this.lookup=f,this.partial=!0,this._expediente=[]}ngOnInit(){}get forma(){return this.efemerides?this.lookup.getValue(this.lookup.DIA_HORA_CORRIDOS_OU_UTEIS,this.efemerides.forma):"Desconhecido"}get expediente(){let f=this.lookup.DIA_SEMANA.map(_=>this.efemerides?.expediente[_.code]?.length?_.value+": "+this.efemerides.expediente[_.code].map(T=>T.inicio+" at\xe9 "+T.fim).join(", "):"").filter(_=>_.length);return this.efemerides?.expediente?.especial?.length&&f.push("Especial: "+this.efemerides.expediente.especial.map(_=>this.util.getDateFormatted(_.data)+" - "+_.inicio+" at\xe9 "+_.fim+(_.sem?" (Sem expediente)":"")).join(", ")),JSON.stringify(this._expediente)!=JSON.stringify(f)&&(this._expediente=f),this._expediente}get useDias(){return["DIAS_UTEIS","DIAS_CORRIDOS"].includes(this.efemerides.forma)}get useCorridos(){return["DIAS_CORRIDOS","HORAS_CORRIDAS"].includes(this.efemerides.forma)}isoToFormatted(d){return d.substr(8,2)+"/"+d.substr(5,2)+"/"+d.substr(0,4)}get feriados(){return Object.entries(this.efemerides?.feriados||{}).map(d=>[this.isoToFormatted(d[0]),d[1]])}get diasNaoUteis(){return Object.entries(this.efemerides?.diasNaoUteis||{}).map(d=>[this.isoToFormatted(d[0]),d[1]])}data(d){return new Date(d)}totalHoras(d){return+d.reduce((f,_)=>f+this.util.getHoursBetween(_.start,_.end),0).toFixed(2)}static{this.\u0275fac=function(f){return new(f||l)(n.rXU(z.a),n.rXU(E.s))}}static{this.\u0275cmp=n.VBU({type:l,selectors:[["calendar-efemerides"]],inputs:{efemerides:"efemerides",partial:"partial"},decls:49,vars:23,consts:[["obsUseHoras",""],["dataUseHoras",""],["tempoUseHoras",""],["class","mt-2 alert alert-primary","role","alert",4,"ngIf"],[4,"ngIf","ngIfElse"],["class","ms-2 d-block",4,"ngFor","ngForOf"],[4,"ngIf"],[4,"ngFor","ngForOf"],["collapse","","transparent","",3,"bold","title"],["role","alert",1,"mt-2","alert","alert-primary"],[1,"bi","bi-info-circle-fill"],[1,"ms-2","d-block"]],template:function(f,_){if(1&f&&(n.DNE(0,N,8,2,"div",3)(1,G,8,2,"div",3)(2,O,1,0,null,4)(3,j,1,1,"ng-template",null,0,n.C5r),n.nrm(5,"br"),n.j41(6,"strong"),n.EFF(7,"[I] In\xedcio:"),n.k0s(),n.EFF(8),n.nrm(9,"br"),n.j41(10,"strong"),n.EFF(11,"[F] Fim:"),n.k0s(),n.EFF(12),n.nrm(13,"br"),n.j41(14,"strong"),n.EFF(15,"[DC] Dias corridos:"),n.k0s(),n.EFF(16),n.nrm(17,"br"),n.j41(18,"strong"),n.EFF(19),n.k0s(),n.EFF(20),n.nrm(21,"br"),n.j41(22,"strong"),n.EFF(23),n.k0s(),n.EFF(24),n.nrm(25,"br"),n.j41(26,"strong"),n.EFF(27,"[FC] Forma de c\xe1lculo:"),n.k0s(),n.EFF(28),n.nrm(29,"br"),n.j41(30,"strong"),n.EFF(31,"[CH] Carga hor\xe1ria:"),n.k0s(),n.EFF(32),n.nrm(33,"br"),n.j41(34,"strong"),n.EFF(35,"Expediente (nos dias da semana):"),n.k0s(),n.nrm(36,"br"),n.DNE(37,$,2,1,"span",5)(38,L,9,4,"ng-container",6),n.j41(39,"strong"),n.EFF(40),n.k0s(),n.nrm(41,"br"),n.DNE(42,M,3,2,"span",7),n.j41(43,"strong"),n.EFF(44),n.k0s(),n.nrm(45,"br"),n.DNE(46,X,3,2,"span",7),n.j41(47,"separator",8),n.DNE(48,g,10,7,"span",7),n.k0s()),2&f){const T=n.sdS(4);n.Y8G("ngIf","DATA"==(null==_.efemerides?null:_.efemerides.resultado)),n.R7$(),n.Y8G("ngIf","TEMPO"==(null==_.efemerides?null:_.efemerides.resultado)),n.R7$(),n.Y8G("ngIf",_.useDias)("ngIfElse",T),n.R7$(6),n.SpI(" ",_.util.getDateTimeFormatted(null==_.efemerides?null:_.efemerides.inicio),""),n.R7$(4),n.SpI(" ",_.util.getDateTimeFormatted(null==_.efemerides?null:_.efemerides.fim),""),n.R7$(4),n.SpI(" ",null==_.efemerides?null:_.efemerides.dias_corridos,""),n.R7$(3),n.SpI("[HU] Horas ",_.useCorridos?"corridas":"\xfateis",":"),n.R7$(),n.SpI(" ",_.util.decimalToTimerFormated(null==_.efemerides?null:_.efemerides.tempoUtil,!0),""),n.R7$(3),n.SpI("[HNU] Horas ",_.useCorridos?"n\xe3o contabilizadas":"n\xe3o \xfateis",":"),n.R7$(),n.SpI(" ",_.util.decimalToTimerFormated(null==_.efemerides?null:_.efemerides.horasNaoUteis,!0),""),n.R7$(4),n.SpI(" ",_.forma,""),n.R7$(4),n.Lme(" ",_.util.decimalToTimerFormated(null==_.efemerides?null:_.efemerides.cargaHoraria,!0),"",_.useCorridos?" - Utilizada: 24h/dia":"",""),n.R7$(5),n.Y8G("ngForOf",_.expediente),n.R7$(),n.Y8G("ngIf",_.partial),n.R7$(2),n.SpI("[DNU] Dias n\xe3o \xfateis (",_.diasNaoUteis.length,"):"),n.R7$(2),n.Y8G("ngForOf",_.diasNaoUteis),n.R7$(2),n.SpI("[FER] Feriado(s) (",_.feriados.length,"):"),n.R7$(2),n.Y8G("ngForOf",_.feriados),n.R7$(),n.Y8G("bold",!0)("title","Detalhes dia-a-dia ("+(null==_.efemerides||null==_.efemerides.diasDetalhes?null:_.efemerides.diasDetalhes.length)+"):"),n.R7$(),n.Y8G("ngForOf",null==_.efemerides?null:_.efemerides.diasDetalhes)}},dependencies:[D.Sq,D.bT,v.F]})}}return l})()}}]);
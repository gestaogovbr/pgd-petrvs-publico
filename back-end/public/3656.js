"use strict";(self.webpackChunkpetrvs=self.webpackChunkpetrvs||[]).push([[3656],{9036:(oe,$,r)=>{r.d($,{l:()=>I});var A=r(4423),Y=r(3279);let I=(()=>{class b extends A.F{constructor(c){super("Avaliacao",c),this.injector=c,this.inputSearchConfig.searchFields=[]}cancelarAvaliacao(c){return new Promise((f,R)=>{this.server.post("api/"+this.collection+"/cancelar-avaliacao",{id:c}).subscribe(P=>{P?.error?R(P?.error):f(!0)},P=>R(P))})}recorrer(c,f){return new Promise((R,P)=>{this.server.post("api/"+this.collection+"/recorrer",{id:c.id,recurso:f}).subscribe(D=>{D?.error?P(D?.error):(c.recurso=f,R(!0))},D=>P(D))})}static{this.\u0275fac=function(f){return new(f||b)(Y.KVO(Y.zZn))}}static{this.\u0275prov=Y.jDH({token:b,factory:b.\u0275fac,providedIn:"root"})}}return b})()},3656:(oe,$,r)=>{r.r($),r.d($,{PlanoEntregaModule:()=>yo});var A=r(6610),Y=r(9455),I=r(8069),b=r(1620),C=r(6819),c=r(3308),f=r(5611),R=r(8467),P=r(6149),D=r(9416),y=r(3535),N=r(291);class w extends N.C{constructor(s){super(),this.entregas=[],this.status_historico=[],this.data_inicio=new Date,this.data_fim=null,this.nome="",this.metadados=void 0,this.arquivar=!1,this.status="INCLUIDO",this.avaliacoes=[],this.unidade_id="",this.avaliacao_id=null,this.plano_entrega_id=null,this.planejamento_id=null,this.cadeia_valor_id=null,this.programa_id=null,this.initialization(s)}}var d=r(9062),m=r(1928),p=r(9036),T=r(976),O=r(8790),e=r(3279),v=r(2034),h=r(5852),G=r(7772),U=r(2305),M=r(6764),ie=r(114),k=r(9226),q=r(16),V=r(5524),X=r(3678),J=r(9898),L=r(5201),Ie=r(3400),j=r(1641),S=r(8717),x=r(418),B=r(4795),se=r(1230),H=r(8857),Q=r(3881),W=r(368),le=r(8311),De=r(7072);const Re=()=>["PORCENTAGEM"],Ge=()=>["QUANTIDADE","VALOR"],je=()=>["QUALITATIVO"],ye=()=>[];function Ne(o,s){if(1&o){const t=e.RV6();e.j41(0,"input-number",3),e.bIt("change",function(n){e.eBV(t);const i=e.XpG();return e.Njj(i.onValueChange(n))}),e.k0s()}if(2&o){const t=e.XpG();e.Y8G("disabled",t.disabled)("icon",t.icon)("label",t.label||"Porcentagem")("control",t.control)("labelInfo",t.labelInfo)}}function Le(o,s){if(1&o){const t=e.RV6();e.j41(0,"input-number",4),e.bIt("change",function(n){e.eBV(t);const i=e.XpG();return e.Njj(i.onValueChange(n))}),e.k0s()}if(2&o){const t=e.XpG();e.Y8G("disabled",t.disabled)("icon",t.icon)("label",t.label||"Num\xe9rico")("control",t.control)("labelInfo",t.labelInfo)}}function Se(o,s){if(1&o){const t=e.RV6();e.j41(0,"input-select",5),e.bIt("change",function(n){e.eBV(t);const i=e.XpG();return e.Njj(i.onValueChange(n))}),e.k0s()}if(2&o){const t=e.XpG();e.Y8G("disabled",t.disabled)("icon",t.icon)("label",t.label||"Qualitativo")("control",t.control)("items",(null==t.entrega?null:t.entrega.lista_qualitativos)||e.lJ4(6,ye))("labelInfo",t.labelInfo)}}let te=(()=>{class o{constructor(){this.class="form-group",this.icon="",this.labelInfo="",this._size=0}set size(t){t!=this._size&&(this._size=t,this.class=this.class.replace(/\scol\-md\-[0-9]+/g,"")+" col-md-"+t)}get size(){return this._size||12}checkTipoIndicador(t){return t.includes(this.entrega?.tipo_indicador||"")}onValueChange(t){this.change&&this.change(this.control?.value,this.entrega)}static{this.\u0275fac=function(a){return new(a||o)}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["plano-entrega-valor-meta-input"]],hostVars:2,hostBindings:function(a,n){2&a&&e.HbH(n.class)},inputs:{entrega:"entrega",icon:"icon",label:"label",labelInfo:"labelInfo",disabled:"disabled",control:"control",change:"change",size:"size"},decls:3,vars:6,consts:[["sufix","%","required","",3,"disabled","icon","label","control","labelInfo","change",4,"ngIf"],["required","",3,"disabled","icon","label","control","labelInfo","change",4,"ngIf"],["required","",3,"disabled","icon","label","control","items","labelInfo","change",4,"ngIf"],["sufix","%","required","",3,"change","disabled","icon","label","control","labelInfo"],["required","",3,"change","disabled","icon","label","control","labelInfo"],["required","",3,"change","disabled","icon","label","control","items","labelInfo"]],template:function(a,n){1&a&&e.DNE(0,Ne,1,5,"input-number",0)(1,Le,1,5,"input-number",1)(2,Se,1,7,"input-select",2),2&a&&(e.Y8G("ngIf",n.checkTipoIndicador(e.lJ4(3,Re))),e.R7$(),e.Y8G("ngIf",n.checkTipoIndicador(e.lJ4(4,Ge))),e.R7$(),e.Y8G("ngIf",n.checkTipoIndicador(e.lJ4(5,je))))},dependencies:[A.bT,X.K,W.n]})}}return o})();const ke=["etiqueta"];function Ve(o,s){if(1&o&&(e.j41(0,"strong",17),e.EFF(1,"Entregas: "),e.k0s(),e.j41(2,"span",18),e.nrm(3,"badge",19),e.k0s()),2&o){const t=s.separator;e.R7$(3),e.Y8G("label",null==t?null:t.text)}}function Fe(o,s){if(1&o&&e.nrm(0,"badge",24),2&o){const t=e.XpG().row,a=e.XpG();e.Y8G("icon",a.entityService.getIcon("Unidade"))("label",t.unidade.sigla)}}function Ye(o,s){if(1&o&&e.nrm(0,"badge",25),2&o){const t=e.XpG().row;e.Y8G("label",t.destinatario)}}function ze(o,s){if(1&o&&e.nrm(0,"reaction",26),2&o){const t=e.XpG().row;e.Y8G("entity",t)}}function $e(o,s){if(1&o&&(e.j41(0,"h6"),e.EFF(1),e.k0s(),e.j41(2,"span",20),e.DNE(3,Fe,1,2,"badge",21)(4,Ye,1,1,"badge",22),e.k0s(),e.DNE(5,ze,1,1,"reaction",23)),2&o){const t=s.row,a=e.XpG();e.R7$(),e.JRh(t.descricao),e.R7$(2),e.Y8G("ngIf",t.unidade),e.R7$(),e.Y8G("ngIf",null==t.destinatario?null:t.destinatario.length),e.R7$(),e.Y8G("ngIf",a.execucao)}}function we(o,s){1&o&&e.nrm(0,"badge",28),2&o&&e.Y8G("lookup",s.$implicit)}function Be(o,s){1&o&&e.DNE(0,we,1,1,"badge",27),2&o&&e.Y8G("ngForOf",s.row.etiquetas)}function Ue(o,s){if(1&o){const t=e.RV6();e.j41(0,"input-multiselect",29)(1,"input-select",30,8),e.bIt("details",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.onEtiquetaConfigClick())}),e.k0s()()}if(2&o){const t=e.XpG();e.Y8G("size",12)("control",t.formEdit.controls.etiquetas)("addItemHandle",t.addItemHandleEtiquetas.bind(t)),e.R7$(),e.Y8G("size",12)("control",t.formEdit.controls.etiqueta)("items",t.etiquetas)}}function Me(o,s){if(1&o&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&o){const t=e.XpG().row,a=e.XpG();e.R7$(),e.SpI(" ",a.dao.getDateFormatted(t.data_inicio),"")}}function qe(o,s){if(1&o&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&o){const t=e.XpG().row,a=e.XpG();e.R7$(),e.SpI(" ",a.dao.getDateFormatted(t.data_fim),"")}}function Xe(o,s){if(1&o&&(e.DNE(0,Me,2,1,"span",31),e.nrm(1,"br"),e.DNE(2,qe,2,1,"span",31)),2&o){const t=s.row;e.Y8G("ngIf",t.data_inicio),e.R7$(2),e.Y8G("ngIf",t.data_fim)}}function xe(o,s){if(1&o&&e.nrm(0,"badge",32)(1,"br")(2,"badge",33),2&o){const t=s.row,a=e.XpG();e.Y8G("textValue",a.planoEntregaService.getValorMeta(t)),e.R7$(2),e.Y8G("textValue",a.planoEntregaService.getValorRealizado(t))}}function He(o,s){if(1&o&&e.nrm(0,"plano-entrega-valor-meta-input",34)(1,"plano-entrega-valor-meta-input",35),2&o){const t=s.row,a=e.XpG();e.Y8G("entrega",t.entrega)("size",6)("control",a.form.controls.meta),e.R7$(),e.Y8G("entrega",t.entrega)("size",6)("control",a.form.controls.realizado)("change",a.onRealizadaChange.bind(a))}}function Qe(o,s){1&o&&e.nrm(0,"i",42)}function Je(o,s){if(1&o&&(e.j41(0,"tr")(1,"td"),e.DNE(2,Qe,1,0,"i",40),e.k0s(),e.j41(3,"td",41),e.EFF(4),e.k0s()()),2&o){const t=s.$implicit;e.R7$(2),e.Y8G("ngIf",t.checked),e.R7$(2),e.JRh(t.texto)}}function We(o,s){if(1&o&&(e.j41(0,"table"),e.DNE(1,Je,5,2,"tr",39),e.k0s()),2&o){const t=e.XpG(2).row;e.R7$(),e.Y8G("ngForOf",t.checklist)}}function Ke(o,s){if(1&o&&(e.j41(0,"separator",38),e.DNE(1,We,2,1,"table",31),e.k0s()),2&o){const t=e.XpG().row;e.Y8G("collapsed",!0),e.R7$(),e.Y8G("ngIf",null==t.checklist?null:t.checklist.length)}}function Ze(o,s){if(1&o&&(e.nrm(0,"progress-bar",36),e.DNE(1,Ke,2,2,"separator",37)),2&o){const t=s.row;e.Y8G("value",t.progresso_realizado)("goal",t.progresso_esperado),e.R7$(),e.Y8G("ngIf",null==t.checklist?null:t.checklist.length)}}function et(o,s){1&o&&e.nrm(0,"separator",45)}function tt(o,s){if(1&o&&(e.j41(0,"tr")(1,"td"),e.nrm(2,"input-switch",46),e.k0s(),e.j41(3,"td",41),e.EFF(4),e.k0s()()),2&o){const t=s.$implicit,a=s.index,n=e.XpG(4);e.R7$(2),e.Y8G("size",12)("source",n.checklist)("path",a+".checked"),e.R7$(2),e.JRh(t.texto)}}function at(o,s){if(1&o&&(e.j41(0,"table"),e.DNE(1,tt,5,4,"tr",39),e.k0s()),2&o){const t=e.XpG(3);e.R7$(),e.Y8G("ngForOf",t.checklist)}}function nt(o,s){if(1&o&&(e.nrm(0,"input-number",43),e.DNE(1,et,1,0,"separator",44)(2,at,2,1,"table",31)),2&o){const t=s.row,a=e.XpG(2);e.Y8G("size",12)("control",a.formEdit.controls.progresso_realizado),e.R7$(),e.Y8G("ngIf",null==t.checklist?null:t.checklist.length),e.R7$(),e.Y8G("ngIf",null==t.checklist?null:t.checklist.length)}}function ot(o,s){if(1&o&&(e.j41(0,"column",13),e.DNE(1,Ze,2,3,"ng-template",null,9,e.C5r)(3,nt,3,4,"ng-template",null,10,e.C5r),e.k0s()),2&o){const t=e.sdS(2),a=e.sdS(4),n=e.XpG();e.Y8G("title","Progresso\nChecklist")("width",200)("template",t)("editTemplate",t)("columnEditTemplate",n.selectable?void 0:a)("edit",n.selectable?void 0:n.onColumnChecklistEdit.bind(n))("save",n.selectable?void 0:n.onColumnChecklistSave.bind(n))}}function it(o,s){if(1&o&&e.nrm(0,"badge",49),2&o){const t=e.XpG().row;e.Y8G("label",null==t.entrega?null:t.entrega.nome)}}function st(o,s){if(1&o&&(e.DNE(0,it,1,1,"badge",47),e.nrm(1,"comentarios-widget",48)),2&o){const t=s.row,a=e.XpG();e.Y8G("ngIf",t.entrega),e.R7$(),e.Y8G("entity",t)("selectable",!a.execucao||!(null==a.grid||!a.grid.editing))("grid",a.grid)("save",a.refreshComentarios.bind(a))}}let re=(()=>{class o extends B.g{set noPersist(t){super.noPersist=t}get noPersist(){return super.noPersist}set control(t){super.control=t}get control(){return super.control}set entity(t){super.entity=t}get entity(){return super.entity}set planejamentoId(t){this._planejamentoId!=t&&(this._planejamentoId=t)}get planejamentoId(){return this._planejamentoId}set cadeiaValorId(t){this._cadeiaValorId!=t&&(this._cadeiaValorId=t)}get cadeiaValorId(){return this._cadeiaValorId}set unidadeId(t){this._unidadeId!=t&&(this._unidadeId=t)}get unidadeId(){return this._unidadeId}set dataFim(t){this._dataFim!=t&&(this._dataFim=t)}get dataFim(){return this._dataFim}get items(){return this.gridControl.value||this.gridControl.setValue([]),this.gridControl.value}constructor(t){super(t),this.injector=t,this.disabled=!1,this.execucao=!1,this.entityToControl=a=>a.entregas||[],this.options=[],this.planoEntregaId="",this.etiquetas=[],this.etiquetasAscendentes=[],this.selectable=!1,this.validate=(a,n)=>{let i=null;return["nome"].indexOf(n)>=0&&!a.value?.length&&(i="Obrigat\xf3rio"),i},this.filterWhere=a=>{let n=[];return n.push(["plano_entrega_id","==",this.planoEntregaId]),n},this.title=this.lex.translate("Entregas"),this.join=["unidade","entrega","reacoes.usuario:id,nome,apelido","produtos"],this.code="MOD_PENT",this.cdRef=t.get(e.gRc),this.dao=t.get(S.o),this.unidadeDao=t.get(y.s),this.planoEntregaService=t.get(m.C),this.form=this.fh.FormBuilder({descricao:{default:""},data_inicio:{default:new Date},data_fim:{default:new Date},meta:{default:""},realizado:{default:null},entrega_id:{default:null},unidade_id:{default:null},progresso_esperado:{default:null},progresso_realizado:{default:null},destinatario:{default:null},etiquetas:{default:[]}},this.cdRef,this.validate),this.formEdit=this.fh.FormBuilder({progresso_realizado:{default:0},etiquetas:{default:[]},etiqueta:{default:null}}),this.addOption(Object.assign({onClick:this.consult.bind(this)},this.OPTION_INFORMACOES),"MOD_PENT"),this.addOption(Object.assign({onClick:this.delete.bind(this)},this.OPTION_EXCLUIR),"MOD_PENT_ENTR_EXCL"),this.addOption(Object.assign({onClick:this.showLogs.bind(this)},this.OPTION_LOGS),"MOD_AUDIT_LOG")}ngOnInit(){super.ngOnInit(),this.planoEntregaId=this.urlParams.get("id")||""}get isDisabled(){return this.formDisabled||this.disabled}add(){var t=this;return(0,c.A)(function*(){let a=new x.j({_status:"ADD",id:t.dao.generateUuid(),plano_entrega_id:t.entity?.id});var n;t.go.navigate({route:["gestao","plano-entrega","entrega"]},{metadata:{plano_entrega:t.entity,planejamento_id:t.planejamentoId,cadeia_valor_id:t.cadeiaValorId,unidade_id:t.unidadeId,data_fim:t.dataFim,entrega:a},modalClose:(n=(0,c.A)(function*(i){if(i)try{t.items.push(t.isNoPersist?i:yield t.dao.save(i,t.join)),t.cdRef.detectChanges()}catch(l){t.error(l?.error||l?.message||l)}}),function(l){return n.apply(this,arguments)})})})()}dynamicOptions(t){return this.execucao||this.isDisabled?[]:this.options}dynamicButtons(t){const a=[];return this.isDisabled&&a.push(Object.assign({onClick:this.consult.bind(this)},this.OPTION_INFORMACOES)),this.execucao&&a.push({label:"Hist\xf3rico de execu\xe7\xe3o",icon:"bi bi-activity",color:"btn-outline-info",onClick:this.showProgresso.bind(this)}),t._status||a.push({label:"Detalhes",icon:"bi bi-eye",color:"btn-outline-success",onClick:this.showDetalhes.bind(this)}),a}edit(t){var a=this;return(0,c.A)(function*(){if(a.execucao)a.grid.edit(t);else{t._status="ADD"==t._status?"ADD":"EDIT";let n=a.items.indexOf(t);a.go.navigate({route:["gestao","plano-entrega","entrega"]},{metadata:{plano_entrega:a.entity,planejamento_id:a.planejamentoId,cadeia_valor_id:a.cadeiaValorId,unidade_id:a.unidadeId,entrega:t},modalClose:(i=(0,c.A)(function*(l){l&&(a.isNoPersist||(yield a.dao?.save(l)),a.items[n]=l)}),function(u){return i.apply(this,arguments)})})}var i})()}load(t,a){var n=this;return(0,c.A)(function*(){n.form.patchValue(a),n.form.controls.meta.setValue(n.planoEntregaService.getValor(a.meta)),n.form.controls.realizado.setValue(n.planoEntregaService.getValor(a.realizado)),n.cdRef.detectChanges()})()}save(t,a){var n=this;return(0,c.A)(function*(){let i;if(n.form.markAllAsTouched(),t.valid){n.submitting=!0;try{i=yield n.dao?.update(a.id,{realizado:n.planoEntregaService.getEntregaValor(a.entrega,t.controls.realizado.value),progresso_realizado:t.controls.progresso_realizado.value},n.join)}finally{n.submitting=!1}}return i})()}delete(t){var a=this;return(0,c.A)(function*(){if(yield a.dialog.confirm("Exclui ?","Deseja realmente excluir?")){let i=a.items.indexOf(t);a.isNoPersist?t._status="DELETE":a.dao.delete(t).then(()=>{a.items.splice(i,1),a.cdRef.detectChanges(),a.dialog.topAlert("Registro exclu\xeddo com sucesso!",5e3)}).catch(l=>{a.dialog.alert("Erro","Erro ao excluir: "+(l?.message?l?.message:l))})}})()}consult(t){var a=this;return(0,c.A)(function*(){a.go.navigate({route:["gestao","plano-entrega","entrega",t.id,"consult"]},{metadata:{plano_entrega:a.entity,planejamento_id:a.planejamentoId,cadeia_valor_id:a.cadeiaValorId,unidade_id:a.unidadeId,entrega:t}})})()}showLogs(t){var a=this;return(0,c.A)(function*(){a.go.navigate({route:["logs","change",t.id,"consult"]})})()}showPlanejamento(t){var a=this;return(0,c.A)(function*(){a.go.navigate({route:["gestao","plano-entrega","entrega","objetivos",t]},{modal:!0})})()}showCadeiaValor(t){var a=this;return(0,c.A)(function*(){a.go.navigate({route:["gestao","plano-entrega","entrega","processos",t]},{modal:!0})})()}showProgresso(t){var a=this;return(0,c.A)(function*(){a.go.navigate({route:["gestao","plano-entrega","entrega","progresso",t.id]},{modal:!0,modalClose:n=>{a.parent?.refresh(a.entity?.id)}})})()}showDetalhes(t){var a=this;return(0,c.A)(function*(){a.go.navigate({route:["gestao","plano-entrega","entrega",t.id,"detalhes"]},{metadata:{plano_entrega:a.entity,planejamento_id:a.planejamentoId,cadeia_valor_id:a.cadeiaValorId,unidade_id:a.unidadeId,entrega:t}})})()}refreshComentarios(t){let a=this.items.find(n=>n.id==t.id);a&&(a.comentarios=t.comentarios||[])}onRealizadaChange(){const t=this.form?.controls.meta.value,a=this.form?.controls.realizado.value;if(t&&a){let n=isNaN(a)?0:(a/t*100).toFixed(0)||0;this.form?.controls.progresso_realizado.setValue(n)}}addItemHandleEtiquetas(){let t;if(this.etiqueta&&this.etiqueta.selectedItem){const a=this.etiqueta.selectedItem,n=a.key?.length?a.key:this.util.textHash(a.value);this.util.validateLookupItem(this.formEdit.controls.etiqueta.value,n)&&(t={key:n,value:a.value,color:a.color,icon:a.icon},this.formEdit.controls.etiqueta.setValue(null))}return t}onColumnEtiquetasEdit(t){var a=this;return(0,c.A)(function*(){if(!a.etiquetasAscendentes.filter(n=>n.data==t.unidade.id).length){let n=yield a.carregaEtiquetasUnidadesAscendentes(t.unidade);a.etiquetasAscendentes.push(...n)}a.formEdit.controls.etiquetas.setValue(t.etiquetas),a.formEdit.controls.etiqueta.setValue(null),a.etiquetas=a.util.merge(t.tipo_atividade?.etiquetas,t.unidade?.etiquetas,(n,i)=>n.key==i.key),a.etiquetas=a.util.merge(a.etiquetas,a.auth.usuario.config?.etiquetas,(n,i)=>n.key==i.key),a.etiquetas=a.util.merge(a.etiquetas,a.etiquetasAscendentes.filter(n=>n.data==t.unidade.id),(n,i)=>n.key==i.key)})()}carregaEtiquetasUnidadesAscendentes(t){var a=this;return(0,c.A)(function*(){let n=[],i=t.path.split("/");return(yield a.unidadeDao.query({where:[["id","in",i]]}).asPromise()).forEach(u=>{n=a.util.merge(n,u.etiquetas,(g,_)=>g.key==_.key)}),n.forEach(u=>u.data=t.id),n})()}onColumnEtiquetasSave(t){var a=this;return(0,c.A)(function*(){try{const n=yield a.dao.update(t.id,{etiquetas:a.formEdit.controls.etiquetas.value});return t.etiquetas=a.formEdit.controls.etiquetas.value,!!n}catch{return!1}})()}onEtiquetaConfigClick(){this.go.navigate({route:["configuracoes","preferencia","usuario",this.auth.usuario.id],params:{etiquetas:!0}},{modal:!0,modalClose:t=>{this.etiquetas=this.util.merge(this.etiquetas,this.auth.usuario.config?.etiquetas,(a,n)=>a.key==n.key),this.cdRef.detectChanges()}})}onColumnChecklistEdit(t){var a=this;return(0,c.A)(function*(){a.formEdit.controls.progresso_realizado.setValue(t.progresso_realizado),a.checklist=a.util.clone(t.checklist)})()}onColumnChecklistSave(t){var a=this;return(0,c.A)(function*(){let n=Math.round(parseInt(a.planoEntregaService.getValorMeta(t))*a.formEdit.controls.progresso_realizado.value/100);try{const i=yield a.dao.update(t.id,{progresso_realizado:a.formEdit.controls.progresso_realizado.value,realizado:a.planoEntregaService.getEntregaValor(t.entrega,n),checklist:a.checklist});return t.progresso_realizado=a.formEdit.controls.progresso_realizado.value,t.checklist=a.checklist,typeof t.realizado.porcentagem<"u"?t.realizado.porcentagem=n:typeof t.realizado.quantitativo<"u"?t.realizado.quantitativo=n:typeof t.realizado.valor<"u"&&(t.realizado.valor=n),!!i}catch{return!1}})()}getObjetivos(t){return t.objetivos.filter(a=>"DELETE"!=a._status)}static{this.\u0275fac=function(a){return new(a||o)(e.rXU(e.zZn))}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["plano-entrega-list-entrega"]],viewQuery:function(a,n){if(1&a&&(e.GBs(j.Q,5),e.GBs(f._,5),e.GBs(ke,5)),2&a){let i;e.mGM(i=e.lsd())&&(n.editableForm=i.first),e.mGM(i=e.lsd())&&(n.grid=i.first),e.mGM(i=e.lsd())&&(n.etiqueta=i.first)}},inputs:{cdRef:"cdRef",disabled:"disabled",parent:"parent",noPersist:"noPersist",control:"control",entity:"entity",planejamentoId:"planejamentoId",cadeiaValorId:"cadeiaValorId",unidadeId:"unidadeId",dataFim:"dataFim",execucao:"execucao"},features:[e.Vt3],decls:25,vars:35,consts:[["groupEntregas",""],["columnEntregaCliente",""],["columnEtiquetas",""],["columnEtiquetasEdit",""],["columnDatas",""],["columnMetaRealizado",""],["editMetaRealizado",""],["columnEntregaCometario",""],["etiqueta",""],["columnProgChecklist",""],["columnChecklistEdit",""],[3,"items","form","groupTemplate","minHeight","editable","hasAdd","add","hasEdit","load","save","selectable"],[3,"title","template","editTemplate"],[3,"title","width","template","editTemplate","columnEditTemplate","edit","save"],[3,"title","width","template","editTemplate"],[3,"title","width","template","editTemplate","columnEditTemplate","edit","save",4,"ngIf"],["type","options",3,"onEdit","dynamicButtons","dynamicOptions"],[1,"grid-group-text"],[1,"text-wrap"],["color","primary",3,"label"],[1,"d-block"],["color","light",3,"icon","label",4,"ngIf"],["color","light","icon","bi bi-mailbox",3,"label",4,"ngIf"],["origem","PLANO_ENTREGA_ENTREGA",3,"entity",4,"ngIf"],["color","light",3,"icon","label"],["color","light","icon","bi bi-mailbox",3,"label"],["origem","PLANO_ENTREGA_ENTREGA",3,"entity"],[3,"lookup",4,"ngFor","ngForOf"],[3,"lookup"],["controlName","etiquetas",3,"size","control","addItemHandle"],["controlName","etiqueta","nullable","","itemNull","- Selecione -","detailsButton","","detailsButtonIcon","bi bi-tools",3,"details","size","control","items"],[4,"ngIf"],["icon","bi bi-graph-up-arrow","color","light","hint","Planejada",3,"textValue"],["icon","bi bi-check-lg","color","light","hint","Realizada",3,"textValue"],["icon","bi bi-graph-up-arrow","disabled","","label","Meta",3,"entrega","size","control"],["icon","bi bi-check-lg","label","Realizada",3,"entrega","size","control","change"],["color","success",3,"value","goal"],["small","","title","Checklist","collapse","",3,"collapsed",4,"ngIf"],["small","","title","Checklist","collapse","",3,"collapsed"],[4,"ngFor","ngForOf"],["class","bi bi-check-circle",4,"ngIf"],[1,"micro-text","fw-ligh"],[1,"bi","bi-check-circle"],["label","Realizado","sufix","%","icon","bi bi-clock","controlName","progresso_realizado","labelInfo","Progresso de execu\xe7\xe3o (% Conclu\xeddo)",3,"size","control"],["small","","title","Checklist",4,"ngIf"],["small","","title","Checklist"],["scale","small",3,"size","source","path"],["color","light","icon","bi bi-list-check",3,"label",4,"ngIf"],["origem","PLANO_ENTREGA_ENTREGA",3,"entity","selectable","grid","save"],["color","light","icon","bi bi-list-check",3,"label"]],template:function(a,n){if(1&a&&(e.j41(0,"grid",11),e.DNE(1,Ve,4,1,"ng-template",null,0,e.C5r),e.j41(3,"columns")(4,"column",12),e.DNE(5,$e,6,4,"ng-template",null,1,e.C5r),e.k0s(),e.j41(7,"column",13),e.DNE(8,Be,1,1,"ng-template",null,2,e.C5r)(10,Ue,3,6,"ng-template",null,3,e.C5r),e.k0s(),e.j41(12,"column",12),e.DNE(13,Xe,3,2,"ng-template",null,4,e.C5r),e.k0s(),e.j41(15,"column",14),e.DNE(16,xe,3,2,"ng-template",null,5,e.C5r)(18,He,2,7,"ng-template",null,6,e.C5r),e.k0s(),e.DNE(20,ot,5,7,"column",15),e.j41(21,"column",12),e.DNE(22,st,2,5,"ng-template",null,7,e.C5r),e.k0s(),e.nrm(24,"column",16),e.k0s()()),2&a){const i=e.sdS(2),l=e.sdS(6),u=e.sdS(9),g=e.sdS(11),_=e.sdS(14),E=e.sdS(17),z=e.sdS(19),F=e.sdS(23);e.Y8G("items",n.items)("form",n.form)("groupTemplate",i)("minHeight",300)("editable",n.isDisabled?void 0:"true")("hasAdd",!n.isDisabled&&n.auth.hasPermissionTo("MOD_PENT_ENTR_INCL")&&!n.execucao)("add",n.add.bind(n))("hasEdit",!n.isDisabled&&n.auth.hasPermissionTo("MOD_PENT_ENTR_EDT"))("load",n.load.bind(n))("save",n.save.bind(n))("selectable",n.selectable),e.R7$(4),e.Y8G("title","Entrega\nDemandante/Destinat\xe1rio")("template",l)("editTemplate",l),e.R7$(3),e.Y8G("title","Etiquetas")("width",100)("template",u)("editTemplate",u)("columnEditTemplate",n.selectable?void 0:g)("edit",n.selectable?void 0:n.onColumnEtiquetasEdit.bind(n))("save",n.selectable?void 0:n.onColumnEtiquetasSave.bind(n)),e.R7$(5),e.Y8G("title","Data In\xedcio\nData Fim")("template",_)("editTemplate",_),e.R7$(3),e.Y8G("title","Meta")("width",100)("template",E)("editTemplate",z),e.R7$(5),e.Y8G("ngIf",n.execucao),e.R7$(),e.Y8G("title",n.lex.translate("Modelo de Entrega")+"\nComent\xe1rios")("template",F)("editTemplate",F),e.R7$(3),e.Y8G("onEdit",n.edit.bind(n))("dynamicButtons",n.dynamicButtons.bind(n))("dynamicOptions",n.dynamicOptions.bind(n))}},dependencies:[A.Sq,A.bT,f._,v.T,h.I,ie.S,X.K,se.b,H.F,L.n,Q.a,W.n,le.T,De.c,te],styles:[".objetivo[_ngcontent-%COMP%]{border-bottom:1px solid #ddd;padding:2px 0}"]})}}return o})();const lt=()=>["CONCLUIDO","AVALIADO"];function rt(o,s){if(1&o){const t=e.RV6();e.j41(0,"input-switch",29),e.bIt("change",function(n){e.eBV(t);const i=e.XpG(2);return e.Njj(i.onPrincipaisChange(n))}),e.k0s()}if(2&o){const t=e.XpG(2);e.Y8G("size",2)("control",t.filter.controls.principais)("labelInfo",t.lex.translate("Unidades")+" onde o "+t.lex.translate("usuario")+" \xe9 integrante, incluindo unidades superiores sob sua ger\xeancia.")}}function dt(o,s){if(1&o){const t=e.RV6();e.j41(0,"toolbar",26)(1,"input-switch",27),e.bIt("change",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.disableMeus())}),e.k0s(),e.DNE(2,rt,1,3,"input-switch",28),e.k0s()}if(2&o){const t=e.XpG();e.Y8G("buttons",t.toolbarButtons),e.R7$(),e.Y8G("size",4)("control",t.filter.controls.subordinadas),e.R7$(),e.Y8G("ngIf",!t.avaliacao)}}function ut(o,s){if(1&o){const t=e.RV6();e.j41(0,"div")(1,"div",30)(2,"input-switch",31),e.bIt("change",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.disableSub())}),e.k0s(),e.nrm(3,"input-search",32,10)(5,"input-select",33)(6,"input-datetime",34)(7,"input-datetime",35),e.k0s()()}if(2&o){const t=e.XpG();e.R7$(2),e.Y8G("size",1)("control",t.filter.controls.meus_planos),e.R7$(),e.Y8G("size",5)("control",t.filter.controls.unidade_id)("dao",t.unidadeDao),e.R7$(2),e.Y8G("size",2)("valueTodos",null)("control",t.filter.controls.data_filtro)("items",t.DATAS_FILTRO),e.R7$(),e.Y8G("size",2)("disabled",null==t.filter.controls.data_filtro.value?"true":void 0)("control",t.filter.controls.data_filtro_inicio),e.R7$(),e.Y8G("size",2)("disabled",null==t.filter.controls.data_filtro.value?"true":void 0)("control",t.filter.controls.data_filtro_fim)}}function ct(o,s){if(1&o){const t=e.RV6();e.j41(0,"div",30)(1,"input-switch",36),e.bIt("change",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.disableSub())}),e.k0s(),e.nrm(2,"input-text",37)(3,"input-search",32,10)(5,"input-select",38)(6,"input-switch",39),e.k0s(),e.j41(7,"div",30),e.nrm(8,"input-search",40,11)(10,"input-search",41,12)(12,"input-select",33)(13,"input-datetime",34)(14,"input-datetime",35),e.k0s()}if(2&o){const t=e.XpG();e.R7$(),e.Y8G("size",1)("control",t.filter.controls.meus_planos),e.R7$(),e.Y8G("size",3)("control",t.filter.controls.nome)("placeholder","Nome do "+t.lex.translate("plano de entrega")),e.BMQ("maxlength",250),e.R7$(),e.Y8G("size",4)("control",t.filter.controls.unidade_id)("dao",t.unidadeDao),e.R7$(2),e.Y8G("size",3)("control",t.filter.controls.status)("items",t.lookup.PLANO_ENTREGA_STATUS)("filter",t.avaliacao?e.lJ4(32,lt):void 0)("valueTodos",null),e.R7$(),e.Y8G("size",1)("control",t.filter.controls.arquivadas),e.R7$(2),e.Y8G("size",3)("control",t.filter.controls.planejamento_id)("dao",t.planejamentoDao),e.R7$(2),e.Y8G("size",3)("control",t.filter.controls.cadeia_valor_id)("dao",t.cadeiaValorDao),e.R7$(2),e.Y8G("size",2)("valueTodos",null)("control",t.filter.controls.data_filtro)("items",t.DATAS_FILTRO),e.R7$(),e.Y8G("size",2)("disabled",null==t.filter.controls.data_filtro.value?"true":void 0)("control",t.filter.controls.data_filtro_inicio),e.R7$(),e.Y8G("size",2)("disabled",null==t.filter.controls.data_filtro.value?"true":void 0)("control",t.filter.controls.data_filtro_fim)}}function mt(o,s){if(1&o&&(e.j41(0,"span",44),e.nrm(1,"i",45),e.EFF(2),e.k0s()),2&o){const t=e.XpG().row;e.R7$(2),e.SpI(" ",null==t.entregas?null:t.entregas.length,"")}}function gt(o,s){if(1&o&&e.DNE(0,mt,3,1,"span",43),2&o){const t=s.row;e.Y8G("ngIf",null==t.entregas?null:t.entregas.length)}}function pt(o,s){if(1&o&&e.nrm(0,"plano-entrega-list-entrega",46),2&o){const t=s.row,a=e.XpG(2);e.Y8G("parent",a)("disabled",a.avaliacao||!a.botaoAtendeCondicoes(a.BOTAO_ALTERAR,t))("entity",t)("execucao",a.execucao)("cdRef",a.cdRef)("planejamentoId",t.planejamento_id)("cadeiaValorId",t.cadeia_valor_id)("unidadeId",t.unidade_id)}}function _t(o,s){if(1&o&&(e.j41(0,"column",42),e.DNE(1,gt,1,1,"ng-template",null,13,e.C5r)(3,pt,1,8,"ng-template",null,14,e.C5r),e.k0s()),2&o){const t=e.sdS(2),a=e.sdS(4),n=e.XpG();e.Y8G("align","center")("hint",n.lex.translate("Entrega"))("template",t)("expandTemplate",a)}}function ht(o,s){1&o&&(e.j41(0,"order",47),e.EFF(1,"#ID"),e.k0s()),2&o&&e.Y8G("header",s.header)}function ft(o,s){if(1&o&&(e.j41(0,"small",48),e.EFF(1),e.k0s()),2&o){const t=s.row;e.R7$(),e.SpI("#",t.numero,"")}}function Et(o,s){if(1&o&&(e.j41(0,"order",49),e.EFF(1,"Nome"),e.k0s(),e.nrm(2,"br"),e.EFF(3)),2&o){const t=s.header,a=e.XpG();e.Y8G("header",t),e.R7$(3),e.SpI(" Programa",a.filter.controls.agrupar.value?"":" - Unidade"," ")}}function bt(o,s){if(1&o&&e.nrm(0,"badge",53),2&o){const t=e.XpG().row,a=e.XpG();e.Y8G("icon",a.entityService.getIcon("Programa"))("label",t.programa.nome)}}function vt(o,s){if(1&o&&e.nrm(0,"badge",54),2&o){const t=e.XpG().row,a=e.XpG();e.Y8G("icon",a.entityService.getIcon(a.lex.translate("unidade")))("label",t.unidade.sigla)}}function Tt(o,s){if(1&o&&(e.j41(0,"span",50),e.EFF(1),e.k0s(),e.nrm(2,"br"),e.DNE(3,bt,1,2,"badge",51)(4,vt,1,2,"badge",52)),2&o){const t=s.row,a=e.XpG();e.xc7("max-width",400,"px"),e.R7$(),e.JRh(t.nome||""),e.R7$(2),e.Y8G("ngIf",t.programa),e.R7$(),e.Y8G("ngIf",!a.filter.controls.agrupar.value&&t.unidade)}}function Ot(o,s){if(1&o&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&o){const t=s.row,a=e.XpG();e.R7$(),e.SpI(" ",a.dao.getDateFormatted(t.data_inicio),"")}}function At(o,s){if(1&o&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&o){const t=s.row,a=e.XpG();e.R7$(),e.SpI(" ",a.dao.getDateFormatted(t.data_fim),"")}}function Ct(o,s){1&o&&(e.EFF(0," Planejamento Institucional"),e.nrm(1,"br"),e.EFF(2," Cadeia de Valor "))}function Pt(o,s){if(1&o&&e.nrm(0,"badge",56),2&o){const t=e.XpG().row,a=e.XpG();e.Y8G("maxWidth",300)("icon",a.entityService.getIcon("Planejamento"))("label",null==t.planejamento?null:t.planejamento.nome)}}function It(o,s){if(1&o&&e.nrm(0,"badge",56),2&o){const t=e.XpG().row,a=e.XpG();e.Y8G("maxWidth",300)("icon",a.entityService.getIcon("CadeiaValor"))("label",null==t.cadeia_valor?null:t.cadeia_valor.nome)}}function Dt(o,s){if(1&o&&e.DNE(0,Pt,1,3,"badge",55)(1,It,1,3,"badge",55),2&o){const t=s.row;e.Y8G("ngIf",t.planejamento),e.R7$(),e.Y8G("ngIf",t.cadeia_valor)}}function Rt(o,s){1&o&&e.nrm(0,"badge",61)}function Gt(o,s){1&o&&e.nrm(0,"badge",62)}function jt(o,s){if(1&o&&e.nrm(0,"avaliar-nota-badge",63),2&o){const t=e.XpG().row;e.Y8G("align","left")("tipoAvaliacao",t.avaliacao.tipo_avaliacao)("nota",t.avaliacao.nota)}}function yt(o,s){if(1&o&&(e.nrm(0,"badge",57)(1,"br"),e.DNE(2,Rt,1,0,"badge",58)(3,Gt,1,0,"badge",59)(4,jt,1,3,"avaliar-nota-badge",60)),2&o){const t=s.row,a=e.XpG();e.Y8G("color",a.lookup.getColor(a.lookup.PLANO_ENTREGA_STATUS,t.status))("icon",a.lookup.getIcon(a.lookup.PLANO_ENTREGA_STATUS,t.status))("label",a.lookup.getValue(a.lookup.PLANO_ENTREGA_STATUS,t.status)),e.R7$(2),e.Y8G("ngIf",t.data_arquivamento),e.R7$(),e.Y8G("ngIf",t.deleted_at),e.R7$(),e.Y8G("ngIf",t.avaliacao)}}let Nt=(()=>{class o extends d.P{constructor(t){super(t,w,D.m),this.injector=t,this.showFilter=!0,this.avaliacao=!1,this.execucao=!1,this.habilitarAdesaoToolbar=!1,this.toolbarButtons=[],this.botoes=[],this.routeStatus={route:["uteis","status"]},this.DATAS_FILTRO=[{key:"VIGENTE",value:"Vigente"},{key:"NAOVIGENTE",value:"N\xe3o vigente"},{key:"INICIAM",value:"Iniciam"},{key:"FINALIZAM",value:"Finalizam"}],this.storeFilter=a=>{const n=a?.value;return{meus_planos:n.meus_planos,arquivadas:n.arquivadas,subordinadas:n.subordinadas}},this.filterValidate=(a,n)=>{let i=null;return"data_filtro_inicio"==n&&a.value>this.filter?.controls.data_filtro_fim.value?i="Maior que fim":"data_filtro_fim"==n&&a.value<this.filter?.controls.data_filtro_inicio.value&&(i="Menor que in\xedcio"),i},this.filterWhere=a=>{let n=[],i=a.value;if(this.filter?.controls.principais.value){let l=["unidade_id","in",(this.auth.unidades||[]).map(u=>u.id)];if(this.auth.isGestorAlgumaAreaTrabalho()){let u=this.auth.unidades?.filter(E=>this.unidadeService.isGestorUnidade(E)),g=u?.map(E=>E.unidade_pai?.id||"").filter(E=>E.length);g?.length&&l[2].push(...g);let _=["unidade.unidade_pai_id","in",u?.map(E=>E.id)];n.push(["or",l,_])}else n.push(l)}if(this.filter?.controls.meus_planos.value){let l=["unidade_id","in",(this.auth.unidades||[]).map(u=>u.id)];n.push(l)}return i.nome?.length&&n.push(["nome","like","%"+i.nome.trim().replace(" ","%")+"%"]),i.data_filtro&&(n.push(["data_filtro","==",i.data_filtro]),n.push(["data_filtro_inicio","==",i.data_filtro_inicio]),n.push(["data_filtro_fim","==",i.data_filtro_fim])),i.unidade_id&&n.push(["unidade_id","==",i.unidade_id]),i.unidade_id||n.push(["unidades_vinculadas","==",this.auth.unidade?.id]),i.planejamento_id&&n.push(["planejamento_id","==",i.planejamento_id]),i.cadeia_valor_id&&n.push(["cadeia_valor_id","==",i.cadeia_valor_id]),this.isModal?n.push(["status","==","ATIVO"]):(i.status||this.avaliacao)&&n.push(["status","in",i.status?[i.status]:["CONCLUIDO","AVALIADO"]]),n.push(["incluir_arquivados","==",this.filter.controls.arquivadas.value]),n.push(["incluir_subordinadas","==",this.filter.controls.subordinadas.value]),n},this.avaliacaoDao=t.get(p.l),this.unidadeDao=t.get(y.s),this.planejamentoDao=t.get(P.Y),this.cadeiaValorDao=t.get(R.X),this.planoEntregaService=t.get(m.C),this.unidadeService=t.get(T.S),this.programaService=t.get(O.t),this.unidadeSelecionada=this.auth.unidade,this.code="MOD_PLANE",this.title=this.lex.translate("Planos de Entregas"),this.filter=this.fh.FormBuilder({agrupar:{default:!0},subordinadas:{default:!1},principais:{default:!1},arquivadas:{default:!1},nome:{default:""},data_filtro:{default:null},data_filtro_inicio:{default:new Date},data_filtro_fim:{default:new Date},status:{default:""},unidade_id:{default:null},unidades_filhas:{default:!1},planejamento_id:{default:null},cadeia_valor_id:{default:null},meus_planos:{default:!0}},this.cdRef,this.filterValidate),this.join=["planejamento:id,nome","programa:id,nome","cadeia_valor:id,nome","unidade:id,sigla,path","entregas.entrega","entregas.objetivos.objetivo","entregas.processos.processo","entregas.unidade","entregas.comentarios.usuario:id,nome,apelido","entregas.reacoes.usuario:id,nome,apelido","entregas.produtos.produto","unidade.gestor:id","unidade.gestores_substitutos:id","unidade.unidade_pai","avaliacao"],this.groupBy=[{field:"unidade.sigla",label:"Unidade"}],this.BOTAO_ADERIR_OPTION={label:"Aderir",icon:this.entityService.getIcon("Adesao"),onClick:(()=>{this.go.navigate({route:["gestao","plano-entrega","adesao"]},{metadata:{planoEntrega:this.linha},modalClose:a=>{this.refresh()}})}).bind(this)},this.BOTAO_ADERIR_TOOLBAR={label:"Aderir",disabled:!this.habilitarAdesaoToolbar,icon:this.entityService.getIcon("Adesao"),onClick:(()=>{this.go.navigate({route:["gestao","plano-entrega","adesao"]},{modalClose:a=>{this.refresh()}})}).bind(this)},this.BOTAO_ALTERAR={label:"Alterar",icon:"bi bi-pencil-square",color:"btn-outline-info",onClick:a=>this.go.navigate({route:["gestao","plano-entrega",a.id,"edit"]},this.modalRefreshId(a))},this.BOTAO_CLONAR={label:"Clonar",icon:"bi bi-copy",color:"btn-outline-primary",onClick:a=>this.go.navigate({route:["gestao","plano-entrega",a.id,"clone"]},this.modalRefreshId(a))},this.BOTAO_ARQUIVAR={label:"Arquivar",icon:"bi bi-inboxes",onClick:this.arquivar.bind(this)},this.BOTAO_AVALIAR={label:"Avaliar",icon:this.lookup.getIcon(this.lookup.PLANO_ENTREGA_STATUS,"AVALIADO"),color:this.lookup.getColor(this.lookup.PLANO_ENTREGA_STATUS,"AVALIADO"),onClick:this.avaliar.bind(this)},this.BOTAO_CANCELAR_PLANO={label:"Cancelar plano",icon:this.lookup.getIcon(this.lookup.PLANO_ENTREGA_STATUS,"CANCELADO"),color:this.lookup.getColor(this.lookup.PLANO_ENTREGA_STATUS,"CANCELADO"),onClick:this.cancelarPlano.bind(this)},this.BOTAO_CANCELAR_AVALIACAO={label:"Cancelar avalia\xe7\xe3o",icon:this.lookup.getIcon(this.lookup.PLANO_ENTREGA_STATUS,"CONCLUIDO"),color:this.lookup.getColor(this.lookup.PLANO_ENTREGA_STATUS,"CANCELADO"),onClick:this.cancelarAvaliacao.bind(this)},this.BOTAO_CANCELAR_CONCLUSAO={label:"Cancelar conclus\xe3o",icon:this.lookup.getIcon(this.lookup.PLANO_ENTREGA_STATUS,"ATIVO"),color:this.lookup.getColor(this.lookup.PLANO_ENTREGA_STATUS,"ATIVO"),onClick:this.cancelarConclusao.bind(this)},this.BOTAO_CANCELAR_HOMOLOGACAO={label:"Cancelar homologa\xe7\xe3o",icon:this.lookup.getIcon(this.lookup.PLANO_ENTREGA_STATUS,"HOMOLOGANDO"),color:this.lookup.getColor(this.lookup.PLANO_ENTREGA_STATUS,"HOMOLOGANDO"),onClick:this.cancelarHomologacao.bind(this)},this.BOTAO_CONCLUIR={label:"Concluir",id:"CONCLUIDO",icon:this.lookup.getIcon(this.lookup.PLANO_ENTREGA_STATUS,"CONCLUIDO"),color:this.lookup.getColor(this.lookup.PLANO_ENTREGA_STATUS,"CONCLUIDO"),onClick:this.concluir.bind(this)},this.BOTAO_CONSULTAR={label:"Informa\xe7\xf5es",icon:"bi bi-info-circle",onClick:a=>this.go.navigate({route:["gestao","plano-entrega",a.id,"consult"]},{modal:!0})},this.BOTAO_DESARQUIVAR={label:"Desarquivar",icon:"bi bi-reply",onClick:this.desarquivar.bind(this)},this.BOTAO_EXCLUIR={label:"Excluir",icon:"bi bi-trash",onClick:this.delete.bind(this)},this.BOTAO_HOMOLOGAR={label:"Homologar",icon:this.lookup.getIcon(this.lookup.PLANO_ENTREGA_STATUS,"ATIVO"),color:this.lookup.getColor(this.lookup.PLANO_ENTREGA_STATUS,"ATIVO"),onClick:this.homologar.bind(this)},this.BOTAO_LIBERAR_HOMOLOGACAO={label:"Liberar para homologa\xe7\xe3o",icon:this.lookup.getIcon(this.lookup.PLANO_ENTREGA_STATUS,"HOMOLOGANDO"),color:this.lookup.getColor(this.lookup.PLANO_ENTREGA_STATUS,"HOMOLOGANDO"),onClick:this.liberarHomologacao.bind(this)},this.BOTAO_LOGS={label:"Logs",icon:this.lookup.getIcon(this.lookup.PLANO_ENTREGA_STATUS,"INCLUIDO"),color:this.lookup.getColor(this.lookup.PLANO_ENTREGA_STATUS,"INCLUIDO"),onClick:a=>this.go.navigate({route:["logs","change",a.id,"consult"]})},this.BOTAO_REATIVAR={label:"Reativar",icon:this.lookup.getIcon(this.lookup.PLANO_ENTREGA_STATUS,"ATIVO"),color:this.lookup.getColor(this.lookup.PLANO_ENTREGA_STATUS,"ATIVO"),onClick:this.reativar.bind(this)},this.BOTAO_RETIRAR_HOMOLOGACAO={label:"Retirar de homologa\xe7\xe3o",icon:this.lookup.getIcon(this.lookup.PLANO_ENTREGA_STATUS,"INCLUIDO"),color:this.lookup.getColor(this.lookup.PLANO_ENTREGA_STATUS,"INCLUIDO"),onClick:this.retirarHomologacao.bind(this)},this.BOTAO_SUSPENDER={label:"Suspender",id:"PAUSADO",icon:this.lookup.getIcon(this.lookup.PLANO_ENTREGA_STATUS,"SUSPENSO"),color:this.lookup.getColor(this.lookup.PLANO_ENTREGA_STATUS,"SUSPENSO"),onClick:this.suspender.bind(this)},this.botoes=[this.BOTAO_ALTERAR,this.BOTAO_ARQUIVAR,this.BOTAO_AVALIAR,this.BOTAO_CANCELAR_PLANO,this.BOTAO_CANCELAR_AVALIACAO,this.BOTAO_CANCELAR_CONCLUSAO,this.BOTAO_CANCELAR_HOMOLOGACAO,this.BOTAO_CONCLUIR,this.BOTAO_CONSULTAR,this.BOTAO_DESARQUIVAR,this.BOTAO_EXCLUIR,this.BOTAO_HOMOLOGAR,this.BOTAO_LIBERAR_HOMOLOGACAO,this.BOTAO_LOGS,this.BOTAO_REATIVAR,this.BOTAO_RETIRAR_HOMOLOGACAO,this.BOTAO_SUSPENDER,this.OPTION_LOGS]}ngOnInit(){super.ngOnInit(),this.execucao=!!this.queryParams?.execucao,this.avaliacao=!!this.queryParams?.avaliacao,this.showFilter=!(typeof this.queryParams?.showFilter<"u")||"true"==this.queryParams.showFilter,this.selectable=this.metadata?.selectable||this.selectable,this.metadata?.minha_unidade&&this.filter?.controls.unidade_id.setValue(this.auth.unidade?.id),this.route.queryParams.subscribe(t=>{this.filter?.controls.unidade_id.setValue(this.auth.unidade?.id),"EXECUCAO"==t.context&&this.filter&&this.filter?.controls.usuario.setValue(this.auth.usuario?.nome)}),this.execucao&&(this.title=this.title+" (Execu\xe7\xe3o)",this.filter.controls.unidade_id.setValue(this.auth.unidadeGestor()?.id||null),this.filter.controls.principais.setValue(!1)),this.avaliacao&&(this.title=this.title+" (Avalia\xe7\xe3o)",this.filter.controls.unidade_id.setValue(this.auth.unidadeGestor()?.id||null),this.filter.controls.unidades_filhas.setValue(!0),this.filter.controls.principais.setValue(!1)),this.checaBotaoAderirToolbar()}ngAfterContentChecked(){this.auth.unidade!=this.unidadeSelecionada&&(this.unidadeSelecionada=this.auth.unidade,this.checaBotaoAderirToolbar(),this.cdRef.detectChanges())}onGridLoad(t){const a=(this.grid?.query||this.query).extra;t?.forEach(n=>{let i=n;i.avaliacao&&(i.avaliacao.tipo_avaliacao=a?.tipos_avaliacoes?.find(l=>l.id==i.avaliacao.tipo_avaliacao_id))})}checaBotaoAderirToolbar(){}planosEntregasAtivosUnidadePai(){return this.auth.unidade?.unidade_pai?.planos_entrega?.filter(t=>this.planoEntregaService.isAtivo(t))||[]}planosEntregasAtivosUnidadeSelecionada(){return this.auth?.unidade?.planos_entrega?.filter(t=>this.planoEntregaService.isAtivo(t))||[]}filterClear(t){t?t.controls?(t.controls.nome.setValue(""),t.controls.data_filtro.setValue(null),t.controls.data_filtro_inicio.setValue(new Date),t.controls.data_filtro_fim.setValue(new Date),t.controls.unidade_id.setValue(null),t.controls.planejamento_id.setValue(null),t.controls.cadeia_valor_id.setValue(null),t.controls.status.setValue(null),t.controls.meus_planos.setValue(!0),t.controls.subordinadas?t.controls.subordinadas.setValue(!1):console.warn("O controle 'subordinadas' n\xe3o existe no formul\xe1rio."),super.filterClear(t)):console.error("Os controls do formul\xe1rio n\xe3o est\xe3o dispon\xedveis."):console.error("O objeto filter est\xe1 indefinido.")}onAgruparChange(t){const a=this.filter.controls.agrupar.value;(a&&!this.groupBy?.length||!a&&this.groupBy?.length)&&(this.groupBy=a?[{field:"unidade.sigla",label:"Unidade"}]:[],this.cdRef.detectChanges(),this.grid.reloadFilter())}onPrincipaisChange(t){this.filter.controls.principais.value?(this.filter.controls.unidade_id.setValue(null),this.filter.controls.meus_planos.setValue(!1)):this.filter.controls.meus_planos.setValue(!this.filter.controls.subordinadas),this.grid.reloadFilter()}dynamicButtons(t){let a=[];switch(this.planoEntregaService.situacaoPlano(t)){case"INCLUIDO":this.botaoAtendeCondicoes(this.BOTAO_LIBERAR_HOMOLOGACAO,t)?a.push(this.BOTAO_LIBERAR_HOMOLOGACAO):a.push(this.BOTAO_CONSULTAR);break;case"HOMOLOGANDO":this.botaoAtendeCondicoes(this.BOTAO_HOMOLOGAR,t)&&a.push(this.BOTAO_HOMOLOGAR);break;case"ATIVO":this.botaoAtendeCondicoes(this.BOTAO_CONCLUIR,t)&&a.push(this.BOTAO_CONCLUIR);break;case"CONCLUIDO":this.botaoAtendeCondicoes(this.BOTAO_AVALIAR,t)&&a.push(this.BOTAO_AVALIAR);break;case"SUSPENSO":this.botaoAtendeCondicoes(this.BOTAO_REATIVAR,t)&&a.push(this.BOTAO_REATIVAR);break;case"AVALIADO":this.botaoAtendeCondicoes(this.BOTAO_ARQUIVAR,t)&&a.push(this.BOTAO_ARQUIVAR);break;case"ARQUIVADO":this.botaoAtendeCondicoes(this.BOTAO_DESARQUIVAR,t)&&a.push(this.BOTAO_DESARQUIVAR)}return a.length||a.push(this.BOTAO_CONSULTAR),a}dynamicOptions(t){let a=[];return this.linha=t,this.botoes.forEach(n=>{this.botaoAtendeCondicoes(n,t)&&a.push(n)}),a}botaoAtendeCondicoes(t,a){switch(t){case this.BOTAO_ADERIR_OPTION:return!this.execucao&&"ATIVO"==this.planoEntregaService.situacaoPlano(a)&&a.unidade_id==this.auth.unidade?.unidade_pai_id&&(this.unidadeService.isGestorUnidade()||this.auth.isLotacaoUsuario(this.auth.unidade)&&this.auth.hasPermissionTo("MOD_PENT_ADR"))&&0==this.planosEntregasAtivosUnidadeSelecionada().filter(Pe=>this.util.intersection([{start:Pe.data_inicio,end:Pe.data_fim},{start:a.data_inicio,end:a.data_fim}])).length;case this.BOTAO_ALTERAR:let n=["INCLUIDO","HOMOLOGANDO","ATIVO"].includes(this.planoEntregaService.situacaoPlano(a)),i=["INCLUIDO","HOMOLOGANDO"].includes(this.planoEntregaService.situacaoPlano(a))&&(this.unidadeService.isGestorUnidade(a.unidade)||this.auth.isLotacaoUsuario(a.unidade)),l=this.unidadeService.isGestorUnidade(1==a.unidade?.instituidora?a.unidade?.id:a.unidade?.unidade_pai_id)&&this.auth.hasPermissionTo("MOD_PENT_EDT_FLH"),u=this.auth.isIntegrante("HOMOLOGADOR_PLANO_ENTREGA",a.unidade.unidade_pai_id),g="ATIVO"==this.planoEntregaService.situacaoPlano(a)&&this.auth.isLotacaoUsuario(a.unidade)&&this.auth.hasPermissionTo(["MOD_PENT_EDT_ATV_HOMOL","MOD_PENT_EDT_ATV_ATV"]),_=this.auth.hasPermissionTo("MOD_PENT_QQR_UND");return!this.execucao&&this.auth.hasPermissionTo("MOD_PENT_EDT")&&n&&this.planoEntregaService.isValido(a)&&(i||l||u||g||_);case this.BOTAO_ARQUIVAR:return["CONCLUIDO","AVALIADO"].includes(this.planoEntregaService.situacaoPlano(a))&&(this.unidadeService.isGestorUnidade(a.unidade)||this.auth.isLotacaoUsuario(a.unidade)&&this.auth.hasPermissionTo("MOD_PENT_ARQ"));case this.BOTAO_AVALIAR:let E=this.unidadeService.isGestorUnidade(1==a.unidade?.instituidora?a.unidade?.id:a.unidade?.unidade_pai_id),z=this.auth.isLotacaoUsuario(a.unidade?.unidade_pai)&&this.auth.hasPermissionTo("MOD_PENT_AVAL"),F=this.auth.isGestorLinhaAscendente(a.unidade)&&this.auth.hasPermissionTo("MOD_PENT_AVAL_SUBORD");return"CONCLUIDO"==this.planoEntregaService.situacaoPlano(a)&&(E||z||F);case this.BOTAO_CANCELAR_AVALIACAO:return"AVALIADO"==this.planoEntregaService.situacaoPlano(a)&&(1==a.unidade?.instituidora?this.unidadeService.isGestorUnidade(a.unidade?.id):this.unidadeService.isGestorUnidade(a.unidade?.unidade_pai_id)||this.auth.isIntegrante("AVALIADOR_PLANO_ENTREGA",a.unidade.id));case this.BOTAO_CANCELAR_CONCLUSAO:return"CONCLUIDO"==this.planoEntregaService.situacaoPlano(a)&&this.programaService.programaVigente(a.programa)&&(this.unidadeService.isGestorUnidade(a.unidade)||this.auth.isLotacaoUsuario(a.unidade)&&this.auth.hasPermissionTo("MOD_PENT_CANC_CONCL"));case this.BOTAO_CANCELAR_HOMOLOGACAO:return!this.execucao&&"ATIVO"==this.planoEntregaService.situacaoPlano(a)&&(1==a.unidade?.instituidora?this.unidadeService.isGestorUnidade(a.unidade?.id):this.unidadeService.isGestorUnidade(a.unidade?.unidade_pai_id)||this.auth.isLotacaoUsuario(a.unidade?.unidade_pai)&&this.auth.hasPermissionTo("MOD_PENT_CANC_HOMOL")||this.auth.isIntegrante("HOMOLOGADOR_PLANO_ENTREGA",a.unidade.unidade_pai_id));case this.BOTAO_CANCELAR_PLANO:return this.auth.hasPermissionTo("MOD_PENT_CNC")&&["INCLUIDO","HOMOLOGANDO","ATIVO"].includes(this.planoEntregaService.situacaoPlano(a))&&(this.unidadeService.isGestorUnidade(a.unidade?.id)||this.unidadeService.isGestorUnidade(a.unidade?.unidade_pai_id));case this.BOTAO_CONCLUIR:return"ATIVO"==this.planoEntregaService.situacaoPlano(a)&&(this.unidadeService.isGestorUnidade(a.unidade)||this.auth.isLotacaoUsuario(a.unidade)&&this.auth.hasPermissionTo("MOD_PENT_CONC"));case this.BOTAO_CONSULTAR:return this.auth.hasPermissionTo("MOD_PENT");case this.BOTAO_DESARQUIVAR:return"ARQUIVADO"==this.planoEntregaService.situacaoPlano(a)&&(this.unidadeService.isGestorUnidade(a.unidade)||this.auth.isLotacaoUsuario(a.unidade)&&this.auth.hasPermissionTo("MOD_PENT_ARQ"));case this.BOTAO_EXCLUIR:return!this.execucao&&this.auth.hasPermissionTo("MOD_PENT_EXCL")&&["INCLUIDO","HOMOLOGANDO"].includes(this.planoEntregaService.situacaoPlano(a))&&(this.unidadeService.isGestorUnidade(a.unidade)||this.auth.isLotacaoUsuario(a.unidade));case this.BOTAO_HOMOLOGAR:let ae="HOMOLOGANDO"==this.planoEntregaService.situacaoPlano(a),ne=this.unidadeService.isGestorUnidade(1==a.unidade?.instituidora?a.unidade?.id:a.unidade?.unidade_pai_id),No=this.auth.isLotacaoUsuario(a.unidade.unidade_pai)&&this.auth.hasPermissionTo("MOD_PENT_HOMOL"),Lo=this.auth.isIntegrante("HOMOLOGADOR_PLANO_ENTREGA",a.unidade.unidade_pai_id);return!this.execucao&&ae&&(ne||No||Lo);case this.BOTAO_LIBERAR_HOMOLOGACAO:return!this.execucao&&"INCLUIDO"==this.planoEntregaService.situacaoPlano(a)&&a.entregas.length>0&&(this.unidadeService.isGestorUnidade(a.unidade)||this.auth.isLotacaoUsuario(a.unidade)&&this.auth.hasPermissionTo("MOD_PENT_LIB_HOMOL"));case this.BOTAO_LOGS:return this.unidadeService.isGestorUnidade(a.unidade)&&this.auth.hasPermissionTo("MOD_PENT_AVAL_SUBORD");case this.BOTAO_REATIVAR:return"SUSPENSO"==this.planoEntregaService.situacaoPlano(a)&&(this.unidadeService.isGestorUnidade(a.unidade)||this.auth.isLotacaoUsuario(a.unidade)&&this.auth.hasPermissionTo("MOD_PENT_RTV")||this.auth.isGestorLinhaAscendente(a.unidade));case this.BOTAO_RETIRAR_HOMOLOGACAO:return!this.execucao&&"HOMOLOGANDO"==this.planoEntregaService.situacaoPlano(a)&&(this.unidadeService.isGestorUnidade(a.unidade)||this.auth.isLotacaoUsuario(a.unidade)&&this.auth.hasPermissionTo("MOD_PENT_RET_HOMOL"));case this.BOTAO_SUSPENDER:return"ATIVO"==this.planoEntregaService.situacaoPlano(a)&&(this.unidadeService.isGestorUnidade(a.unidade)||this.auth.isLotacaoUsuario(a.unidade)&&this.auth.hasPermissionTo("MOD_PENT_SUSP")||this.auth.isGestorLinhaAscendente(a.unidade));case this.BOTAO_CLONAR:return this.auth.hasPermissionTo("MOD_PENT_INCL");case this.OPTION_LOGS:return!0}return!1}arquivar(t){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoEntrega",entity:Object.assign({},t,{arquivar:!0}),novoStatus:t.status,onClick:this.dao.arquivar.bind(this.dao)},title:"Arquivar Plano de Entregas",modalClose:a=>{a&&(this.grid?.query||this.query).refreshId(t.id).then(()=>{this.checaBotaoAderirToolbar()})}})}avaliar(t){this.go.navigate({route:["gestao","plano-entrega",t.id,"avaliar"]},{modal:!0,metadata:{planoEntrega:t},modalClose:a=>{a&&(this.grid?.query||this.query).refreshId(t.id,["avaliacao.tipo_avaliacao.notas"]).then(()=>{this.checaBotaoAderirToolbar()})}})}cancelarAvaliacao(t){var a=this;return(0,c.A)(function*(){a.submitting=!0;try{(yield a.avaliacaoDao.cancelarAvaliacao(t.avaliacao.id))&&(a.grid?.query||a.query).refreshId(t.id).then(()=>{a.checaBotaoAderirToolbar()})}catch(n){a.error(n.message||n)}finally{a.submitting=!1}})()}cancelarConclusao(t){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoEntrega",entity:t,novoStatus:"ATIVO",onClick:this.dao.cancelarConclusao.bind(this.dao)},title:"Cancelar Conclus\xe3o",modalClose:a=>{a&&(this.grid?.query||this.query).refreshId(t.id).then(()=>{this.checaBotaoAderirToolbar()})}})}cancelarHomologacao(t){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoEntrega",entity:t,novoStatus:"HOMOLOGANDO",onClick:this.dao.cancelarHomologacao.bind(this.dao)},title:"Cancelar Homologa\xe7\xe3o",modalClose:a=>{a&&(this.grid?.query||this.query).refreshId(t.id).then(()=>{this.checaBotaoAderirToolbar()})}})}cancelarPlano(t){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoEntrega",entity:Object.assign({},t,{arquivar:!0}),novoStatus:"CANCELADO",onClick:this.dao.cancelarPlano.bind(this.dao)},title:"Cancelar Plano de Entregas",modalClose:a=>{a&&(this.grid?.query||this.query).refreshId(t.id).then(()=>{this.checaBotaoAderirToolbar()})}})}concluir(t){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoEntrega",entity:t,novoStatus:"CONCLUIDO",onClick:this.dao.concluir.bind(this.dao)},title:"Concluir Plano de Entregas",modalClose:a=>{a&&(this.grid?.query||this.query).refreshId(t.id).then(()=>{this.checaBotaoAderirToolbar()})}})}desarquivar(t){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoEntrega",entity:Object.assign({},t,{arquivar:!1}),novoStatus:t.status,onClick:this.dao.arquivar.bind(this.dao)},title:"Desarquivar Plano de Entregas",modalClose:a=>{a&&(this.grid?.query||this.query).refreshId(t.id).then(()=>{this.checaBotaoAderirToolbar()})}})}homologar(t){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoEntrega",entity:t,novoStatus:"ATIVO",onClick:this.dao.homologar.bind(this.dao)},title:"Homologar Plano de Entregas",modalClose:a=>{a&&(this.grid?.query||this.query).refreshId(t.id).then(()=>{this.checaBotaoAderirToolbar()})}})}liberarHomologacao(t){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoEntrega",entity:t,novoStatus:"HOMOLOGANDO",onClick:this.dao.liberarHomologacao.bind(this.dao)},title:"Liberar para Homologa\xe7\xe3o",modalClose:a=>{a&&(this.grid?.query||this.query).refreshId(t.id).then(()=>{this.checaBotaoAderirToolbar()})}})}reativar(t){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoEntrega",entity:t,novoStatus:"ATIVO",onClick:this.dao.reativar.bind(this.dao)},title:"Reativar Plano de Entregas",modalClose:a=>{a&&(this.grid?.query||this.query).refreshId(t.id).then(()=>{this.checaBotaoAderirToolbar()})}})}retirarHomologacao(t){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoEntrega",entity:t,novoStatus:"INCLUIDO",onClick:this.dao.retirarHomologacao.bind(this.dao)},title:"Retirar de Homologa\xe7\xe3o",modalClose:a=>{a&&(this.grid?.query||this.query).refreshId(t.id).then(()=>{this.checaBotaoAderirToolbar()})}})}suspender(t){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoEntrega",entity:t,novoStatus:"SUSPENSO",onClick:this.dao.suspender.bind(this.dao)},title:"Suspender Plano de Entregas",modalClose:a=>{a&&(this.grid?.query||this.query).refreshId(t.id).then(()=>{this.checaBotaoAderirToolbar()})}})}disableMeus(){this.filter&&this.filter.controls.subordinadas&&this.filter.controls.meus_planos?(this.filter.controls.meus_planos.setValue(!this.filter.controls.subordinadas.value),this.grid?.reloadFilter()):console.warn("Formul\xe1rio ou controles n\xe3o inicializados corretamente.")}disableSub(){this.filter&&this.filter.controls.subordinadas&&this.filter.controls.meus_planos?(this.filter.controls.meus_planos.value?(this.filter.controls.subordinadas.setValue(!1),this.filter.controls.principais.setValue(!1)):this.filter.controls.subordinadas.setValue(!0),this.grid?.reloadFilter()):console.warn("Formul\xe1rio ou controles n\xe3o inicializados corretamente.")}canAdd(){return this.auth.hasPermissionTo("MOD_PENT_INCL")}static{this.\u0275fac=function(a){return new(a||o)(e.rXU(e.zZn))}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["plano-entrega-list"]],viewQuery:function(a,n){if(1&a&&e.GBs(f._,5),2&a){let i;e.mGM(i=e.lsd())&&(n.grid=i.first)}},features:[e.Vt3],decls:34,vars:35,consts:[["naoEModal",""],["titleIdNumeroStatus",""],["columnNumero",""],["titleNomeProgramaUnidade",""],["columnNome",""],["columnInicio",""],["columnFim",""],["titlePlanoCadeia",""],["columnPlanoCadeia",""],["columnStatus",""],["unidade",""],["planejamento",""],["cadeiaValor",""],["columnEntregas",""],["columnExpandedEntregas",""],[3,"select","dao","add","title","orderBy","groupBy","join","selectable","hasAdd","hasEdit","loadList"],[3,"buttons",4,"ngIf"],[3,"deleted","form","where","submit","clear","collapseChange","collapsed","visible"],[4,"ngIf","ngIfElse"],["type","expand","icon","bi bi-list-check",3,"align","hint","template","expandTemplate",4,"ngIf"],[3,"titleTemplate","template"],["title","In\xedcio","orderBy","data_inicio",3,"template"],["title","Fim","orderBy","data_fim",3,"template"],[3,"title","template"],["type","options",3,"dynamicOptions","dynamicButtons"],[3,"rows"],[3,"buttons"],["labelPosition","left","label","Unidades Subordinadas","labelInfo","Planos de entrega das unidades subordinadas",3,"change","size","control"],["labelPosition","left","label","Vinculados","controlName","principais",3,"size","control","labelInfo","change",4,"ngIf"],["labelPosition","left","label","Vinculados","controlName","principais",3,"change","size","control","labelInfo"],[1,"row"],["label","Meus","labelInfo","Planos de entrega das unidades da qual sou integrante (\xc1reas de trabalho)",3,"change","size","control"],["controlName","unidade_id",3,"size","control","dao"],["label","Data","itemTodos","- Nenhum -","controlName","data_filtro",3,"size","valueTodos","control","items"],["date","","label","In\xedcio","controlName","data_filtro_inicio","labelInfo","Data in\xedcio do per\xedodo",3,"size","disabled","control"],["date","","label","Fim","controlName","data_filtro_fim","labelInfo","Data fim do per\xedodo",3,"size","disabled","control"],["label","Meus","labelInfo","Planos de entrega das unidade da qual sou integrante (\xc1reas de trabalho)",3,"change","size","control"],["label","Nome","controlName","nome",3,"size","control","placeholder"],["label","Status","controlName","status","itemTodos","- Todos -",3,"size","control","items","filter","valueTodos"],["label","Arquivados","controlName","arquivadas","labelInfo","Listar tamb\xe9m os planos de entregas arquivados",3,"size","control"],["controlName","planejamento_id",3,"size","control","dao"],["controlName","cadeia_valor_id",3,"size","control","dao"],["type","expand","icon","bi bi-list-check",3,"align","hint","template","expandTemplate"],["class","badge rounded-pill bg-light text-dark",4,"ngIf"],[1,"badge","rounded-pill","bg-light","text-dark"],[1,"bi","bi-list-check"],[3,"parent","disabled","entity","execucao","cdRef","planejamentoId","cadeiaValorId","unidadeId"],["by","numero",3,"header"],[1,"micro-text","fw-ligh"],["by","nome",3,"header"],[1,"text-break","text-wrap"],["color","light",3,"icon","label",4,"ngIf"],["color","secondary",3,"icon","label",4,"ngIf"],["color","light",3,"icon","label"],["color","secondary",3,"icon","label"],["color","light",3,"maxWidth","icon","label",4,"ngIf"],["color","light",3,"maxWidth","icon","label"],[3,"color","icon","label"],["color","warning","icon","bi bi-inboxes","label","Arquivado",4,"ngIf"],["color","danger","icon","bi bi-trash3","label","Exclu\xeddo",4,"ngIf"],[3,"align","tipoAvaliacao","nota",4,"ngIf"],["color","warning","icon","bi bi-inboxes","label","Arquivado"],["color","danger","icon","bi bi-trash3","label","Exclu\xeddo"],[3,"align","tipoAvaliacao","nota"]],template:function(a,n){if(1&a){const i=e.RV6();e.j41(0,"grid",15),e.bIt("select",function(u){return e.eBV(i),e.Njj(n.onSelect(u))}),e.DNE(1,dt,3,4,"toolbar",16),e.j41(2,"filter",17),e.DNE(3,ut,8,15,"div",18)(4,ct,15,33,"ng-template",null,0,e.C5r),e.k0s(),e.j41(6,"columns"),e.DNE(7,_t,5,4,"column",19),e.j41(8,"column",20),e.DNE(9,ht,2,1,"ng-template",null,1,e.C5r)(11,ft,2,1,"ng-template",null,2,e.C5r),e.k0s(),e.j41(13,"column",20),e.DNE(14,Et,4,2,"ng-template",null,3,e.C5r)(16,Tt,5,5,"ng-template",null,4,e.C5r),e.k0s(),e.j41(18,"column",21),e.DNE(19,Ot,2,1,"ng-template",null,5,e.C5r),e.k0s(),e.j41(21,"column",22),e.DNE(22,At,2,1,"ng-template",null,6,e.C5r),e.k0s(),e.j41(24,"column",20),e.DNE(25,Ct,3,0,"ng-template",null,7,e.C5r)(27,Dt,2,2,"ng-template",null,8,e.C5r),e.k0s(),e.j41(29,"column",23),e.DNE(30,yt,5,6,"ng-template",null,9,e.C5r),e.k0s(),e.nrm(32,"column",24),e.k0s(),e.nrm(33,"pagination",25),e.k0s()}if(2&a){const i=e.sdS(5),l=e.sdS(10),u=e.sdS(12),g=e.sdS(15),_=e.sdS(17),E=e.sdS(20),z=e.sdS(23),F=e.sdS(26),ae=e.sdS(28),ne=e.sdS(31);e.Y8G("dao",n.dao)("add",n.add)("title",n.isModal?"":n.title)("orderBy",n.orderBy)("groupBy",n.groupBy)("join",n.join)("selectable",n.selectable)("hasAdd",n.canAdd())("hasEdit",!1)("loadList",n.onGridLoad.bind(n)),e.R7$(),e.Y8G("ngIf",!n.selectable),e.R7$(),e.Y8G("deleted",n.auth.hasPermissionTo("MOD_AUDIT_DEL"))("form",n.filter)("where",n.filterWhere)("submit",n.filterSubmit.bind(n))("clear",n.filterClear.bind(n))("collapseChange",n.filterCollapseChange.bind(n))("collapsed",!n.selectable&&n.filterCollapsed)("visible",n.showFilter),e.R7$(),e.Y8G("ngIf",n.isModal)("ngIfElse",i),e.R7$(4),e.Y8G("ngIf",!n.selectable),e.R7$(),e.Y8G("titleTemplate",l)("template",u),e.R7$(5),e.Y8G("titleTemplate",g)("template",_),e.R7$(5),e.Y8G("template",E),e.R7$(3),e.Y8G("template",z),e.R7$(3),e.Y8G("titleTemplate",F)("template",ae),e.R7$(5),e.Y8G("title","Status\nAvalia\xe7\xe3o")("template",ne),e.R7$(3),e.Y8G("dynamicOptions",n.dynamicOptions.bind(n))("dynamicButtons",n.dynamicButtons.bind(n)),e.R7$(),e.Y8G("rows",n.rowsLimit)}},dependencies:[A.bT,f._,v.T,h.I,G.i,U.H,M.e,ie.S,k.O,q.H,V.r,X.K,J.Y,L.n,Ie.R,re]})}}return o})();var de=r(5374),K=r(24);const Lt=["programa"],St=["unidade"],kt=["nome"],Vt=["data_fim"];let Z=(()=>{class o extends K.n{constructor(t){super(t,w,D.m),this.injector=t,this.validate=(a,n)=>{let i=null;return["nome","unidade_id","programa_id"].indexOf(n)>=0&&!a.value?.length&&(i="Obrigat\xf3rio"),["data_inicio"].indexOf(n)>=0&&!this.dao?.validDateTime(a.value)&&(i="Inv\xe1lido"),["data_fim"].indexOf(n)>=0&&!this.dao?.validDateTime(a.value)&&(i="Inv\xe1lido"),i},this.formValidation=a=>{const n=this.form?.controls.data_inicio.value,i=this.form?.controls.data_fim.value;if(!this.programa?.selectedEntity)return"Obrigat\xf3rio selecionar o programa";if(!this.dao?.validDateTime(n))return"Data de in\xedcio inv\xe1lida";if(!this.dao?.validDateTime(i))return"Data de fim inv\xe1lida";if(n>i)return"A data do fim n\xe3o pode ser menor que a data do in\xedcio!";{const u=this.form.controls.entregas.value||[];for(let g of u){if(!this.auth.hasPermissionTo("MOD_PENT_ENTR_EXTRPL")&&g.data_inicio<n)return"A "+this.lex.translate("entrega")+" '"+g.descricao+"' possui data inicial anterior \xe0 "+this.lex.translate("do Plano de Entrega")+": "+this.util.getDateFormatted(n);if(!this.auth.hasPermissionTo("MOD_PENT_ENTR_EXTRPL")&&g.data_fim>i)return"A "+this.lex.translate("entrega")+" '"+g.descricao+"' possui data fim posterior \xe0 "+this.lex.translate("do Plano de Entrega")+": "+this.util.getDateFormatted(i)}}},this.titleEdit=a=>"Editando "+this.lex.translate("Plano de Entregas")+": "+(a?.nome||""),this.unidadeDao=t.get(y.s),this.programaDao=t.get(de.X),this.cadeiaValorDao=t.get(R.X),this.planoEntregaDao=t.get(D.m),this.planejamentoInstitucionalDao=t.get(P.Y),this.join=["entregas.entrega","entregas.objetivos.objetivo","entregas.processos.processo","entregas.produtos.produto","entregas.unidade","unidade","entregas.reacoes.usuario:id,nome,apelido"],this.modalWidth=1200,this.form=this.fh.FormBuilder({nome:{default:""},data_inicio:{default:new Date},data_fim:{default:new Date},unidade_id:{default:""},plano_entrega_id:{default:null},planejamento_id:{default:null},cadeia_valor_id:{default:null},programa_id:{default:null},entregas:{default:[]}},this.cdRef,this.validate),this.programaMetadata={todosUnidadeExecutora:!1,vigentesUnidadeExecutora:!0}}loadData(t,a,n){var i=this;return(0,c.A)(function*(){"clone"==n&&(t.id="",t.data_inicio=new Date,t.data_fim=new Date,t.entregas=t.entregas.map(u=>(u.id=i.planoEntregaDao.generateUuid(),u.plano_entrega_id=null,u._status="ADD",u.progresso_realizado=0,u)));let l=Object.assign({},a.value);a.patchValue(i.util.fillForm(l,t)),"clone"==n&&(a.controls.data_inicio.setValue(""),a.controls.data_fim.setValue("")),i.cdRef.detectChanges()})()}initializeData(t){var a=this;return(0,c.A)(function*(){a.entity=new w,a.entity.unidade_id=a.auth.unidade?.id||"",a.entity.unidade=a.auth.unidade;let i=(yield a.programaDao.query({where:[["vigentesUnidadeExecutora","==",a.auth.unidade.id]],orderBy:[["unidade.path","desc"]]}).asPromise())[0];i&&(a.entity.programa=i,a.entity.programa_id=i.id);const l=new Date(a.entity.data_inicio).toLocaleDateString(),u=a.entity.data_fim?new Date(a.entity.data_fim).toLocaleDateString():(new Date).toLocaleDateString();a.entity.nome=a.auth.unidade.sigla+" - "+l+" - "+u,a.loadData(a.entity,a.form)})()}saveData(t){var a=this;return(0,c.A)(function*(){return new Promise((n,i)=>{let l=a.util.fill(new w,a.entity);l=a.util.fillForm(l,a.form.value),l.entregas=l.entregas?.filter(u=>u._status)||[],n(l)})})()}dynamicButtons(t){return[]}onDataChange(){this.sugereNome()}onUnidadeChange(){var t=this;return(0,c.A)(function*(){let n=t.form.controls.unidade_id.value||t.auth.unidade?.id;if(n)try{yield t.planoEntregaDao.permissaoIncluir(n)}catch(i){t.error(i)}t.sugereNome()})()}sugereNome(){const t=this.unidade?.selectedItem?this.unidade?.selectedItem?.entity.sigla:this.auth.unidade?.sigla,a=new Date(this.form.controls.data_inicio.value).toLocaleDateString(),n=this.form.controls.data_fim.value?" - "+new Date(this.form.controls.data_fim.value).toLocaleDateString():"";this.form.controls.nome.setValue(t+" - "+a+n)}somaDia(t,a){let n=new Date(t);return n.setDate(n.getDate()+a),n}onProgramaChange(){const t=this.programa?.selectedEntity?.prazo_max_plano_entrega,a=this.somaDia(this.entity.data_inicio,t);this.entity?.data_fim||(this.form.controls.data_fim.setValue(new Date(a)),this.dataFim?.change.emit())}static{this.\u0275fac=function(a){return new(a||o)(e.rXU(e.zZn))}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["app-plano-entrega-form"]],viewQuery:function(a,n){if(1&a&&(e.GBs(j.Q,5),e.GBs(f._,7),e.GBs(Lt,7),e.GBs(St,7),e.GBs(kt,7),e.GBs(Vt,7)),2&a){let i;e.mGM(i=e.lsd())&&(n.editableForm=i.first),e.mGM(i=e.lsd())&&(n.grid=i.first),e.mGM(i=e.lsd())&&(n.programa=i.first),e.mGM(i=e.lsd())&&(n.unidade=i.first),e.mGM(i=e.lsd())&&(n.nomePE=i.first),e.mGM(i=e.lsd())&&(n.dataFim=i.first)}},features:[e.Vt3],decls:20,vars:28,consts:[["unidade",""],["programa",""],["data_fim",""],["nome",""],["planejamento",""],["cadeiaValor",""],["entregas",""],["initialFocus","entregas",3,"submit","cancel","form","disabled","title"],[1,"row"],["controlName","unidade_id","required","",3,"change","size","disabled","dao"],["controlName","programa_id","required","",3,"change","size","disabled","dao","metadata"],["date","","label","In\xedcio","controlName","data_inicio","required","",3,"change","size","labelInfo"],["date","","label","Fim","controlName","data_fim","required","",3,"change","size","labelInfo"],["label","Nome","controlName","nome","required","",3,"size"],["controlName","planejamento_id","label","Planejamento Institucional",3,"size","emptyValue","dao"],["controlName","cadeia_valor_id","label","Cadeia de Valor",3,"size","emptyValue","dao"],["title","Entregas"],["noPersist","",3,"disabled","control","planejamentoId","cadeiaValorId","unidadeId","dataFim"]],template:function(a,n){if(1&a){const i=e.RV6();e.j41(0,"editable-form",7),e.bIt("submit",function(){return e.eBV(i),e.Njj(n.onSaveData())})("cancel",function(){return e.eBV(i),e.Njj(n.onCancel())}),e.j41(1,"div")(2,"div",8)(3,"input-search",9,0),e.bIt("change",function(){return e.eBV(i),e.Njj(n.onUnidadeChange())}),e.k0s(),e.j41(5,"input-search",10,1),e.bIt("change",function(){return e.eBV(i),e.Njj(n.onProgramaChange())}),e.k0s(),e.j41(7,"input-datetime",11),e.bIt("change",function(){return e.eBV(i),e.Njj(n.onDataChange())}),e.k0s(),e.j41(8,"input-datetime",12,2),e.bIt("change",function(){return e.eBV(i),e.Njj(n.onDataChange())}),e.k0s()(),e.j41(10,"div",8),e.nrm(11,"input-text",13,3)(13,"input-search",14,4)(15,"input-search",15,5),e.k0s(),e.nrm(17,"separator",16)(18,"plano-entrega-list-entrega",17,6),e.k0s()()}2&a&&(e.Y8G("form",n.form)("disabled",n.formDisabled)("title",n.isModal?"":n.title),e.R7$(3),e.Y8G("size",4)("disabled",null!=n.entity&&n.entity.id?"disabled":void 0)("dao",n.unidadeDao),e.R7$(2),e.Y8G("size",4)("disabled",null!=n.entity&&n.entity.id?"disabled":void 0)("dao",n.programaDao)("metadata",n.programaMetadata),e.R7$(2),e.Y8G("size",2)("labelInfo","In\xedcio "+n.lex.translate("Plano de Entrega")),e.R7$(),e.Y8G("size",2)("labelInfo","Fim "+n.lex.translate("Plano de Entrega")),e.R7$(3),e.Y8G("size",4),e.BMQ("maxlength",250),e.R7$(2),e.Y8G("size",4)("emptyValue",null)("dao",n.planejamentoInstitucionalDao),e.R7$(2),e.Y8G("size",4)("emptyValue",null)("dao",n.cadeiaValorDao),e.R7$(3),e.Y8G("disabled",n.formDisabled)("control",n.form.controls.entregas)("planejamentoId",n.form.controls.planejamento_id.value)("cadeiaValorId",n.form.controls.cadeia_valor_id.value)("unidadeId",n.form.controls.unidade_id.value)("dataFim",n.form.controls.data_fim.value))},dependencies:[j.Q,k.O,q.H,V.r,H.F,re]})}}return o})();var ue=r(1385),ce=r(9970),me=r(242),Ft=r(3292);const Yt=["unidade"];function zt(o,s){if(1&o&&e.nrm(0,"planejamento-show",18),2&o){const t=e.XpG(2);e.Y8G("planejamento",t.objetivo.planejamento)}}function $t(o,s){if(1&o&&(e.qex(0),e.DNE(1,zt,1,1,"planejamento-show",16),e.j41(2,"div",17)(3,"h5"),e.EFF(4,"Objetivo:"),e.k0s(),e.j41(5,"h6"),e.EFF(6),e.k0s()(),e.bVm()),2&o){const t=e.XpG();e.R7$(),e.Y8G("ngIf",t.objetivo.planejamento),e.R7$(5),e.JRh(t.objetivo.nome)}}function wt(o,s){if(1&o&&(e.j41(0,"div",21)(1,"h6"),e.EFF(2,"Cadeia de valor:"),e.k0s(),e.j41(3,"h4"),e.EFF(4),e.k0s()()),2&o){const t=e.XpG(2);e.R7$(4),e.JRh(t.processo.cadeia_valor.nome)}}function Bt(o,s){if(1&o&&(e.qex(0),e.DNE(1,wt,5,1,"div",19),e.j41(2,"div",20)(3,"h5"),e.EFF(4,"Processo:"),e.k0s(),e.j41(5,"h6"),e.EFF(6),e.k0s()(),e.bVm()),2&o){const t=e.XpG();e.R7$(),e.Y8G("ngIf",t.processo.cadeia_valor),e.R7$(5),e.JRh(t.processo.nome)}}function Ut(o,s){if(1&o&&e.nrm(0,"badge",25),2&o){const t=e.XpG().row,a=e.XpG();e.Y8G("icon",a.entityService.getIcon("Unidade"))("label",t.plano_entrega.unidade.sigla)}}function Mt(o,s){if(1&o&&e.nrm(0,"badge",26),2&o){const t=e.XpG().row;e.Y8G("label",t.destinatario)}}function qt(o,s){if(1&o&&(e.EFF(0),e.nrm(1,"br"),e.j41(2,"span",22),e.DNE(3,Ut,1,2,"badge",23)(4,Mt,1,1,"badge",24),e.k0s()),2&o){const t=s.row;e.SpI(" ",t.descricao,""),e.R7$(3),e.Y8G("ngIf",t.plano_entrega&&t.plano_entrega.unidade),e.R7$(),e.Y8G("ngIf",null==t.destinatario?null:t.destinatario.length)}}function Xt(o,s){if(1&o&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&o){const t=e.XpG().row,a=e.XpG();e.R7$(),e.SpI(" ",a.dao.getDateFormatted(t.data_inicio),"")}}function xt(o,s){if(1&o&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&o){const t=e.XpG().row,a=e.XpG();e.R7$(),e.SpI(" ",a.dao.getDateFormatted(t.data_fim),"")}}function Ht(o,s){if(1&o&&(e.DNE(0,Xt,2,1,"span",5),e.nrm(1,"br"),e.DNE(2,xt,2,1,"span",5)),2&o){const t=s.row;e.Y8G("ngIf",t.data_inicio),e.R7$(2),e.Y8G("ngIf",t.data_fim)}}function Qt(o,s){if(1&o&&e.nrm(0,"progress-bar",27),2&o){const t=s.row;e.Y8G("value",t.progresso_realizado)("goal",t.progresso_esperado)}}let ge=(()=>{class o extends d.P{constructor(t){super(t,x.j,S.o),this.injector=t,this.filterWhere=a=>{let n=[],i=a.value;return this.objetivoId&&n.push(["objetivos.objetivo_id","==",this.objetivoId]),this.processoId&&n.push(["processos.processo_id","==",this.processoId]),i.unidade_id&&n.push(["plano_entrega.unidade_id","==",i.unidade_id]),i.entrega_id&&n.push(["entrega_id","==",i.entrega_id]),i.data_inicio&&n.push(["data_inicio",">=",i.data_inicio]),i.data_fim&&n.push(["data_fim","<=",i.data_fim]),n},this.unidadeDao=t.get(y.s),this.entregaDao=t.get(ue.u),this.entregaService=t.get(m.C),this.objetivoDao=t.get(ce.O),this.processoDao=t.get(me.p),this.join=["plano_entrega.unidade"],this.title=this.lex.translate("Entregas"),this.filter=this.fh.FormBuilder({unidade_id:{default:null},entrega_id:{default:null},data_inicio:{default:null},data_fim:{default:null}})}ngOnInit(){super.ngOnInit(),this.objetivoId=this.urlParams.get("objetivo_id")||void 0,this.processoId=this.urlParams.get("processo_id")||void 0,this.objetivoId&&this.objetivoDao?.getById(this.objetivoId,["planejamento"]).then(t=>{this.objetivo=t}),this.processoId&&this.processoDao?.getById(this.processoId,["cadeia_valor"]).then(t=>{this.processo=t})}filterClear(t){t.controls.unidade_id.setValue(null),t.controls.entrega_id.setValue(null),t.controls.data_inicio.setValue(null),t.controls.data_fim.setValue(null),super.filterClear(t)}static{this.\u0275fac=function(a){return new(a||o)(e.rXU(e.zZn))}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["plano-entrega-mapa-entregas"]],viewQuery:function(a,n){if(1&a&&(e.GBs(f._,5),e.GBs(Yt,5)),2&a){let i;e.mGM(i=e.lsd())&&(n.grid=i.first),e.mGM(i=e.lsd())&&(n.unidade=i.first)}},features:[e.Vt3],decls:23,vars:31,consts:[["unidade",""],["entrega",""],["columnEntregaCliente",""],["columnDatas",""],["columnProgresso",""],[4,"ngIf"],[3,"dao","title","orderBy","join"],[3,"deleted","form","where","submit","clear","collapseChange","collapsed"],[1,"row"],["controlName","unidade_id",3,"size","control","dao"],["controlName","entrega_id",3,"size","control","dao"],["date","","noIcon","","label","In\xedcio","controlName","data_inicio","labelInfo","Data de in\xedcio do planejamento institucional",3,"size","control"],["date","","noIcon","","label","Fim","controlName","data_fim","labelInfo","Data do fim do planejamento institucional",3,"size","control"],[3,"title","template"],[3,"title","width","template"],[3,"rows"],[3,"planejamento",4,"ngIf"],[1,"objetivos","arrow_box","w-100"],[3,"planejamento"],["class","planejamento arrow_box first-box w-100",4,"ngIf"],[1,"procesos","arrow_box","w-100"],[1,"planejamento","arrow_box","first-box","w-100"],[1,"d-block"],["color","light",3,"icon","label",4,"ngIf"],["color","light","icon","bi bi-mailbox",3,"label",4,"ngIf"],["color","light",3,"icon","label"],["color","light","icon","bi bi-mailbox",3,"label"],["color","success",3,"value","goal"]],template:function(a,n){if(1&a&&(e.DNE(0,$t,7,2,"ng-container",5)(1,Bt,7,2,"ng-container",5),e.j41(2,"grid",6),e.nrm(3,"toolbar"),e.j41(4,"filter",7)(5,"div",8),e.nrm(6,"input-search",9,0)(8,"input-search",10,1)(10,"input-datetime",11)(11,"input-datetime",12),e.k0s()(),e.j41(12,"columns")(13,"column",13),e.DNE(14,qt,5,3,"ng-template",null,2,e.C5r),e.k0s(),e.j41(16,"column",13),e.DNE(17,Ht,3,2,"ng-template",null,3,e.C5r),e.k0s(),e.j41(19,"column",14),e.DNE(20,Qt,1,2,"ng-template",null,4,e.C5r),e.k0s()(),e.nrm(22,"pagination",15),e.k0s()),2&a){const i=e.sdS(15),l=e.sdS(18),u=e.sdS(21);e.Y8G("ngIf",n.objetivo),e.R7$(),e.Y8G("ngIf",n.processo),e.R7$(),e.Y8G("dao",n.dao)("title",n.isModal?"":n.title)("orderBy",n.orderBy)("join",n.join),e.R7$(2),e.Y8G("deleted",n.auth.hasPermissionTo("MOD_AUDIT_DEL"))("form",n.filter)("where",n.filterWhere)("submit",n.filterSubmit.bind(n))("clear",n.filterClear.bind(n))("collapseChange",n.filterCollapseChange.bind(n))("collapsed",!n.selectable&&n.filterCollapsed),e.R7$(2),e.Y8G("size",4)("control",n.filter.controls.unidade_id)("dao",n.unidadeDao),e.R7$(2),e.Y8G("size",4)("control",n.filter.controls.entrega_id)("dao",n.entregaDao),e.R7$(2),e.Y8G("size",2)("control",n.filter.controls.data_inicio),e.R7$(),e.Y8G("size",2)("control",n.filter.controls.data_fim),e.R7$(2),e.Y8G("title","Entrega\nDemandante/Destinat\xe1rio")("template",i),e.R7$(3),e.Y8G("title","Data In\xedcio\nData Fim")("template",l),e.R7$(3),e.Y8G("title","Progresso")("width",200)("template",u),e.R7$(3),e.Y8G("rows",n.rowsLimit)}},dependencies:[A.bT,f._,v.T,h.I,G.i,U.H,M.e,k.O,V.r,L.n,Q.a,Ft.r]})}}return o})();const Jt=()=>["gestao","plano-entrega"],Wt=o=>({unidade_id:o,status:"ATIVO"}),Kt=o=>({showFilter:!1,filter:o}),Zt=(o,s)=>({route:o,params:s}),ea=o=>["unidade_id","=",o],ta=()=>["status","=","ATIVO"],aa=(o,s)=>[o,s];let na=(()=>{class o extends K.n{constructor(t){super(t,w,D.m),this.injector=t,this.validate=(a,n)=>{let i=null;return["nome","plano_entrega_id"].indexOf(n)>=0&&!a.value?.length&&(i="Obrigat\xf3rio"),i},this.titleEdit=a=>"Editando "+this.lex.translate("Plano de Entregas")+": "+(a?.nome||""),this.unidadeDao=t.get(y.s),this.programaDao=t.get(de.X),this.planoEntregaDao=t.get(D.m),this.cadeiaValorDao=t.get(R.X),this.planejamentoInstitucionalDao=t.get(P.Y),this.join=[],this.modalWidth=1e3,this.form=this.fh.FormBuilder({nome:{default:""},data_inicio:{default:""},data_fim:{default:""},planejamento_id:{default:null},cadeia_valor_id:{default:null},unidade_id:{default:this.auth.unidade?.id},plano_entrega_id:{default:null},programa_id:{default:null},status:{default:"HOMOLOGANDO"}},this.cdRef,this.validate)}ngOnInit(){super.ngOnInit();let t=this.metadata?.planoEntrega?this.metadata?.planoEntrega:null;t&&(this.form.controls.plano_entrega_id.setValue(t.id),this.form.controls.nome.setValue(t.nome),this.form.controls.data_inicio.setValue(t.data_inicio),this.form.controls.data_fim.setValue(t.data_fim),this.form.controls.planejamento_id.setValue(t.planejamento_id),this.form.controls.cadeia_valor_id.setValue(t.cadeia_valor_id))}loadData(t,a){var n=this;return(0,c.A)(function*(){let i=Object.assign({},a.value);a.patchValue(n.util.fillForm(i,t)),n.cdRef.detectChanges()})()}initializeData(t){var a=this;return(0,c.A)(function*(){a.loadData(a.entity,a.form)})()}saveData(t){var a=this;return(0,c.A)(function*(){return new Promise((n,i)=>{let l=a.util.fill(new w,a.entity);l=a.util.fillForm(l,a.form.value),n(l)})})()}onPlanoEntregaChange(t){this.form.controls.plano_entrega_id.value&&(this.form.controls.nome.setValue(this.planoEntrega?.selectedEntity.nome),this.form.controls.data_inicio.setValue(this.planoEntrega?.selectedEntity.data_inicio),this.form.controls.data_fim.setValue(this.planoEntrega?.selectedEntity.data_fim),this.form.controls.planejamento_id.setValue(this.planoEntrega?.selectedEntity.planejamento_id),this.form.controls.cadeia_valor_id.setValue(this.planoEntrega?.selectedEntity.cadeia_valor_id),this.form.controls.programa_id.setValue(this.planoEntrega?.selectedEntity.programa_id))}static{this.\u0275fac=function(a){return new(a||o)(e.rXU(e.zZn))}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["plano-entrega-adesao"]],viewQuery:function(a,n){if(1&a&&(e.GBs(j.Q,5),e.GBs(f._,7),e.GBs(k.O,7)),2&a){let i;e.mGM(i=e.lsd())&&(n.editableForm=i.first),e.mGM(i=e.lsd())&&(n.grid=i.first),e.mGM(i=e.lsd())&&(n.planoEntrega=i.first)}},features:[e.Vt3],decls:21,vars:39,consts:[["planoEntrega",""],["initialFocus","plano_entrega_id",3,"submit","cancel","form","disabled","title"],[1,"row","mb-4"],["controlName","plano_entrega_id","label","Plano de Entregas da Unidade-pai","required","",3,"change","size","dao","selectRoute","where"],[1,"row"],["label","Nome deste Plano de Entregas","controlName","nome","required","",3,"size"],["disabled","","controlName","unidade_id",3,"size","label","dao"],["disabled","","label","Status","controlName","status",3,"size"],[1,"row","mt-4"],["title","Dados herdados do Plano de Entregas da Unidade-pai",3,"collapse"],["disabled","","label","Programa de Gest\xe3o","controlName","programa_id",3,"size","dao"],["disabled","","label","Planejamento Institucional","controlName","planejamento_id",3,"size","dao"],["disabled","","controlName","data_inicio","label","In\xedcio",3,"size","labelInfo"],["disabled","","label","Cadeia de Valor","controlName","cadeia_valor_id",3,"size","dao"],["disabled","","controlName","data_fim","label","Fim",3,"size","labelInfo"]],template:function(a,n){if(1&a){const i=e.RV6();e.j41(0,"editable-form",1),e.bIt("submit",function(){return e.eBV(i),e.Njj(n.onSaveData())})("cancel",function(){return e.eBV(i),e.Njj(n.onCancel())}),e.j41(1,"div")(2,"div",2)(3,"input-search",3,0),e.bIt("change",function(u){return e.eBV(i),e.Njj(n.onPlanoEntregaChange(u))}),e.k0s(),e.nrm(5,"separator"),e.k0s(),e.j41(6,"div",4),e.nrm(7,"input-text",5),e.k0s(),e.j41(8,"div",4),e.nrm(9,"input-search",6)(10,"input-text",7),e.k0s(),e.j41(11,"div",8)(12,"separator",9)(13,"div",4),e.nrm(14,"input-search",10),e.k0s(),e.j41(15,"div",4),e.nrm(16,"input-search",11)(17,"input-datetime",12),e.k0s(),e.j41(18,"div",4),e.nrm(19,"input-search",13)(20,"input-datetime",14),e.k0s()()()()()}2&a&&(e.Y8G("form",n.form)("disabled",n.formDisabled)("title",n.isModal?"":n.title),e.R7$(3),e.Y8G("size",12)("dao",n.planoEntregaDao)("selectRoute",e.l_i(30,Zt,e.lJ4(25,Jt),e.eq3(28,Kt,e.eq3(26,Wt,n.auth.unidade.unidade_pai_id))))("where",e.l_i(36,aa,e.eq3(33,ea,n.auth.unidade.unidade_pai_id),e.lJ4(35,ta))),e.R7$(4),e.Y8G("size",12),e.BMQ("maxlength",250),e.R7$(2),e.Y8G("size",9)("label",n.lex.translate("Unidade"))("dao",n.unidadeDao),e.R7$(),e.Y8G("size",3),e.BMQ("maxlength",250),e.R7$(2),e.Y8G("collapse","collapse"),e.R7$(2),e.Y8G("size",12)("dao",n.programaDao),e.R7$(2),e.Y8G("size",9)("dao",n.planejamentoInstitucionalDao),e.R7$(),e.Y8G("size",3)("labelInfo","In\xedcio "+n.lex.translate("Plano de Entrega")),e.R7$(2),e.Y8G("size",9)("dao",n.cadeiaValorDao),e.R7$(),e.Y8G("size",3)("labelInfo","Fim "+n.lex.translate("Plano de Entrega")))},dependencies:[j.Q,k.O,q.H,V.r,H.F]})}}return o})();var oa=r(3609),ia=r(158),pe=r(2075),_e=r(6774),he=r(4423);let sa=(()=>{class o extends he.F{constructor(t){super("PlanoEntregaEntregaProduto",t),this.injector=t,this.inputSearchConfig.searchFields=["produto.nome"]}static{this.\u0275fac=function(a){return new(a||o)(e.KVO(e.zZn))}}static{this.\u0275prov=e.jDH({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var la=r(8320);class ra extends N.C{constructor(s){super(),this.produto_id="",this.entrega_id="",this.initialization(s)}}const da=["produto"],ua=()=>["gestao","produto"],ca=()=>({mode:"search-ativos"}),ma=(o,s)=>({route:o,params:s});function ga(o,s){1&o&&(e.j41(0,"order",8),e.EFF(1,"Produtos"),e.k0s()),2&o&&e.Y8G("header",s.header)}function pa(o,s){if(1&o&&(e.j41(0,"div",9)(1,"p"),e.EFF(2),e.k0s()()),2&o){const t=s.row;e.R7$(2),e.JRh(null==t.produto?null:t.produto.nome)}}function _a(o,s){if(1&o&&e.nrm(0,"input-search",10,4),2&o){const t=e.XpG();e.Y8G("placeholder","Selecione o Produto")("dao",t.produtoDao)("selectRoute",e.l_i(5,ma,e.lJ4(3,ua),e.lJ4(4,ca)))}}let ha=(()=>{class o extends B.g{set control(t){super.control=t}get control(){return super.control}set entity(t){super.entity=t}get entity(){return super.entity}set disabled(t){this._disabled!=t&&(this._disabled=t)}get disabled(){return this._disabled}set noPersist(t){super.noPersist=t}get noPersist(){return super.noPersist}get items(){return this.gridControl.value||this.gridControl.setValue(new ra),this.gridControl.value.produtos||(this.gridControl.value.produtos=[]),this.gridControl.value.produtos}constructor(t){var a;super(t),a=this,this.injector=t,this.edit=!1,this._disabled=!1,this.asyncValidate=function(){var n=(0,c.A)(function*(i,l){let u=null;if(["produto_id"].indexOf(l)>=0)if(i.value?.length)if(a.items.some(_=>_.produto_id===i.value))u="Produto j\xe1 inserido nesta entrega";else try{const _=yield a.produtoDao?.getById(i.value);!_?.data_ativado&&_?.data_desativado&&(u="Produto inativo n\xe3o pode ser usado")}catch{u="Erro ao verificar o produto"}else u="Obrigat\xf3rio";return u});return function(i,l){return n.apply(this,arguments)}}(),this.dao=t.get(sa),this.produtoDao=t.get(la.L),this.cdRef=t.get(e.gRc),this.form=this.fh.FormBuilder({produto_id:{default:"",async:!0}},this.cdRef,void 0,this.asyncValidate),this.join=["produto"]}addProduto(){var t=this;return(0,c.A)(function*(){return{id:t.dao.generateUuid(),_status:"ADD"}})()}loadProduto(t,a){return(0,c.A)(function*(){"ADD"!=a._status&&t.controls.entrega_id.setValue(a.entrega_id)})()}removeProduto(t){var a=this;return(0,c.A)(function*(){if(yield a.dialog.confirm("Excluir?","Deseja realmente excluir o Produto?")){a.loading=!0;try{a.isNoPersist?Object.assign(t,{_status:"DELETE"}):yield a.dao?.delete(t.id)}finally{a.loading=!1}return!a.isNoPersist}return!1})()}saveProduto(t,a){var n=this;return(0,c.A)(function*(){let i;return n.form.markAllAsTouched(),n.form.valid&&(a.id="NEW"==a.id?n.dao.generateUuid():a.id,a.produto_id=n.form.controls.produto_id.value,a.produto=n.produto.selectedEntity,i=a,console.log(a),n.cdRef.detectChanges()),i})()}static{this.\u0275fac=function(a){return new(a||o)(e.rXU(e.zZn))}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["plano-entrega-list-produto"]],viewQuery:function(a,n){if(1&a&&(e.GBs(j.Q,5),e.GBs(f._,5),e.GBs(da,5)),2&a){let i;e.mGM(i=e.lsd())&&(n.editableForm=i.first),e.mGM(i=e.lsd())&&(n.grid=i.first),e.mGM(i=e.lsd())&&(n.produto=i.first)}},inputs:{control:"control",entity:"entity",disabled:"disabled",noPersist:"noPersist",cdRef:"cdRef",edit:"edit"},features:[e.Vt3],decls:11,vars:18,consts:[["gridSolucoes",""],["titleProduto",""],["columnProduto",""],["editProduto",""],["produto",""],["noMargin","","editable","",3,"items","form","selectable","minHeight","join","groupBy","add","remove","save","load","hasDelete","hasEdit","hasAdd"],[3,"titleTemplate","template","editTemplate","verticalAlign","align"],["type","options"],["by","produto.nome",3,"header"],[1,"w-100","d-flex"],["label","","required","","controlName","produto_id",3,"placeholder","dao","selectRoute"]],template:function(a,n){if(1&a&&(e.j41(0,"grid",5,0)(2,"columns")(3,"column",6),e.DNE(4,ga,2,1,"ng-template",null,1,e.C5r)(6,pa,3,1,"ng-template",null,2,e.C5r)(8,_a,2,8,"ng-template",null,3,e.C5r),e.k0s(),e.nrm(10,"column",7),e.k0s()()),2&a){const i=e.sdS(5),l=e.sdS(7),u=e.sdS(9);e.Y8G("items",n.items)("form",n.form)("selectable",!1)("minHeight",n.items.length>2?0:300)("join",n.join)("groupBy",n.groupBy)("add",n.addProduto.bind(n))("remove",n.removeProduto.bind(n))("save",n.saveProduto.bind(n))("load",n.loadProduto.bind(n))("hasDelete",!n.disabled)("hasEdit",!n.disabled)("hasAdd",!n.disabled),e.R7$(3),e.Y8G("titleTemplate",i)("template",l)("editTemplate",u)("verticalAlign","middle")("align","center")}},dependencies:[f._,v.T,h.I,k.O,J.Y]})}}return o})();const fa=["gridProcessos"],Ea=["gridObjetivos"],ba=["entregas"],va=["planejamento"],Ta=["cadeiaValor"],Oa=["inputObjetivo"],Aa=["inputProcesso"],Ca=["entrega"],Pa=["unidade"],Ia=["tabs"],Da=["etiqueta"],Ra=o=>["plano_entrega.unidade_id","in",o],Ga=()=>["gestao","plano-entrega","entrega-list"],ja=o=>({route:o}),ya=o=>({idsUnidadesAscendentes:o}),Na=o=>["planejamento_id","==",o],fe=o=>[o],La=()=>["gestao","planejamento","objetivoList"],Sa=o=>({planejamento_id:o}),Ee=o=>({filter:o}),be=(o,s)=>({route:o,params:s}),ka=o=>["cadeia_valor_id","==",o],Va=()=>["gestao","cadeia-valor","processoList"],Fa=o=>({cadeia_valor_id:o});function Ya(o,s){if(1&o&&(e.j41(0,"div",21),e.nrm(1,"plano-entrega-valor-meta-input",43)(2,"input-number",44),e.j41(3,"div",21),e.nrm(4,"plano-entrega-valor-meta-input",45)(5,"input-number",46),e.k0s()()),2&o){const t=e.XpG(),a=e.sdS(31);e.R7$(),e.Y8G("entrega",null==a?null:a.selectedEntity)("size",6)("control",t.form.controls.meta),e.R7$(),e.Y8G("size",6),e.R7$(2),e.Y8G("entrega",null==a?null:a.selectedEntity)("size",6)("control",t.form.controls.realizado)("change",t.onRealizadoChange.bind(t)),e.R7$(),e.Y8G("size",6)("stepValue",.01)}}function za(o,s){1&o&&(e.j41(0,"div",21),e.nrm(1,"input-number",44)(2,"input-number",46),e.k0s()),2&o&&(e.R7$(),e.Y8G("size",6),e.R7$(),e.Y8G("size",6)("stepValue",.01))}function $a(o,s){1&o&&(e.j41(0,"order",51),e.EFF(1,"Objetivos"),e.k0s()),2&o&&e.Y8G("header",s.header)}function wa(o,s){if(1&o&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&o){const t=s.row;e.R7$(),e.JRh(null==t.objetivo?null:t.objetivo.nome)}}function Ba(o,s){if(1&o&&e.nrm(0,"input-search",52,10),2&o){const t=e.XpG(2);e.Y8G("size",12)("where",e.eq3(6,fe,e.eq3(4,Na,t.planejamentoId)))("dao",t.planejamentoObjetivoDao)("selectRoute",e.l_i(13,be,e.lJ4(8,La),e.eq3(11,Ee,e.eq3(9,Sa,t.planejamentoId))))}}function Ua(o,s){if(1&o&&(e.j41(0,"tab",47),e.nrm(1,"input-search",48,5),e.j41(3,"grid",49,6)(5,"columns")(6,"column",50),e.DNE(7,$a,2,1,"ng-template",null,7,e.C5r)(9,wa,2,1,"ng-template",null,8,e.C5r)(11,Ba,2,16,"ng-template",null,9,e.C5r),e.k0s(),e.nrm(13,"column",29),e.k0s()()()),2&o){const t=e.sdS(8),a=e.sdS(10),n=e.sdS(12),i=e.XpG();e.R7$(),e.Y8G("size",12)("dao",i.planejamentoDao),e.R7$(2),e.Y8G("control",i.form.controls.objetivos)("form",i.formObjetivos)("orderBy",i.orderBy)("hasDelete",!0)("hasEdit",!0)("add",i.addObjetivo.bind(i))("remove",i.removeObjetivo.bind(i))("save",i.saveObjetivo.bind(i)),e.R7$(3),e.Y8G("titleTemplate",t)("template",a)("editTemplate",n)}}function Ma(o,s){1&o&&(e.j41(0,"order",56),e.EFF(1,"Processos"),e.k0s()),2&o&&e.Y8G("header",s.header)}function qa(o,s){if(1&o&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&o){const t=s.row;e.R7$(),e.JRh(null==t.processo?null:t.processo.nome)}}function Xa(o,s){if(1&o&&e.nrm(0,"input-search",57,16),2&o){const t=e.XpG(2);e.Y8G("size",12)("where",e.eq3(6,fe,e.eq3(4,ka,t.cadeiaValorId)))("dao",t.cadeiaValorProcessoDao)("selectRoute",e.l_i(13,be,e.lJ4(8,Va),e.eq3(11,Ee,e.eq3(9,Fa,t.cadeiaValorId))))}}function xa(o,s){if(1&o&&(e.j41(0,"tab",53),e.nrm(1,"input-search",54,11),e.j41(3,"grid",49,12)(5,"columns")(6,"column",50),e.DNE(7,Ma,2,1,"ng-template",null,13,e.C5r)(9,qa,2,1,"ng-template",null,14,e.C5r)(11,Xa,2,16,"ng-template",null,15,e.C5r),e.k0s(),e.nrm(13,"column",55),e.k0s()()()),2&o){const t=e.sdS(8),a=e.sdS(10),n=e.sdS(12),i=e.XpG();e.R7$(),e.Y8G("size",12)("dao",i.cadeiaValorDao),e.R7$(2),e.Y8G("control",i.form.controls.processos)("form",i.formProcessos)("orderBy",i.orderBy)("hasDelete",!0)("hasEdit",!0)("add",i.addProcesso.bind(i))("remove",i.removeProcesso.bind(i))("save",i.saveProcesso.bind(i)),e.R7$(3),e.Y8G("titleTemplate",t)("template",a)("editTemplate",n),e.R7$(7),e.Y8G("dynamicButtons",i.dynamicButtonsProcessos.bind(i))}}function Ha(o,s){if(1&o&&(e.j41(0,"tab",58),e.nrm(1,"plano-entrega-list-produto",59,17),e.k0s()),2&o){const t=e.XpG();e.R7$(),e.Y8G("entity",t.entity)("disabled",t.formDisabled)}}let ve=(()=>{class o extends K.n{constructor(t){super(t,x.j,S.o),this.injector=t,this.itensQualitativo=[],this.idsUnidadesAscendentes=[],this.checklist=[],this.etiquetas=[],this.etiquetasAscendentes=[],this.validate=(a,n)=>{let i=null;return["descricao","destinatario"].indexOf(n)>=0?a.value?.length?this.entrega.selectedEntity&&this.entrega.selectedEntity.descricao==a.value&&(i="\xc9 necess\xe1rio incrementar ou modificar a descri\xe7\xe3o da entrega"):i="Obrigat\xf3rio":["progresso_realizado","realizado"].indexOf(n)>=0&&!(a.value>=0||a.value?.length>0)||["progresso_esperado","meta"].indexOf(n)>=0&&!(a.value>0||a.value?.length>0)?i="Obrigat\xf3rio":["unidade_id"].indexOf(n)>=0&&!a.value?.length?i="A unidade demandante \xe9 obrigat\xf3ria":["entrega_id"].indexOf(n)>=0&&!a.value?.length?i="A entrega \xe9 obrigat\xf3ria":["data_inicio"].indexOf(n)>=0&&!this.dao?.validDateTime(a.value)||["data_fim"].indexOf(n)>=0&&!this.dao?.validDateTime(a.value)?i="Inv\xe1lido":["planejamento_objetivo_id"].indexOf(n)>=0?(a.value?.length||(i="O objetivo do planejamento \xe9 obrigat\xf3rio"),a.value?.length&&this.gridObjetivos?.items.filter(l=>"ADD"==l._status).map(l=>l.planejamento_objetivo_id).includes(this.formObjetivos.controls.planejamento_objetivo_id.value)&&(i="Este objetivo est\xe1 em duplicidade!")):["cadeia_processo_id"].indexOf(n)>=0&&(a.value?.length||(i="O processo da cadeia de valor \xe9 obrigat\xf3rio"),a.value?.length&&this.gridProcessos?.items.map(l=>l.cadeia_processo_id).includes(this.formProcessos.controls.cadeia_processo_id.value)&&(i="Este processo est\xe1 em duplicidade!")),i},this.formValidation=a=>{let n=this.form?.controls.data_inicio.value,i=this.form?.controls.data_fim.value;return this.gridObjetivos?.editing?(this.tabs.active="OBJETIVOS","Salve ou cancele o registro atual em edi\xe7\xe3o"):this.gridProcessos?.editing?(this.tabs.active="PROCESSOS","Salve ou cancele o registro atual em edi\xe7\xe3o"):this.dao?.validDateTime(n)?this.dao?.validDateTime(i)?n>i?"A data do fim n\xe3o pode ser anterior \xe0 data do in\xedcio!":!this.auth.hasPermissionTo("MOD_PENT_ENTR_EXTRPL")&&this.planoEntrega&&n<this.planoEntrega.data_inicio?"Data de inicio menor que a data de inicio "+this.lex.translate("do Plano de Entrega")+": "+this.util.getDateFormatted(this.planoEntrega.data_inicio):!this.auth.hasPermissionTo("MOD_PENT_ENTR_EXTRPL")&&this.planoEntrega&&this.planoEntrega.data_fim&&i>this.planoEntrega.data_fim?"Data de fim maior que a data de fim "+this.lex.translate("do Plano de Entrega")+": "+this.util.getDateFormatted(this.planoEntrega.data_fim):void 0:"Data de fim inv\xe1lida":"Data de in\xedcio inv\xe1lida"},this.planejamentoDao=t.get(P.Y),this.unidadeDao=t.get(y.s),this.entregaDao=t.get(ue.u),this.planoEntregaDao=t.get(D.m),this.planejamentoInstitucionalDao=t.get(P.Y),this.planoEntregaEntregaDao=t.get(S.o),this.cadeiaValorDao=t.get(R.X),this.cadeiaValorProcessoDao=t.get(me.p),this.planejamentoObjetivoDao=t.get(ce.O),this.planoEntregaService=t.get(m.C),this.modalWidth=700,this.join=["entrega","objetivos.objetivo","processos.processo","produtos.produto"],this.form=this.fh.FormBuilder({descricao:{default:""},descricao_entrega:{default:""},data_inicio:{default:new Date},data_fim:{default:new Date},meta:{default:100},descricao_meta:{default:""},realizado:{default:null},plano_entrega_id:{default:""},entrega_pai_id:{default:null},entrega_id:{default:null},progresso_esperado:{default:100},progresso_realizado:{default:null},unidade_id:{default:null},destinatario:{default:null},objetivos:{default:[]},processos:{default:[]},produtos:{default:[]},listaQualitativo:{default:[]},planejamento_id:{default:null},cadeia_valor_id:{default:null},objetivo_id:{default:null},objetivo:{default:null},checklist:{default:[]},etiquetas:{default:[]},etiqueta:{default:""}},this.cdRef,this.validate),this.formObjetivos=this.fh.FormBuilder({planejamento_objetivo_id:{default:null}},this.cdRef,this.validate),this.formProcessos=this.fh.FormBuilder({cadeia_processo_id:{default:null}},this.cdRef,this.validate),this.formChecklist=this.fh.FormBuilder({id:{default:""},texto:{default:""},checked:{default:!1}},this.cdRef)}ngOnInit(){super.ngOnInit(),this.planoEntrega=this.metadata?.plano_entrega,this.planejamentoId=this.metadata?.planejamento_id,this.cadeiaValorId=this.metadata?.cadeia_valor_id,this.unidadeId=this.metadata?.unidade_id,this.metadata?.data_fim&&(this.dataFim=this.metadata?.data_fim),this.entity=this.metadata?.entrega}loadData(t,a){var n=this;return(0,c.A)(function*(){""==t.unidade_id&&(t.unidade_id=n.unidadeId??"");let i=Object.assign({},a.value);n.onEntregaChange(a.value);let{meta:l,realizado:u,...g}=t;yield n.entrega?.loadSearch(t.entrega||i.entrega_id,!1),yield n.unidade?.loadSearch(n.unidadeId),yield n.planejamento?.loadSearch(n.planejamentoId),yield n.cadeiaValor?.loadSearch(n.cadeiaValorId);let _=n.unidadeId?.length?yield n.unidadeDao.getById(n.unidadeId):null;n.idsUnidadesAscendentes=_?.path?.split("/").slice(1)||[],_&&n.idsUnidadesAscendentes.push(_.id),a.patchValue(n.util.fillForm(i,g)),a.controls.meta.setValue(n.planoEntregaService.getValor(t.meta)),a.controls.realizado.setValue(n.planoEntregaService.getValor(t.realizado)),a.controls.objetivos.setValue(t.objetivos),a.controls.processos.setValue(t.processos),a.controls.produtos.setValue(t.produtos),n.dataFim&&a.controls.data_fim.setValue(n.dataFim),yield n.loadEtiquetas()})()}initializeData(t){var a=this;return(0,c.A)(function*(){yield a.loadData(a.entity,t)})()}onSaveEntrega(){var t=this;return(0,c.A)(function*(){let a,n=!0;if(t.formValidation)try{a=yield t.formValidation(t.form)}catch(i){a=i}if(t.form.valid&&!a){if("edit"==t.action){let i=(yield t.saveData(t.form.value)).modalResult,l=[];i._status="EDIT",t.loading=!0;try{l=yield t.planoEntregaDao.planosImpactadosPorAlteracaoEntrega(i)}finally{t.loading=!1}if(l.length){let u=l.map(g=>t.util.getDateFormatted(g.data_inicio)+" - "+t.util.getDateFormatted(g.data_fim)+" - "+g.unidade?.sigla+": "+g.usuario?.nome+"\n");n=yield t.dialog.confirm("Altera assim mesmo?","Caso prossiga com essa modifica\xe7\xe3o os seguintes planos de trabalho ser\xe3o repactuados automaticamente:\n\n"+u+"\nDeseja prosseguir?")}}n&&(yield t.onSaveData())}else t.form.markAllAsTouched(),a&&t.error(a)})()}saveData(t){return new Promise((a,n)=>{let i=this.util.fill(new x.j,this.entity);this.gridObjetivos?.confirm(),this.gridProcessos?.confirm();let{meta:l,realizado:u,...g}=this.form.value;i=this.util.fillForm(i,g),i.unidade=this.unidade?.selectedEntity,i.entrega=this.entrega?.selectedEntity,i.meta=this.planoEntregaService.getEntregaValor(i.entrega,l),i.realizado=this.planoEntregaService.getEntregaValor(i.entrega,u),a(new oa.p(i))})}onRealizadoChange(t,a){this.calculaRealizado()}calculaRealizado(){const t=this.form?.controls.meta.value,a=this.form?.controls.realizado.value;if(t&&a){let n=isNaN(a)?0:(a/t*100).toFixed(0)||0;this.form?.controls.progresso_realizado.setValue(n)}}dynamicOptionsObjetivos(t){let a=[];return a.push({label:"Excluir",icon:"bi bi-trash",color:"btn-outline-danger",onClick:i=>{this.removeObjetivo(i)}}),a}dynamicButtonsObjetivos(t){return[]}dynamicButtonsProcessos(t){return[]}addObjetivo(){var t=this;return(0,c.A)(function*(){return{id:t.dao.generateUuid(),_status:"ADD"}})()}removeObjetivo(t){var a=this;return(0,c.A)(function*(){return(yield a.dialog.confirm("Exclui ?","Deseja realmente excluir?"))&&(t._status="DELETE"),!1})()}saveObjetivo(t,a){var n=this;return(0,c.A)(function*(){let i=a;if(t.controls.planejamento_objetivo_id.value.length&&n.inputObjetivo.selectedItem)return i.planejamento_objetivo_id=t.controls.planejamento_objetivo_id.value,i.objetivo=n.inputObjetivo.selectedItem.entity,i})()}addProcesso(){var t=this;return(0,c.A)(function*(){return{id:t.dao.generateUuid(),_status:"ADD"}})()}removeProcesso(t){var a=this;return(0,c.A)(function*(){return(yield a.dialog.confirm("Exclui ?","Deseja realmente excluir?"))&&(t._status="DELETE"),!1})()}saveProcesso(t,a){var n=this;return(0,c.A)(function*(){let i=a;if(t.controls.cadeia_processo_id.value.length&&n.inputProcesso.selectedItem)return i.cadeia_processo_id=t.controls.cadeia_processo_id.value,i.processo=n.inputProcesso.selectedItem.entity,i})()}onEntregaChange(t){var a=this;return(0,c.A)(function*(){if(a.entrega&&a.entrega.selectedItem){const n=a.entrega?.selectedEntity;switch(n.tipo_indicador){case"QUALITATIVO":a.itensQualitativo=n.lista_qualitativos||[],a.form?.controls.meta.setValue(a.itensQualitativo.length?a.itensQualitativo[0].key:null),a.form?.controls.realizado.setValue(a.itensQualitativo.length?a.itensQualitativo[0].key:null);break;case"VALOR":case"QUANTIDADE":a.form?.controls.meta.setValue(""),a.form?.controls.realizado.setValue(0);break;case"PORCENTAGEM":a.form?.controls.meta.setValue(100),a.form?.controls.realizado.setValue(0)}yield a.loadEtiquetas(),n.checklist&&a.loadChecklist(),a.calculaRealizado()}})()}loadEtiquetas(){var t=this;return(0,c.A)(function*(){if(!t.etiquetasAscendentes.filter(a=>a.data==t.unidade?.selectedEntity?.id).length){let a=yield t.carregaEtiquetasUnidadesAscendentes(t.unidade?.selectedEntity);t.etiquetasAscendentes.push(...a)}t.etiquetas=t.util.merge(t.entrega?.selectedEntity?.etiquetas,t.unidade?.selectedEntity?.etiquetas,(a,n)=>a.key==n.key),t.etiquetas=t.util.merge(t.etiquetas,t.auth.usuario.config?.etiquetas,(a,n)=>a.key==n.key),t.etiquetas=t.util.merge(t.etiquetas,t.etiquetasAscendentes.filter(a=>a.data==t.unidade?.selectedEntity?.id),(a,n)=>a.key==n.key)})()}carregaEtiquetasUnidadesAscendentes(t){var a=this;return(0,c.A)(function*(){let n=[],i=(t=t||a.auth.unidade).path.split("/");return(yield a.unidadeDao.query({where:[["id","in",i]]}).asPromise()).forEach(u=>{n=a.util.merge(n,u.etiquetas,(g,_)=>g.key==_.key)}),n.forEach(u=>u.data=t.id),n})()}loadChecklist(){let a=(this.entrega?.selectedEntity).checklist.map(n=>({id:n.id,texto:n.texto,checked:!1}));this.checklist=a||[],this.form.controls.checklist.setValue(a)}addItemHandleEtiquetas(){let t;if(this.etiqueta&&this.etiqueta.selectedItem){const a=this.etiqueta.selectedItem,n=a.key?.length?a.key:this.util.textHash(a.value);this.util.validateLookupItem(this.form.controls.etiquetas.value,n)&&(t={key:n,value:a.value,color:a.color,icon:a.icon},this.form.controls.etiqueta.setValue(""))}return t}static{this.\u0275fac=function(a){return new(a||o)(e.rXU(e.zZn))}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["plano-entrega-form-entrega"]],viewQuery:function(a,n){if(1&a&&(e.GBs(j.Q,5),e.GBs(fa,5),e.GBs(Ea,5),e.GBs(ba,5),e.GBs(va,5),e.GBs(Ta,5),e.GBs(Oa,5),e.GBs(Aa,5),e.GBs(Ca,5),e.GBs(Pa,5),e.GBs(Ia,5),e.GBs(Da,5)),2&a){let i;e.mGM(i=e.lsd())&&(n.editableForm=i.first),e.mGM(i=e.lsd())&&(n.gridProcessos=i.first),e.mGM(i=e.lsd())&&(n.gridObjetivos=i.first),e.mGM(i=e.lsd())&&(n.entregas=i.first),e.mGM(i=e.lsd())&&(n.planejamento=i.first),e.mGM(i=e.lsd())&&(n.cadeiaValor=i.first),e.mGM(i=e.lsd())&&(n.inputObjetivo=i.first),e.mGM(i=e.lsd())&&(n.inputProcesso=i.first),e.mGM(i=e.lsd())&&(n.entrega=i.first),e.mGM(i=e.lsd())&&(n.unidade=i.first),e.mGM(i=e.lsd())&&(n.tabs=i.first),e.mGM(i=e.lsd())&&(n.etiqueta=i.first)}},features:[e.Vt3],decls:45,vars:58,consts:[["tabs",""],["unidade",""],["entrega",""],["naoSelecionou",""],["etiqueta",""],["planejamento",""],["gridObjetivos",""],["titleObjetivo",""],["columnObjetivo",""],["editObjetivo",""],["inputObjetivo",""],["cadeiaValor",""],["gridProcessos",""],["titleProcessos",""],["processo",""],["editProcesso",""],["inputProcesso",""],["produtos",""],["initialFocus","descricao",3,"submit","cancel","form","disabled","title"],["display","","right","",3,"title"],["key","ENTREGAS","label","Entregas"],[1,"row"],["collapse","",3,"title","collapsed"],["label","T\xedtulo","controlName","descricao","required","",3,"size","placeholder"],["controlName","descricao_entrega",3,"size","label","placeholder"],["controlName","entrega_pai_id",3,"size","label","dao","where","selectRoute","metadata"],[1,"row","mt-4"],["editable","",3,"control","form","hasAdd","hasDelete"],["type","text","title","Texto","field","texto"],["type","options"],["date","","label","In\xedcio","controlName","data_inicio","required","",3,"size","labelInfo"],["date","","label","Fim","controlName","data_fim","required","",3,"size","labelInfo"],["label","Demandante","controlName","unidade_id","required","",3,"size","dao"],["label","Destinat\xe1rio","controlName","destinatario","required","",3,"size"],["title","Planejamento"],["controlName","entrega_id","placeholder","Selecione ou cadastre uma meta do cat\xe1logo usando a lupa","required","",3,"change","size","label","dao"],["label","Descri\xe7\xe3o da meta","controlName","descricao_meta","placeholder","Descreva a meta",3,"size"],["class","row",4,"ngIf","ngIfElse"],["label","Etiquetas","controlName","etiquetas",3,"size","control","addItemHandle"],["controlName","etiqueta",3,"size","control","items"],["key","OBJETIVOS","label","Objetivos",4,"ngIf"],["key","PROCESSOS","label","Processos",4,"ngIf"],["key","PRODUTOS","label","Produtos",4,"ngIf"],["icon","bi bi-graph-up-arrow","label","Meta","labelInfo","Onde quero chegar ao final da entrega. Evolu\xe7\xe3o total da entrega, podendo ultrapassar o per\xedodo do plano de entregas",3,"entrega","size","control"],["label","Parcela da entrega no plano","controlName","progresso_esperado","sufix","%","labelInfo","Quanto vou caminhar nesse plano de entregas. Percentual do total da entrega que ser\xe1 realizado durante a vig\xeancia desse plano",3,"size"],["icon","bi bi-check-lg","label","Progresso ao in\xedcio do plano","labelInfo","De onde estou saindo nesse plano. Valor correspondente ao progresso verificado no planejamento do plano de entregas",3,"entrega","size","control","change"],["label","Progresso j\xe1 realizado","controlName","progresso_realizado","sufix","%","disabled","","labelInfo","Quanto caminhei no plano atual Evolu\xe7\xe3o j\xe1 realizada para a meta. No ato da cria\xe7\xe3o do plano, \xe9 o percentual de progresso ao in\xedcio do plano em rela\xe7\xe3o \xe0 meta",3,"size","stepValue"],["key","OBJETIVOS","label","Objetivos"],["controlName","planejamento_id","disabled","",3,"size","dao"],["editable","",3,"control","form","orderBy","hasDelete","hasEdit","add","remove","save"],[3,"titleTemplate","template","editTemplate"],["by","objetivo.nome",3,"header"],["controlName","planejamento_objetivo_id",3,"size","where","dao","selectRoute"],["key","PROCESSOS","label","Processos"],["controlName","cadeia_valor_id","disabled","",3,"size","dao"],["type","options",3,"dynamicButtons"],["by","processo.nome",3,"header"],["label","","icon","","controlName","cadeia_processo_id","label","",3,"size","where","dao","selectRoute"],["key","PRODUTOS","label","Produtos"],["noPersist","",3,"entity","disabled"]],template:function(a,n){if(1&a){const i=e.RV6();e.j41(0,"editable-form",18),e.bIt("submit",function(){return e.eBV(i),e.Njj(n.onSaveEntrega())})("cancel",function(){return e.eBV(i),e.Njj(n.onCancel())}),e.j41(1,"tabs",19,0)(3,"tab",20)(4,"div",21)(5,"separator",22)(6,"div",21),e.nrm(7,"input-text",23),e.k0s(),e.j41(8,"div",21),e.nrm(9,"input-textarea",24),e.k0s(),e.j41(10,"div",21),e.nrm(11,"input-search",25),e.k0s(),e.j41(12,"separator",22)(13,"div",26)(14,"h5"),e.EFF(15,"Etapas"),e.k0s(),e.j41(16,"grid",27)(17,"columns"),e.nrm(18,"column",28)(19,"column",29),e.k0s()()()()(),e.j41(20,"separator",22)(21,"div",21),e.nrm(22,"input-datetime",30)(23,"input-datetime",31),e.k0s(),e.j41(24,"div",21),e.nrm(25,"input-search",32,1)(27,"input-text",33),e.k0s()(),e.nrm(28,"separator",34),e.j41(29,"div",21)(30,"input-search",35,2),e.bIt("change",function(u){return e.eBV(i),e.Njj(n.onEntregaChange(u))}),e.k0s()(),e.j41(32,"div",21),e.nrm(33,"input-textarea",36),e.k0s(),e.DNE(34,Ya,6,10,"div",37)(35,za,3,3,"ng-template",null,3,e.C5r),e.j41(37,"separator",22)(38,"div",21)(39,"input-multiselect",38),e.nrm(40,"input-select",39,4),e.k0s()()()()(),e.DNE(42,Ua,14,13,"tab",40)(43,xa,14,14,"tab",41)(44,Ha,3,2,"tab",42),e.k0s()()}if(2&a){const i=e.sdS(31),l=e.sdS(36);e.Y8G("form",n.form)("disabled",n.formDisabled)("title",n.isModal?"":n.title),e.R7$(),e.Y8G("title",n.isModal?"":n.title),e.R7$(4),e.Y8G("title","Informa\xe7\xf5es gerais da "+n.lex.translate("entrega"))("collapsed",!1),e.R7$(2),e.Y8G("size",12)("placeholder","T\xedtulo da "+n.lex.translate("entrega")),e.BMQ("maxlength",250),e.R7$(2),e.Y8G("size",12)("label","Descri\xe7\xe3o da "+n.lex.translate("entrega"))("placeholder","Descreva a "+n.lex.translate("entrega")),e.R7$(2),e.Y8G("size",12)("label","V\xednculo com "+n.lex.translate("entrega")+" de "+n.lex.translate("plano de entrega")+" superior")("dao",n.planoEntregaEntregaDao)("where",e.eq3(51,Ra,n.idsUnidadesAscendentes))("selectRoute",e.eq3(54,ja,e.lJ4(53,Ga)))("metadata",e.eq3(56,ya,n.idsUnidadesAscendentes)),e.R7$(),e.Y8G("title","Etapas da "+n.lex.translate("entrega"))("collapsed",!0),e.R7$(4),e.Y8G("control",n.form.controls.checklist)("form",n.formChecklist)("hasAdd",!0)("hasDelete",!0),e.R7$(4),e.Y8G("title","Especifica\xe7\xf5es da "+n.lex.translate("entrega"))("collapsed",!1),e.R7$(2),e.Y8G("size",6)("labelInfo","In\xedcio "+n.lex.translate("Plano de Entregas")),e.R7$(),e.Y8G("size",6)("labelInfo","Fim "+n.lex.translate("Plano de Entregas")+"(Estimativa Inicial)"),e.R7$(2),e.Y8G("size",6)("dao",n.unidadeDao),e.R7$(2),e.Y8G("size",6),e.BMQ("maxlength",250),e.R7$(3),e.Y8G("size",12)("label",n.lex.translate("Tipo de Meta"))("dao",n.entregaDao),e.R7$(3),e.Y8G("size",12),e.R7$(),e.Y8G("ngIf",null==i?null:i.selectedEntity)("ngIfElse",l),e.R7$(3),e.Y8G("title","Caracteriza\xe7\xe3o da "+n.lex.translate("entrega"))("collapsed",!1),e.R7$(2),e.Y8G("size",12)("control",n.form.controls.etiquetas)("addItemHandle",n.addItemHandleEtiquetas.bind(n)),e.R7$(),e.Y8G("size",12)("control",n.form.controls.etiqueta)("items",n.etiquetas),e.R7$(2),e.Y8G("ngIf",null==n.planejamentoId?null:n.planejamentoId.length),e.R7$(),e.Y8G("ngIf",null==n.cadeiaValorId?null:n.cadeiaValorId.length),e.R7$(),e.Y8G("ngIf",!1)}},dependencies:[A.bT,f._,v.T,h.I,j.Q,k.O,q.H,ia.S,V.r,X.K,se.b,pe.O,_e.j,H.F,J.Y,W.n,te,ha]})}}return o})();var Te=r(2805),Qa=r(4762);const Ja=["selectResponsaveis"];function Wa(o,s){1&o&&(e.j41(0,"strong"),e.EFF(1,"Respons\xe1vel"),e.k0s())}function Ka(o,s){if(1&o&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&o){const t=s.row;e.R7$(),e.SpI(" ",t.responsavel," ")}}function Za(o,s){1&o&&(e.j41(0,"strong"),e.EFF(1,"Criado em"),e.k0s())}function en(o,s){if(1&o&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&o){const t=s.row,a=e.XpG();e.R7$(),e.JRh(a.util.getDateTimeFormatted(t.date_time))}}function tn(o,s){1&o&&(e.j41(0,"div",9)(1,"div",17)(2,"strong"),e.EFF(3,"Atributos"),e.k0s()(),e.j41(4,"div",18)(5,"strong"),e.EFF(6,"Valores"),e.nrm(7,"br"),e.EFF(8,"Atuais"),e.k0s()(),e.j41(9,"div",18)(10,"strong"),e.EFF(11,"Valores"),e.nrm(12,"br"),e.EFF(13,"Anteriores"),e.k0s()()())}function an(o,s){if(1&o&&(e.j41(0,"tr")(1,"td",21),e.EFF(2),e.k0s(),e.j41(3,"td",22),e.EFF(4),e.k0s(),e.j41(5,"td",22),e.EFF(6),e.k0s()()),2&o){const t=s.$implicit,a=e.XpG(2);e.R7$(2),e.JRh(t[0]),e.R7$(2),e.JRh("EDIT"==a.action||"ADD"==a.action?t[1]:""),e.R7$(2),e.JRh("EDIT"==a.action?t[2]:"ADD"==a.action?"":t[1])}}function nn(o,s){if(1&o&&(e.j41(0,"separator",19)(1,"table")(2,"tbody"),e.DNE(3,an,7,3,"tr",20),e.k0s()()()),2&o){const t=s.row,a=e.XpG();e.Y8G("collapse","collapse")("collapsed",!0),e.R7$(3),e.Y8G("ngForOf",a.preparaDelta(t))}}let on=(()=>{class o extends d.P{constructor(t,a){super(t,Qa.l,Te.m),this.injector=t,this.responsaveis=[],this.planoId="",this.action="",this.filterWhere=n=>{let i=[],l=n.value;return i.push(["table_name","==","planos_entregas"]),i.push(["row_id","==",this.planoId]),l.responsavel_id?.length&&i.push(["user_id","==","null"==l.responsavel_id?null:l.responsavel_id]),l.data_inicio&&i.push(["date_time",">=",l.data_inicio]),l.data_fim&&i.push(["date_time","<=",l.data_fim]),l.tipo?.length&&i.push(["type","==",l.tipo]),i},this.planoEntregaDao=t.get(D.m),this.title="Logs de Planos de Entregas",this.filter=this.fh.FormBuilder({responsavel_id:{default:""},data_inicio:{default:""},data_fim:{default:""},tipo:{default:""}}),this.orderBy=[["id","desc"]]}ngOnInit(){super.ngOnInit(),this.planoId=this.urlParams?.get("id")||"",this.planoEntregaDao.getById(this.planoId).then(t=>this.planoEntrega=t)}ngAfterViewInit(){super.ngAfterViewInit()}filterClear(t){t.controls.responsavel_id.setValue(""),t.controls.data_inicio.setValue(""),t.controls.data_fim.setValue(""),t.controls.tipo.setValue(""),super.filterClear(t)}preparaDelta(t){this.action=t.type;let a=t.delta instanceof Array?t.delta:Object.entries(t.delta);return a.forEach(n=>{n[1]instanceof Date&&(n[1]=new Date(n[1]).toUTCString()),n.length>2&&n[2]instanceof Date&&(n[2]=new Date(n[2]).toUTCString())}),a}static{this.\u0275fac=function(a){return new(a||o)(e.rXU(e.zZn),e.rXU(Te.m))}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["plano-entrega-list-logs"]],viewQuery:function(a,n){if(1&a&&(e.GBs(f._,5),e.GBs(Ja,5)),2&a){let i;e.mGM(i=e.lsd())&&(n.grid=i.first),e.mGM(i=e.lsd())&&(n.selectResponsaveis=i.first)}},features:[e.Vt3],decls:31,vars:30,consts:[["selectResponsaveis",""],["titleResponsavel",""],["columnResponsavel",""],["titleDataCriacao",""],["columnDataCriacao",""],["titleDiferenca",""],["columnDiferenca",""],[3,"dao","hasEdit","title","orderBy","groupBy","join"],[3,"deleted","form","where","submit","clear","collapseChange","collapsed"],[1,"row"],["label","Respons\xe1vel pelo registro","controlName","responsavel_id",3,"control","items"],["datetime","","label","In\xedcio","controlName","data_inicio","labelInfo","In\xedcio dos registros",3,"size","control"],["datetime","","label","Fim","controlName","data_fim","labelInfo","Fim dos registros",3,"size","control"],["label","Tipo","icon","bi bi-arrow-up-right-circle","controlName","tipo","itemTodos","Todos","valueTodos","",3,"size","control","items"],[3,"titleTemplate","template"],["title","Tipo de Opera\xe7\xe3o","field","type"],[3,"rows"],["width","150",1,"col","align-bottom"],["width","250",1,"col"],["title","(ver detalhes)",3,"collapse","collapsed"],[4,"ngFor","ngForOf"],["width","150"],["width","250"]],template:function(a,n){if(1&a&&(e.j41(0,"grid",7)(1,"span")(2,"strong"),e.EFF(3),e.k0s()(),e.nrm(4,"toolbar"),e.j41(5,"filter",8)(6,"div",9),e.nrm(7,"input-select",10,0),e.k0s(),e.j41(9,"div",9),e.nrm(10,"input-datetime",11)(11,"input-datetime",12)(12,"input-select",13),e.k0s()(),e.j41(13,"columns")(14,"column",14),e.DNE(15,Wa,2,0,"ng-template",null,1,e.C5r)(17,Ka,2,1,"ng-template",null,2,e.C5r),e.k0s(),e.j41(19,"column",14),e.DNE(20,Za,2,0,"ng-template",null,3,e.C5r)(22,en,2,1,"ng-template",null,4,e.C5r),e.k0s(),e.j41(24,"column",14),e.DNE(25,tn,14,0,"ng-template",null,5,e.C5r)(27,nn,4,3,"ng-template",null,6,e.C5r),e.k0s(),e.nrm(29,"column",15),e.k0s(),e.nrm(30,"pagination",16),e.k0s()),2&a){const i=e.sdS(16),l=e.sdS(18),u=e.sdS(21),g=e.sdS(23),_=e.sdS(26),E=e.sdS(28);e.Y8G("dao",n.dao)("hasEdit",!1)("title",n.isModal?"":n.title)("orderBy",n.orderBy)("groupBy",n.groupBy)("join",n.join),e.R7$(3),e.JRh((null==n.planoEntrega?null:n.planoEntrega.numero)+" - "+(null==n.planoEntrega?null:n.planoEntrega.nome)),e.R7$(2),e.Y8G("deleted",n.auth.hasPermissionTo("MOD_AUDIT_DEL"))("form",n.filter)("where",n.filterWhere)("submit",n.filterSubmit.bind(n))("clear",n.filterClear.bind(n))("collapseChange",n.filterCollapseChange.bind(n))("collapsed",!n.selectable&&n.filterCollapsed),e.R7$(2),e.Y8G("control",n.filter.controls.responsavel_id)("items",n.responsaveis),e.R7$(3),e.Y8G("size",4)("control",n.filter.controls.data_inicio),e.R7$(),e.Y8G("size",4)("control",n.filter.controls.data_fim),e.R7$(),e.Y8G("size",4)("control",n.filter.controls.tipo)("items",n.lookup.TIPO_LOG_CHANGE),e.R7$(2),e.Y8G("titleTemplate",i)("template",l),e.R7$(5),e.Y8G("titleTemplate",u)("template",g),e.R7$(5),e.Y8G("titleTemplate",_)("template",E),e.R7$(6),e.Y8G("rows",n.rowsLimit)}},dependencies:[A.Sq,f._,v.T,h.I,G.i,U.H,M.e,V.r,X.K,H.F]})}}return o})();function sn(o,s){if(1&o&&(e.j41(0,"h3",18),e.EFF(1),e.k0s()),2&o){const t=e.XpG();e.R7$(),e.JRh(t.title)}}function ln(o,s){if(1&o&&e.nrm(0,"toolbar",19),2&o){const t=e.XpG();e.Y8G("buttons",t.buttons)}}function rn(o,s){if(1&o&&(e.EFF(0),e.nrm(1,"br")(2,"badge",20)(3,"br")(4,"badge",21)),2&o){const t=s.row,a=e.XpG();e.SpI(" ",t.descricao||"(n\xe3o informado)",""),e.R7$(2),e.Y8G("icon",a.entityService.getIcon("Unidade"))("label",t.unidade.sigla||"(n\xe3o informado)"),e.R7$(2),e.Y8G("label",t.destinatario||"(n\xe3o informado)")}}function dn(o,s){if(1&o&&(e.j41(0,"span"),e.EFF(1),e.nrm(2,"br"),e.EFF(3),e.k0s()),2&o){const t=s.row,a=e.XpG();e.R7$(),e.JRh(a.dao.getDateFormatted(t.data_inicio)),e.R7$(2),e.JRh(a.dao.getDateFormatted(t.data_fim))}}function un(o,s){if(1&o&&(e.j41(0,"span",23),e.nrm(1,"i",24),e.EFF(2),e.k0s()),2&o){const t=e.XpG().row;e.R7$(2),e.SpI(" ",t.entrega.nome||t.entrega_pai.descricao," ")}}function cn(o,s){1&o&&e.DNE(0,un,3,1,"span",22),2&o&&e.Y8G("ngIf",s.row.entrega)}function mn(o,s){if(1&o&&e.nrm(0,"badge",25)(1,"br")(2,"badge",25),2&o){const t=s.row,a=e.XpG();e.Y8G("label",a.planoEntregaService.getValorMeta(t)),e.R7$(2),e.Y8G("label",a.planoEntregaService.getValorRealizado(t))}}function gn(o,s){1&o&&e.nrm(0,"progress-bar",26),2&o&&e.Y8G("value",s.row.progresso_realizado)}let pn=(()=>{class o extends d.P{constructor(t){super(t,x.j,S.o),this.injector=t,this.buttons=[],this.idsUnidadesAscendentes=[],this.filterWhere=a=>{let n=a.value,i=[];return this.idsUnidadesAscendentes.length&&i.push(["plano_entrega.unidade_id","in",this.idsUnidadesAscendentes]),n.unidade_id?.length&&i.push(["unidade_id","==",n.unidade_id]),n.descricao?.length&&i.push(["descricao","like","%"+n.descricao.trim().replace(" ","%")+"%"]),n.descricao?.length&&i.push(["descricao_entrega","like","%"+n.descricao_entrega.trim().replace(" ","%")+"%"]),n.destinatario?.length&&i.push(["destinatario","like","%"+n.destinatario.trim().replace(" ","%")+"%"]),i},this.planoEntregaDao=t.get(S.o),this.unidadeDao=t.get(y.s),this.planoEntregaService=t.get(m.C),this.title=this.lex.translate("Entregas"),this.filter=this.fh.FormBuilder({descricao:{default:""},descricao_entrega:{default:""},unidade_id:{default:""},destinatario:{default:""}}),this.join=["entrega:id,nome","entrega_pai:id,descricao","unidade:id,sigla","plano_entrega:id,nome"],this.groupBy=[{field:"plano_entrega.nome",label:"Unidade"}]}ngOnInit(){super.ngOnInit(),this.idsUnidadesAscendentes=this.metadata?.idsUnidadesAscendentes||this.idsUnidadesAscendentes,this.filter?.controls.unidade_id.setValue(this.idsUnidadesAscendentes[0])}dynamicOptions(t){let a=[];return a.push({label:"Informa\xe7\xf5es",icon:"bi bi-info-circle",onClick:n=>this.go.navigate({route:["gestao","planejamento","objetivo",n.id,"consult"]},{modal:!0})}),a}filterClear(t){super.filterClear(t)}static{this.\u0275fac=function(a){return new(a||o)(e.rXU(e.zZn))}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["app-plano-entrega-list-entrega-list"]],viewQuery:function(a,n){if(1&a&&e.GBs(f._,5),2&a){let i;e.mGM(i=e.lsd())&&(n.grid=i.first)}},features:[e.Vt3],decls:26,vars:32,consts:[["columnEntregaCliente",""],["columnDatas",""],["columnIndicador",""],["columnMetaRealizado",""],["columnProgresso",""],["class","my-2",4,"ngIf"],[3,"select","dao","orderBy","groupBy","join","selectable"],[3,"buttons",4,"ngIf"],[3,"deleted","form","where","submit","clear","collapseChange","collapsed"],[1,"row"],["label","Unidade","controlName","unidade_id",3,"size","control","dao"],["label","T\xedtulo da entrega","controlName","descricao","placeholder","T\xedtulo",3,"size","control"],["label","Descri\xe7\xe3o da entrega","controlName","descricao_entrega","placeholder","Descri\xe7\xe3o",3,"size","control"],[3,"title","template"],["title","Entrega",3,"template"],["title","Progresso",3,"template"],["type","options"],[3,"rows"],[1,"my-2"],[3,"buttons"],["color","success",3,"icon","label"],["icon","bi bi-mailbox","color","light",3,"label"],["class","badge bg-light text-dark",4,"ngIf"],[1,"badge","bg-light","text-dark"],[1,"bi","bi-list-check"],["color","light",3,"label"],["color","success",3,"value"]],template:function(a,n){if(1&a){const i=e.RV6();e.DNE(0,sn,2,1,"h3",5),e.j41(1,"grid",6),e.bIt("select",function(u){return e.eBV(i),e.Njj(n.onSelect(u))}),e.DNE(2,ln,1,1,"toolbar",7),e.j41(3,"filter",8)(4,"div",9),e.nrm(5,"input-search",10)(6,"input-text",11)(7,"input-text",12),e.k0s()(),e.j41(8,"columns")(9,"column",13),e.DNE(10,rn,5,4,"ng-template",null,0,e.C5r),e.k0s(),e.j41(12,"column",13),e.DNE(13,dn,4,2,"ng-template",null,1,e.C5r),e.k0s(),e.j41(15,"column",14),e.DNE(16,cn,1,1,"ng-template",null,2,e.C5r),e.k0s(),e.j41(18,"column",13),e.DNE(19,mn,3,2,"ng-template",null,3,e.C5r),e.k0s(),e.j41(21,"column",15),e.DNE(22,gn,1,1,"ng-template",null,4,e.C5r),e.k0s(),e.nrm(24,"column",16),e.k0s(),e.nrm(25,"pagination",17),e.k0s()}if(2&a){const i=e.sdS(11),l=e.sdS(14),u=e.sdS(17),g=e.sdS(20),_=e.sdS(23);e.Y8G("ngIf",!n.isModal),e.R7$(),e.Y8G("dao",n.dao)("orderBy",n.orderBy)("groupBy",n.groupBy)("join",n.join)("selectable",n.selectable),e.R7$(),e.Y8G("ngIf",!n.selectable),e.R7$(),e.Y8G("deleted",n.auth.hasPermissionTo("MOD_AUDIT_DEL"))("form",n.filter)("where",n.filterWhere)("submit",n.filterSubmit.bind(n))("clear",n.filterClear.bind(n))("collapseChange",n.filterCollapseChange.bind(n))("collapsed",!n.selectable&&n.filterCollapsed),e.R7$(2),e.Y8G("size",4)("control",n.filter.controls.unidade_id)("dao",n.unidadeDao),e.R7$(),e.Y8G("size",4)("control",n.filter.controls.descricao),e.BMQ("maxlength",250),e.R7$(),e.Y8G("size",4)("control",n.filter.controls.descricao_entrega),e.BMQ("maxlength",250),e.R7$(2),e.Y8G("title","Entrega\nDemandante\nDestinat\xe1rio")("template",i),e.R7$(3),e.Y8G("title","Data In\xedcio\nData Fim")("template",l),e.R7$(3),e.Y8G("template",u),e.R7$(3),e.Y8G("title","Meta\nRealizado")("template",g),e.R7$(3),e.Y8G("template",_),e.R7$(4),e.Y8G("rows",n.rowsLimit)}},dependencies:[A.bT,f._,v.T,h.I,G.i,U.H,M.e,k.O,q.H,L.n,Q.a]})}}return o})();var _n=r(3764);let Oe=(()=>{class o extends he.F{constructor(t){super("PlanoEntregaEntregaProgresso",t),this.injector=t,this.inputSearchConfig.searchFields=["data_progresso"]}static{this.\u0275fac=function(a){return new(a||o)(e.KVO(e.zZn))}}static{this.\u0275prov=e.jDH({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();class ee extends N.C{constructor(s){super(),this.data_inicio=new Date,this.data_fim=null,this.data_progresso=null,this.homologado=!1,this.meta={},this.realizado={},this.progresso_esperado=100,this.progresso_realizado=0,this.plano_entrega_entrega_id="",this.usuario_id="",this.initialization(s)}}function hn(o,s){1&o&&e.nrm(0,"toolbar")}function fn(o,s){if(1&o&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&o){const t=e.XpG().row,a=e.XpG();e.R7$(),e.SpI(" ",a.dao.getDateFormatted(t.data_progresso),"")}}function En(o,s){1&o&&e.DNE(0,fn,2,1,"span",5),2&o&&e.Y8G("ngIf",s.row.data_progresso)}function bn(o,s){if(1&o&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&o){const t=e.XpG().row,a=e.XpG();e.R7$(),e.SpI(" ",a.dao.getDateFormatted(t.data_inicio),"")}}function vn(o,s){if(1&o&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&o){const t=e.XpG().row,a=e.XpG();e.R7$(),e.SpI(" ",a.dao.getDateFormatted(t.data_fim),"")}}function Tn(o,s){if(1&o&&(e.DNE(0,bn,2,1,"span",5),e.nrm(1,"br"),e.DNE(2,vn,2,1,"span",5)),2&o){const t=s.row;e.Y8G("ngIf",t.data_inicio),e.R7$(2),e.Y8G("ngIf",t.data_fim)}}function On(o,s){if(1&o&&e.nrm(0,"badge",15)(1,"br")(2,"badge",16),2&o){const t=s.row,a=e.XpG();e.Y8G("textValue",a.planoEntregaService.getValorMeta(t.plano_entrega_entrega)),e.R7$(2),e.Y8G("textValue",a.planoEntregaService.getValorRealizado(t.plano_entrega_entrega))}}function An(o,s){if(1&o&&e.nrm(0,"progress-bar",17),2&o){const t=s.row;e.Y8G("value",t.progresso_realizado)("goal",t.progresso_esperado)}}let Cn=(()=>{class o extends d.P{constructor(t){super(t,ee,Oe),this.injector=t,this.planoEntregaEntregaId="",this.filterWhere=a=>{let n=[],i=a.value;return i.data_inicial_progresso&&n.push(["data_progresso",">=",i.data_inicial_progresso]),i.data_final_progresso&&n.push(["data_progresso","<=",i.data_final_progresso]),n.push(["plano_entrega_entrega_id","==",this.planoEntregaEntregaId]),n},this.planoEntregaService=t.get(m.C),this.title=this.lex.translate("Hist\xf3rico de execu\xe7\xe3o"),this.orderBy=[["data_progresso","desc"]],this.join=["plano_entrega_entrega.entrega"],this.filter=this.fh.FormBuilder({data_inicial_progresso:{default:null},data_final_progresso:{default:null}}),this.addOption(Object.assign({onClick:this.delete.bind(this)},this.OPTION_EXCLUIR),"MOD_PENT_ENTR_PRO_EXCL")}onGridLoad(t){t?.forEach(a=>a.entrega=a.plano_entrega_entrega?.entrega)}ngOnInit(){super.ngOnInit(),this.planoEntregaEntregaId=this.urlParams.get("entrega_id")||""}static{this.\u0275fac=function(a){return new(a||o)(e.rXU(e.zZn))}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["app-plano-entrega-list-progresso"]],viewQuery:function(a,n){if(1&a&&e.GBs(f._,5),2&a){let i;e.mGM(i=e.lsd())&&(n.grid=i.first)}},features:[e.Vt3],decls:21,vars:38,consts:[["columnProgressoData",""],["columnDatas",""],["columnMetaRealizado",""],["columnProgresso",""],[3,"select","dao","add","title","orderBy","groupBy","join","selectable","hasAdd","hasEdit","loadList"],[4,"ngIf"],[3,"deleted","form","where","submit","collapseChange","collapsed"],[1,"row"],["noIcon","","label","Data inicial do progresso","controlName","data_inicial_progresso","labelInfo","Data que foi registrado o progresso",3,"size","control"],["noIcon","","label","Data final do progresso","controlName","data_final_progresso","labelInfo","Data que foi registrado o progresso",3,"size","control"],[3,"title","template","editTemplate"],[3,"title","width","template"],[3,"title","width","template","editTemplate","columnEditTemplate"],["type","options",3,"onEdit","options"],[3,"rows"],["icon","bi bi-graph-up-arrow","color","light","hint","Planejada",3,"textValue"],["icon","bi bi-check-lg","color","light","hint","Realizada",3,"textValue"],["color","success",3,"value","goal"]],template:function(a,n){if(1&a){const i=e.RV6();e.j41(0,"grid",4),e.bIt("select",function(u){return e.eBV(i),e.Njj(n.onSelect(u))}),e.DNE(1,hn,1,0,"toolbar",5),e.j41(2,"filter",6)(3,"div",7),e.nrm(4,"input-datetime",8)(5,"input-datetime",9),e.k0s()(),e.j41(6,"columns")(7,"column",10),e.DNE(8,En,1,1,"ng-template",null,0,e.C5r),e.k0s(),e.j41(10,"column",10),e.DNE(11,Tn,3,2,"ng-template",null,1,e.C5r),e.k0s(),e.j41(13,"column",11),e.DNE(14,On,3,2,"ng-template",null,2,e.C5r),e.k0s(),e.j41(16,"column",12),e.DNE(17,An,1,2,"ng-template",null,3,e.C5r),e.k0s(),e.nrm(19,"column",13),e.k0s(),e.nrm(20,"pagination",14),e.k0s()}if(2&a){const i=e.sdS(9),l=e.sdS(12),u=e.sdS(15),g=e.sdS(18);e.Y8G("dao",n.dao)("add",n.add)("title",n.isModal?"":n.title)("orderBy",n.orderBy)("groupBy",n.groupBy)("join",n.join)("selectable",n.selectable)("hasAdd",n.auth.hasPermissionTo("MOD_PENT_ENTR_PRO_INCL"))("hasEdit",n.auth.hasPermissionTo("MOD_PENT_ENTR_PRO_EDT"))("loadList",n.onGridLoad.bind(n)),e.R7$(),e.Y8G("ngIf",!n.selectable),e.R7$(),e.Y8G("deleted",n.auth.hasPermissionTo("MOD_AUDIT_DEL"))("form",n.filter)("where",n.filterWhere)("submit",n.filterSubmit.bind(n))("collapseChange",n.filterCollapseChange.bind(n))("collapsed",!n.selectable&&n.filterCollapsed),e.R7$(2),e.Y8G("size",3)("control",n.filter.controls.data_inicial_progresso),e.R7$(),e.Y8G("size",3)("control",n.filter.controls.data_final_progresso),e.R7$(2),e.Y8G("title","Data progresso")("template",i)("editTemplate",i),e.R7$(3),e.Y8G("title","Data In\xedcio\nData Fim")("template",l)("editTemplate",l),e.R7$(3),e.Y8G("title","Meta")("width",100)("template",u),e.R7$(3),e.Y8G("title","Progresso")("width",200)("template",g)("editTemplate",g)("columnEditTemplate",n.selectable?void 0:g),e.R7$(3),e.Y8G("onEdit",n.edit)("options",n.options),e.R7$(),e.Y8G("rows",n.rowsLimit)}},dependencies:[A.bT,f._,v.T,h.I,G.i,U.H,M.e,V.r,L.n,Q.a]})}}return o})(),Ae=(()=>{class o extends K.n{constructor(t){super(t,ee,Oe),this.injector=t,this.validate=(a,n)=>{let i=null;return["progresso_realizado","realizado"].indexOf(n)>=0&&!(a.value>=0||a.value?.length>0)||["progresso_esperado","meta"].indexOf(n)>=0&&!(a.value>0||a.value?.length>0)?i="Obrigat\xf3rio":(["data_inicio"].indexOf(n)>=0&&!this.dao?.validDateTime(a.value)||["data_fim"].indexOf(n)>=0&&!this.dao?.validDateTime(a.value))&&(i="Inv\xe1lido"),i},this.titleEdit=a=>"Editando "+this.lex.translate("Progresso da entrega")+": "+(a?.entrega?.descricao||""),this.planoEntregaService=t.get(m.C),this.planoEntregaEntregaDao=t.get(S.o),this.join=["plano_entrega_entrega.entrega"],this.form=this.fh.FormBuilder({data_progresso:{default:new Date},data_inicio:{default:new Date},data_fim:{default:new Date},meta:{default:100},realizado:{default:null},progresso_esperado:{default:100},progresso_realizado:{default:null},usuario_id:{default:null},plano_entrega_entrega_id:{default:null}},this.cdRef,this.validate)}ngOnInit(){super.ngOnInit(),this.planoEntregaEntregaId=this.urlParams.get("entrega_id")}loadData(t,a){var n=this;return(0,c.A)(function*(){let i=Object.assign({},a.value),{meta:l,realizado:u,...g}=t;a.patchValue(n.util.fillForm(i,g)),a.controls.meta.setValue(n.planoEntregaService.getValor(t.meta)),a.controls.realizado.setValue(n.planoEntregaService.getValor(t.realizado))})()}initializeData(t){var a=this;return(0,c.A)(function*(){a.entity=new ee,a.planoEntregaEntrega=a.planoEntregaEntregaId?yield a.planoEntregaEntregaDao.getById(a.planoEntregaEntregaId,["entrega"]):void 0,a.entity.usuario_id=a.auth.usuario.id,a.entity.plano_entrega_entrega_id=a.planoEntregaEntrega?.id,a.entity.plano_entrega_entrega=a.planoEntregaEntrega,a.entity.meta=a.planoEntregaEntrega?.meta,a.entity.realizado=a.planoEntregaEntrega?.realizado,a.entity.progresso_esperado=a.planoEntregaEntrega?.progresso_esperado,a.entity.progresso_realizado=a.planoEntregaEntrega?.progresso_realizado,a.entity.data_inicio=a.planoEntregaEntrega?.data_inicio,a.entity.data_fim=a.planoEntregaEntrega?.data_fim,yield a.loadData(a.entity,t)})()}saveData(t){return new Promise((a,n)=>{let i=this.util.fill(new ee,this.entity),{meta:l,realizado:u,...g}=this.form.value;i=this.util.fillForm(i,g),i.meta=this.planoEntregaService.getEntregaValor(this.entity.plano_entrega_entrega?.entrega,l),i.realizado=this.planoEntregaService.getEntregaValor(this.entity.plano_entrega_entrega?.entrega,u),a(i)})}static{this.\u0275fac=function(a){return new(a||o)(e.rXU(e.zZn))}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["plano-entrega-form-progresso"]],viewQuery:function(a,n){if(1&a&&e.GBs(j.Q,5),2&a){let i;e.mGM(i=e.lsd())&&(n.editableForm=i.first)}},features:[e.Vt3],decls:11,vars:16,consts:[["initialFocus","data_progresso",3,"submit","cancel","form","disabled","title"],[1,"row"],["date","","label","Data do progresso","controlName","data_progresso","required","",3,"size"],["date","","label","In\xedcio","controlName","data_inicio","required","",3,"size","labelInfo"],["date","","label","Fim","controlName","data_fim","required","",3,"size","labelInfo"],["icon","bi bi-graph-up-arrow","label","Meta",3,"entrega","size","control"],["icon","bi bi-check-lg","label","Valor Inicial","labelInfo","Valor da meta verificado no in\xedcio do plano de entrega",3,"entrega","size","control"],["label","Progresso Esperado","controlName","progresso_esperado","sufix","%",3,"size"],["label","Progresso Realizado","controlName","progresso_realizado","sufix","%",3,"size"]],template:function(a,n){1&a&&(e.j41(0,"editable-form",0),e.bIt("submit",function(){return n.onSaveData()})("cancel",function(){return n.onCancel()}),e.j41(1,"div",1),e.nrm(2,"input-datetime",2)(3,"input-datetime",3)(4,"input-datetime",4),e.k0s(),e.j41(5,"div",1),e.nrm(6,"plano-entrega-valor-meta-input",5)(7,"plano-entrega-valor-meta-input",6),e.k0s(),e.j41(8,"div",1),e.nrm(9,"input-number",7)(10,"input-number",8),e.k0s()()),2&a&&(e.Y8G("form",n.form)("disabled",n.formDisabled)("title",n.isModal?"":n.title),e.R7$(2),e.Y8G("size",4),e.R7$(),e.Y8G("size",4)("labelInfo","In\xedcio "+n.lex.translate("Plano de Entregas")),e.R7$(),e.Y8G("size",4)("labelInfo","Fim "+n.lex.translate("Plano de Entregas")+"(Estimativa Inicial)"),e.R7$(2),e.Y8G("entrega",null==n.entity||null==n.entity.plano_entrega_entrega?null:n.entity.plano_entrega_entrega.entrega)("size",6)("control",n.form.controls.meta),e.R7$(),e.Y8G("entrega",null==n.entity||null==n.entity.plano_entrega_entrega?null:n.entity.plano_entrega_entrega.entrega)("size",6)("control",n.form.controls.realizado),e.R7$(2),e.Y8G("size",6),e.R7$(),e.Y8G("size",6))},dependencies:[j.Q,V.r,W.n,te]})}}return o})();var Pn=r(6867),In=r(6190),Dn=r(4450),Rn=r(336);const Gn=["listaAtividades"];function jn(o,s){1&o&&(e.j41(0,"b"),e.EFF(1,"Descri\xe7\xe3o"),e.k0s())}function yn(o,s){if(1&o&&(e.j41(0,"span",8),e.EFF(1),e.k0s(),e.nrm(2,"reaction",9)),2&o){const t=s.row;e.R7$(),e.JRh(t.descricao),e.R7$(),e.Y8G("entity",t)}}function Nn(o,s){if(1&o&&(e.EFF(0," Un./"),e.j41(1,"order",10),e.EFF(2,"Respons\xe1vel"),e.k0s(),e.nrm(3,"br"),e.j41(4,"order",11),e.EFF(5,"Demandante"),e.k0s()),2&o){const t=s.header;e.R7$(),e.Y8G("header",t),e.R7$(3),e.Y8G("header",t)}}function Ln(o,s){if(1&o&&(e.j41(0,"div",12),e.nrm(1,"badge",13)(2,"badge",14),e.k0s(),e.nrm(3,"badge",15)),2&o){const t=s.row,a=e.XpG();e.R7$(),e.Y8G("label",t.unidade.sigla),e.R7$(),e.Y8G("icon","bi "+(null!=t.usuario&&null!=t.usuario.nome&&t.usuario.nome.length?"bi-person-check":"bi-person-x"))("label",a.util.apelidoOuNome(t.usuario,!0)||"(N\xe3o atribu\xeddo)")("hint","Respons\xe1vel: "+((null==t.usuario?null:t.usuario.nome)||"N\xe3o atribuido a nenhum usu\xe1rio")),e.R7$(),e.Y8G("label",a.util.apelidoOuNome(t.demandante,!0)||"Desconhecido")("hint","Demandante: "+((null==t.demandante?null:t.demandante.nome)||"Desconhecido"))}}function Sn(o,s){1&o&&e.nrm(0,"progress-bar",16),2&o&&e.Y8G("value",s.row.progresso)}let kn=(()=>{class o extends B.g{set entregaId(t){this._entregaId!=t&&(this._entregaId=t)}get entregaId(){return this._entregaId}constructor(t){super(t),this.injector=t,this.items=[],this.loader=!1,this.AtividadeDao=t.get(Rn.R),this.join=["unidade","usuario","demandante","reacoes.usuario:id,nome,apelido"]}ngOnInit(){super.ngOnInit(),this.loadData()}loadData(){this.loader=!0,this.AtividadeDao.query({where:[["plano_trabalho_entrega_id","==",this._entregaId],["unidades_subordinadas","==",!0]],join:this.join}).asPromise().then(t=>{this.items=t}).finally(()=>{this.loader=!1})}static{this.\u0275fac=function(a){return new(a||o)(e.rXU(e.zZn))}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["plano-trabalho-entrega-atividades"]],viewQuery:function(a,n){if(1&a&&e.GBs(Gn,5),2&a){let i;e.mGM(i=e.lsd())&&(n.listaAtividades=i.first)}},inputs:{entregaId:"entregaId"},features:[e.Vt3],decls:17,vars:10,consts:[["titleIdAtividadeDescricao",""],["columnAtividadeDescricao",""],["titleUnResponsavelDemandante",""],["columnPessoas",""],["columnProgressoEtiquetasChecklist",""],[3,"items","loading"],[3,"titleTemplate","template"],[3,"title","width","template"],[1,"micro-text","fw-ligh","atividade-descricao"],["origem","ATIVIDADE",3,"entity"],["by","usuario.nome",3,"header"],["by","demandante.nome",3,"header"],[1,"text-nowrap"],["icon","bi bi-briefcase","color","light",3,"label"],["color","light",3,"icon","label","hint"],["icon","bi bi-cursor","color","light",3,"label","hint"],["color","success",3,"value"]],template:function(a,n){if(1&a&&(e.j41(0,"h5"),e.EFF(1),e.k0s(),e.j41(2,"grid",5)(3,"columns")(4,"column",6),e.DNE(5,jn,2,0,"ng-template",null,0,e.C5r)(7,yn,3,2,"ng-template",null,1,e.C5r),e.k0s(),e.j41(9,"column",6),e.DNE(10,Nn,6,2,"ng-template",null,2,e.C5r)(12,Ln,4,6,"ng-template",null,3,e.C5r),e.k0s(),e.j41(14,"column",7),e.DNE(15,Sn,1,1,"ng-template",null,4,e.C5r),e.k0s()()()),2&a){const i=e.sdS(6),l=e.sdS(8),u=e.sdS(11),g=e.sdS(13),_=e.sdS(16);e.R7$(),e.SpI("",n.lex.translate("Atividades"),":"),e.R7$(),e.Y8G("items",n.items)("loading",n.loader),e.R7$(2),e.Y8G("titleTemplate",i)("template",l),e.R7$(5),e.Y8G("titleTemplate",u)("template",g),e.R7$(5),e.Y8G("title","Progresso")("width",200)("template",_)}},dependencies:[f._,v.T,h.I,J.Y,L.n,Q.a,le.T]})}}return o})();const Vn=["accordionUser"];function Fn(o,s){}function Yn(o,s){1&o&&e.nrm(0,"plano-trabalho-entrega-atividades",29),2&o&&e.Y8G("entregaId",s.row.id)}function zn(o,s){1&o&&(e.j41(0,"div",30)(1,"span")(2,"strong"),e.EFF(3,"Plano de trabalho"),e.k0s()()())}function $n(o,s){if(1&o&&(e.j41(0,"span",31),e.EFF(1),e.nrm(2,"br"),e.EFF(3),e.k0s()),2&o){const t=e.XpG().$implicit,a=e.XpG(2);e.R7$(),e.SpI("",a.PlanoTrabalhoDao.getDateFormatted(t.data_inicio)," "),e.R7$(2),e.JRh(" at\xe9 "+a.PlanoTrabalhoDao.getDateFormatted(t.data_fim))}}function wn(o,s){1&o&&(e.j41(0,"div",30)(1,"span")(2,"strong"),e.EFF(3,"Origem"),e.k0s()()())}function Bn(o,s){if(1&o&&e.nrm(0,"badge",37),2&o){const t=e.XpG().row,a=e.XpG(3);e.Y8G("label",(null==t.plano_entrega_entrega||null==t.plano_entrega_entrega.plano_entrega||null==t.plano_entrega_entrega.plano_entrega.unidade?null:t.plano_entrega_entrega.plano_entrega.unidade.sigla)||"Desconhecido")("icon",a.entityService.getIcon("Unidade"))}}function Un(o,s){if(1&o&&e.nrm(0,"badge",38),2&o){const t=e.XpG().row;e.Y8G("label",t.orgao)}}function Mn(o,s){if(1&o&&(e.j41(0,"div",32)(1,"div",33),e.nrm(2,"badge",34),e.DNE(3,Bn,1,2,"badge",35)(4,Un,1,1,"badge",36),e.k0s()()),2&o){const t=s.row,a=e.XpG(3);e.R7$(2),e.Y8G("label",a.planoTrabalhoService.tipoEntrega(t,a.entity).titulo)("color",a.planoTrabalhoService.tipoEntrega(t,a.entity).cor),e.R7$(),e.Y8G("ngIf",null==t.plano_entrega_entrega_id?null:t.plano_entrega_entrega_id.length),e.R7$(),e.Y8G("ngIf",null==t.orgao?null:t.orgao.length)}}function qn(o,s){if(1&o&&(e.j41(0,"div",30)(1,"small"),e.nrm(2,"badge",39),e.k0s()()),2&o){const t=e.XpG().$implicit,a=e.XpG(2);e.R7$(2),e.Y8G("color",100==a.totalForcaTrabalho(t.entregas)?"success":"warning")("label",a.totalForcaTrabalho(t.entregas)+"%")}}function Xn(o,s){if(1&o&&(e.j41(0,"small"),e.EFF(1),e.k0s()),2&o){const t=s.row;e.R7$(),e.JRh(t.forca_trabalho+"%")}}function xn(o,s){1&o&&(e.j41(0,"div",30)(1,"span")(2,"strong"),e.EFF(3,"Detalhamento/Descri\xe7\xe3o dos Trabalhos"),e.k0s()()())}function Hn(o,s){if(1&o&&(e.j41(0,"small",30),e.EFF(1),e.k0s()),2&o){const t=s.row;e.R7$(),e.JRh(t.descricao)}}function Qn(o,s){if(1&o&&e.nrm(0,"badge",40),2&o){const t=e.XpG().$implicit,a=e.XpG(2);e.Y8G("color",a.lookup.getColor(a.lookup.PLANO_TRABALHO_STATUS,t.status))("icon",a.lookup.getIcon(a.lookup.PLANO_TRABALHO_STATUS,t.status))("label",a.lookup.getValue(a.lookup.PLANO_TRABALHO_STATUS,t.status))}}function Jn(o,s){if(1&o&&(e.j41(0,"div",20)(1,"div",21)(2,"grid",22)(3,"columns")(4,"column",23),e.DNE(5,Yn,1,1,"ng-template",null,7,e.C5r),e.k0s(),e.j41(7,"column",24),e.DNE(8,zn,4,0,"ng-template",null,8,e.C5r)(10,$n,4,2,"ng-template",null,9,e.C5r),e.k0s(),e.j41(12,"column",25),e.DNE(13,wn,4,0,"ng-template",null,10,e.C5r)(15,Mn,5,4,"ng-template",null,11,e.C5r),e.k0s(),e.j41(17,"column",26),e.DNE(18,qn,3,2,"ng-template",null,5,e.C5r)(20,Xn,2,1,"ng-template",null,6,e.C5r),e.k0s(),e.j41(22,"column",27),e.DNE(23,xn,4,0,"ng-template",null,12,e.C5r)(25,Hn,2,1,"ng-template",null,13,e.C5r),e.k0s(),e.j41(27,"column",28),e.DNE(28,Qn,1,3,"ng-template",null,14,e.C5r),e.k0s()()()()()),2&o){const t=s.$implicit,a=e.sdS(6),n=e.sdS(9),i=e.sdS(11),l=e.sdS(14),u=e.sdS(16),g=e.sdS(19),_=e.sdS(21),E=e.sdS(24),z=e.sdS(26),F=e.sdS(29);e.R7$(2),e.Y8G("items",t.entregas),e.R7$(2),e.Aen("vertical-align:middle"),e.Y8G("expandTemplate",a),e.R7$(3),e.Y8G("template",i)("titleTemplate",n),e.R7$(5),e.Y8G("titleTemplate",l)("template",u)("verticalAlign","middle")("width",300)("align","center"),e.R7$(5),e.Y8G("titleTemplate",g)("title","% CHD")("template",_)("width",125)("align","center")("titleHint","% Carga Hor\xe1ria Dispon\xedvel"),e.R7$(5),e.Y8G("maxWidth",250)("titleTemplate",E)("template",z)("verticalAlign","middle")("align","center"),e.R7$(5),e.Y8G("template",F)}}function Wn(o,s){if(1&o&&(e.j41(0,"h5"),e.EFF(1,"Entregas do plano:"),e.k0s(),e.nrm(2,"hr"),e.DNE(3,Jn,30,23,"div",19)),2&o){const t=s.row;e.R7$(3),e.Y8G("ngForOf",t.planos_trabalho)}}function Kn(o,s){1&o&&(e.j41(0,"b"),e.EFF(1,"Participante"),e.k0s())}function Zn(o,s){if(1&o&&(e.j41(0,"b"),e.EFF(1),e.k0s(),e.nrm(2,"br"),e.j41(3,"small"),e.EFF(4),e.k0s()),2&o){const t=s.row;e.R7$(),e.JRh(t.nome),e.R7$(3),e.JRh(t.apelido||"")}}function eo(o,s){}function to(o,s){if(1&o&&(e.j41(0,"small"),e.nrm(1,"badge",39),e.k0s()),2&o){const t=s.row,a=e.XpG();e.R7$(),e.Y8G("color",100==a.totalForcaTrabalho(a.planoAtivo(t.planos_trabalho).entregas)?"success":"warning")("label",a.totalForcaTrabalho(a.planoAtivo(t.planos_trabalho).entregas)+"%")}}let ao=(()=>{class o extends B.g{set entregaId(t){this._entregaId!=t&&(this._entregaId=t)}get entregaId(){return this._entregaId}constructor(t){super(t),this.injector=t,this.items=[],this.loader=!1,this.PlanoTrabalhoDao=t.get(Pn.x),this.PlanoTrabalhoEntregaDao=t.get(In.R),this.planoTrabalhoService=t.get(Dn.V),this.join=["plano_trabalho.usuario","plano_entrega_entrega.plano_entrega.unidade"],this.groupBy=[{field:"plano_trabalho.usuario",label:"Usu\xe1rio"}]}ngOnInit(){super.ngOnInit(),this.loadData()}loadData(){this.loader=!0,this.cdRef.detectChanges();try{this.PlanoTrabalhoEntregaDao.query({where:[["plano_entrega_entrega_id","==",this._entregaId],["planoTrabalho.status","in",["ATIVO","CONCLUIDO","AVALIADO"]]],join:this.join}).asPromise().then(t=>{t.forEach(a=>{const n=a.plano_trabalho.usuario;if(n){const i=n.id;let l=this.items.find(E=>E.id===i);l||(l={...n,planos_trabalho:[],initialization(E){}},this.items.push(l));const u=a.plano_trabalho.id;let g=l.planos_trabalho.find(E=>E.id===u);g||(g={...a.plano_trabalho,entregas:[],initialization(E){}},l.planos_trabalho.push(g));const _={...a,initialization(E){}};g.entregas.push(_)}})}).finally(()=>{this.loader=!1,this.cdRef.detectChanges()})}catch{console.log("Erro")}}totalForcaTrabalho(t=[]){const a=t.map(n=>1*n.forca_trabalho).reduce((n,i)=>n+i,0);return Math.round(100*a)/100}planoAtivo(t){return t.find(n=>"ATIVO"===n.status)||{}}static{this.\u0275fac=function(a){return new(a||o)(e.rXU(e.zZn))}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["plano-entrega-entregas-plano-trabalho"]],viewQuery:function(a,n){if(1&a&&e.GBs(Vn,5),2&a){let i;e.mGM(i=e.lsd())&&(n.accordionUser=i.first)}},inputs:{entregaId:"entregaId"},features:[e.Vt3],decls:18,vars:11,consts:[["accordionUser",""],["usuarioSectionTitle",""],["columnExpandeEntregas",""],["titleParticipante",""],["columnParticipante",""],["titleForcaTrabalho",""],["columnForcaTrabalho",""],["columnExpandedAtividades",""],["titlePlano",""],["columnPlano",""],["titleOrigem",""],["columnOrigem",""],["titleDescricao",""],["columnDescricao",""],["columnStatus",""],[3,"items","loading"],["type","expand",3,"expandTemplate","template","width"],[3,"titleTemplate","template"],[3,"titleTemplate","template","title","titleHint"],["class","card mb-2",4,"ngFor","ngForOf"],[1,"card","mb-2"],[1,"card-body"],[3,"items"],["type","expand",3,"expandTemplate"],[3,"template","titleTemplate"],[3,"titleTemplate","template","verticalAlign","width","align"],[3,"titleTemplate","title","template","width","align","titleHint"],[3,"maxWidth","titleTemplate","template","verticalAlign","align"],["title","Status",3,"template"],[3,"entregaId"],[1,"text-center"],[1,"d-block","text-center"],[1,"w-100","d-flex","justify-content-center"],[1,"one-per-line"],[3,"label","color"],["color","primary",3,"label","icon",4,"ngIf"],["icon","bi bi-box-arrow-down-left","color","warning",3,"label",4,"ngIf"],["color","primary",3,"label","icon"],["icon","bi bi-box-arrow-down-left","color","warning",3,"label"],["icon","bi bi-calculator",3,"color","label"],[3,"color","icon","label"]],template:function(a,n){if(1&a&&(e.j41(0,"grid",15,0)(2,"columns")(3,"column",16),e.DNE(4,Fn,0,0,"ng-template",null,1,e.C5r)(6,Wn,4,1,"ng-template",null,2,e.C5r),e.k0s(),e.j41(8,"column",17),e.DNE(9,Kn,2,0,"ng-template",null,3,e.C5r)(11,Zn,5,2,"ng-template",null,4,e.C5r),e.k0s(),e.j41(13,"column",18),e.DNE(14,eo,0,0,"ng-template",null,5,e.C5r)(16,to,2,2,"ng-template",null,6,e.C5r),e.k0s()()()),2&a){const i=e.sdS(5),l=e.sdS(7),u=e.sdS(10),g=e.sdS(12),_=e.sdS(15),E=e.sdS(17);e.Y8G("items",n.items)("loading",n.loader),e.R7$(3),e.Y8G("expandTemplate",l)("template",i)("width",40),e.R7$(5),e.Y8G("titleTemplate",u)("template",g),e.R7$(5),e.Y8G("titleTemplate",_)("template",E)("title","% CHD")("titleHint","% Carga Hor\xe1ria Dispon\xedvel")}},dependencies:[A.Sq,A.bT,f._,v.T,h.I,L.n,kn]})}}return o})();var Ce=r(4401),no=r(7438);function oo(o,s){if(1&o&&e.nrm(0,"badge",8),2&o){const t=e.XpG().$implicit,a=e.XpG(2);e.Y8G("icon",a.entityService.getIcon("Unidade"))("label",null==t.data||null==t.data.unidade?null:t.data.unidade.sigla)}}function io(o,s){if(1&o){const t=e.RV6();e.j41(0,"div",4),e.EFF(1),e.k0s(),e.DNE(2,oo,1,2,"badge",5),e.nrm(3,"br"),e.j41(4,"button",6),e.bIt("click",function(){const n=e.eBV(t).$implicit,i=e.XpG(2);return e.Njj(i.showDetalhes(n.data))}),e.nrm(5,"i",7),e.k0s()}if(2&o){const t=s.$implicit;e.R7$(),e.JRh(t.label),e.R7$(),e.Y8G("ngIf",null==t.data?null:t.data.unidade)}}function so(o,s){if(1&o&&(e.j41(0,"p-organizationChart",2),e.DNE(1,io,6,2,"ng-template",3),e.k0s()),2&o){const t=e.XpG();e.Y8G("value",t.entregasVinculadas)}}function lo(o,s){1&o&&(e.j41(0,"div",9)(1,"div",10),e.nrm(2,"span",11),e.k0s()())}let ro=(()=>{class o extends B.g{set entregaId(t){this._entregaId!=t&&(this._entregaId=t)}get entregaId(){return this._entregaId}constructor(t){super(t),this.injector=t,this.loader=!1,this.entregasVinculadas=[],this.planoEntregaEntregaDao=t.get(S.o),this.join=["unidade"]}ngOnInit(){super.ngOnInit(),this.loadData()}loadData(){var t=this;return(0,c.A)(function*(){t.loader=!0;try{t.entregasVinculadas=yield t.planoEntregaEntregaDao.hierarquia(t._entregaId),t.cdRef.detectChanges(),t.loader=!1}catch{console.log("Erro")}})()}showDetalhes(t){var a=this;return(0,c.A)(function*(){a.go.navigate({route:["gestao","plano-entrega","entrega",t.id,"detalhes"]},{metadata:{entrega:t}})})()}static{this.\u0275fac=function(a){return new(a||o)(e.rXU(e.zZn))}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["plano-entrega-entregas-vinculadas"]],inputs:{entregaId:"entregaId"},features:[e.Vt3],decls:2,vars:2,consts:[[3,"value",4,"ngIf"],["class","d-flex justify-content-center my-2",4,"ngIf"],[3,"value"],["pTemplate","default"],[1,"p-2"],["color","light",3,"icon","label",4,"ngIf"],["title","Detalhes da entrega",1,"btn","btn-sm",3,"click"],[1,"bi","bi-eye"],["color","light",3,"icon","label"],[1,"d-flex","justify-content-center","my-2"],["role","status",1,"spinner-border"],[1,"visually-hidden"]],template:function(a,n){1&a&&e.DNE(0,so,2,1,"p-organizationChart",0)(1,lo,3,0,"div",1),2&a&&(e.Y8G("ngIf",n.entregasVinculadas.length),e.R7$(),e.Y8G("ngIf",n.loader))},dependencies:[A.bT,L.n,Ce.a3,no.Ei]})}}return o})();function uo(o,s){1&o&&e.nrm(0,"badge",19),2&o&&e.Y8G("lookup",s.$implicit)}function co(o,s){if(1&o&&e.nrm(0,"badge",20),2&o){const t=e.XpG(2);e.Y8G("icon",t.entityService.getIcon("Unidade"))("label",null==t.entrega||null==t.entrega.unidade?null:t.entrega.unidade.sigla)}}function mo(o,s){if(1&o&&e.nrm(0,"badge",21),2&o){const t=e.XpG(2);e.Y8G("label",null==t.entrega?null:t.entrega.destinatario)}}function go(o,s){if(1&o&&(e.j41(0,"div",22)(1,"div")(2,"b"),e.EFF(3,"Planejada"),e.k0s(),e.nrm(4,"br")(5,"badge",23),e.k0s(),e.nrm(6,"div",24),e.j41(7,"div")(8,"b"),e.EFF(9,"Executada"),e.k0s(),e.nrm(10,"br")(11,"badge",25),e.k0s()()),2&o){const t=e.XpG(2);e.R7$(5),e.Y8G("textValue",t.planoEntregaService.getValorMeta(t.entrega)),e.R7$(6),e.Y8G("textValue",t.planoEntregaService.getValorRealizado(t.entrega))}}function po(o,s){if(1&o){const t=e.RV6();e.j41(0,"div",33)(1,"small"),e.EFF(2),e.k0s(),e.j41(3,"button",34),e.bIt("click",function(){e.eBV(t);const n=e.XpG().$implicit,i=e.XpG(3);return e.Njj(i.showPlanejamento(n.objetivo.id))}),e.nrm(4,"i",35),e.k0s()()}if(2&o){const t=e.XpG().$implicit;e.R7$(2),e.JRh(t.objetivo.nome)}}function _o(o,s){if(1&o&&(e.j41(0,"li",31),e.DNE(1,po,5,1,"div",32),e.k0s()),2&o){const t=s.$implicit;e.R7$(),e.Y8G("ngIf",t.objetivo)}}function ho(o,s){if(1&o&&(e.j41(0,"div",26)(1,"h5",27),e.EFF(2),e.k0s(),e.j41(3,"div",28)(4,"ul",29),e.DNE(5,_o,2,1,"li",30),e.k0s()()()),2&o){const t=e.XpG(2);e.R7$(2),e.JRh(t.lex.translate("Objetivos")),e.R7$(3),e.Y8G("ngForOf",null==t.entrega?null:t.entrega.objetivos)}}function fo(o,s){if(1&o){const t=e.RV6();e.j41(0,"div",33)(1,"small"),e.EFF(2),e.k0s(),e.j41(3,"button",34),e.bIt("click",function(){e.eBV(t);const n=e.XpG().$implicit,i=e.XpG(3);return e.Njj(i.showCadeiaValor(n.processo.id))}),e.nrm(4,"i",35),e.k0s()()}if(2&o){const t=e.XpG().$implicit;e.R7$(2),e.JRh(t.processo.nome)}}function Eo(o,s){if(1&o&&(e.j41(0,"li",31),e.DNE(1,fo,5,1,"div",32),e.k0s()),2&o){const t=s.$implicit;e.R7$(),e.Y8G("ngIf",t.processo)}}function bo(o,s){if(1&o&&(e.j41(0,"div",26)(1,"h5",27),e.EFF(2),e.k0s(),e.j41(3,"div",28)(4,"ul",29),e.DNE(5,Eo,2,1,"li",30),e.k0s()()()),2&o){const t=e.XpG(2);e.R7$(2),e.JRh(t.lex.translate("Processos")),e.R7$(3),e.Y8G("ngForOf",null==t.entrega?null:t.entrega.processos)}}function vo(o,s){if(1&o&&(e.j41(0,"li",31)(1,"div",33)(2,"small"),e.EFF(3),e.k0s()()()),2&o){const t=s.$implicit;e.R7$(3),e.JRh(null==t.produto?null:t.produto.nome)}}function To(o,s){if(1&o&&(e.j41(0,"div",26)(1,"h5",27),e.EFF(2),e.k0s(),e.j41(3,"div",28)(4,"ul",29),e.DNE(5,vo,4,1,"li",30),e.k0s()()()),2&o){const t=e.XpG(2);e.R7$(2),e.JRh(t.lex.translate("Produtos e Servi\xe7os")),e.R7$(3),e.Y8G("ngForOf",null==t.entrega?null:t.entrega.produtos)}}function Oo(o,s){if(1&o&&(e.j41(0,"div",8)(1,"div",9),e.DNE(2,uo,1,1,"badge",10),e.k0s(),e.j41(3,"h5"),e.EFF(4),e.k0s(),e.j41(5,"small"),e.EFF(6),e.k0s(),e.nrm(7,"hr"),e.j41(8,"p"),e.EFF(9,"Per\xedodo: "),e.j41(10,"small"),e.EFF(11),e.k0s()(),e.j41(12,"div",11)(13,"p",12),e.EFF(14,"Demandante: "),e.DNE(15,co,1,2,"badge",13),e.k0s(),e.j41(16,"p"),e.EFF(17,"Destinat\xe1rio: "),e.DNE(18,mo,1,1,"badge",14),e.k0s()(),e.j41(19,"h5",15),e.EFF(20),e.k0s(),e.j41(21,"small",16),e.EFF(22),e.k0s(),e.DNE(23,go,12,2,"div",17)(24,ho,6,2,"div",18)(25,bo,6,2,"div",18)(26,To,6,2,"div",18),e.k0s()),2&o){const t=e.XpG();e.R7$(2),e.Y8G("ngForOf",null==t.entrega?null:t.entrega.etiquetas),e.R7$(2),e.JRh(null==t.entrega?null:t.entrega.descricao),e.R7$(2),e.JRh(null==t.entrega?null:t.entrega.descricao_entrega),e.R7$(5),e.Lme("",t.planoEntregaEntregaDao.getDateFormatted(null==t.entrega?null:t.entrega.data_inicio)," at\xe9 ",t.planoEntregaEntregaDao.getDateFormatted(null==t.entrega?null:t.entrega.data_fim),""),e.R7$(4),e.Y8G("ngIf",null==t.entrega?null:t.entrega.unidade),e.R7$(3),e.Y8G("ngIf",null==t.entrega||null==t.entrega.destinatario?null:t.entrega.destinatario.length),e.R7$(2),e.JRh(t.lex.translate("Meta")),e.R7$(2),e.JRh(null==t.entrega?null:t.entrega.descricao_meta),e.R7$(),e.Y8G("ngIf",t.entrega),e.R7$(),e.Y8G("ngIf",null==t.entrega||null==t.entrega.objetivos?null:t.entrega.objetivos.length),e.R7$(),e.Y8G("ngIf",null==t.entrega||null==t.entrega.processos?null:t.entrega.processos.length),e.R7$(),e.Y8G("ngIf",null==t.entrega||null==t.entrega.produtos?null:t.entrega.produtos.length)}}function Ao(o,s){if(1&o&&(e.j41(0,"div",36),e.nrm(1,"plano-entrega-entregas-vinculadas",37),e.k0s()),2&o){const t=e.XpG();e.R7$(),e.Y8G("entregaId",t.entrega.id)}}function Co(o,s){if(1&o&&(e.j41(0,"div",38),e.nrm(1,"plano-entrega-entregas-plano-trabalho",37),e.k0s()),2&o){const t=e.XpG();e.R7$(),e.Y8G("entregaId",t.entrega.id)}}const Io=[{path:"",component:Nt,canActivate:[b.q],resolve:{config:C.L},runGuardsAndResolvers:"always",data:{title:"Plano de Entregas"}},{path:"new",component:Z,canActivate:[b.q],resolve:{config:C.L},runGuardsAndResolvers:"always",data:{title:"Inclus\xe3o de Plano de Entregas",modal:!0}},{path:":id/edit",component:Z,canActivate:[b.q],resolve:{config:C.L},runGuardsAndResolvers:"always",data:{title:"Edi\xe7\xe3o de Plano de Entregas",modal:!0}},{path:":id/clone",component:Z,canActivate:[b.q],resolve:{config:C.L},runGuardsAndResolvers:"always",data:{title:"Clone de Plano de Entregas",modal:!0,clone:!0}},{path:":id/consult",component:Z,canActivate:[b.q],resolve:{config:C.L},runGuardsAndResolvers:"always",data:{title:"Consulta a Plano de Entregas",modal:!0}},{path:":id/logs",component:on,canActivate:[b.q],resolve:{config:C.L},runGuardsAndResolvers:"always",data:{title:"Logs de Altera\xe7\xf5es em Planos de Entregas",modal:!0}},{path:":planoEntregaId/avaliar",component:_n.I,canActivate:[b.q],resolve:{config:C.L},runGuardsAndResolvers:"always",data:{title:"Avaliar Plano de Entrega"}},{path:"entrega",component:ve,canActivate:[b.q],resolve:{config:C.L},runGuardsAndResolvers:"always",data:{title:"Entregas do Plano de Entregas",modal:!0}},{path:"entrega/:id/consult",component:ve,canActivate:[b.q],resolve:{config:C.L},runGuardsAndResolvers:"always",data:{title:"Consulta entrega do Plano de Entregas",modal:!0}},{path:"entrega/:id/detalhes",component:(()=>{class o extends B.g{constructor(t){super(t),this.injector=t,this.planoEntregaEntregaDao=t.get(S.o),this.planoEntregaService=t.get(m.C)}ngOnInit(){super.ngOnInit(),this.entrega=this.metadata?.entrega}showPlanejamento(t){var a=this;return(0,c.A)(function*(){a.go.navigate({route:["gestao","plano-entrega","entrega","objetivos",t]},{modal:!0})})()}showCadeiaValor(t){var a=this;return(0,c.A)(function*(){a.go.navigate({route:["gestao","plano-entrega","entrega","processos",t]},{modal:!0})})()}static{this.\u0275fac=function(a){return new(a||o)(e.rXU(e.zZn))}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["plano-entrega-entrega-detalhes"]],features:[e.Vt3],decls:8,vars:4,consts:[["detalhesEntrega",""],["right","",3,"title"],["key","INFOS","icon","bi bi-info-lg","label","Informa\xe7\xf5es"],["key","VINCULOS","icon","bi bi-arrow-down-up","label","V\xednculos"],["key","PARTICIPANTES","icon","bi bi-people","label","Participantes"],["class","","style","min-height: 400px;",4,"ngIf"],["style","min-height: 400px;",4,"ngIf"],["class","row","style","min-height: 400px;",4,"ngIf"],[1,"",2,"min-height","400px"],[1,"mb-2"],[3,"lookup",4,"ngFor","ngForOf"],[1,"d-flex"],[1,"me-2"],["color","light",3,"icon","label",4,"ngIf"],["color","light","icon","bi bi-mailbox",3,"label",4,"ngIf"],[1,"text-center"],[1,"d-block","text-center","mb-2"],["class","d-flex justify-content-center",4,"ngIf"],["class","mt-3",4,"ngIf"],[3,"lookup"],["color","light",3,"icon","label"],["color","light","icon","bi bi-mailbox",3,"label"],[1,"d-flex","justify-content-center"],["icon","bi bi-graph-up-arrow","color","light","hint","Planejada",3,"textValue"],[1,"vr","mx-5"],["icon","bi bi-check-lg","color","light","hint","Realizada",3,"textValue"],[1,"mt-3"],[1,"text-center","mb-2"],[1,"card"],[1,"list-group","list-group-flush"],["class","list-group-item",4,"ngFor","ngForOf"],[1,"list-group-item"],["class","d-flex justify-content-between align-items-center",4,"ngIf"],[1,"d-flex","justify-content-between","align-items-center"],[1,"btn","btn-sm","btn-outline-info","me-2",3,"click"],[1,"bi","bi-eye"],[2,"min-height","400px"],[3,"entregaId"],[1,"row",2,"min-height","400px"]],template:function(a,n){if(1&a&&(e.j41(0,"tabs",1,0),e.nrm(2,"tab",2)(3,"tab",3)(4,"tab",4),e.k0s(),e.DNE(5,Oo,27,13,"div",5)(6,Ao,2,1,"div",6)(7,Co,2,1,"div",7)),2&a){const i=e.sdS(1);e.Y8G("title",n.isModal?"":n.title),e.R7$(5),e.Y8G("ngIf","INFOS"==i.active),e.R7$(),e.Y8G("ngIf","VINCULOS"==i.active&&n.entrega),e.R7$(),e.Y8G("ngIf","PARTICIPANTES"==i.active&&n.entrega)}},dependencies:[A.Sq,A.bT,pe.O,_e.j,L.n,ao,ro]})}}return o})(),canActivate:[b.q],resolve:{config:C.L},runGuardsAndResolvers:"always",data:{title:"Detalhes da entrega do Plano de Entregas",modal:!0}},{path:"entrega-list",component:pn,canActivate:[b.q],resolve:{config:C.L},runGuardsAndResolvers:"always",data:{title:"Entregas do Plano de Entregas",modal:!0}},{path:"entrega/objetivos/:objetivo_id",component:ge,canActivate:[b.q],resolve:{config:C.L},runGuardsAndResolvers:"always",data:{title:"Entregas do Plano de Entregas",modal:!0}},{path:"entrega/processos/:processo_id",component:ge,canActivate:[b.q],resolve:{config:C.L},runGuardsAndResolvers:"always",data:{title:"Entregas do Plano de Entregas",modal:!0}},{path:"adesao",component:na,canActivate:[b.q],resolve:{config:C.L},runGuardsAndResolvers:"always",data:{title:"Ades\xe3o a Plano de Entregas",modal:!0}},{path:"entrega/progresso/:entrega_id",component:Cn,canActivate:[b.q],resolve:{config:C.L},runGuardsAndResolvers:"always",data:{title:"Progressos da entrega do Plano de Entregas",modal:!0}},{path:"entrega/progresso/:entrega_id/new",component:Ae,canActivate:[b.q],resolve:{config:C.L},runGuardsAndResolvers:"always",data:{title:"Inclus\xe3o de Progresso entrega do Plano de Entregas",modal:!0}},{path:"entrega/progresso/:entrega_id/:id/edit",component:Ae,canActivate:[b.q],resolve:{config:C.L},runGuardsAndResolvers:"always",data:{title:"Inclus\xe3o de Progresso entrega do Plano de Entregas",modal:!0}}];let Do=(()=>{class o{static{this.\u0275fac=function(a){return new(a||o)}}static{this.\u0275mod=e.$C({type:o})}static{this.\u0275inj=e.G2t({imports:[I.iI.forChild(Io),I.iI]})}}return o})();var Ro=r(7991),Go=r(9923),jo=r(3756);let yo=(()=>{class o{static{this.\u0275fac=function(a){return new(a||o)}}static{this.\u0275mod=e.$C({type:o})}static{this.\u0275inj=e.G2t({imports:[A.MD,Y.h,Do,Ro.PlanejamentoModule,Go.CadeiaValorModule,Ce.ux,jo.UteisModule]})}}return o})()},4450:(oe,$,r)=>{r.d($,{V:()=>y});var A=r(3308),Y=r(2220),I=r(3279),b=r(4796),C=r(2342),c=r(3609),f=r(568),R=r(6867),P=r(9036),D=r(2736);let y=(()=>{class N{constructor(d,m,p,T,O,e,v,h){this.auth=d,this.util=m,this.go=p,this.lookup=T,this.dao=O,this.avaliacaoDao=e,this.templateService=v,this.planoTrabalhoDao=h}template(d){return d.programa?.template_tcr}metadados(d){return{needSign:this.needSign.bind(this),extraTags:this.extraTags.bind(this),especie:"TCR",titulo:"Termo de Ci\xeancia e Responsabilidade",dataset:this.planoTrabalhoDao.dataset(),datasource:this.planoTrabalhoDao.datasource(d),template:d.programa?.template_tcr,template_id:d.programa?.template_tcr_id}}needSign(d,m){const p=d,T=m||(p?.documentos||[]).find(O=>p?.documento_id?.length&&O.id==p?.documento_id)||p?.documento;if(d&&T&&!T.assinaturas?.find(O=>O.usuario_id==this.auth.usuario.id)){const O=p.tipo_modalidade,e=p.programa,v=this.auth.entidade;let h=[];return e?.plano_trabalho_assinatura_participante&&h.push(p.usuario_id),e?.plano_trabalho_assinatura_gestor_lotacao&&h.push(...this.auth.gestoresLotacao.map(G=>G.id)),e?.plano_trabalho_assinatura_gestor_unidade&&h.push(p.unidade?.gestor?.id||"",...p.unidade?.gestores_substitutos?.map(G=>G.id)||""),e?.plano_trabalho_assinatura_gestor_entidade&&h.push(v.gestor_id||"",v.gestor_substituto_id||""),!!O&&h.includes(this.auth.usuario.id)}return!1}extraTags(d,m,p){const T=d;let O=[];return T?.documento_id==m.id&&O.push({key:m.id,value:"Vigente",icon:"bi bi-check-all",color:"primary"}),JSON.stringify(p.tags)!=JSON.stringify(O)&&(p.tags=O),p.tags}tipoEntrega(d,m){let p=m||d.plano_trabalho,T=d.plano_entrega_entrega?.plano_entrega?.unidade_id==p.unidade_id?"PROPRIA_UNIDADE":d.plano_entrega_entrega?"OUTRA_UNIDADE":d.orgao?.length?"OUTRO_ORGAO":"SEM_ENTREGA",O=this.lookup.ORIGENS_ENTREGAS_PLANO_TRABALHO.find(h=>h.key==T)||{key:"",value:"Desconhecido1"};return{titulo:O.value,cor:O.color||"danger",nome:p?._metadata?.novaEntrega?.plano_entrega_entrega?.entrega?.nome||d.plano_entrega_entrega?.entrega?.nome||"Desconhecido2",tipo:T,descricao:p?._metadata?.novaEntrega?.plano_entrega_entrega?.descricao||d.plano_entrega_entrega?.descricao||""}}atualizarTcr(d,m,p,T){if(m.usuario&&m.unidade){let O=this.dao.datasource(d),e=this.dao.datasource(m),v=m.programa;if(e.usuario.texto_complementar_plano=p||m.usuario?.texto_complementar_plano||"",e.unidade.texto_complementar_plano=T||m.unidade?.texto_complementar_plano||"",(v?.termo_obrigatorio||m.documento_id?.length)&&JSON.stringify(e)!=JSON.stringify(O)&&v?.template_tcr){let h=m.documentos?.find(G=>G.id==m.documento_id);m.documento_id?.length&&h&&!h.assinaturas?.length&&"LINK"!=h.tipo?(h.conteudo=this.templateService.renderTemplate(d.documento?.conteudo||"",e),h.dataset=this.dao.dataset(),h.datasource=e,h._status="ADD"==h._status?"ADD":"EDIT"):(h=new Y.j({id:this.dao?.generateUuid(),tipo:"HTML",especie:"TCR",titulo:"Termo de Ci\xeancia e Responsabilidade",conteudo:this.templateService.renderTemplate(d.documento?.conteudo||v?.template_tcr?.conteudo||"",e),status:"GERADO",_status:"ADD",template:v?.template_tcr?.conteudo,dataset:this.dao.dataset(),datasource:e,entidade_id:this.auth.entidade?.id,plano_trabalho_id:m.id,template_id:v?.template_tcr_id}),m.documentos.push(h)),m.documento=h,m.documento_id=h?.id||null}}return m.documento}situacaoPlano(d){return d.deleted_at?"EXCLUIDO":d.data_arquivamento?"ARQUIVADO":d.status}isValido(d){return!d.deleted_at&&"CANCELADO"!=d.status&&!d.data_arquivamento}estaVigente(d){let m=new Date;return"ATIVO"==d.status&&d.data_inicio<=m&&d.data_fim>=m}diasParaConcluirConsolidacao(d,m){return d&&m?this.util.daystamp(d.data_fim)+m.dias_tolerancia_avaliacao-this.util.daystamp(this.auth.hora):-1}avaliar(d,m,p){this.go.navigate({route:["gestao","plano-trabalho","consolidacao",d.id,"avaliar"]},{modal:!0,metadata:{consolidacao:d,programa:m},modalClose:T=>{T&&(d.status="AVALIADO",d.avaliacao_id=T.id,d.avaliacao=T,p(d))}})}visualizarAvaliacao(d){this.go.navigate({route:["gestao","plano-trabalho","consolidacao",d.id,"verAvaliacoes"]},{modal:!0,metadata:{consolidacao:d}})}fazerRecurso(d,m,p){this.go.navigate({route:["gestao","plano-trabalho","consolidacao",d.id,"recurso"]},{modal:!0,metadata:{recurso:["Inadequado","N\xe3o executado"].includes(d.avaliacao?.nota),consolidacao:d,programa:m},modalClose:T=>{T&&(d.avaliacao=T,p(d))}})}cancelarAvaliacao(d,m,p){var T=this;return(0,A.A)(function*(){m.submitting=!0;try{(yield T.avaliacaoDao.cancelarAvaliacao(d.avaliacao.id))&&(d.status="CONCLUIDO",d.avaliacao_id=null,d.avaliacao=void 0,p(d))}catch(O){m.error(O.message||O)}finally{m.submitting=!1}})()}usuarioAssinou(d,m){return m=m||this.auth.usuario.id,Object.values(d).some(p=>(p||[]).includes(m))}assinaturasFaltantes(d,m){return{participante:d.participante.filter(p=>!m.participante.includes(p)),gestores_unidade_executora:d.gestores_unidade_executora.length?d.gestores_unidade_executora.filter(p=>m.gestores_unidade_executora.includes(p)).length?[]:d.gestores_unidade_executora:[],gestores_unidade_lotacao:d.gestores_unidade_lotacao.length?d.gestores_unidade_lotacao.filter(p=>m.gestores_unidade_lotacao.includes(p)).length?[]:d.gestores_unidade_lotacao:[],gestores_entidade:d.gestores_entidade.length?d.gestores_entidade.filter(p=>m.gestores_entidade.includes(p)).length?[]:d.gestores_entidade:[]}}static{this.\u0275fac=function(m){return new(m||N)(I.KVO(b.u),I.KVO(C.a),I.KVO(c.T),I.KVO(f.s),I.KVO(R.x),I.KVO(P.l),I.KVO(D.I),I.KVO(R.x))}}static{this.\u0275prov=I.jDH({token:N,factory:N.\u0275fac,providedIn:"root"})}}return N})()}}]);
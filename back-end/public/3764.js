"use strict";(self.webpackChunkpetrvs=self.webpackChunkpetrvs||[]).push([[3764],{619:(y,g,l)=>{l.d(g,{K:()=>r});var m=l(291);class r extends m.C{constructor(_){super(),this.data_avaliacao=new Date,this.nota=0,this.justificativa=null,this.recurso=null,this.justificativas=[],this.entregas_checklist=[],this.avaliador_id="",this.plano_trabalho_consolidacao_id=null,this.plano_entrega_id=null,this.tipo_avaliacao_id="",this.tipo_avaliacao_nota_id="",this.initialization(_)}}},3400:(y,g,l)=>{l.d(g,{R:()=>b});var m=l(8832),r=l(3279),v=l(6610),_=l(4286),f=l(5201);function A(d,C){if(1&d&&(r.j41(0,"div",2),r.nrm(1,"input-rate",3),r.k0s()),2&d){const c=r.XpG();r.R7$(),r.Y8G("starMargin",1)("align",c.align)("size",12)("control",c.fakeControl)}}function I(d,C){if(1&d&&r.nrm(0,"badge",5),2&d){const c=r.XpG(2);r.Y8G("icon",c.tipoAvaliacaoNota.icone)("label",c.tipoAvaliacaoNota.nota)}}function j(d,C){if(1&d&&r.DNE(0,I,1,2,"badge",4),2&d){const c=r.XpG();r.Y8G("ngIf",c.tipoAvaliacaoNota)}}let b=(()=>{class d{constructor(){this.align="center",this.items=[],this.fakeControl=new m.MJ,this._tipoAvaliacao=void 0}set tipoAvaliacao(c){this._tipoAvaliacao!=c&&(this._tipoAvaliacao=c,this.items=(this._tipoAvaliacao?.notas||[]).map(u=>Object.assign({},{key:u.nota,value:u.nota,hint:u.descricao,icon:u.icone})),this.tipoAvaliacaoNota=(this._tipoAvaliacao?.notas||[]).find(u=>u.nota==this.nota))}get tipoAvaliacao(){return this._tipoAvaliacao}set nota(c){c!=this.fakeControl.value&&(this.fakeControl.setValue(c),this.tipoAvaliacaoNota=(this._tipoAvaliacao?.notas||[]).find(u=>u.nota==this.nota))}get nota(){return this.fakeControl.value}get isQuantitativo(){return"QUANTITATIVO"==this.tipoAvaliacao?.tipo}get isQualitativo(){return"QUALITATIVO"==this.tipoAvaliacao?.tipo}static{this.\u0275fac=function(u){return new(u||d)}}static{this.\u0275cmp=r.VBU({type:d,selectors:[["avaliar-nota-badge"]],inputs:{align:"align",tipoAvaliacao:"tipoAvaliacao",nota:"nota"},decls:3,vars:2,consts:[["qualitativo",""],["class","row",4,"ngIf","ngIfElse"],[1,"row"],["small","","disabled","",3,"starMargin","align","size","control"],["disabled","",3,"icon","label",4,"ngIf"],["disabled","",3,"icon","label"]],template:function(u,G){if(1&u&&r.DNE(0,A,2,4,"div",1)(1,j,1,1,"ng-template",null,0,r.C5r),2&u){const R=r.sdS(2);r.Y8G("ngIf",G.isQuantitativo)("ngIfElse",R)}},dependencies:[v.bT,_.Q,f.n]})}}return d})()},3764:(y,g,l)=>{l.d(g,{I:()=>Aa});var m=l(3308),r=l(1641),v=l(24),_=l(3283),f=l(619),A=l(9036),I=l(1629),j=l(9416),b=l(3609),d=l(1928),C=l(8717),c=l(6190),u=l(291);class G extends u.C{constructor(i){super(),this.checklist=[],this.avaliacao_id="",this.plano_trabalho_entrega_id=null,this.plano_entrega_entrega_id=null,this.initialization(i)}}var R=l(5374),a=l(3279),h=l(6610),P=l(5611),O=l(2034),k=l(5852),Y=l(114),F=l(158),$=l(3094),V=l(8857),M=l(5201),z=l(5825),w=l(3881),B=l(4286),N=l(8832),S=l(9328),x=l(3890);function X(e,i){if(1&e&&a.nrm(0,"i"),2&e){const t=a.XpG().$implicit;a.ZvI("bi ",t.icon,"")}}function H(e,i){if(1&e){const t=a.RV6();a.qex(0),a.j41(1,"div",3),a.bIt("click",function(){const o=a.eBV(t).$implicit,s=a.XpG();return a.Njj(s.onClick(o))}),a.DNE(2,X,1,3,"i",4),a.j41(3,"span"),a.EFF(4),a.k0s()(),a.bVm()}if(2&e){const t=i.$implicit,n=a.XpG();a.R7$(),a.xc7("border-color",t.color)("background-color",n.isChecked(t)?t.color:"")("color",t.color&&n.isChecked(t)?n.util.contrastColor(t.color):t.color),a.AVh("button_avaliation_disabled",n.isDisabled),a.Y8G("id",n.generatedId(n.controlName)+"_"+t.key),a.R7$(),a.Y8G("ngIf",t.icon),a.R7$(2),a.JRh(t.value)}}let Q=(()=>{class e extends S.O{set value(t){t!=this._value&&(this._value=t,this.detectChanges(),this.control?.setValue(t),this.change&&this.change(t))}get value(){return this._value}set control(t){this._control=t}get control(){return this.getControl()}set size(t){this.setSize(t)}get size(){return this.getSize()}constructor(t){super(t),this.injector=t,this.class="form-group",this.hostClass="",this.labelPosition="top",this.controlName=null,this.icon="bi bi-toggle-on",this.label="",this.labelInfo="",this.bold=!1,this.loading=!1,this.items=[],this._value=""}ngOnInit(){super.ngOnInit()}isChecked(t){return this.value==t.key}onClick(t){this.isDisabled||(this.value=t.key)}ngAfterViewInit(){super.ngAfterViewInit(),this.control&&(this.value=this.control.value,this.control.valueChanges.subscribe(t=>{this.value=t}))}static{this.\u0275fac=function(n){return new(n||e)(a.rXU(a.zZn))}}static{this.\u0275cmp=a.VBU({type:e,selectors:[["input-choose"]],hostVars:2,hostBindings:function(n,o){2&n&&a.HbH(o.class)},inputs:{hostClass:"hostClass",labelPosition:"labelPosition",controlName:"controlName",disabled:"disabled",icon:"icon",label:"label",labelInfo:"labelInfo",labelClass:"labelClass",bold:"bold",loading:"loading",items:"items",form:"form",source:"source",path:"path",required:"required",change:"change",value:"value",control:"control",size:"size"},features:[a.Jv_([],[{provide:N.ZU,useExisting:N.j4}]),a.Vt3],decls:3,vars:13,consts:[[3,"labelPosition","labelClass","controlName","required","control","loading","disabled","label","labelInfo","icon","bold","isRadio"],[1,"d-flex","flex-wrap","justify-content-center","mt-3"],[4,"ngFor","ngForOf"],[1,"button_avaliation","text-center","mb-3",3,"click","id"],[3,"class",4,"ngIf"]],template:function(n,o){1&n&&(a.j41(0,"input-container",0)(1,"div",1),a.DNE(2,H,5,11,"ng-container",2),a.k0s()()),2&n&&(a.Y8G("labelPosition",o.labelPosition)("labelClass",o.labelClass)("controlName",o.controlName)("required",o.required)("control",o.control)("loading",o.loading)("disabled",o.disabled)("label",o.label)("labelInfo",o.labelInfo)("icon",o.icon)("bold",o.bold)("isRadio",!0),a.R7$(2),a.Y8G("ngForOf",o.items))},dependencies:[h.Sq,h.bT,x.t],styles:[".label-input-invalid[_ngcontent-%COMP%]{border-color:#dc3545}.button_avaliation_disabled[_ngcontent-%COMP%]{cursor:default!important}.button_avaliation_disabled[_ngcontent-%COMP%]:hover   i[_ngcontent-%COMP%]:before{animation:none!important}.button_avaliation[_ngcontent-%COMP%]{border:3px solid;padding:5px 10px;cursor:pointer;border-radius:4px;margin-right:10px;max-width:150px;min-width:100px}.button_avaliation[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.8rem}.button_avaliation[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:block;font-size:12px}.button_avaliation[_ngcontent-%COMP%]:hover   i[_ngcontent-%COMP%]:before{animation:_ngcontent-%COMP%_bouncetop .3s alternate ease infinite}@keyframes _ngcontent-%COMP%_bouncetop{0%{-webkit-transform:translateY(0)}to{-webkit-transform:translateY(3px)}}"]})}}return e})();function U(e,i){if(1&e){const t=a.RV6();a.j41(0,"input-rate",2),a.bIt("change",function(o){a.eBV(t);const s=a.XpG();return a.Njj(s.onValueChange(o))}),a.k0s()}if(2&e){const t=a.XpG();a.Y8G("disabled",t.disabled)("size",12)("label",t.label)("control",t.control)}}function J(e,i){if(1&e&&a.nrm(0,"input-choose",3),2&e){const t=a.XpG();a.Y8G("label",t.label)("control",t.control)("disabled",t.disabled)("items",t.items)("change",t.onValueChange.bind(t))}}let L=(()=>{class e{constructor(){this.class="form-group",this.label="Qual nota?",this.items=[],this._size=0,this._control=void 0,this._tipoAvaliacao=void 0}set tipoAvaliacao(t){if(this._tipoAvaliacao!=t){this._tipoAvaliacao=t;let n=this._tipoAvaliacao?.notas;n.sort((o,s)=>s.sequencia-o.sequencia),this.items=(n||[]).map(o=>Object.assign({},{key:o.nota,value:o.nota,hint:o.descricao,icon:o.icone,color:o.cor}))}}get tipoAvaliacao(){return this._tipoAvaliacao}set control(t){this._control!=t&&(this._control=t,t&&(t.valueChanges.subscribe(this.updateNota.bind(this)),this.updateNota()))}get control(){return this._control}set size(t){t!=this._size&&(this._size=t,this.class=this.class.replace(/\scol\-md\-[0-9]+/g,"")+" col-md-"+t)}get size(){return this._size||12}get isQuantitativo(){return"QUANTITATIVO"==this.tipoAvaliacao?.tipo}get isQualitativo(){return"QUALITATIVO"==this.tipoAvaliacao?.tipo}updateNota(){this.nota=this.tipoAvaliacao?.notas.find(t=>t.nota==this.control?.value)}onValueChange(t){this.control?.updateValueAndValidity(),this.change&&this.change(this.control?.value)}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275cmp=a.VBU({type:e,selectors:[["avaliar-nota-input"]],hostVars:2,hostBindings:function(n,o){2&n&&a.HbH(o.class)},inputs:{label:"label",disabled:"disabled",change:"change",tipoAvaliacao:"tipoAvaliacao",control:"control",size:"size"},decls:3,vars:2,consts:[["qualitativo",""],[3,"disabled","size","label","control","change",4,"ngIf","ngIfElse"],[3,"change","disabled","size","label","control"],[3,"label","control","disabled","items","change"]],template:function(n,o){if(1&n&&a.DNE(0,U,1,4,"input-rate",1)(1,J,1,5,"ng-template",null,0,a.C5r),2&n){const s=a.sdS(2);a.Y8G("ngIf",o.isQuantitativo)("ngIfElse",s)}},dependencies:[h.bT,B.Q,Q]})}}return e})();var K=l(3400);const W=["notaInput"],Z=["justificativas"];function q(e,i){if(1&e&&(a.j41(0,"separator",23),a.nrm(1,"input-textarea",24),a.k0s()),2&e){const t=a.XpG();a.R7$(),a.Y8G("size",12)("disabled",t.recurso?void 0:"true")("rows",2)("control",t.form.controls.recurso)}}function aa(e,i){if(1&e&&(a.j41(0,"div",25)(1,"button",26),a.nrm(2,"i"),a.j41(3,"strong",27),a.EFF(4),a.k0s(),a.EFF(5),a.k0s()()),2&e){const t=a.XpG();a.R7$(),a.Aen(t.styleButtonNota),a.R7$(),a.HbH(t.nota.icone),a.xc7("color",t.nota.cor||"black"),a.R7$(2),a.JRh(t.nota.nota),a.R7$(),a.SpI(" - ",t.nota.descricao," ")}}function ta(e,i){if(1&e&&(a.j41(0,"div",16),a.nrm(1,"input-multitoggle",28,1),a.k0s()),2&e){const t=a.XpG();a.R7$(),a.Y8G("disabled",t.recurso?"true":void 0)("control",t.form.controls.justificativas)("label",t.nota.pergunta)("items",t.tiposJustificativas)}}function oa(e,i){if(1&e&&a.EFF(0),2&e){const t=i.row,n=a.XpG(2);a.SpI(" ",n.util.getDateFormatted(n.isPlanoEntrega?t.data_inicio:null==t.plano_entrega_entrega?null:t.plano_entrega_entrega.data_inicio)," ")}}function na(e,i){if(1&e&&a.EFF(0),2&e){const t=i.row,n=a.XpG(2);a.SpI(" ",n.util.getDateFormatted(n.isPlanoEntrega?t.data_fim:null==t.plano_entrega_entrega?null:t.plano_entrega_entrega.data_fim)," ")}}function ea(e,i){if(1&e&&a.nrm(0,"badge",38),2&e){const t=i.row,n=a.XpG(2);a.Y8G("icon",n.entityService.getIcon("Entrega"))("label",t.descricao)}}function ia(e,i){1&e&&a.nrm(0,"badge",40),2&e&&a.Y8G("label",i.row.forca_trabalho+"%")}function la(e,i){if(1&e&&(a.j41(0,"column",39),a.DNE(1,ia,1,1,"ng-template",null,6,a.C5r),a.k0s()),2&e){const t=a.sdS(2);a.Y8G("template",t)("titleHint","% Carga Hor\xe1ria Dispon\xedvel Planejada")}}function sa(e,i){if(1&e&&a.nrm(0,"badge",42)(1,"br")(2,"badge",43),2&e){const t=i.row,n=a.XpG(3);a.Y8G("textValue",n.planoEntregaService.getValorMeta(t)),a.R7$(2),a.Y8G("textValue",n.planoEntregaService.getValorRealizado(t))}}function ra(e,i){if(1&e&&(a.j41(0,"column",41),a.DNE(1,sa,3,2,"ng-template",null,7,a.C5r),a.k0s()),2&e){const t=a.sdS(2);a.Y8G("title","Meta\nRealizado")("width",200)("template",t)}}function ca(e,i){if(1&e&&a.nrm(0,"progress-bar",45),2&e){const t=i.row;a.Y8G("value",t.progresso_realizado)("goal",t.progresso_esperado)}}function da(e,i){if(1&e&&(a.j41(0,"column",44),a.DNE(1,ca,1,2,"ng-template",null,8,a.C5r),a.k0s()),2&e){const t=a.sdS(2);a.Y8G("width",200)("template",t)}}function ua(e,i){if(1&e&&a.nrm(0,"input-switch",47),2&e){const t=i.row,n=i.column,o=a.XpG(3);a.Y8G("source",t._metadata)("path",n.metadata.key)("disabled",o.recurso?"true":void 0)}}function pa(e,i){if(1&e&&(a.j41(0,"column",46),a.DNE(1,ua,1,3,"ng-template",null,9,a.C5r),a.k0s()),2&e){const t=i.$implicit,n=a.sdS(2);a.Y8G("title",t.value)("template",n)("metadata",t)}}function ma(e,i){if(1&e&&(a.j41(0,"separator",29)(1,"grid",30,2)(3,"columns")(4,"column",31),a.DNE(5,oa,1,1,"ng-template",null,3,a.C5r),a.k0s(),a.j41(7,"column",32),a.DNE(8,na,1,1,"ng-template",null,4,a.C5r),a.k0s(),a.j41(10,"column",33),a.DNE(11,ea,1,2,"ng-template",null,5,a.C5r),a.k0s(),a.DNE(13,la,3,2,"column",34)(14,ra,3,3,"column",35)(15,da,3,2,"column",36)(16,pa,3,3,"column",37),a.k0s()()()),2&e){const t=a.sdS(6),n=a.sdS(9),o=a.sdS(12),s=a.XpG();a.Y8G("title",s.lex.translate("Entregas"))("collapsed",!s.checklist.length),a.R7$(),a.Y8G("items",s.entregas)("minHeight",0),a.R7$(3),a.Y8G("template",t),a.R7$(3),a.Y8G("template",n),a.R7$(3),a.Y8G("template",o),a.R7$(3),a.Y8G("ngIf",s.isConsolidacao),a.R7$(),a.Y8G("ngIf",s.isPlanoEntrega),a.R7$(),a.Y8G("ngIf",s.isPlanoEntrega),a.R7$(),a.Y8G("ngForOf",s.checklist)}}function ga(e,i){if(1&e&&(a.j41(0,"div",54)(1,"div",55),a.nrm(2,"profile-picture",56),a.k0s(),a.j41(3,"div",57)(4,"strong"),a.EFF(5),a.k0s(),a.nrm(6,"br"),a.j41(7,"small"),a.EFF(8),a.k0s()()()),2&e){const t=i.row;a.R7$(2),a.Y8G("url",t.avaliador.url_foto||"")("size",40)("hint",t.avaliador.nome||""),a.R7$(3),a.JRh(t.avaliador.nome||""),a.R7$(3),a.JRh(t.avaliador.apelido||"")}}function _a(e,i){if(1&e&&a.nrm(0,"badge",38),2&e){const t=i.$implicit,n=a.XpG(3);a.Y8G("icon",n.entityService.getIcon("TipoJustificativa"))("label",t.value)}}function ha(e,i){if(1&e&&(a.nrm(0,"avaliar-nota-badge",58)(1,"br"),a.j41(2,"small"),a.EFF(3),a.k0s(),a.j41(4,"div",59),a.DNE(5,_a,1,2,"badge",60),a.k0s()),2&e){const t=i.row;a.Y8G("align","left")("tipoAvaliacao",t.tipo_avaliacao)("nota",t.nota),a.R7$(3),a.JRh(t.justificativa||""),a.R7$(2),a.Y8G("ngForOf",t.justificativas)}}function va(e,i){if(1&e&&(a.j41(0,"small"),a.EFF(1),a.k0s()),2&e){const t=i.row;a.R7$(),a.JRh(t.recurso||"")}}function fa(e,i){1&e&&a.nrm(0,"badge",63)}function ba(e,i){1&e&&a.nrm(0,"badge",64)}function Ca(e,i){if(1&e&&(a.j41(0,"div",59),a.DNE(1,fa,1,0,"badge",61)(2,ba,1,0,"badge",62),a.k0s()),2&e){const t=i.row,n=a.XpG(2);a.R7$(),a.Y8G("ngIf",null==t.recurso?null:t.recurso.length),a.R7$(),a.Y8G("ngIf",t.id==(null==n.entity?null:n.entity.id))}}function Ea(e,i){if(1&e&&(a.j41(0,"separator",48)(1,"grid",30,2)(3,"columns"),a.nrm(4,"column",49),a.j41(5,"column",50),a.DNE(6,ga,9,5,"ng-template",null,10,a.C5r),a.k0s(),a.j41(8,"column",51),a.DNE(9,ha,6,5,"ng-template",null,11,a.C5r),a.k0s(),a.j41(11,"column",52),a.DNE(12,va,2,1,"ng-template",null,12,a.C5r),a.k0s(),a.j41(14,"column",53),a.DNE(15,Ca,3,2,"ng-template",null,13,a.C5r),a.k0s()()()()),2&e){const t=a.sdS(7),n=a.sdS(10),o=a.sdS(13),s=a.sdS(16),p=a.XpG();a.R7$(),a.Y8G("items",p.avaliacoes)("minHeight",0),a.R7$(4),a.Y8G("template",t),a.R7$(3),a.Y8G("title","Nota\nJustificativas")("template",n),a.R7$(3),a.Y8G("template",o),a.R7$(3),a.Y8G("template",s)}}let Aa=(()=>{class e extends v.n{constructor(t){super(t,f.K,A.l),this.injector=t,this.recurso=!1,this.tiposJustificativas=[],this.entregas=[],this.checklist=[],this.avaliacoes=[],this.modalWidth=900,this.joinConsolidacao=[],this.joinPlanoEntrega=[],this.joinPrograma=["tipo_avaliacao_plano_trabalho.notas.justificativas","tipo_avaliacao_plano_entrega.notas.justificativas"],this.joinPlanoEntregaEntrega=["entrega","objetivos.objetivo","processos.processo","unidade","comentarios.usuario:id,nome,apelido"],this.joinPlanoTrabalhoEntrega=["entrega","planoEntregaEntrega:id,descricao,data_inicio,data_fim,plano_entrega_id,entrega_id","planoEntregaEntrega.entrega:id,nome,tipo_indicador"],this.validate=(n,o)=>{let s=null;return this.recurso?"recurso"==o&&!n.value?.length&&(s="Obrigat\xf3rio"):"nota"==o&&([null,void 0].includes(n.value)||!this.nota)&&(s="Obrigat\xf3rio"),s},this.formValidation=n=>{const o=n.value;if(!this.recurso&&this.nota?.justifica&&!o.justificativa?.length&&!o.justificativas?.length)return"Para a nota seleciona ser\xe1 necess\xe1rio ao menos uma justificativa."},this.programaDao=t.get(R.X),this.planoTrabalhoEntregaDao=t.get(c.R),this.tipoAvaliacaoDao=t.get(_.h),this.consolidacaoDao=t.get(I.I),this.planoEntregaDao=t.get(j.m),this.planoEntregaEntregaDao=t.get(C.o),this.planoEntregaService=t.get(d.C),this.join=["avaliador","entregas_checklist","tipo_avaliacao.notas"],this.form=this.fh.FormBuilder({nota:{default:null},recurso:{default:""},justificativas:{default:[]},justificativa:{default:""},arquivar:{default:!0}},this.cdRef,this.validate)}loadData(t,n){var o=this;return(0,m.A)(function*(){let s=Object.assign({},n.value);o.loading=!0;try{o.consolidacao=o.urlParams?.has("consolidacaoId")||o.metadata?.consolidacao?o.metadata?.consolidacao||(yield o.consolidacaoDao.getById(o.urlParams.get("consolidacaoId"),o.joinConsolidacao)):void 0,o.planoEntrega=o.urlParams?.has("planoEntregaId")||o.metadata?.planoEntrega?o.metadata?.planoEntrega||(yield o.planoEntregaDao.getById(o.urlParams.get("planoEntregaId"),o.joinPlanoEntrega)):void 0,o.avaliacoes=yield o.dao.query({where:o.consolidacao?[["plano_trabalho_consolidacao_id","==",o.consolidacao.id]]:[["plano_entrega_id","==",o.planoEntrega?.id]],join:o.join,orderBy:[["data_avaliacao","desc"]]}).asPromise(),o.entity=o.avaliacoes.find(p=>p.id==(o.consolidacao||o.planoEntrega)?.avaliacao_id)||o.entity,o.programa=o.metadata?.programa||(yield o.programaDao.query({where:[["id","==",o.consolidacao?.plano_trabalho?.programa_id||o.planoEntrega?.programa_id]],join:o.joinPrograma}).firstOrDefault(o.consolidacao?.plano_trabalho?.programa||o.planoEntrega?.programa)),o.origem=o.consolidacao?"CONSOLIDACAO":"PLANO_ENTREGA",o.tipoAvaliacao=o.isConsolidacao?o.programa?.tipo_avaliacao_plano_trabalho:o.programa?.tipo_avaliacao_plano_entrega,o.checklist=(o.isConsolidacao?o.programa?.checklist_avaliacao_entregas_plano_trabalho:o.programa?.checklist_avaliacao_entregas_plano_entrega)||[],o.recurso=!!o.metadata?.recurso,o.entregas=o.metadata?.entregas||(o.isConsolidacao?yield o.planoTrabalhoEntregaDao.query({where:[["plano_trabalho_id","==",o.consolidacao.plano_trabalho_id]],join:o.joinPlanoTrabalhoEntrega}).asPromise():yield o.planoEntregaEntregaDao.query({where:[["plano_entrega_id","==",o.planoEntrega.id]],join:o.joinPlanoEntregaEntrega}).asPromise()),o.entregas.forEach(p=>{p._metadata={},o.checklist.forEach(T=>{let D=o.entity?.entregas_checklist.find(E=>p.id==(E.plano_entrega_entrega_id||E.plano_trabalho_entrega_id));p._metadata[T.key]=!D||!!D.checklist.find(E=>E.id==T.key)?.checked})}),o.usuario=o.consolidacao?.plano_trabalho?.usuario,s=o.util.fillForm(s,o.entity),o.form.controls.nota.setValue(s.nota),o.onNotaChange(new Event("change")),n.patchValue(s)}finally{o.loading=!1}})()}initializeData(t){var n=this;return(0,m.A)(function*(){n.entity=new f.K,yield n.loadData(n.entity,t)})()}get nota(){return this.notaInput?.nota}get labelNota(){return"Como foi o trabalho "+(this.isConsolidacao?"de "+this.util.apelidoOuNome(this.usuario):"da "+this.planoEntrega?.unidade?.sigla)+"?"}get styleButtonNota(){const t=this.util.colorHexToRGB(this.nota?.cor||"#000000");return"background-color: rgba("+t.r+","+t.g+","+t.b+", 0.2);"}get isConsolidacao(){return"CONSOLIDACAO"==this.origem}get isPlanoEntrega(){return"PLANO_ENTREGA"==this.origem}onNotaChange(t){this.tiposJustificativas=this.nota?.justificativas?.map(n=>({key:n.tipo_justificativa_id,value:n.tipo_justificativa.nome||""}))||[]}saveData(t){var n=this;return(0,m.A)(function*(){return n.recurso?(yield n.dao.recorrer(n.consolidacao.avaliacao,t.recurso),new b.p(n.consolidacao.avaliacao)):(n.entity.id="",n.entity.data_avaliacao=n.auth.hora,n.entity.nota=t.nota,n.entity.justificativa=t.justificativa,n.entity.justificativas=t.justificativas,n.entity.avaliador_id=n.auth.usuario.id,n.entity.plano_entrega_id=n.planoEntrega?.id||null,n.entity.plano_trabalho_consolidacao_id=n.consolidacao?.id||null,n.entity.tipo_avaliacao_id=n.tipoAvaliacao.id,n.entity.tipo_avaliacao_nota_id=n.nota.id,n.checklist.length&&(n.entity.entregas_checklist=n.entregas.map(o=>new G({plano_trabalho_entrega_id:n.consolidacao?o.id:null,plano_entrega_entrega_id:n.planoEntrega?o.id:null,checklist:n.checklist.map(s=>({id:s.key,texto:s.value,checked:!!o._metadata[s.key]}))}))),new b.p(yield n.dao.save(n.entity,n.join)))})()}static{this.\u0275fac=function(n){return new(n||e)(a.rXU(a.zZn))}}static{this.\u0275cmp=a.VBU({type:e,selectors:[["avaliar"]],viewQuery:function(n,o){if(1&n&&(a.GBs(W,5),a.GBs(Z,5),a.GBs(r.Q,5)),2&n){let s;a.mGM(s=a.lsd())&&(o.notaInput=s.first),a.mGM(s=a.lsd())&&(o.justificativas=s.first),a.mGM(s=a.lsd())&&(o.editableForm=s.first)}},features:[a.Vt3],decls:10,vars:17,consts:[["notaInput",""],["justificativas",""],["gridEntregas",""],["culumnDataInicio",""],["columnDataFim",""],["columnEntrega",""],["columnForcaTrabalho",""],["columnMetaRealizado",""],["columnProgresso",""],["columnCheck",""],["columnAvaliador",""],["columnNotaJustificativa",""],["columnRecurso",""],["columnStatus",""],[3,"submit","cancel","form","disabled"],["title","Recurso",4,"ngIf"],[1,"row"],[3,"size","disabled","tipoAvaliacao","label","change","control"],["class","d-flex justify-content-center",4,"ngIf"],["class","row",4,"ngIf"],["label","Justificativa","controlName","justificativa",3,"disabled","size","rows","control"],["collapse","",3,"title","collapsed",4,"ngIf"],["title","Hist\xf3rico de avalia\xe7\xf5es","collapse","",4,"ngIf"],["title","Recurso"],["label","Texto do recurso","controlName","recurso",3,"size","disabled","rows","control"],[1,"d-flex","justify-content-center"],["type","button",1,"pe-none","btn"],[1,"ms-1"],[3,"disabled","control","label","items"],["collapse","",3,"title","collapsed"],[3,"items","minHeight"],["title","In\xedcio",3,"template"],["title","Fim",3,"template"],["title","Entrega",3,"template"],["title","% CHD Planejado",3,"template","titleHint",4,"ngIf"],[3,"title","width","template",4,"ngIf"],["title","Progresso",3,"width","template",4,"ngIf"],[3,"title","template","metadata",4,"ngFor","ngForOf"],[3,"icon","label"],["title","% CHD Planejado",3,"template","titleHint"],["color","light",3,"label"],[3,"title","width","template"],["icon","bi bi-graph-up-arrow","color","light","hint","Meta",3,"textValue"],["icon","bi bi-check-lg","color","light","hint","Realizado",3,"textValue"],["title","Progresso",3,"width","template"],["color","success",3,"value","goal"],[3,"title","template","metadata"],[3,"source","path","disabled"],["title","Hist\xf3rico de avalia\xe7\xf5es","collapse",""],["title","Data","type","datetime","field","data_avaliacao"],["title","Avaliador",3,"template"],[3,"title","template"],["title","Recurso",3,"template"],["title","Status",3,"template"],[1,"avaliador"],[1,"avaliador-profile"],[3,"url","size","hint"],[1,"avaliador-nome"],[3,"align","tipoAvaliacao","nota"],[1,"one-per-line"],[3,"icon","label",4,"ngFor","ngForOf"],["icon","bi bi-journal-medical","color","warning","label","Recorrido",4,"ngIf"],["icon","bi bi-check-circle","color","success","label","Vigente",4,"ngIf"],["icon","bi bi-journal-medical","color","warning","label","Recorrido"],["icon","bi bi-check-circle","color","success","label","Vigente"]],template:function(n,o){if(1&n){const s=a.RV6();a.j41(0,"editable-form",14),a.bIt("submit",function(){return a.eBV(s),a.Njj(o.onSaveData())})("cancel",function(){return a.eBV(s),a.Njj(o.onCancel())}),a.DNE(1,q,2,4,"separator",15),a.j41(2,"div",16),a.nrm(3,"avaliar-nota-input",17,0),a.k0s(),a.DNE(5,aa,6,8,"div",18)(6,ta,3,4,"div",19),a.nrm(7,"input-textarea",20),a.DNE(8,ma,17,11,"separator",21)(9,Ea,17,7,"separator",22),a.k0s()}2&n&&(a.Y8G("form",o.form)("disabled",o.formDisabled),a.R7$(),a.Y8G("ngIf",o.recurso||(null==o.form.controls.recurso||null==o.form.controls.recurso.value?null:o.form.controls.recurso.value.length)),a.R7$(2),a.Y8G("size",12)("disabled",o.recurso?"true":void 0)("tipoAvaliacao",o.tipoAvaliacao)("label",o.labelNota)("change",o.onNotaChange.bind(o))("control",o.form.controls.nota),a.R7$(2),a.Y8G("ngIf",o.nota),a.R7$(),a.Y8G("ngIf",!1),a.R7$(),a.Y8G("disabled",o.recurso?"true":void 0)("size",12)("rows",2)("control",o.form.controls.justificativa),a.R7$(),a.Y8G("ngIf",o.entregas.length),a.R7$(),a.Y8G("ngIf",o.avaliacoes.length))},dependencies:[h.Sq,h.bT,P._,O.T,k.I,r.Q,Y.S,F.S,$.j,V.F,M.n,z.r,w.a,L,K.R],styles:[".avaliador[_ngcontent-%COMP%]{display:table}.avaliador-profile[_ngcontent-%COMP%]{width:fit-content;display:table-cell}.avaliador-nome[_ngcontent-%COMP%]{display:table-cell;min-width:100px}"]})}}return e})()}}]);
"use strict";(self.webpackChunkpetrvs=self.webpackChunkpetrvs||[]).push([[5959],{730:(R,u,s)=>{s.d(u,{I:()=>h});var c=s(291);class h extends c.C{constructor(m){super(),this.perfil_id=null,this.tipo_capacidade_id="",this.initialization(m)}}},5959:(R,u,s)=>{s.r(u),s.d(u,{PerfilModule:()=>et});var c=s(6610),h=s(8069),p=s(1620),m=s(6819),E=s(3308),y=s(1641),g=s(5611),F=s(9419),T=s(7682),j=s(4927),v=s(730),I=s(291);class C extends I.C{constructor(l){super(),this.capacidades=[],this.nivel=0,this.nome="",this.descricao="",this.initialization(l)}}var x=s(24),t=s(3279),A=s(568);let $=(()=>{class a{constructor(i){this.lookup=i}ordenarTiposCapacidade(i){return i.sort((n,e)=>n.codigo.toUpperCase()<e.codigo.toUpperCase()?-1:1)}static{this.\u0275fac=function(n){return new(n||a)(t.KVO(A.s))}}static{this.\u0275prov=t.jDH({token:a,factory:a.\u0275fac,providedIn:"root"})}}return a})();var D=s(2034),P=s(5852),O=s(114),G=s(16),N=s(2075),S=s(6774);function B(a,l){if(1&a&&(t.j41(0,"h3",16),t.EFF(1),t.k0s()),2&a){const i=t.XpG();t.R7$(),t.JRh(i.title)}}function L(a,l){if(1&a&&(t.j41(0,"span",25),t.nrm(1,"i",26),t.EFF(2),t.k0s()),2&a){const i=t.XpG().row;t.R7$(2),t.SpI(" ",null==i.filhos?null:i.filhos.length,"")}}function w(a,l){if(1&a&&t.DNE(0,L,3,1,"span",24),2&a){const i=l.row;t.Y8G("ngIf",null==i.filhos?null:i.filhos.length)}}function Y(a,l){if(1&a){const i=t.RV6();t.j41(0,"tr")(1,"td")(2,"div",29)(3,"span",30)(4,"small",31),t.nrm(5,"i",32),t.EFF(6),t.k0s(),t.nrm(7,"span",33),t.k0s()()(),t.j41(8,"td")(9,"div",34)(10,"span",35),t.EFF(11),t.k0s()()(),t.j41(12,"td",36)(13,"div",37)(14,"span",38)(15,"input-switch",39,6),t.bIt("change",function(){const e=t.eBV(i).$implicit,o=t.sdS(16),d=t.XpG(3);return t.Njj(d.onHabilitadoChangeFilha(e,o.value))}),t.k0s()()()()()}if(2&a){const i=l.$implicit,n=t.XpG(3);t.R7$(6),t.SpI(" ",i.codigo,""),t.R7$(5),t.JRh(i.descricao),t.R7$(4),t.Y8G("size",1)("size",2)("disabled","consult"==n.action?"true":void 0)("source",i)}}function M(a,l){if(1&a&&(t.j41(0,"table",27)(1,"tbody"),t.DNE(2,Y,17,6,"tr",28),t.k0s()()),2&a){const i=l.row;t.R7$(2),t.Y8G("ngForOf",i.filhos)}}function z(a,l){if(1&a&&(t.j41(0,"span",40)(1,"strong",41),t.EFF(2),t.k0s()()),2&a){const i=l.row;t.R7$(2),t.JRh(i.codigo)}}function V(a,l){if(1&a&&(t.j41(0,"span",33),t.EFF(1),t.k0s()),2&a){const i=l.row;t.R7$(),t.SpI(" ",i.descricao,"")}}function H(a,l){if(1&a){const i=t.RV6();t.j41(0,"input-switch",42,6),t.bIt("change",function(){const e=t.eBV(i).row,o=t.sdS(1),d=t.XpG(2);return t.Njj(d.onHabilitadoChange(e,o.value))}),t.k0s()}if(2&a){const i=l.row,n=t.XpG(2);t.Y8G("disabled","consult"==n.action?"true":void 0)("source",i)}}function W(a,l){if(1&a&&(t.j41(0,"tab",17)(1,"grid",18,0)(3,"columns")(4,"column",19),t.DNE(5,w,1,1,"ng-template",null,1,t.C5r)(7,M,3,1,"ng-template",20,2,t.C5r),t.k0s(),t.j41(9,"column",21),t.DNE(10,z,3,1,"ng-template",null,3,t.C5r),t.k0s(),t.j41(12,"column",22),t.DNE(13,V,2,1,"ng-template",null,4,t.C5r),t.k0s(),t.j41(15,"column",23),t.DNE(16,H,2,2,"ng-template",null,5,t.C5r),t.k0s()()()()),2&a){const i=t.sdS(6),n=t.sdS(8),e=t.sdS(11),o=t.sdS(14),d=t.sdS(17),r=t.XpG();t.Y8G("label",r.lex.translate("Capacidades")),t.R7$(),t.Y8G("items",r.tiposCapacidades)("scrollable",!0),t.R7$(3),t.Y8G("align","center")("hint","Lista das capacidades com status m\xf3dulo")("template",i)("expandTemplate",n)("minWidth",50),t.R7$(5),t.Y8G("template",e)("minWidth",160)("maxWidth",160),t.R7$(3),t.Y8G("title",r.lex.translate("M\xf3dulo/Capacidade"))("template",o)("minWidth",600),t.R7$(3),t.Y8G("template",d)}}let b=(()=>{class a extends x.n{constructor(i){super(i,C,F.e),this.injector=i,this.tiposCapacidades=[],this.validate=(n,e)=>{let o=null;return["nome","descricao"].indexOf(e)>=0&&!n.value?.length&&(o="Obrigat\xf3rio"),o},this.titleEdit=n=>"Editando "+this.lex.translate("Perfil")+": "+(n?.nome||""),this.tipoCapacidadeDao=i.get(j.T),this.perfilService=i.get($),this.form=this.fh.FormBuilder({nome:{default:""},capacidades:{default:[]},descricao:{default:""},nivel:{default:""},data_inicio:{default:""},data_fim:{default:""}},this.cdRef,this.validate),this.join=["capacidades.tipo_capacidade"]}loadData(i,n){var e=this;return(0,E.A)(function*(){let o=Object.assign({},n.value);e.entity=i;var d=new T.l({where:[["grupo_id","==",null]],orderBy:[["codigo","asc"]],join:["filhos"]});yield e.tipoCapacidadeDao.query(d).asPromise().then(r=>{r.forEach(_=>{e.perfilService.ordenarTiposCapacidade(_.filhos),e.tiposCapacidades.push(_)})}),o=e.util.fillForm(o,i);for(let r of e.tiposCapacidades){const _=i.capacidades?.find(f=>f.tipo_capacidade?.codigo==r.codigo);r._metadata=Object.assign(r._metadata||{},{habilitado:!!_});for(let f of r.filhos){const at=i.capacidades?.find(nt=>nt.tipo_capacidade?.codigo==f.codigo);f._metadata=Object.assign(f._metadata||{},{habilitado:!!at})}}n.patchValue(o)})()}onHabilitadoChange(i,n){let e=this.entity.capacidades?.find(o=>o.tipo_capacidade_id==i.id);if(n)e&&"DELETE"==e._status&&(e._status=void 0),e||this.entity.capacidades.push(new v.I({tipo_capacidade_id:i.id,perfil_id:this.entity.id,_status:"ADD"}));else{e&&!e._status&&(e._status="DELETE"),e&&"ADD"==e._status&&this.entity.capacidades.splice(this.entity.capacidades.findIndex(o=>o.tipo_capacidade_id==i.id),1);for(let o of i.filhos){o._metadata=Object.assign(o._metadata||{},{habilitado:!1});let d=this.entity.capacidades?.find(r=>r.tipo_capacidade_id==o.id);d&&!d._status&&(d._status="DELETE"),d&&"ADD"==d._status&&this.entity.capacidades.splice(this.entity.capacidades.findIndex(r=>r.tipo_capacidade_id==o.id),1)}}this.refreshCapacidadesHabilitadas()}refreshCapacidadesHabilitadas(){var i=this;return(0,E.A)(function*(){let n=Object.assign({},i.form.value);n=i.util.fillForm(n,i.entity),i.form.patchValue(n),i.cdRef.detectChanges()})()}onHabilitadoChangeFilha(i,n){let e=this.entity.capacidades?.find(d=>d.tipo_capacidade_id==i.id),o=this.tiposCapacidades.find(d=>d.id==i.grupo_id);if(n){if(!o._metadata.habilitado){o._metadata=Object.assign(o._metadata||{},{habilitado:!0});let d=this.entity.capacidades?.find(r=>r.tipo_capacidade_id==o.id);d&&"DELETE"==d._status&&(d._status=void 0),d||this.entity.capacidades.push(new v.I({tipo_capacidade_id:o.id,perfil_id:this.entity.id,_status:"ADD"}))}e&&"DELETE"==e._status&&(e._status=void 0),e||this.entity.capacidades.push(new v.I({tipo_capacidade_id:i.id,perfil_id:this.entity.id,_status:"ADD"}))}else e&&!e._status&&(e._status="DELETE"),e&&"ADD"==e._status&&this.entity.capacidades.splice(this.entity.capacidades.findIndex(d=>d.tipo_capacidade_id==i.id),1);this.refreshCapacidadesHabilitadas()}initializeData(i){i.patchValue(new C)}saveData(i){return new Promise((n,e)=>{let o=this.util.fill(new C,this.entity);o=this.util.fillForm(o,this.form.value),o.capacidades=o.capacidades.filter(d=>["ADD","DELETE"].includes(d._status||"")),n(o)})}static{this.\u0275fac=function(n){return new(n||a)(t.rXU(t.zZn))}}static{this.\u0275cmp=t.VBU({type:a,selectors:[["app-perfil-form"]],viewQuery:function(n,e){if(1&n&&(t.GBs(y.Q,5),t.GBs(g._,5)),2&n){let o;t.mGM(o=t.lsd())&&(e.editableForm=o.first),t.mGM(o=t.lsd())&&(e.gridPai=o.first)}},features:[t.Vt3],decls:10,vars:11,consts:[["gridPai",""],["columnCapacidades",""],["columnExpandedCapacidades",""],["columnCodCapacidade",""],["columnTipoCapacidade",""],["columnSelecionado",""],["habilitado",""],["class","my-2",4,"ngIf"],["initialFocus","nome",3,"submit","cancel","form","disabled"],["display","","right",""],["key","PRINCIPAL","label","Principal"],[1,"row"],["label","Nome","controlName","nome","required","",3,"size"],["numbers","","label","N\xedvel","controlName","nivel",3,"size","disabled"],["label","Descri\xe7\xe3o","controlName","descricao","required","",3,"size"],["key","CAPACIDADES",3,"label",4,"ngIf"],[1,"my-2"],["key","CAPACIDADES",3,"label"],[3,"items","scrollable"],["type","expand","icon","bi bi-shield-lock",3,"align","hint","template","expandTemplate","minWidth"],[2,"justify-content","inherit"],["title","C\xf3digo","orderBy","codigo",3,"template","minWidth","maxWidth"],[3,"title","template","minWidth"],["title","Habilitado",3,"template"],["class","badge rounded-pill bg-light text-dark",4,"ngIf"],[1,"badge","rounded-pill","bg-light","text-dark"],[1,"bi","bi-grid"],[1,"table","table-hover"],[4,"ngFor","ngForOf"],[2,"width","220px"],[1,"text-wrap","text-center"],[1,"micro-text","fw-light"],[1,"bi","bi-key"],[1,"badge","bg-light","text-dark"],[2,"width","450px"],[1,"badge","bg-light","text-dark","text-wrap"],[2,"text-align","right"],[2,"width","60px","margin-left","40px"],[1,"text-align"],["scale","medium","path","_metadata.habilitado",1,"text-align",2,"right","10px",3,"change","size","disabled","source"],[1,"text-wrap"],[1,"grid-group-text"],["path","_metadata.habilitado",2,"width","45px","margin-right","70px",3,"change","disabled","source"]],template:function(n,e){1&n&&(t.DNE(0,B,2,1,"h3",7),t.j41(1,"editable-form",8),t.bIt("submit",function(){return e.onSaveData()})("cancel",function(){return e.onCancel()}),t.j41(2,"tabs",9)(3,"tab",10)(4,"div",11),t.nrm(5,"input-text",12)(6,"input-text",13),t.k0s(),t.j41(7,"div",11),t.nrm(8,"input-text",14),t.k0s()(),t.DNE(9,W,18,15,"tab",15),t.k0s()()),2&n&&(t.Y8G("ngIf",!e.isModal),t.R7$(),t.Y8G("form",e.form)("disabled",e.formDisabled),t.R7$(4),t.Y8G("size",10),t.BMQ("maxlength",250),t.R7$(),t.Y8G("size",2)("disabled",e.entity?"disabled":void 0),t.BMQ("maxlength",250),t.R7$(2),t.Y8G("size",12),t.BMQ("maxlength",250),t.R7$(),t.Y8G("ngIf",e.auth.hasPermissionTo("MOD_CFG_PERFS")))},dependencies:[c.Sq,c.bT,g._,D.T,P.I,y.Q,O.S,G.H,N.O,S.j]})}}return a})();var X=s(9062),Q=s(7772),k=s(2305),U=s(6764);function J(a,l){if(1&a&&(t.j41(0,"h3",11),t.EFF(1),t.k0s()),2&a){const i=t.XpG();t.R7$(),t.JRh(i.title)}}function K(a,l){if(1&a&&(t.j41(0,"span"),t.EFF(1),t.k0s()),2&a){const i=l.row;t.R7$(),t.JRh(i.nivel)}}const Z=[{path:"",component:(()=>{class a extends X.P{constructor(i){super(i,C,F.e),this.injector=i,this.options=[],this.filterWhere=n=>{let e=[],o=n.value;return o.nome?.length&&e.push(["nome","like","%"+o.nome.trim().replace(" ","%")+"%"]),e},this.title=this.lex.translate("Perfis"),this.code="MOD_CFG_PERFS",this.orderBy=[["nome","asc"]],this.filter=this.fh.FormBuilder({nome:{default:""}}),this.addOption(this.OPTION_INFORMACOES),this.addOption(this.OPTION_LOGS,"MOD_AUDIT_LOG")}static{this.\u0275fac=function(n){return new(n||a)(t.rXU(t.zZn))}}static{this.\u0275cmp=t.VBU({type:a,selectors:[["app-perfil-list"]],viewQuery:function(n,e){if(1&n&&t.GBs(g._,5),2&n){let o;t.mGM(o=t.lsd())&&(e.grid=o.first)}},features:[t.Vt3],decls:14,vars:22,consts:[["columnNivel",""],["class","my-2",4,"ngIf"],[3,"dao","add","orderBy","groupBy","join","hasAdd","hasEdit"],[3,"deleted","form","where","submit","collapseChange","collapsed"],[1,"row"],["controlName","nome","placeholder","Nome...",3,"size","label","control"],["title","Nome","field","nome"],["title","Descri\xe7\xe3o","field","descricao"],["title","N\xedvel de acesso",3,"template"],["type","options",3,"onEdit","options"],[3,"rows"],[1,"my-2"]],template:function(n,e){if(1&n&&(t.DNE(0,J,2,1,"h3",1),t.j41(1,"grid",2),t.nrm(2,"toolbar"),t.j41(3,"filter",3)(4,"div",4),t.nrm(5,"input-text",5),t.k0s()(),t.j41(6,"columns"),t.nrm(7,"column",6)(8,"column",7),t.j41(9,"column",8),t.DNE(10,K,2,1,"ng-template",null,0,t.C5r),t.k0s(),t.nrm(12,"column",9),t.k0s(),t.nrm(13,"pagination",10),t.k0s()),2&n){const o=t.sdS(11);t.Y8G("ngIf",!e.isModal),t.R7$(),t.Y8G("dao",e.dao)("add",e.add)("orderBy",e.orderBy)("groupBy",e.groupBy)("join",e.join)("hasAdd",!1)("hasEdit",!1),t.R7$(2),t.Y8G("deleted",e.auth.hasPermissionTo("MOD_AUDIT_DEL"))("form",e.filter)("where",e.filterWhere)("submit",e.filterSubmit.bind(e))("collapseChange",e.filterCollapseChange.bind(e))("collapsed",e.filterCollapsed),t.R7$(2),t.Y8G("size",12)("label","Nome "+e.lex.translate("Perfil"))("control",e.filter.controls.nome),t.BMQ("maxlength",250),t.R7$(4),t.Y8G("template",o),t.R7$(3),t.Y8G("onEdit",e.edit)("options",e.options),t.R7$(),t.Y8G("rows",e.rowsLimit)}},dependencies:[c.bT,g._,D.T,P.I,Q.i,k.H,U.e,G.H]})}}return a})(),canActivate:[p.q],resolve:{config:m.L},runGuardsAndResolvers:"always",data:{title:"Perfils"}},{path:"new",component:b,canActivate:[p.q],resolve:{config:m.L},runGuardsAndResolvers:"always",data:{title:"Inclus\xe3o de Perfil",modal:!0}},{path:":id/edit",component:b,canActivate:[p.q],resolve:{config:m.L},runGuardsAndResolvers:"always",data:{title:"Edi\xe7\xe3o de Perfil",modal:!0}},{path:":perfil_id/capacidade",loadChildren:()=>s.e(3492).then(s.bind(s,3492)).then(a=>a.CapacidadeModule),canActivate:[p.q]},{path:":id/consult",component:b,canActivate:[p.q],resolve:{config:m.L},runGuardsAndResolvers:"always",data:{title:"Consulta a Perfil",modal:!0}}];let q=(()=>{class a{static{this.\u0275fac=function(n){return new(n||a)}}static{this.\u0275mod=t.$C({type:a})}static{this.\u0275inj=t.G2t({imports:[h.iI.forChild(Z),h.iI]})}}return a})();var tt=s(9455),it=s(8832);let et=(()=>{class a{static{this.\u0275fac=function(n){return new(n||a)}}static{this.\u0275mod=t.$C({type:a})}static{this.\u0275inj=t.G2t({imports:[c.MD,tt.h,it.X1,q]})}}return a})()}}]);
"use strict";(self.webpackChunkpetrvs=self.webpackChunkpetrvs||[]).push([[837],{1095:(ne,S,r)=>{r.d(S,{w:()=>P});var O=r(6976),R=r(755);let P=(()=>{class E extends O.B{constructor(u){super("Avaliacao",u),this.injector=u,this.inputSearchConfig.searchFields=[]}cancelarAvaliacao(u){return new Promise((f,D)=>{this.server.post("api/"+this.collection+"/cancelar-avaliacao",{id:u}).subscribe(I=>{I?.error?D(I?.error):f(!0)},I=>D(I))})}recorrer(u,f){return new Promise((D,I)=>{this.server.post("api/"+this.collection+"/recorrer",{id:u.id,recurso:f}).subscribe(Z=>{Z?.error?I(Z?.error):(u.recurso=f,D(!0))},Z=>I(Z))})}static#e=this.\u0275fac=function(f){return new(f||E)(R.LFG(R.zs3))};static#t=this.\u0275prov=R.Yz7({token:E,factory:E.\u0275fac,providedIn:"root"})}return E})()},2837:(ne,S,r)=>{r.r(S),r.d(S,{PlanoEntregaModule:()=>ho});var O=r(6733),R=r(2662),P=r(5579),E=r(1391),C=r(2314),u=r(8239),f=r(3150),D=r(9520),I=r(5458),Z=r(9190),N=r(1214),w=r(4368);class V extends w.X{constructor(l){super(),this.entregas=[],this.status_historico=[],this.data_inicio=new Date,this.data_fim=null,this.nome="",this.metadados=void 0,this.arquivar=!1,this.status="INCLUIDO",this.avaliacoes=[],this.unidade_id="",this.avaliacao_id=null,this.plano_entrega_id=null,this.planejamento_id=null,this.cadeia_valor_id=null,this.programa_id=null,this.initialization(l)}}var d=r(8509),c=r(7447),p=r(1095),T=r(609),e=r(755),b=r(7224),A=r(3351),m=r(7765),x=r(5512),z=r(2704),oe=r(8820),J=r(8967),j=r(2392),q=r(4495),G=r(4603),X=r(1915),y=r(5489),Ce=r(6486),U=r(4040),L=r(1021),F=r(2398),k=r(6298),ie=r(7819),B=r(5560),Y=r(9756),H=r(9224),le=r(4792),Ie=r(1419);function Pe(o,l){if(1&o){const t=e.EpF();e.TgZ(0,"input-number",3),e.NdJ("change",function(n){e.CHM(t);const i=e.oxw();return e.KtG(i.onValueChange(n))}),e.qZA()}if(2&o){const t=e.oxw();e.Q6J("disabled",t.disabled)("icon",t.icon)("label",t.label||"Porcentagem")("control",t.control)("labelInfo",t.labelInfo)}}function Ze(o,l){if(1&o){const t=e.EpF();e.TgZ(0,"input-number",4),e.NdJ("change",function(n){e.CHM(t);const i=e.oxw();return e.KtG(i.onValueChange(n))}),e.qZA()}if(2&o){const t=e.oxw();e.Q6J("disabled",t.disabled)("icon",t.icon)("label",t.label||"Num\xe9rico")("control",t.control)("labelInfo",t.labelInfo)}}const De=function(){return[]};function xe(o,l){if(1&o){const t=e.EpF();e.TgZ(0,"input-select",5),e.NdJ("change",function(n){e.CHM(t);const i=e.oxw();return e.KtG(i.onValueChange(n))}),e.qZA()}if(2&o){const t=e.oxw();e.Q6J("disabled",t.disabled)("icon",t.icon)("label",t.label||"Qualitativo")("control",t.control)("items",(null==t.entrega?null:t.entrega.lista_qualitativos)||e.DdM(6,De))("labelInfo",t.labelInfo)}}const Ne=function(){return["PORCENTAGEM"]},ye=function(){return["QUANTIDADE","VALOR"]},Ue=function(){return["QUALITATIVO"]};let $=(()=>{class o{constructor(){this.class="form-group",this.icon="",this.labelInfo="",this._size=0}set size(t){t!=this._size&&(this._size=t,this.class=this.class.replace(/\scol\-md\-[0-9]+/g,"")+" col-md-"+t)}get size(){return this._size||12}checkTipoIndicador(t){return t.includes(this.entrega?.tipo_indicador||"")}onValueChange(t){this.change&&this.change(this.control?.value,this.entrega)}static#e=this.\u0275fac=function(a){return new(a||o)};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["plano-entrega-valor-meta-input"]],hostVars:2,hostBindings:function(a,n){2&a&&e.Tol(n.class)},inputs:{entrega:"entrega",icon:"icon",label:"label",labelInfo:"labelInfo",disabled:"disabled",control:"control",change:"change",size:"size"},decls:3,vars:6,consts:[["sufix","%","required","",3,"disabled","icon","label","control","labelInfo","change",4,"ngIf"],["required","",3,"disabled","icon","label","control","labelInfo","change",4,"ngIf"],["required","",3,"disabled","icon","label","control","items","labelInfo","change",4,"ngIf"],["sufix","%","required","",3,"disabled","icon","label","control","labelInfo","change"],["required","",3,"disabled","icon","label","control","labelInfo","change"],["required","",3,"disabled","icon","label","control","items","labelInfo","change"]],template:function(a,n){1&a&&(e.YNc(0,Pe,1,5,"input-number",0),e.YNc(1,Ze,1,5,"input-number",1),e.YNc(2,xe,1,7,"input-select",2)),2&a&&(e.Q6J("ngIf",n.checkTipoIndicador(e.DdM(3,Ne))),e.xp6(1),e.Q6J("ngIf",n.checkTipoIndicador(e.DdM(4,ye))),e.xp6(1),e.Q6J("ngIf",n.checkTipoIndicador(e.DdM(5,Ue))))},dependencies:[O.O5,G.p,H.l]})}return o})();const Le=["etiqueta"];function we(o,l){if(1&o&&(e.TgZ(0,"strong",14),e._uU(1,"Entregas: "),e.qZA(),e.TgZ(2,"span",15),e._UZ(3,"badge",16),e.qZA()),2&o){const t=l.separator;e.xp6(3),e.Q6J("label",null==t?null:t.text)}}function qe(o,l){if(1&o&&e._UZ(0,"badge",21),2&o){const t=e.oxw().row,a=e.oxw();e.Q6J("icon",a.entityService.getIcon("Unidade"))("label",t.unidade.sigla)}}function Qe(o,l){if(1&o&&e._UZ(0,"badge",22),2&o){const t=e.oxw().row;e.Q6J("label",t.destinatario)}}function Re(o,l){if(1&o&&e._UZ(0,"reaction",23),2&o){const t=e.oxw().row;e.Q6J("entity",t)}}function Je(o,l){if(1&o&&(e.TgZ(0,"h6"),e._uU(1),e.qZA(),e.TgZ(2,"span",17),e.YNc(3,qe,1,2,"badge",18),e.YNc(4,Qe,1,1,"badge",19),e.qZA(),e.YNc(5,Re,1,1,"reaction",20)),2&o){const t=l.row,a=e.oxw();e.xp6(1),e.Oqu(t.descricao),e.xp6(2),e.Q6J("ngIf",t.unidade),e.xp6(1),e.Q6J("ngIf",null==t.destinatario?null:t.destinatario.length),e.xp6(1),e.Q6J("ngIf",a.execucao)}}function Me(o,l){1&o&&e._UZ(0,"badge",25),2&o&&e.Q6J("lookup",l.$implicit)}function Se(o,l){1&o&&e.YNc(0,Me,1,1,"badge",24),2&o&&e.Q6J("ngForOf",l.row.etiquetas)}function Ve(o,l){if(1&o){const t=e.EpF();e.TgZ(0,"input-multiselect",26)(1,"input-select",27,28),e.NdJ("details",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.onEtiquetaConfigClick())}),e.qZA()()}if(2&o){const t=e.oxw();e.Q6J("size",12)("control",t.formEdit.controls.etiquetas)("addItemHandle",t.addItemHandleEtiquetas.bind(t)),e.xp6(1),e.Q6J("size",12)("control",t.formEdit.controls.etiqueta)("items",t.etiquetas)}}function ze(o,l){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=e.oxw().row,a=e.oxw();e.xp6(1),e.hij(" ",a.dao.getDateFormatted(t.data_inicio),"")}}function je(o,l){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=e.oxw().row,a=e.oxw();e.xp6(1),e.hij(" ",a.dao.getDateFormatted(t.data_fim),"")}}function Ge(o,l){if(1&o&&(e.YNc(0,ze,2,1,"span",29),e._UZ(1,"br"),e.YNc(2,je,2,1,"span",29)),2&o){const t=l.row;e.Q6J("ngIf",t.data_inicio),e.xp6(2),e.Q6J("ngIf",t.data_fim)}}function Fe(o,l){if(1&o&&e._UZ(0,"badge",30)(1,"br")(2,"badge",31),2&o){const t=l.row,a=e.oxw();e.Q6J("textValue",a.planoEntregaService.getValorMeta(t)),e.xp6(2),e.Q6J("textValue",a.planoEntregaService.getValorRealizado(t))}}function ke(o,l){if(1&o&&e._UZ(0,"plano-entrega-valor-meta-input",32)(1,"plano-entrega-valor-meta-input",33),2&o){const t=l.row,a=e.oxw();e.Q6J("entrega",t.entrega)("size",6)("control",a.form.controls.meta),e.xp6(1),e.Q6J("entrega",t.entrega)("size",6)("control",a.form.controls.realizado)("change",a.onRealizadaChange.bind(a))}}function Be(o,l){1&o&&e._UZ(0,"i",42)}function Ye(o,l){if(1&o&&(e.TgZ(0,"tr")(1,"td"),e.YNc(2,Be,1,0,"i",40),e.qZA(),e.TgZ(3,"td",41),e._uU(4),e.qZA()()),2&o){const t=l.$implicit;e.xp6(2),e.Q6J("ngIf",t.checked),e.xp6(2),e.Oqu(t.texto)}}function He(o,l){if(1&o&&(e.TgZ(0,"table"),e.YNc(1,Ye,5,2,"tr",39),e.qZA()),2&o){const t=e.oxw(2).row;e.xp6(1),e.Q6J("ngForOf",t.checklist)}}function We(o,l){if(1&o&&(e.TgZ(0,"separator",38),e.YNc(1,He,2,1,"table",29),e.qZA()),2&o){const t=e.oxw().row;e.Q6J("collapsed",!0),e.xp6(1),e.Q6J("ngIf",null==t.checklist?null:t.checklist.length)}}function Ke(o,l){if(1&o&&(e._UZ(0,"progress-bar",36),e.YNc(1,We,2,2,"separator",37)),2&o){const t=l.row;e.Q6J("value",t.progresso_realizado)("goal",t.progresso_esperado),e.xp6(1),e.Q6J("ngIf",null==t.checklist?null:t.checklist.length)}}function Xe(o,l){1&o&&e._UZ(0,"separator",45)}function $e(o,l){if(1&o&&(e.TgZ(0,"tr")(1,"td"),e._UZ(2,"input-switch",46),e.qZA(),e.TgZ(3,"td",41),e._uU(4),e.qZA()()),2&o){const t=l.$implicit,a=l.index,n=e.oxw(4);e.xp6(2),e.Q6J("size",12)("source",n.checklist)("path",a+".checked"),e.xp6(2),e.Oqu(t.texto)}}function et(o,l){if(1&o&&(e.TgZ(0,"table"),e.YNc(1,$e,5,4,"tr",39),e.qZA()),2&o){const t=e.oxw(3);e.xp6(1),e.Q6J("ngForOf",t.checklist)}}function tt(o,l){if(1&o&&(e._UZ(0,"input-number",43),e.YNc(1,Xe,1,0,"separator",44),e.YNc(2,et,2,1,"table",29)),2&o){const t=l.row,a=e.oxw(2);e.Q6J("size",12)("control",a.formEdit.controls.progresso_realizado),e.xp6(1),e.Q6J("ngIf",null==t.checklist?null:t.checklist.length),e.xp6(1),e.Q6J("ngIf",null==t.checklist?null:t.checklist.length)}}function at(o,l){if(1&o&&(e.TgZ(0,"column",4),e.YNc(1,Ke,2,3,"ng-template",null,34,e.W1O),e.YNc(3,tt,3,4,"ng-template",null,35,e.W1O),e.qZA()),2&o){const t=e.MAs(2),a=e.MAs(4),n=e.oxw();e.Q6J("title","Progresso\nChecklist")("width",200)("template",t)("editTemplate",t)("columnEditTemplate",n.selectable?void 0:a)("edit",n.selectable?void 0:n.onColumnChecklistEdit.bind(n))("save",n.selectable?void 0:n.onColumnChecklistSave.bind(n))}}function nt(o,l){if(1&o&&e._UZ(0,"badge",49),2&o){const t=e.oxw().row;e.Q6J("label",null==t.entrega?null:t.entrega.nome)}}function ot(o,l){if(1&o&&(e.YNc(0,nt,1,1,"badge",47),e._UZ(1,"comentarios-widget",48)),2&o){const t=l.row,a=e.oxw();e.Q6J("ngIf",t.entrega),e.xp6(1),e.Q6J("entity",t)("selectable",!a.execucao||!(null==a.grid||!a.grid.editing))("grid",a.grid)("save",a.refreshComentarios.bind(a))}}let se=(()=>{class o extends k.D{set noPersist(t){super.noPersist=t}get noPersist(){return super.noPersist}set control(t){super.control=t}get control(){return super.control}set entity(t){super.entity=t}get entity(){return super.entity}set planejamentoId(t){this._planejamentoId!=t&&(this._planejamentoId=t)}get planejamentoId(){return this._planejamentoId}set cadeiaValorId(t){this._cadeiaValorId!=t&&(this._cadeiaValorId=t)}get cadeiaValorId(){return this._cadeiaValorId}set unidadeId(t){this._unidadeId!=t&&(this._unidadeId=t)}get unidadeId(){return this._unidadeId}set dataFim(t){this._dataFim!=t&&(this._dataFim=t)}get dataFim(){return this._dataFim}get items(){return this.gridControl.value||this.gridControl.setValue([]),this.gridControl.value}constructor(t){super(t),this.injector=t,this.disabled=!1,this.execucao=!1,this.entityToControl=a=>a.entregas||[],this.options=[],this.planoEntregaId="",this.etiquetas=[],this.etiquetasAscendentes=[],this.selectable=!1,this.validate=(a,n)=>{let i=null;return["nome"].indexOf(n)>=0&&!a.value?.length&&(i="Obrigat\xf3rio"),i},this.filterWhere=a=>{let n=[];return n.push(["plano_entrega_id","==",this.planoEntregaId]),n},this.title=this.lex.translate("Entregas"),this.join=["unidade","entrega","reacoes.usuario:id,nome,apelido"],this.code="MOD_PENT",this.cdRef=t.get(e.sBO),this.dao=t.get(L.K),this.unidadeDao=t.get(N.J),this.planoEntregaService=t.get(c.f),this.form=this.fh.FormBuilder({descricao:{default:""},data_inicio:{default:new Date},data_fim:{default:new Date},meta:{default:""},realizado:{default:null},entrega_id:{default:null},unidade_id:{default:null},progresso_esperado:{default:null},progresso_realizado:{default:null},destinatario:{default:null},etiquetas:{default:[]}},this.cdRef,this.validate),this.formEdit=this.fh.FormBuilder({progresso_realizado:{default:0},etiquetas:{default:[]},etiqueta:{default:null}}),this.addOption(Object.assign({onClick:this.consult.bind(this)},this.OPTION_INFORMACOES),"MOD_PENT"),this.addOption(Object.assign({onClick:this.delete.bind(this)},this.OPTION_EXCLUIR),"MOD_PENT_ENTR_EXCL"),this.addOption(Object.assign({onClick:this.showLogs.bind(this)},this.OPTION_LOGS),"MOD_AUDIT_LOG")}ngOnInit(){super.ngOnInit(),this.planoEntregaId=this.urlParams.get("id")||""}get isDisabled(){return this.formDisabled||this.disabled}add(){var t=this;return(0,u.Z)(function*(){let a=new F.O({_status:"ADD",id:t.dao.generateUuid(),plano_entrega_id:t.entity?.id});var n;t.go.navigate({route:["gestao","plano-entrega","entrega"]},{metadata:{plano_entrega:t.entity,planejamento_id:t.planejamentoId,cadeia_valor_id:t.cadeiaValorId,unidade_id:t.unidadeId,data_fim:t.dataFim,entrega:a},modalClose:(n=(0,u.Z)(function*(i){if(i)try{t.items.push(t.isNoPersist?i:yield t.dao.save(i,t.join)),t.cdRef.detectChanges()}catch(s){t.error(s?.error||s?.message||s)}}),function(s){return n.apply(this,arguments)})})})()}dynamicOptions(t){return this.execucao||this.isDisabled?[]:this.options}dynamicButtons(t){const a=[];return this.isDisabled&&a.push(Object.assign({onClick:this.consult.bind(this)},this.OPTION_INFORMACOES)),this.execucao&&a.push({label:"Hist\xf3rico de execu\xe7\xe3o",icon:"bi bi-activity",color:"btn-outline-info",onClick:this.showProgresso.bind(this)}),a.push({label:"Detalhes",icon:"bi bi-eye",color:"btn-outline-success",onClick:this.showDetalhes.bind(this)}),a}edit(t){var a=this;return(0,u.Z)(function*(){if(a.execucao)a.grid.edit(t);else{t._status="ADD"==t._status?"ADD":"EDIT";let n=a.items.indexOf(t);a.go.navigate({route:["gestao","plano-entrega","entrega"]},{metadata:{plano_entrega:a.entity,planejamento_id:a.planejamentoId,cadeia_valor_id:a.cadeiaValorId,unidade_id:a.unidadeId,entrega:t},modalClose:(i=(0,u.Z)(function*(s){s&&(a.isNoPersist||(yield a.dao?.save(s)),a.items[n]=s)}),function(g){return i.apply(this,arguments)})})}var i})()}load(t,a){var n=this;return(0,u.Z)(function*(){n.form.patchValue(a),n.form.controls.meta.setValue(n.planoEntregaService.getValor(a.meta)),n.form.controls.realizado.setValue(n.planoEntregaService.getValor(a.realizado)),n.cdRef.detectChanges()})()}save(t,a){var n=this;return(0,u.Z)(function*(){let i;if(n.form.markAllAsTouched(),t.valid){n.submitting=!0;try{i=yield n.dao?.update(a.id,{realizado:n.planoEntregaService.getEntregaValor(a.entrega,t.controls.realizado.value),progresso_realizado:t.controls.progresso_realizado.value},n.join)}finally{n.submitting=!1}}return i})()}delete(t){var a=this;return(0,u.Z)(function*(){if(yield a.dialog.confirm("Exclui ?","Deseja realmente excluir?")){let i=a.items.indexOf(t);a.isNoPersist?t._status="DELETE":a.dao.delete(t).then(()=>{a.items.splice(i,1),a.cdRef.detectChanges(),a.dialog.topAlert("Registro exclu\xeddo com sucesso!",5e3)}).catch(s=>{a.dialog.alert("Erro","Erro ao excluir: "+(s?.message?s?.message:s))})}})()}consult(t){var a=this;return(0,u.Z)(function*(){a.go.navigate({route:["gestao","plano-entrega","entrega",t.id,"consult"]},{metadata:{plano_entrega:a.entity,planejamento_id:a.planejamentoId,cadeia_valor_id:a.cadeiaValorId,unidade_id:a.unidadeId,entrega:t}})})()}showLogs(t){var a=this;return(0,u.Z)(function*(){a.go.navigate({route:["logs","change",t.id,"consult"]})})()}showPlanejamento(t){var a=this;return(0,u.Z)(function*(){a.go.navigate({route:["gestao","plano-entrega","entrega","objetivos",t]},{modal:!0})})()}showCadeiaValor(t){var a=this;return(0,u.Z)(function*(){a.go.navigate({route:["gestao","plano-entrega","entrega","processos",t]},{modal:!0})})()}showProgresso(t){var a=this;return(0,u.Z)(function*(){a.go.navigate({route:["gestao","plano-entrega","entrega","progresso",t.id]},{modal:!0,modalClose:n=>{a.parent?.refresh(a.entity?.id)}})})()}showDetalhes(t){var a=this;return(0,u.Z)(function*(){a.go.navigate({route:["gestao","plano-entrega","entrega",t.id,"detalhes"]},{metadata:{plano_entrega:a.entity,planejamento_id:a.planejamentoId,cadeia_valor_id:a.cadeiaValorId,unidade_id:a.unidadeId,entrega:t}})})()}refreshComentarios(t){let a=this.items.find(n=>n.id==t.id);a&&(a.comentarios=t.comentarios||[])}onRealizadaChange(){const t=this.form?.controls.meta.value,a=this.form?.controls.realizado.value;if(t&&a){let n=isNaN(a)?0:(a/t*100).toFixed(0)||0;this.form?.controls.progresso_realizado.setValue(n)}}addItemHandleEtiquetas(){let t;if(this.etiqueta&&this.etiqueta.selectedItem){const a=this.etiqueta.selectedItem,n=a.key?.length?a.key:this.util.textHash(a.value);this.util.validateLookupItem(this.formEdit.controls.etiqueta.value,n)&&(t={key:n,value:a.value,color:a.color,icon:a.icon},this.formEdit.controls.etiqueta.setValue(null))}return t}onColumnEtiquetasEdit(t){var a=this;return(0,u.Z)(function*(){if(!a.etiquetasAscendentes.filter(n=>n.data==t.unidade.id).length){let n=yield a.carregaEtiquetasUnidadesAscendentes(t.unidade);a.etiquetasAscendentes.push(...n)}a.formEdit.controls.etiquetas.setValue(t.etiquetas),a.formEdit.controls.etiqueta.setValue(null),a.etiquetas=a.util.merge(t.tipo_atividade?.etiquetas,t.unidade?.etiquetas,(n,i)=>n.key==i.key),a.etiquetas=a.util.merge(a.etiquetas,a.auth.usuario.config?.etiquetas,(n,i)=>n.key==i.key),a.etiquetas=a.util.merge(a.etiquetas,a.etiquetasAscendentes.filter(n=>n.data==t.unidade.id),(n,i)=>n.key==i.key)})()}carregaEtiquetasUnidadesAscendentes(t){var a=this;return(0,u.Z)(function*(){let n=[],i=t.path.split("/");return(yield a.unidadeDao.query({where:[["id","in",i]]}).asPromise()).forEach(g=>{n=a.util.merge(n,g.etiquetas,(_,h)=>_.key==h.key)}),n.forEach(g=>g.data=t.id),n})()}onColumnEtiquetasSave(t){var a=this;return(0,u.Z)(function*(){try{const n=yield a.dao.update(t.id,{etiquetas:a.formEdit.controls.etiquetas.value});return t.etiquetas=a.formEdit.controls.etiquetas.value,!!n}catch{return!1}})()}onEtiquetaConfigClick(){this.go.navigate({route:["configuracoes","preferencia","usuario",this.auth.usuario.id],params:{etiquetas:!0}},{modal:!0,modalClose:t=>{this.etiquetas=this.util.merge(this.etiquetas,this.auth.usuario.config?.etiquetas,(a,n)=>a.key==n.key),this.cdRef.detectChanges()}})}onColumnChecklistEdit(t){var a=this;return(0,u.Z)(function*(){a.formEdit.controls.progresso_realizado.setValue(t.progresso_realizado),a.checklist=a.util.clone(t.checklist)})()}onColumnChecklistSave(t){var a=this;return(0,u.Z)(function*(){let n=Math.round(parseInt(a.planoEntregaService.getValorMeta(t))*a.formEdit.controls.progresso_realizado.value/100);try{const i=yield a.dao.update(t.id,{progresso_realizado:a.formEdit.controls.progresso_realizado.value,realizado:a.planoEntregaService.getEntregaValor(t.entrega,n),checklist:a.checklist});return t.progresso_realizado=a.formEdit.controls.progresso_realizado.value,t.checklist=a.checklist,typeof t.realizado.porcentagem<"u"?t.realizado.porcentagem=n:typeof t.realizado.quantitativo<"u"?t.realizado.quantitativo=n:typeof t.realizado.valor<"u"&&(t.realizado.valor=n),!!i}catch{return!1}})()}getObjetivos(t){return t.objetivos.filter(a=>"DELETE"!=a._status)}static#e=this.\u0275fac=function(a){return new(a||o)(e.Y36(e.zs3))};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["plano-entrega-list-entrega"]],viewQuery:function(a,n){if(1&a&&(e.Gf(U.Q,5),e.Gf(f.M,5),e.Gf(Le,5)),2&a){let i;e.iGM(i=e.CRH())&&(n.editableForm=i.first),e.iGM(i=e.CRH())&&(n.grid=i.first),e.iGM(i=e.CRH())&&(n.etiqueta=i.first)}},inputs:{cdRef:"cdRef",disabled:"disabled",parent:"parent",noPersist:"noPersist",control:"control",entity:"entity",planejamentoId:"planejamentoId",cadeiaValorId:"cadeiaValorId",unidadeId:"unidadeId",dataFim:"dataFim",execucao:"execucao"},features:[e.qOj],decls:25,vars:35,consts:[[3,"items","form","groupTemplate","minHeight","editable","hasAdd","add","hasEdit","load","save","selectable"],["groupEntregas",""],[3,"title","template","editTemplate"],["columnEntregaCliente",""],[3,"title","width","template","editTemplate","columnEditTemplate","edit","save"],["columnEtiquetas",""],["columnEtiquetasEdit",""],["columnDatas",""],[3,"title","width","template","editTemplate"],["columnMetaRealizado",""],["editMetaRealizado",""],[3,"title","width","template","editTemplate","columnEditTemplate","edit","save",4,"ngIf"],["columnEntregaCometario",""],["type","options",3,"onEdit","dynamicButtons","dynamicOptions"],[1,"grid-group-text"],[1,"text-wrap"],["color","primary",3,"label"],[1,"d-block"],["color","light",3,"icon","label",4,"ngIf"],["color","light","icon","bi bi-mailbox",3,"label",4,"ngIf"],["origem","PLANO_ENTREGA_ENTREGA",3,"entity",4,"ngIf"],["color","light",3,"icon","label"],["color","light","icon","bi bi-mailbox",3,"label"],["origem","PLANO_ENTREGA_ENTREGA",3,"entity"],[3,"lookup",4,"ngFor","ngForOf"],[3,"lookup"],["controlName","etiquetas",3,"size","control","addItemHandle"],["controlName","etiqueta","nullable","","itemNull","- Selecione -","detailsButton","","detailsButtonIcon","bi bi-tools",3,"size","control","items","details"],["etiqueta",""],[4,"ngIf"],["icon","bi bi-graph-up-arrow","color","light","hint","Planejada",3,"textValue"],["icon","bi bi-check-lg","color","light","hint","Realizada",3,"textValue"],["icon","bi bi-graph-up-arrow","disabled","","label","Meta",3,"entrega","size","control"],["icon","bi bi-check-lg","label","Realizada",3,"entrega","size","control","change"],["columnProgChecklist",""],["columnChecklistEdit",""],["color","success",3,"value","goal"],["small","","title","Checklist","collapse","",3,"collapsed",4,"ngIf"],["small","","title","Checklist","collapse","",3,"collapsed"],[4,"ngFor","ngForOf"],["class","bi bi-check-circle",4,"ngIf"],[1,"micro-text","fw-ligh"],[1,"bi","bi-check-circle"],["label","Realizado","sufix","%","icon","bi bi-clock","controlName","progresso_realizado","labelInfo","Progresso de execu\xe7\xe3o (% Conclu\xeddo)",3,"size","control"],["small","","title","Checklist",4,"ngIf"],["small","","title","Checklist"],["scale","small",3,"size","source","path"],["color","light","icon","bi bi-list-check",3,"label",4,"ngIf"],["origem","PLANO_ENTREGA_ENTREGA",3,"entity","selectable","grid","save"],["color","light","icon","bi bi-list-check",3,"label"]],template:function(a,n){if(1&a&&(e.TgZ(0,"grid",0),e.YNc(1,we,4,1,"ng-template",null,1,e.W1O),e.TgZ(3,"columns")(4,"column",2),e.YNc(5,Je,6,4,"ng-template",null,3,e.W1O),e.qZA(),e.TgZ(7,"column",4),e.YNc(8,Se,1,1,"ng-template",null,5,e.W1O),e.YNc(10,Ve,3,6,"ng-template",null,6,e.W1O),e.qZA(),e.TgZ(12,"column",2),e.YNc(13,Ge,3,2,"ng-template",null,7,e.W1O),e.qZA(),e.TgZ(15,"column",8),e.YNc(16,Fe,3,2,"ng-template",null,9,e.W1O),e.YNc(18,ke,2,7,"ng-template",null,10,e.W1O),e.qZA(),e.YNc(20,at,5,7,"column",11),e.TgZ(21,"column",2),e.YNc(22,ot,2,5,"ng-template",null,12,e.W1O),e.qZA(),e._UZ(24,"column",13),e.qZA()()),2&a){const i=e.MAs(2),s=e.MAs(6),g=e.MAs(9),_=e.MAs(11),h=e.MAs(14),v=e.MAs(17),M=e.MAs(19),Q=e.MAs(23);e.Q6J("items",n.items)("form",n.form)("groupTemplate",i)("minHeight",300)("editable",n.isDisabled?void 0:"true")("hasAdd",!n.isDisabled&&n.auth.hasPermissionTo("MOD_PENT_ENTR_INCL")&&!n.execucao)("add",n.add.bind(n))("hasEdit",!n.isDisabled&&n.auth.hasPermissionTo("MOD_PENT_ENTR_EDT"))("load",n.load.bind(n))("save",n.save.bind(n))("selectable",n.selectable),e.xp6(4),e.Q6J("title","Entrega\nDemandante/Destinat\xe1rio")("template",s)("editTemplate",s),e.xp6(3),e.Q6J("title","Etiquetas")("width",100)("template",g)("editTemplate",g)("columnEditTemplate",n.selectable?void 0:_)("edit",n.selectable?void 0:n.onColumnEtiquetasEdit.bind(n))("save",n.selectable?void 0:n.onColumnEtiquetasSave.bind(n)),e.xp6(5),e.Q6J("title","Data In\xedcio\nData Fim")("template",h)("editTemplate",h),e.xp6(3),e.Q6J("title","Meta")("width",100)("template",v)("editTemplate",M),e.xp6(5),e.Q6J("ngIf",n.execucao),e.xp6(1),e.Q6J("title",n.lex.translate("Modelo de Entrega")+"\nComent\xe1rios")("template",Q)("editTemplate",Q),e.xp6(3),e.Q6J("onEdit",n.edit.bind(n))("dynamicButtons",n.dynamicButtons.bind(n))("dynamicOptions",n.dynamicOptions.bind(n))}},dependencies:[O.sg,O.O5,f.M,b.a,A.b,oe.a,G.p,ie.p,B.N,y.F,Y.R,H.l,le.C,Ie.y,$],styles:[".objetivo[_ngcontent-%COMP%]{border-bottom:1px solid #ddd;padding:2px 0}"]})}return o})();function it(o,l){if(1&o){const t=e.EpF();e.TgZ(0,"input-switch",24),e.NdJ("change",function(n){e.CHM(t);const i=e.oxw(2);return e.KtG(i.onPrincipaisChange(n))}),e.qZA()}if(2&o){const t=e.oxw(2);e.Q6J("size",2)("control",t.filter.controls.principais)("labelInfo",t.lex.translate("Unidades")+" onde o "+t.lex.translate("usuario")+" \xe9 integrante, incluindo unidades superiores sob sua ger\xeancia.")}}function lt(o,l){if(1&o){const t=e.EpF();e.TgZ(0,"toolbar",21)(1,"input-switch",22),e.NdJ("change",function(n){e.CHM(t);const i=e.oxw();return e.KtG(i.onAgruparChange(n))}),e.qZA(),e.YNc(2,it,1,3,"input-switch",23),e.qZA()}if(2&o){const t=e.oxw();e.Q6J("buttons",t.toolbarButtons),e.xp6(1),e.Q6J("size",3)("control",t.filter.controls.agrupar),e.xp6(1),e.Q6J("ngIf",!t.avaliacao)}}function st(o,l){if(1&o&&(e.TgZ(0,"div")(1,"div",25),e._UZ(2,"input-switch",26)(3,"input-search",27,28)(5,"input-select",29)(6,"input-datetime",30)(7,"input-datetime",31),e.qZA()()),2&o){const t=e.oxw();e.xp6(2),e.Q6J("size",1)("control",t.filter.controls.meus_planos),e.xp6(1),e.Q6J("size",5)("control",t.filter.controls.unidade_id)("dao",t.unidadeDao),e.xp6(2),e.Q6J("size",2)("valueTodos",null)("control",t.filter.controls.data_filtro)("items",t.DATAS_FILTRO),e.xp6(1),e.Q6J("size",2)("disabled",null==t.filter.controls.data_filtro.value?"true":void 0)("control",t.filter.controls.data_filtro_inicio),e.xp6(1),e.Q6J("size",2)("disabled",null==t.filter.controls.data_filtro.value?"true":void 0)("control",t.filter.controls.data_filtro_fim)}}const rt=function(){return["CONCLUIDO","AVALIADO"]};function dt(o,l){if(1&o&&(e.TgZ(0,"div",25),e._UZ(1,"input-switch",26)(2,"input-text",32)(3,"input-search",27,28)(5,"input-select",33)(6,"input-switch",34),e.qZA(),e.TgZ(7,"div",25),e._UZ(8,"input-search",35,36)(10,"input-search",37,38)(12,"input-select",29)(13,"input-datetime",30)(14,"input-datetime",31),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("size",1)("control",t.filter.controls.meus_planos),e.xp6(1),e.Q6J("size",3)("control",t.filter.controls.nome)("placeholder","Nome do "+t.lex.translate("plano de entrega")),e.uIk("maxlength",250),e.xp6(1),e.Q6J("size",4)("control",t.filter.controls.unidade_id)("dao",t.unidadeDao),e.xp6(2),e.Q6J("size",3)("control",t.filter.controls.status)("items",t.lookup.PLANO_ENTREGA_STATUS)("filter",t.avaliacao?e.DdM(32,rt):void 0)("valueTodos",null),e.xp6(1),e.Q6J("size",1)("control",t.filter.controls.arquivadas),e.xp6(2),e.Q6J("size",3)("control",t.filter.controls.planejamento_id)("dao",t.planejamentoDao),e.xp6(2),e.Q6J("size",3)("control",t.filter.controls.cadeia_valor_id)("dao",t.cadeiaValorDao),e.xp6(2),e.Q6J("size",2)("valueTodos",null)("control",t.filter.controls.data_filtro)("items",t.DATAS_FILTRO),e.xp6(1),e.Q6J("size",2)("disabled",null==t.filter.controls.data_filtro.value?"true":void 0)("control",t.filter.controls.data_filtro_inicio),e.xp6(1),e.Q6J("size",2)("disabled",null==t.filter.controls.data_filtro.value?"true":void 0)("control",t.filter.controls.data_filtro_fim)}}function ct(o,l){if(1&o&&(e.TgZ(0,"span",43),e._UZ(1,"i",44),e._uU(2),e.qZA()),2&o){const t=e.oxw().row;e.xp6(2),e.hij(" ",null==t.entregas?null:t.entregas.length,"")}}function ut(o,l){if(1&o&&e.YNc(0,ct,3,1,"span",42),2&o){const t=l.row;e.Q6J("ngIf",null==t.entregas?null:t.entregas.length)}}function gt(o,l){if(1&o&&e._UZ(0,"plano-entrega-list-entrega",45),2&o){const t=l.row,a=e.oxw(2);e.Q6J("parent",a)("disabled",a.avaliacao||!a.botaoAtendeCondicoes(a.BOTAO_ALTERAR,t))("entity",t)("execucao",a.execucao)("cdRef",a.cdRef)("planejamentoId",t.planejamento_id)("cadeiaValorId",t.cadeia_valor_id)("unidadeId",t.unidade_id)}}function _t(o,l){if(1&o&&(e.TgZ(0,"column",39),e.YNc(1,ut,1,1,"ng-template",null,40,e.W1O),e.YNc(3,gt,1,8,"ng-template",null,41,e.W1O),e.qZA()),2&o){const t=e.MAs(2),a=e.MAs(4),n=e.oxw();e.Q6J("align","center")("hint",n.lex.translate("Entrega"))("template",t)("expandTemplate",a)}}function pt(o,l){1&o&&(e.TgZ(0,"order",46),e._uU(1,"#ID"),e.qZA()),2&o&&e.Q6J("header",l.header)}function mt(o,l){if(1&o&&(e.TgZ(0,"small",47),e._uU(1),e.qZA()),2&o){const t=l.row;e.xp6(1),e.hij("#",t.numero,"")}}function ht(o,l){if(1&o&&(e.TgZ(0,"order",48),e._uU(1,"Nome"),e.qZA(),e._UZ(2,"br"),e._uU(3)),2&o){const t=l.header,a=e.oxw();e.Q6J("header",t),e.xp6(3),e.hij(" Programa",a.filter.controls.agrupar.value?"":" - Unidade"," ")}}function ft(o,l){if(1&o&&e._UZ(0,"badge",52),2&o){const t=e.oxw().row,a=e.oxw();e.Q6J("icon",a.entityService.getIcon("Programa"))("label",t.programa.nome)}}function bt(o,l){if(1&o&&e._UZ(0,"badge",53),2&o){const t=e.oxw().row,a=e.oxw();e.Q6J("icon",a.entityService.getIcon(a.lex.translate("unidade")))("label",t.unidade.sigla)}}function vt(o,l){if(1&o&&(e.TgZ(0,"span",49),e._uU(1),e.qZA(),e._UZ(2,"br"),e.YNc(3,ft,1,2,"badge",50),e.YNc(4,bt,1,2,"badge",51)),2&o){const t=l.row,a=e.oxw();e.Udp("max-width",400,"px"),e.xp6(1),e.Oqu(t.nome||""),e.xp6(2),e.Q6J("ngIf",t.programa),e.xp6(1),e.Q6J("ngIf",!a.filter.controls.agrupar.value&&t.unidade)}}function Et(o,l){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=l.row,a=e.oxw();e.xp6(1),e.hij(" ",a.dao.getDateFormatted(t.data_inicio),"")}}function At(o,l){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=l.row,a=e.oxw();e.xp6(1),e.hij(" ",a.dao.getDateFormatted(t.data_fim),"")}}function Tt(o,l){1&o&&(e._uU(0," Planejamento Institucional"),e._UZ(1,"br"),e._uU(2," Cadeia de Valor "))}function Ot(o,l){if(1&o&&e._UZ(0,"badge",55),2&o){const t=e.oxw().row,a=e.oxw();e.Q6J("maxWidth",300)("icon",a.entityService.getIcon("Planejamento"))("label",null==t.planejamento?null:t.planejamento.nome)}}function Ct(o,l){if(1&o&&e._UZ(0,"badge",55),2&o){const t=e.oxw().row,a=e.oxw();e.Q6J("maxWidth",300)("icon",a.entityService.getIcon("CadeiaValor"))("label",null==t.cadeia_valor?null:t.cadeia_valor.nome)}}function It(o,l){if(1&o&&(e.YNc(0,Ot,1,3,"badge",54),e.YNc(1,Ct,1,3,"badge",54)),2&o){const t=l.row;e.Q6J("ngIf",t.planejamento),e.xp6(1),e.Q6J("ngIf",t.cadeia_valor)}}function Pt(o,l){1&o&&e._UZ(0,"badge",60)}function Zt(o,l){1&o&&e._UZ(0,"badge",61)}function Dt(o,l){if(1&o&&e._UZ(0,"avaliar-nota-badge",62),2&o){const t=e.oxw().row;e.Q6J("align","left")("tipoAvaliacao",t.avaliacao.tipo_avaliacao)("nota",t.avaliacao.nota)}}function xt(o,l){if(1&o&&(e._UZ(0,"badge",56)(1,"br"),e.YNc(2,Pt,1,0,"badge",57),e.YNc(3,Zt,1,0,"badge",58),e.YNc(4,Dt,1,3,"avaliar-nota-badge",59)),2&o){const t=l.row,a=e.oxw();e.Q6J("color",a.lookup.getColor(a.lookup.PLANO_ENTREGA_STATUS,t.status))("icon",a.lookup.getIcon(a.lookup.PLANO_ENTREGA_STATUS,t.status))("label",a.lookup.getValue(a.lookup.PLANO_ENTREGA_STATUS,t.status)),e.xp6(2),e.Q6J("ngIf",t.data_arquivamento),e.xp6(1),e.Q6J("ngIf",t.deleted_at),e.xp6(1),e.Q6J("ngIf",t.avaliacao)}}let Nt=(()=>{class o extends d.E{constructor(t){super(t,V,Z.r),this.injector=t,this.showFilter=!0,this.avaliacao=!1,this.execucao=!1,this.habilitarAdesaoToolbar=!1,this.toolbarButtons=[],this.botoes=[],this.routeStatus={route:["uteis","status"]},this.DATAS_FILTRO=[{key:"VIGENTE",value:"Vigente"},{key:"NAOVIGENTE",value:"N\xe3o vigente"},{key:"INICIAM",value:"Iniciam"},{key:"FINALIZAM",value:"Finalizam"}],this.storeFilter=a=>{const n=a?.value;return{meus_planos:n.meus_planos,arquivadas:n.arquivadas,unidade_id:n.unidade_id}},this.filterValidate=(a,n)=>{let i=null;return"data_filtro_inicio"==n&&a.value>this.filter?.controls.data_filtro_fim.value?i="Maior que fim":"data_filtro_fim"==n&&a.value<this.filter?.controls.data_filtro_inicio.value&&(i="Menor que in\xedcio"),i},this.filterWhere=a=>{let n=[],i=a.value;if(this.filter?.controls.principais.value){console.log("princi");let s=["unidade_id","in",(this.auth.unidades||[]).map(g=>g.id)];if(this.auth.isGestorAlgumaAreaTrabalho()){let g=this.auth.unidades?.filter(v=>this.unidadeService.isGestorUnidade(v)),_=g?.map(v=>v.unidade_pai?.id||"").filter(v=>v.length);_?.length&&s[2].push(..._);let h=["unidade.unidade_pai_id","in",g?.map(v=>v.id)];n.push(["or",s,h])}else n.push(s)}if(this.filter?.controls.meus_planos.value){let s=["unidade_id","in",(this.auth.unidades||[]).map(g=>g.id)];n.push(s)}return i.nome?.length&&n.push(["nome","like","%"+i.nome.trim().replace(" ","%")+"%"]),i.data_filtro&&(n.push(["data_filtro","==",i.data_filtro]),n.push(["data_filtro_inicio","==",i.data_filtro_inicio]),n.push(["data_filtro_fim","==",i.data_filtro_fim])),i.unidade_id&&n.push(["unidade_id","==",i.unidade_id]),i.unidade_id||n.push(["unidades_vinculadas","==",this.auth.unidade?.id]),i.planejamento_id&&n.push(["planejamento_id","==",i.planejamento_id]),i.cadeia_valor_id&&n.push(["cadeia_valor_id","==",i.cadeia_valor_id]),this.isModal?n.push(["status","==","ATIVO"]):(i.status||this.avaliacao)&&n.push(["status","in",i.status?[i.status]:["CONCLUIDO","AVALIADO"]]),n.push(["incluir_arquivados","==",this.filter.controls.arquivadas.value]),n},this.avaliacaoDao=t.get(p.w),this.unidadeDao=t.get(N.J),this.planejamentoDao=t.get(I.U),this.cadeiaValorDao=t.get(D.m),this.planoEntregaService=t.get(c.f),this.unidadeService=t.get(T.Z),this.unidadeSelecionada=this.auth.unidade,this.code="MOD_PLANE",this.title=this.lex.translate("Planos de Entregas"),this.filter=this.fh.FormBuilder({agrupar:{default:!0},principais:{default:!1},arquivadas:{default:!1},nome:{default:""},data_filtro:{default:null},data_filtro_inicio:{default:new Date},data_filtro_fim:{default:new Date},status:{default:""},unidade_id:{default:null},unidades_filhas:{default:!1},planejamento_id:{default:null},cadeia_valor_id:{default:null},meus_planos:{default:!0}},this.cdRef,this.filterValidate),this.join=["planejamento:id,nome","programa:id,nome","cadeia_valor:id,nome","unidade:id,sigla,path","entregas.entrega","entregas.objetivos.objetivo","entregas.processos.processo","entregas.unidade","entregas.comentarios.usuario:id,nome,apelido","entregas.reacoes.usuario:id,nome,apelido","unidade.gestor:id","unidade.gestores_substitutos:id","unidade.unidade_pai","avaliacao"],this.groupBy=[{field:"unidade.sigla",label:"Unidade"}],this.BOTAO_ADERIR_OPTION={label:"Aderir",icon:this.entityService.getIcon("Adesao"),onClick:(()=>{this.go.navigate({route:["gestao","plano-entrega","adesao"]},{metadata:{planoEntrega:this.linha},modalClose:a=>{this.refresh()}})}).bind(this)},this.BOTAO_ADERIR_TOOLBAR={label:"Aderir",disabled:!this.habilitarAdesaoToolbar,icon:this.entityService.getIcon("Adesao"),onClick:(()=>{this.go.navigate({route:["gestao","plano-entrega","adesao"]},{modalClose:a=>{this.refresh()}})}).bind(this)},this.BOTAO_ALTERAR={label:"Alterar",icon:"bi bi-pencil-square",color:"btn-outline-info",onClick:a=>this.go.navigate({route:["gestao","plano-entrega",a.id,"edit"]},this.modalRefreshId(a))},this.BOTAO_ARQUIVAR={label:"Arquivar",icon:"bi bi-inboxes",onClick:this.arquivar.bind(this)},this.BOTAO_AVALIAR={label:"Avaliar",icon:this.lookup.getIcon(this.lookup.PLANO_ENTREGA_STATUS,"AVALIADO"),color:this.lookup.getColor(this.lookup.PLANO_ENTREGA_STATUS,"AVALIADO"),onClick:this.avaliar.bind(this)},this.BOTAO_CANCELAR_PLANO={label:"Cancelar plano",icon:this.lookup.getIcon(this.lookup.PLANO_ENTREGA_STATUS,"CANCELADO"),color:this.lookup.getColor(this.lookup.PLANO_ENTREGA_STATUS,"CANCELADO"),onClick:this.cancelarPlano.bind(this)},this.BOTAO_CANCELAR_AVALIACAO={label:"Cancelar avalia\xe7\xe3o",icon:this.lookup.getIcon(this.lookup.PLANO_ENTREGA_STATUS,"CONCLUIDO"),color:this.lookup.getColor(this.lookup.PLANO_ENTREGA_STATUS,"CANCELADO"),onClick:this.cancelarAvaliacao.bind(this)},this.BOTAO_CANCELAR_CONCLUSAO={label:"Cancelar conclus\xe3o",icon:this.lookup.getIcon(this.lookup.PLANO_ENTREGA_STATUS,"ATIVO"),color:this.lookup.getColor(this.lookup.PLANO_ENTREGA_STATUS,"ATIVO"),onClick:this.cancelarConclusao.bind(this)},this.BOTAO_CANCELAR_HOMOLOGACAO={label:"Cancelar homologa\xe7\xe3o",icon:this.lookup.getIcon(this.lookup.PLANO_ENTREGA_STATUS,"HOMOLOGANDO"),color:this.lookup.getColor(this.lookup.PLANO_ENTREGA_STATUS,"HOMOLOGANDO"),onClick:this.cancelarHomologacao.bind(this)},this.BOTAO_CONCLUIR={label:"Concluir",id:"CONCLUIDO",icon:this.lookup.getIcon(this.lookup.PLANO_ENTREGA_STATUS,"CONCLUIDO"),color:this.lookup.getColor(this.lookup.PLANO_ENTREGA_STATUS,"CONCLUIDO"),onClick:this.concluir.bind(this)},this.BOTAO_CONSULTAR={label:"Informa\xe7\xf5es",icon:"bi bi-info-circle",onClick:a=>this.go.navigate({route:["gestao","plano-entrega",a.id,"consult"]},{modal:!0})},this.BOTAO_DESARQUIVAR={label:"Desarquivar",icon:"bi bi-reply",onClick:this.desarquivar.bind(this)},this.BOTAO_EXCLUIR={label:"Excluir",icon:"bi bi-trash",onClick:this.delete.bind(this)},this.BOTAO_HOMOLOGAR={label:"Homologar",icon:this.lookup.getIcon(this.lookup.PLANO_ENTREGA_STATUS,"ATIVO"),color:this.lookup.getColor(this.lookup.PLANO_ENTREGA_STATUS,"ATIVO"),onClick:this.homologar.bind(this)},this.BOTAO_LIBERAR_HOMOLOGACAO={label:"Liberar para homologa\xe7\xe3o",icon:this.lookup.getIcon(this.lookup.PLANO_ENTREGA_STATUS,"HOMOLOGANDO"),color:this.lookup.getColor(this.lookup.PLANO_ENTREGA_STATUS,"HOMOLOGANDO"),onClick:this.liberarHomologacao.bind(this)},this.BOTAO_LOGS={label:"Logs",icon:this.lookup.getIcon(this.lookup.PLANO_ENTREGA_STATUS,"INCLUIDO"),color:this.lookup.getColor(this.lookup.PLANO_ENTREGA_STATUS,"INCLUIDO"),onClick:a=>this.go.navigate({route:["logs","change",a.id,"consult"]})},this.BOTAO_REATIVAR={label:"Reativar",icon:this.lookup.getIcon(this.lookup.PLANO_ENTREGA_STATUS,"ATIVO"),color:this.lookup.getColor(this.lookup.PLANO_ENTREGA_STATUS,"ATIVO"),onClick:this.reativar.bind(this)},this.BOTAO_RETIRAR_HOMOLOGACAO={label:"Retirar de homologa\xe7\xe3o",icon:this.lookup.getIcon(this.lookup.PLANO_ENTREGA_STATUS,"INCLUIDO"),color:this.lookup.getColor(this.lookup.PLANO_ENTREGA_STATUS,"INCLUIDO"),onClick:this.retirarHomologacao.bind(this)},this.BOTAO_SUSPENDER={label:"Suspender",id:"PAUSADO",icon:this.lookup.getIcon(this.lookup.PLANO_ENTREGA_STATUS,"SUSPENSO"),color:this.lookup.getColor(this.lookup.PLANO_ENTREGA_STATUS,"SUSPENSO"),onClick:this.suspender.bind(this)},this.botoes=[this.BOTAO_ALTERAR,this.BOTAO_ARQUIVAR,this.BOTAO_AVALIAR,this.BOTAO_CANCELAR_PLANO,this.BOTAO_CANCELAR_AVALIACAO,this.BOTAO_CANCELAR_CONCLUSAO,this.BOTAO_CANCELAR_HOMOLOGACAO,this.BOTAO_CONCLUIR,this.BOTAO_CONSULTAR,this.BOTAO_DESARQUIVAR,this.BOTAO_EXCLUIR,this.BOTAO_HOMOLOGAR,this.BOTAO_LIBERAR_HOMOLOGACAO,this.BOTAO_LOGS,this.BOTAO_REATIVAR,this.BOTAO_RETIRAR_HOMOLOGACAO,this.BOTAO_SUSPENDER]}ngOnInit(){super.ngOnInit(),this.execucao=!!this.queryParams?.execucao,this.avaliacao=!!this.queryParams?.avaliacao,this.showFilter=!(typeof this.queryParams?.showFilter<"u")||"true"==this.queryParams.showFilter,this.selectable=this.metadata?.selectable||this.selectable,this.execucao&&(this.title=this.title+" (Execu\xe7\xe3o)",this.filter.controls.unidade_id.setValue(this.auth.unidadeGestor()?.id||null),this.filter.controls.principais.setValue(!1)),this.avaliacao&&(this.title=this.title+" (Avalia\xe7\xe3o)",this.filter.controls.unidade_id.setValue(this.auth.unidadeGestor()?.id||null),this.filter.controls.unidades_filhas.setValue(!0),this.filter.controls.principais.setValue(!1)),this.checaBotaoAderirToolbar()}ngAfterContentChecked(){this.auth.unidade!=this.unidadeSelecionada&&(this.unidadeSelecionada=this.auth.unidade,this.checaBotaoAderirToolbar(),this.cdRef.detectChanges())}onGridLoad(t){const a=(this.grid?.query||this.query).extra;t&&this.execucao&&t.forEach(n=>{["ATIVO","SUSPENSO"].includes(n.status)&&this.grid.expand(n.id)}),t?.forEach(n=>{let i=n;i.avaliacao&&(i.avaliacao.tipo_avaliacao=a?.tipos_avaliacoes?.find(s=>s.id==i.avaliacao.tipo_avaliacao_id))})}checaBotaoAderirToolbar(){}planosEntregasAtivosUnidadePai(){return this.auth.unidade?.unidade_pai?.planos_entrega?.filter(t=>this.planoEntregaService.isAtivo(t))||[]}planosEntregasAtivosUnidadeSelecionada(){return this.auth?.unidade?.planos_entrega?.filter(t=>this.planoEntregaService.isAtivo(t))||[]}filterClear(t){t.controls.nome.setValue(""),t.controls.data_filtro.setValue(null),t.controls.data_filtro_inicio.setValue(new Date),t.controls.data_filtro_fim.setValue(new Date),t.controls.unidade_id.setValue(null),t.controls.planejamento_id.setValue(null),t.controls.cadeia_valor_id.setValue(null),t.controls.status.setValue(null),t.controls.meus_planos.setValue(!1),super.filterClear(t)}onAgruparChange(t){const a=this.filter.controls.agrupar.value;(a&&!this.groupBy?.length||!a&&this.groupBy?.length)&&(this.groupBy=a?[{field:"unidade.sigla",label:"Unidade"}]:[],this.cdRef.detectChanges(),this.grid.reloadFilter())}onPrincipaisChange(t){this.filter.controls.principais.value?(this.filter.controls.unidade_id.setValue(null),this.filter.controls.meus_planos.setValue(!1)):this.filter.controls.meus_planos.setValue(!0),this.grid.reloadFilter()}dynamicButtons(t){let a=[];switch(this.planoEntregaService.situacaoPlano(t)){case"INCLUIDO":this.botaoAtendeCondicoes(this.BOTAO_LIBERAR_HOMOLOGACAO,t)?a.push(this.BOTAO_LIBERAR_HOMOLOGACAO):a.push(this.BOTAO_CONSULTAR);break;case"HOMOLOGANDO":this.botaoAtendeCondicoes(this.BOTAO_HOMOLOGAR,t)&&a.push(this.BOTAO_HOMOLOGAR);break;case"ATIVO":this.botaoAtendeCondicoes(this.BOTAO_CONCLUIR,t)&&a.push(this.BOTAO_CONCLUIR);break;case"CONCLUIDO":this.botaoAtendeCondicoes(this.BOTAO_AVALIAR,t)&&a.push(this.BOTAO_AVALIAR);break;case"SUSPENSO":this.botaoAtendeCondicoes(this.BOTAO_REATIVAR,t)&&a.push(this.BOTAO_REATIVAR);break;case"AVALIADO":this.botaoAtendeCondicoes(this.BOTAO_ARQUIVAR,t)&&a.push(this.BOTAO_ARQUIVAR);break;case"ARQUIVADO":this.botaoAtendeCondicoes(this.BOTAO_DESARQUIVAR,t)&&a.push(this.BOTAO_DESARQUIVAR)}return a.length||a.push(this.BOTAO_CONSULTAR),a}dynamicOptions(t){let a=[];return this.linha=t,this.botoes.forEach(n=>{this.botaoAtendeCondicoes(n,t)&&a.push(n)}),a}botaoAtendeCondicoes(t,a){switch(t){case this.BOTAO_ADERIR_OPTION:return!this.execucao&&"ATIVO"==this.planoEntregaService.situacaoPlano(a)&&a.unidade_id==this.auth.unidade?.unidade_pai_id&&(this.unidadeService.isGestorUnidade()||this.auth.isLotacaoUsuario(this.auth.unidade)&&this.auth.hasPermissionTo("MOD_PENT_ADR"))&&0==this.planosEntregasAtivosUnidadeSelecionada().filter(Oe=>this.util.intersection([{start:Oe.data_inicio,end:Oe.data_fim},{start:a.data_inicio,end:a.data_fim}])).length;case this.BOTAO_ALTERAR:let n=["INCLUIDO","HOMOLOGANDO","ATIVO"].includes(this.planoEntregaService.situacaoPlano(a)),i=["INCLUIDO","HOMOLOGANDO"].includes(this.planoEntregaService.situacaoPlano(a))&&(this.unidadeService.isGestorUnidade(a.unidade)||this.auth.isLotacaoUsuario(a.unidade)),s=this.unidadeService.isGestorUnidade(1==a.unidade?.instituidora?a.unidade?.id:a.unidade?.unidade_pai_id)&&this.auth.hasPermissionTo("MOD_PENT_EDT_FLH"),g=this.auth.isIntegrante("HOMOLOGADOR_PLANO_ENTREGA",a.unidade.unidade_pai_id),_="ATIVO"==this.planoEntregaService.situacaoPlano(a)&&this.auth.isLotacaoUsuario(a.unidade)&&this.auth.hasPermissionTo(["MOD_PENT_EDT_ATV_HOMOL","MOD_PENT_EDT_ATV_ATV"]),h=this.auth.hasPermissionTo("MOD_PENT_QQR_UND");return!this.execucao&&this.auth.hasPermissionTo("MOD_PENT_EDT")&&n&&this.planoEntregaService.isValido(a)&&(i||s||g||_||h);case this.BOTAO_ARQUIVAR:return["CONCLUIDO","AVALIADO"].includes(this.planoEntregaService.situacaoPlano(a))&&(this.unidadeService.isGestorUnidade(a.unidade)||this.auth.isLotacaoUsuario(a.unidade)&&this.auth.hasPermissionTo("MOD_PENT_ARQ"));case this.BOTAO_AVALIAR:let v=this.unidadeService.isGestorUnidade(1==a.unidade?.instituidora?a.unidade?.id:a.unidade?.unidade_pai_id),M=this.auth.isLotacaoUsuario(a.unidade?.unidade_pai)&&this.auth.hasPermissionTo("MOD_PENT_AVAL"),Q=this.auth.isGestorLinhaAscendente(a.unidade)&&this.auth.hasPermissionTo("MOD_PENT_AVAL_SUBORD");return"CONCLUIDO"==this.planoEntregaService.situacaoPlano(a)&&(v||M||Q);case this.BOTAO_CANCELAR_AVALIACAO:return"AVALIADO"==this.planoEntregaService.situacaoPlano(a)&&(1==a.unidade?.instituidora?this.unidadeService.isGestorUnidade(a.unidade?.id):this.unidadeService.isGestorUnidade(a.unidade?.unidade_pai_id)||this.auth.isIntegrante("AVALIADOR_PLANO_ENTREGA",a.unidade.id));case this.BOTAO_CANCELAR_CONCLUSAO:return"CONCLUIDO"==this.planoEntregaService.situacaoPlano(a)&&(this.unidadeService.isGestorUnidade(a.unidade)||this.auth.isLotacaoUsuario(a.unidade)&&this.auth.hasPermissionTo("MOD_PENT_CANC_CONCL"));case this.BOTAO_CANCELAR_HOMOLOGACAO:return!this.execucao&&"ATIVO"==this.planoEntregaService.situacaoPlano(a)&&(1==a.unidade?.instituidora?this.unidadeService.isGestorUnidade(a.unidade?.id):this.unidadeService.isGestorUnidade(a.unidade?.unidade_pai_id)||this.auth.isLotacaoUsuario(a.unidade?.unidade_pai)&&this.auth.hasPermissionTo("MOD_PENT_CANC_HOMOL")||this.auth.isIntegrante("HOMOLOGADOR_PLANO_ENTREGA",a.unidade.unidade_pai_id));case this.BOTAO_CANCELAR_PLANO:return this.auth.hasPermissionTo("MOD_PENT_CNC")&&["INCLUIDO","HOMOLOGANDO","ATIVO"].includes(this.planoEntregaService.situacaoPlano(a))&&(this.unidadeService.isGestorUnidade(a.unidade?.id)||this.unidadeService.isGestorUnidade(a.unidade?.unidade_pai_id));case this.BOTAO_CONCLUIR:return"ATIVO"==this.planoEntregaService.situacaoPlano(a)&&(this.unidadeService.isGestorUnidade(a.unidade)||this.auth.isLotacaoUsuario(a.unidade)&&this.auth.hasPermissionTo("MOD_PENT_CONC"));case this.BOTAO_CONSULTAR:return this.auth.hasPermissionTo("MOD_PENT");case this.BOTAO_DESARQUIVAR:return"ARQUIVADO"==this.planoEntregaService.situacaoPlano(a)&&(this.unidadeService.isGestorUnidade(a.unidade)||this.auth.isLotacaoUsuario(a.unidade)&&this.auth.hasPermissionTo("MOD_PENT_ARQ"));case this.BOTAO_EXCLUIR:return!this.execucao&&this.auth.hasPermissionTo("MOD_PENT_EXCL")&&["INCLUIDO","HOMOLOGANDO"].includes(this.planoEntregaService.situacaoPlano(a))&&(this.unidadeService.isGestorUnidade(a.unidade)||this.auth.isLotacaoUsuario(a.unidade));case this.BOTAO_HOMOLOGAR:let te="HOMOLOGANDO"==this.planoEntregaService.situacaoPlano(a),ae=this.unidadeService.isGestorUnidade(1==a.unidade?.instituidora?a.unidade?.id:a.unidade?.unidade_pai_id),fo=this.auth.isLotacaoUsuario(a.unidade.unidade_pai)&&this.auth.hasPermissionTo("MOD_PENT_HOMOL"),bo=this.auth.isIntegrante("HOMOLOGADOR_PLANO_ENTREGA",a.unidade.unidade_pai_id);return!this.execucao&&te&&(ae||fo||bo);case this.BOTAO_LIBERAR_HOMOLOGACAO:return!this.execucao&&"INCLUIDO"==this.planoEntregaService.situacaoPlano(a)&&a.entregas.length>0&&(this.unidadeService.isGestorUnidade(a.unidade)||this.auth.isLotacaoUsuario(a.unidade)&&this.auth.hasPermissionTo("MOD_PENT_LIB_HOMOL"));case this.BOTAO_LOGS:return this.unidadeService.isGestorUnidade(a.unidade)&&this.auth.hasPermissionTo("MOD_PENT_AVAL_SUBORD");case this.BOTAO_REATIVAR:return"SUSPENSO"==this.planoEntregaService.situacaoPlano(a)&&(this.unidadeService.isGestorUnidade(a.unidade)||this.auth.isLotacaoUsuario(a.unidade)&&this.auth.hasPermissionTo("MOD_PENT_RTV")||this.auth.isGestorLinhaAscendente(a.unidade));case this.BOTAO_RETIRAR_HOMOLOGACAO:return!this.execucao&&"HOMOLOGANDO"==this.planoEntregaService.situacaoPlano(a)&&(this.unidadeService.isGestorUnidade(a.unidade)||this.auth.isLotacaoUsuario(a.unidade)&&this.auth.hasPermissionTo("MOD_PENT_RET_HOMOL"));case this.BOTAO_SUSPENDER:return"ATIVO"==this.planoEntregaService.situacaoPlano(a)&&(this.unidadeService.isGestorUnidade(a.unidade)||this.auth.isLotacaoUsuario(a.unidade)&&this.auth.hasPermissionTo("MOD_PENT_SUSP")||this.auth.isGestorLinhaAscendente(a.unidade))}return!1}arquivar(t){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoEntrega",entity:Object.assign({},t,{arquivar:!0}),novoStatus:t.status,onClick:this.dao.arquivar.bind(this.dao)},title:"Arquivar Plano de Entregas",modalClose:a=>{a&&(this.grid?.query||this.query).refreshId(t.id).then(()=>{this.checaBotaoAderirToolbar()})}})}avaliar(t){this.go.navigate({route:["gestao","plano-entrega",t.id,"avaliar"]},{modal:!0,metadata:{planoEntrega:t},modalClose:a=>{a&&(this.grid?.query||this.query).refreshId(t.id,["avaliacao.tipo_avaliacao.notas"]).then(()=>{this.checaBotaoAderirToolbar()})}})}cancelarAvaliacao(t){var a=this;return(0,u.Z)(function*(){a.submitting=!0;try{(yield a.avaliacaoDao.cancelarAvaliacao(t.avaliacao.id))&&(a.grid?.query||a.query).refreshId(t.id).then(()=>{a.checaBotaoAderirToolbar()})}catch(n){a.error(n.message||n)}finally{a.submitting=!1}})()}cancelarConclusao(t){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoEntrega",entity:t,novoStatus:"ATIVO",onClick:this.dao.cancelarConclusao.bind(this.dao)},title:"Cancelar Conclus\xe3o",modalClose:a=>{a&&(this.grid?.query||this.query).refreshId(t.id).then(()=>{this.checaBotaoAderirToolbar()})}})}cancelarHomologacao(t){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoEntrega",entity:t,novoStatus:"HOMOLOGANDO",onClick:this.dao.cancelarHomologacao.bind(this.dao)},title:"Cancelar Homologa\xe7\xe3o",modalClose:a=>{a&&(this.grid?.query||this.query).refreshId(t.id).then(()=>{this.checaBotaoAderirToolbar()})}})}cancelarPlano(t){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoEntrega",entity:Object.assign({},t,{arquivar:!0}),novoStatus:"CANCELADO",onClick:this.dao.cancelarPlano.bind(this.dao)},title:"Cancelar Plano de Entregas",modalClose:a=>{a&&(this.grid?.query||this.query).refreshId(t.id).then(()=>{this.checaBotaoAderirToolbar()})}})}concluir(t){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoEntrega",entity:t,novoStatus:"CONCLUIDO",onClick:this.dao.concluir.bind(this.dao)},title:"Concluir Plano de Entregas",modalClose:a=>{a&&(this.grid?.query||this.query).refreshId(t.id).then(()=>{this.checaBotaoAderirToolbar()})}})}desarquivar(t){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoEntrega",entity:Object.assign({},t,{arquivar:!1}),novoStatus:t.status,onClick:this.dao.arquivar.bind(this.dao)},title:"Desarquivar Plano de Entregas",modalClose:a=>{a&&(this.grid?.query||this.query).refreshId(t.id).then(()=>{this.checaBotaoAderirToolbar()})}})}homologar(t){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoEntrega",entity:t,novoStatus:"ATIVO",onClick:this.dao.homologar.bind(this.dao)},title:"Homologar Plano de Entregas",modalClose:a=>{a&&(this.grid?.query||this.query).refreshId(t.id).then(()=>{this.checaBotaoAderirToolbar()})}})}liberarHomologacao(t){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoEntrega",entity:t,novoStatus:"HOMOLOGANDO",onClick:this.dao.liberarHomologacao.bind(this.dao)},title:"Liberar para Homologa\xe7\xe3o",modalClose:a=>{a&&(this.grid?.query||this.query).refreshId(t.id).then(()=>{this.checaBotaoAderirToolbar()})}})}reativar(t){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoEntrega",entity:t,novoStatus:"ATIVO",onClick:this.dao.reativar.bind(this.dao)},title:"Reativar Plano de Entregas",modalClose:a=>{a&&(this.grid?.query||this.query).refreshId(t.id).then(()=>{this.checaBotaoAderirToolbar()})}})}retirarHomologacao(t){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoEntrega",entity:t,novoStatus:"INCLUIDO",onClick:this.dao.retirarHomologacao.bind(this.dao)},title:"Retirar de Homologa\xe7\xe3o",modalClose:a=>{a&&(this.grid?.query||this.query).refreshId(t.id).then(()=>{this.checaBotaoAderirToolbar()})}})}suspender(t){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoEntrega",entity:t,novoStatus:"SUSPENSO",onClick:this.dao.suspender.bind(this.dao)},title:"Suspender Plano de Entregas",modalClose:a=>{a&&(this.grid?.query||this.query).refreshId(t.id).then(()=>{this.checaBotaoAderirToolbar()})}})}canAdd(){return this.auth.hasPermissionTo("MOD_PENT_INCL")}static#e=this.\u0275fac=function(a){return new(a||o)(e.Y36(e.zs3))};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["plano-entrega-list"]],viewQuery:function(a,n){if(1&a&&e.Gf(f.M,5),2&a){let i;e.iGM(i=e.CRH())&&(n.grid=i.first)}},features:[e.qOj],decls:34,vars:35,consts:[[3,"dao","add","title","orderBy","groupBy","join","selectable","hasAdd","hasEdit","loadList","select"],[3,"buttons",4,"ngIf"],[3,"deleted","form","where","submit","clear","collapseChange","collapsed","visible"],[4,"ngIf","ngIfElse"],["naoEModal",""],["type","expand","icon","bi bi-list-check",3,"align","hint","template","expandTemplate",4,"ngIf"],[3,"titleTemplate","template"],["titleIdNumeroStatus",""],["columnNumero",""],["titleNomeProgramaUnidade",""],["columnNome",""],["title","In\xedcio","orderBy","data_inicio",3,"template"],["columnInicio",""],["title","Fim","orderBy","data_fim",3,"template"],["columnFim",""],["titlePlanoCadeia",""],["columnPlanoCadeia",""],[3,"title","template"],["columnStatus",""],["type","options",3,"dynamicOptions","dynamicButtons"],[3,"rows"],[3,"buttons"],["labelPosition","left","label","Agrupar por unidade","controlName","agrupar",3,"size","control","change"],["labelPosition","left","label","Vinculados","controlName","principais",3,"size","control","labelInfo","change",4,"ngIf"],["labelPosition","left","label","Vinculados","controlName","principais",3,"size","control","labelInfo","change"],[1,"row"],["label","Meus","controlName","meus_planos","labelInfo","Planos de entrega das unidade da qual sou integrante (\xc1reas de trabalho)",3,"size","control"],["controlName","unidade_id",3,"size","control","dao"],["unidade",""],["label","Data","itemTodos","- Nenhum -","controlName","data_filtro",3,"size","valueTodos","control","items"],["date","","label","In\xedcio","controlName","data_filtro_inicio","labelInfo","Data in\xedcio do per\xedodo",3,"size","disabled","control"],["date","","label","Fim","controlName","data_filtro_fim","labelInfo","Data fim do per\xedodo",3,"size","disabled","control"],["label","Nome","controlName","nome",3,"size","control","placeholder"],["label","Status","controlName","status","itemTodos","- Todos -",3,"size","control","items","filter","valueTodos"],["label","Arquivados","controlName","arquivadas","labelInfo","Listar tamb\xe9m os planos de entregas arquivados",3,"size","control"],["controlName","planejamento_id",3,"size","control","dao"],["planejamento",""],["controlName","cadeia_valor_id",3,"size","control","dao"],["cadeiaValor",""],["type","expand","icon","bi bi-list-check",3,"align","hint","template","expandTemplate"],["columnEntregas",""],["columnExpandedEntregas",""],["class","badge rounded-pill bg-light text-dark",4,"ngIf"],[1,"badge","rounded-pill","bg-light","text-dark"],[1,"bi","bi-list-check"],[3,"parent","disabled","entity","execucao","cdRef","planejamentoId","cadeiaValorId","unidadeId"],["by","numero",3,"header"],[1,"micro-text","fw-ligh"],["by","nome",3,"header"],[1,"text-break","text-wrap"],["color","light",3,"icon","label",4,"ngIf"],["color","secondary",3,"icon","label",4,"ngIf"],["color","light",3,"icon","label"],["color","secondary",3,"icon","label"],["color","light",3,"maxWidth","icon","label",4,"ngIf"],["color","light",3,"maxWidth","icon","label"],[3,"color","icon","label"],["color","warning","icon","bi bi-inboxes","label","Arquivado",4,"ngIf"],["color","danger","icon","bi bi-trash3","label","Exclu\xeddo",4,"ngIf"],[3,"align","tipoAvaliacao","nota",4,"ngIf"],["color","warning","icon","bi bi-inboxes","label","Arquivado"],["color","danger","icon","bi bi-trash3","label","Exclu\xeddo"],[3,"align","tipoAvaliacao","nota"]],template:function(a,n){if(1&a&&(e.TgZ(0,"grid",0),e.NdJ("select",function(s){return n.onSelect(s)}),e.YNc(1,lt,3,4,"toolbar",1),e.TgZ(2,"filter",2),e.YNc(3,st,8,15,"div",3),e.YNc(4,dt,15,33,"ng-template",null,4,e.W1O),e.qZA(),e.TgZ(6,"columns"),e.YNc(7,_t,5,4,"column",5),e.TgZ(8,"column",6),e.YNc(9,pt,2,1,"ng-template",null,7,e.W1O),e.YNc(11,mt,2,1,"ng-template",null,8,e.W1O),e.qZA(),e.TgZ(13,"column",6),e.YNc(14,ht,4,2,"ng-template",null,9,e.W1O),e.YNc(16,vt,5,5,"ng-template",null,10,e.W1O),e.qZA(),e.TgZ(18,"column",11),e.YNc(19,Et,2,1,"ng-template",null,12,e.W1O),e.qZA(),e.TgZ(21,"column",13),e.YNc(22,At,2,1,"ng-template",null,14,e.W1O),e.qZA(),e.TgZ(24,"column",6),e.YNc(25,Tt,3,0,"ng-template",null,15,e.W1O),e.YNc(27,It,2,2,"ng-template",null,16,e.W1O),e.qZA(),e.TgZ(29,"column",17),e.YNc(30,xt,5,6,"ng-template",null,18,e.W1O),e.qZA(),e._UZ(32,"column",19),e.qZA(),e._UZ(33,"pagination",20),e.qZA()),2&a){const i=e.MAs(5),s=e.MAs(10),g=e.MAs(12),_=e.MAs(15),h=e.MAs(17),v=e.MAs(20),M=e.MAs(23),Q=e.MAs(26),te=e.MAs(28),ae=e.MAs(31);e.Q6J("dao",n.dao)("add",n.add)("title",n.isModal?"":n.title)("orderBy",n.orderBy)("groupBy",n.groupBy)("join",n.join)("selectable",n.selectable)("hasAdd",n.canAdd())("hasEdit",!1)("loadList",n.onGridLoad.bind(n)),e.xp6(1),e.Q6J("ngIf",!n.selectable),e.xp6(1),e.Q6J("deleted",n.auth.hasPermissionTo("MOD_AUDIT_DEL"))("form",n.filter)("where",n.filterWhere)("submit",n.filterSubmit.bind(n))("clear",n.filterClear.bind(n))("collapseChange",n.filterCollapseChange.bind(n))("collapsed",!n.selectable&&n.filterCollapsed)("visible",n.showFilter),e.xp6(1),e.Q6J("ngIf",n.isModal)("ngIfElse",i),e.xp6(4),e.Q6J("ngIf",!n.selectable),e.xp6(1),e.Q6J("titleTemplate",s)("template",g),e.xp6(5),e.Q6J("titleTemplate",_)("template",h),e.xp6(5),e.Q6J("template",v),e.xp6(3),e.Q6J("template",M),e.xp6(3),e.Q6J("titleTemplate",Q)("template",te),e.xp6(5),e.Q6J("title","Status\nAvalia\xe7\xe3o")("template",ae),e.xp6(3),e.Q6J("dynamicOptions",n.dynamicOptions.bind(n))("dynamicButtons",n.dynamicButtons.bind(n)),e.xp6(1),e.Q6J("rows",n.rowsLimit)}},dependencies:[O.O5,f.M,b.a,A.b,m.z,x.n,z.Q,oe.a,J.V,j.m,q.k,G.p,X.l,y.F,Ce.M,se]})}return o})();var re=r(2214),W=r(1184);const yt=["programa"],Ut=["unidade"],Lt=["nome"],wt=["data_fim"];let ee=(()=>{class o extends W.F{constructor(t){super(t,V,Z.r),this.injector=t,this.validate=(a,n)=>{let i=null;return["nome","unidade_id","programa_id"].indexOf(n)>=0&&!a.value?.length&&(i="Obrigat\xf3rio"),["data_inicio"].indexOf(n)>=0&&!this.dao?.validDateTime(a.value)&&(i="Inv\xe1lido"),["data_fim"].indexOf(n)>=0&&!this.dao?.validDateTime(a.value)&&(i="Inv\xe1lido"),i},this.formValidation=a=>{const n=this.form?.controls.data_inicio.value,i=this.form?.controls.data_fim.value;if(!this.programa?.selectedEntity)return"Obrigat\xf3rio selecionar o programa";if(!this.dao?.validDateTime(n))return"Data de in\xedcio inv\xe1lida";if(!this.dao?.validDateTime(i))return"Data de fim inv\xe1lida";if(n>i)return"A data do fim n\xe3o pode ser menor que a data do in\xedcio!";{const g=this.form.controls.entregas.value||[];for(let _ of g){if(!this.auth.hasPermissionTo("MOD_PENT_ENTR_EXTRPL")&&_.data_inicio<n)return"A "+this.lex.translate("entrega")+" '"+_.descricao+"' possui data inicial anterior \xe0 "+this.lex.translate("do Plano de Entrega")+": "+this.util.getDateFormatted(n);if(!this.auth.hasPermissionTo("MOD_PENT_ENTR_EXTRPL")&&_.data_fim>i)return"A "+this.lex.translate("entrega")+" '"+_.descricao+"' possui data fim posterior \xe0 "+this.lex.translate("do Plano de Entrega")+": "+this.util.getDateFormatted(i)}}},this.titleEdit=a=>"Editando "+this.lex.translate("Plano de Entregas")+": "+(a?.nome||""),this.unidadeDao=t.get(N.J),this.programaDao=t.get(re.w),this.cadeiaValorDao=t.get(D.m),this.planoEntregaDao=t.get(Z.r),this.planejamentoInstitucionalDao=t.get(I.U),this.join=["entregas.entrega","entregas.objetivos.objetivo","entregas.processos.processo","entregas.unidade","unidade","entregas.reacoes.usuario:id,nome,apelido"],this.modalWidth=1200,this.form=this.fh.FormBuilder({nome:{default:""},data_inicio:{default:new Date},data_fim:{default:new Date},unidade_id:{default:""},plano_entrega_id:{default:null},planejamento_id:{default:null},cadeia_valor_id:{default:null},programa_id:{default:null},entregas:{default:[]}},this.cdRef,this.validate),this.programaMetadata={todosUnidadeExecutora:!0,vigentesUnidadeExecutora:!1}}loadData(t,a){var n=this;return(0,u.Z)(function*(){let i=Object.assign({},a.value);a.patchValue(n.util.fillForm(i,t)),n.cdRef.detectChanges()})()}initializeData(t){var a=this;return(0,u.Z)(function*(){a.entity=new V,a.entity.unidade_id=a.auth.unidade?.id||"",a.entity.unidade=a.auth.unidade;let n=yield a.programaDao.query({where:[["vigentesUnidadeExecutora","==",a.auth.unidade.id]]}).asPromise(),i=n[n.length-1];i&&(a.entity.programa=i,a.entity.programa_id=i.id);const s=new Date(a.entity.data_inicio).toLocaleDateString(),g=a.entity.data_fim?new Date(a.entity.data_fim).toLocaleDateString():(new Date).toLocaleDateString();a.entity.nome=a.auth.unidade.sigla+" - "+s+" - "+g,a.loadData(a.entity,a.form)})()}saveData(t){var a=this;return(0,u.Z)(function*(){return new Promise((n,i)=>{let s=a.util.fill(new V,a.entity);s=a.util.fillForm(s,a.form.value),s.entregas=s.entregas?.filter(g=>g._status)||[],n(s)})})()}dynamicButtons(t){return[]}onDataChange(){this.sugereNome()}onUnidadeChange(){var t=this;return(0,u.Z)(function*(){let n=t.form.controls.unidade_id.value||t.auth.unidade?.id;if(n)try{yield t.planoEntregaDao.permissaoIncluir(n)}catch(i){t.error(i)}t.sugereNome()})()}sugereNome(){const t=this.unidade?.selectedItem?this.unidade?.selectedItem?.entity.sigla:this.auth.unidade?.sigla,a=new Date(this.form.controls.data_inicio.value).toLocaleDateString(),n=this.form.controls.data_fim.value?" - "+new Date(this.form.controls.data_fim.value).toLocaleDateString():"";this.form.controls.nome.setValue(t+" - "+a+n)}somaDia(t,a){let n=new Date(t);return n.setDate(n.getDate()+a),n}onProgramaChange(){const t=this.programa?.selectedEntity?.prazo_max_plano_entrega,a=this.somaDia(this.entity.data_inicio,t);this.entity?.data_fim||(this.form.controls.data_fim.setValue(new Date(a)),this.dataFim?.change.emit())}static#e=this.\u0275fac=function(a){return new(a||o)(e.Y36(e.zs3))};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["app-plano-entrega-form"]],viewQuery:function(a,n){if(1&a&&(e.Gf(U.Q,5),e.Gf(f.M,7),e.Gf(yt,7),e.Gf(Ut,7),e.Gf(Lt,7),e.Gf(wt,7)),2&a){let i;e.iGM(i=e.CRH())&&(n.editableForm=i.first),e.iGM(i=e.CRH())&&(n.grid=i.first),e.iGM(i=e.CRH())&&(n.programa=i.first),e.iGM(i=e.CRH())&&(n.unidade=i.first),e.iGM(i=e.CRH())&&(n.nomePE=i.first),e.iGM(i=e.CRH())&&(n.dataFim=i.first)}},features:[e.qOj],decls:20,vars:28,consts:[["initialFocus","entregas",3,"form","disabled","title","submit","cancel"],[1,"row"],["controlName","unidade_id","required","",3,"size","disabled","dao","change"],["unidade",""],["controlName","programa_id","required","",3,"size","disabled","dao","metadata","change"],["programa",""],["date","","label","In\xedcio","controlName","data_inicio","required","",3,"size","labelInfo","change"],["date","","label","Fim","controlName","data_fim","required","",3,"size","labelInfo","change"],["data_fim",""],["label","Nome","controlName","nome","required","",3,"size"],["nome",""],["controlName","planejamento_id","label","Planejamento Institucional",3,"size","emptyValue","dao"],["planejamento",""],["controlName","cadeia_valor_id","label","Cadeia de Valor",3,"size","emptyValue","dao"],["cadeiaValor",""],["title","Entregas"],["noPersist","",3,"disabled","control","planejamentoId","cadeiaValorId","unidadeId","dataFim"],["entregas",""]],template:function(a,n){1&a&&(e.TgZ(0,"editable-form",0),e.NdJ("submit",function(){return n.onSaveData()})("cancel",function(){return n.onCancel()}),e.TgZ(1,"div")(2,"div",1)(3,"input-search",2,3),e.NdJ("change",function(){return n.onUnidadeChange()}),e.qZA(),e.TgZ(5,"input-search",4,5),e.NdJ("change",function(){return n.onProgramaChange()}),e.qZA(),e.TgZ(7,"input-datetime",6),e.NdJ("change",function(){return n.onDataChange()}),e.qZA(),e.TgZ(8,"input-datetime",7,8),e.NdJ("change",function(){return n.onDataChange()}),e.qZA()(),e.TgZ(10,"div",1),e._UZ(11,"input-text",9,10)(13,"input-search",11,12)(15,"input-search",13,14),e.qZA(),e._UZ(17,"separator",15)(18,"plano-entrega-list-entrega",16,17),e.qZA()()),2&a&&(e.Q6J("form",n.form)("disabled",n.formDisabled)("title",n.isModal?"":n.title),e.xp6(3),e.Q6J("size",4)("disabled",null!=n.entity&&n.entity.id?"disabled":void 0)("dao",n.unidadeDao),e.xp6(2),e.Q6J("size",4)("disabled",null!=n.entity&&n.entity.id?"disabled":void 0)("dao",n.programaDao)("metadata",n.programaMetadata),e.xp6(2),e.Q6J("size",2)("labelInfo","In\xedcio "+n.lex.translate("Plano de Entrega")),e.xp6(1),e.Q6J("size",2)("labelInfo","Fim "+n.lex.translate("Plano de Entrega")),e.xp6(3),e.Q6J("size",4),e.uIk("maxlength",250),e.xp6(2),e.Q6J("size",4)("emptyValue",null)("dao",n.planejamentoInstitucionalDao),e.xp6(2),e.Q6J("size",4)("emptyValue",null)("dao",n.cadeiaValorDao),e.xp6(3),e.Q6J("disabled",n.formDisabled)("control",n.form.controls.entregas)("planejamentoId",n.form.controls.planejamento_id.value)("cadeiaValorId",n.form.controls.cadeia_valor_id.value)("unidadeId",n.form.controls.unidade_id.value)("dataFim",n.form.controls.data_fim.value))},dependencies:[U.Q,J.V,j.m,q.k,B.N,se]})}return o})();var de=r(7465),ce=r(1058),ue=r(7501),qt=r(9108);const Qt=["unidade"];function Rt(o,l){if(1&o&&e._UZ(0,"planejamento-show",18),2&o){const t=e.oxw(2);e.Q6J("planejamento",t.objetivo.planejamento)}}function Jt(o,l){if(1&o&&(e.ynx(0),e.YNc(1,Rt,1,1,"planejamento-show",16),e.TgZ(2,"div",17)(3,"h5"),e._uU(4,"Objetivo:"),e.qZA(),e.TgZ(5,"h6"),e._uU(6),e.qZA()(),e.BQk()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.objetivo.planejamento),e.xp6(5),e.Oqu(t.objetivo.nome)}}function Mt(o,l){if(1&o&&(e.TgZ(0,"div",21)(1,"h6"),e._uU(2,"Cadeia de valor:"),e.qZA(),e.TgZ(3,"h4"),e._uU(4),e.qZA()()),2&o){const t=e.oxw(2);e.xp6(4),e.Oqu(t.processo.cadeia_valor.nome)}}function St(o,l){if(1&o&&(e.ynx(0),e.YNc(1,Mt,5,1,"div",19),e.TgZ(2,"div",20)(3,"h5"),e._uU(4,"Processo:"),e.qZA(),e.TgZ(5,"h6"),e._uU(6),e.qZA()(),e.BQk()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.processo.cadeia_valor),e.xp6(5),e.Oqu(t.processo.nome)}}function Vt(o,l){if(1&o&&e._UZ(0,"badge",25),2&o){const t=e.oxw().row,a=e.oxw();e.Q6J("icon",a.entityService.getIcon("Unidade"))("label",t.plano_entrega.unidade.sigla)}}function zt(o,l){if(1&o&&e._UZ(0,"badge",26),2&o){const t=e.oxw().row;e.Q6J("label",t.destinatario)}}function jt(o,l){if(1&o&&(e._uU(0),e._UZ(1,"br"),e.TgZ(2,"span",22),e.YNc(3,Vt,1,2,"badge",23),e.YNc(4,zt,1,1,"badge",24),e.qZA()),2&o){const t=l.row;e.hij(" ",t.descricao,""),e.xp6(3),e.Q6J("ngIf",t.plano_entrega.unidade),e.xp6(1),e.Q6J("ngIf",null==t.destinatario?null:t.destinatario.length)}}function Gt(o,l){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=e.oxw().row,a=e.oxw();e.xp6(1),e.hij(" ",a.dao.getDateFormatted(t.data_inicio),"")}}function Ft(o,l){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=e.oxw().row,a=e.oxw();e.xp6(1),e.hij(" ",a.dao.getDateFormatted(t.data_fim),"")}}function kt(o,l){if(1&o&&(e.YNc(0,Gt,2,1,"span",0),e._UZ(1,"br"),e.YNc(2,Ft,2,1,"span",0)),2&o){const t=l.row;e.Q6J("ngIf",t.data_inicio),e.xp6(2),e.Q6J("ngIf",t.data_fim)}}function Bt(o,l){if(1&o&&e._UZ(0,"progress-bar",27),2&o){const t=l.row;e.Q6J("value",t.progresso_realizado)("goal",t.progresso_esperado)}}let ge=(()=>{class o extends d.E{constructor(t){super(t,F.O,L.K),this.injector=t,this.filterWhere=a=>{let n=[],i=a.value;return this.objetivoId&&n.push(["objetivos.objetivo_id","==",this.objetivoId]),this.processoId&&n.push(["processos.processo_id","==",this.processoId]),i.unidade_id&&n.push(["plano_entrega.unidade_id","==",i.unidade_id]),i.entrega_id&&n.push(["entrega_id","==",i.entrega_id]),i.data_inicio&&n.push(["data_inicio",">=",i.data_inicio]),i.data_fim&&n.push(["data_fim","<=",i.data_fim]),n},this.unidadeDao=t.get(N.J),this.entregaDao=t.get(de.y),this.entregaService=t.get(c.f),this.objetivoDao=t.get(ce.e),this.processoDao=t.get(ue.k),this.join=["plano_entrega.unidade"],this.title=this.lex.translate("Entregas"),this.filter=this.fh.FormBuilder({unidade_id:{default:null},entrega_id:{default:null},data_inicio:{default:null},data_fim:{default:null}})}ngOnInit(){super.ngOnInit(),this.objetivoId=this.urlParams.get("objetivo_id")||void 0,this.processoId=this.urlParams.get("processo_id")||void 0,this.objetivoId&&this.objetivoDao?.getById(this.objetivoId,["planejamento"]).then(t=>{this.objetivo=t}),this.processoId&&this.processoDao?.getById(this.processoId,["cadeia_valor"]).then(t=>{this.processo=t})}filterClear(t){t.controls.unidade_id.setValue(null),t.controls.entrega_id.setValue(null),t.controls.data_inicio.setValue(null),t.controls.data_fim.setValue(null),super.filterClear(t)}static#e=this.\u0275fac=function(a){return new(a||o)(e.Y36(e.zs3))};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["plano-entrega-mapa-entregas"]],viewQuery:function(a,n){if(1&a&&(e.Gf(f.M,5),e.Gf(Qt,5)),2&a){let i;e.iGM(i=e.CRH())&&(n.grid=i.first),e.iGM(i=e.CRH())&&(n.unidade=i.first)}},features:[e.qOj],decls:23,vars:31,consts:[[4,"ngIf"],[3,"dao","title","orderBy","join"],[3,"deleted","form","where","submit","clear","collapseChange","collapsed"],[1,"row"],["controlName","unidade_id",3,"size","control","dao"],["unidade",""],["controlName","entrega_id",3,"size","control","dao"],["entrega",""],["date","","noIcon","","label","In\xedcio","controlName","data_inicio","labelInfo","Data de in\xedcio do planejamento institucional",3,"size","control"],["date","","noIcon","","label","Fim","controlName","data_fim","labelInfo","Data do fim do planejamento institucional",3,"size","control"],[3,"title","template"],["columnEntregaCliente",""],["columnDatas",""],[3,"title","width","template"],["columnProgresso",""],[3,"rows"],[3,"planejamento",4,"ngIf"],[1,"objetivos","arrow_box","w-100"],[3,"planejamento"],["class","planejamento arrow_box first-box w-100",4,"ngIf"],[1,"procesos","arrow_box","w-100"],[1,"planejamento","arrow_box","first-box","w-100"],[1,"d-block"],["color","light",3,"icon","label",4,"ngIf"],["color","light","icon","bi bi-mailbox",3,"label",4,"ngIf"],["color","light",3,"icon","label"],["color","light","icon","bi bi-mailbox",3,"label"],["color","success",3,"value","goal"]],template:function(a,n){if(1&a&&(e.YNc(0,Jt,7,2,"ng-container",0),e.YNc(1,St,7,2,"ng-container",0),e.TgZ(2,"grid",1),e._UZ(3,"toolbar"),e.TgZ(4,"filter",2)(5,"div",3),e._UZ(6,"input-search",4,5)(8,"input-search",6,7)(10,"input-datetime",8)(11,"input-datetime",9),e.qZA()(),e.TgZ(12,"columns")(13,"column",10),e.YNc(14,jt,5,3,"ng-template",null,11,e.W1O),e.qZA(),e.TgZ(16,"column",10),e.YNc(17,kt,3,2,"ng-template",null,12,e.W1O),e.qZA(),e.TgZ(19,"column",13),e.YNc(20,Bt,1,2,"ng-template",null,14,e.W1O),e.qZA()(),e._UZ(22,"pagination",15),e.qZA()),2&a){const i=e.MAs(15),s=e.MAs(18),g=e.MAs(21);e.Q6J("ngIf",n.objetivo),e.xp6(1),e.Q6J("ngIf",n.processo),e.xp6(1),e.Q6J("dao",n.dao)("title",n.isModal?"":n.title)("orderBy",n.orderBy)("join",n.join),e.xp6(2),e.Q6J("deleted",n.auth.hasPermissionTo("MOD_AUDIT_DEL"))("form",n.filter)("where",n.filterWhere)("submit",n.filterSubmit.bind(n))("clear",n.filterClear.bind(n))("collapseChange",n.filterCollapseChange.bind(n))("collapsed",!n.selectable&&n.filterCollapsed),e.xp6(2),e.Q6J("size",4)("control",n.filter.controls.unidade_id)("dao",n.unidadeDao),e.xp6(2),e.Q6J("size",4)("control",n.filter.controls.entrega_id)("dao",n.entregaDao),e.xp6(2),e.Q6J("size",2)("control",n.filter.controls.data_inicio),e.xp6(1),e.Q6J("size",2)("control",n.filter.controls.data_fim),e.xp6(2),e.Q6J("title","Entrega\nDemandante/Destinat\xe1rio")("template",i),e.xp6(3),e.Q6J("title","Data In\xedcio\nData Fim")("template",s),e.xp6(3),e.Q6J("title","Progresso")("width",200)("template",g),e.xp6(3),e.Q6J("rows",n.rowsLimit)}},dependencies:[O.O5,f.M,b.a,A.b,m.z,x.n,z.Q,J.V,q.k,y.F,Y.R,qt.W]})}return o})();const Yt=function(){return["gestao","plano-entrega"]},Ht=function(o){return{unidade_id:o,status:"ATIVO"}},Wt=function(o){return{showFilter:!1,filter:o}},Kt=function(o,l){return{route:o,params:l}},Xt=function(o){return["unidade_id","=",o]},$t=function(){return["status","=","ATIVO"]},ea=function(o,l){return[o,l]};let ta=(()=>{class o extends W.F{constructor(t){super(t,V,Z.r),this.injector=t,this.validate=(a,n)=>{let i=null;return["nome","plano_entrega_id"].indexOf(n)>=0&&!a.value?.length&&(i="Obrigat\xf3rio"),i},this.titleEdit=a=>"Editando "+this.lex.translate("Plano de Entregas")+": "+(a?.nome||""),this.unidadeDao=t.get(N.J),this.programaDao=t.get(re.w),this.planoEntregaDao=t.get(Z.r),this.cadeiaValorDao=t.get(D.m),this.planejamentoInstitucionalDao=t.get(I.U),this.join=[],this.modalWidth=1e3,this.form=this.fh.FormBuilder({nome:{default:""},data_inicio:{default:""},data_fim:{default:""},planejamento_id:{default:null},cadeia_valor_id:{default:null},unidade_id:{default:this.auth.unidade?.id},plano_entrega_id:{default:null},programa_id:{default:null},status:{default:"HOMOLOGANDO"}},this.cdRef,this.validate)}ngOnInit(){super.ngOnInit();let t=this.metadata?.planoEntrega?this.metadata?.planoEntrega:null;t&&(this.form.controls.plano_entrega_id.setValue(t.id),this.form.controls.nome.setValue(t.nome),this.form.controls.data_inicio.setValue(t.data_inicio),this.form.controls.data_fim.setValue(t.data_fim),this.form.controls.planejamento_id.setValue(t.planejamento_id),this.form.controls.cadeia_valor_id.setValue(t.cadeia_valor_id))}loadData(t,a){var n=this;return(0,u.Z)(function*(){let i=Object.assign({},a.value);a.patchValue(n.util.fillForm(i,t)),n.cdRef.detectChanges()})()}initializeData(t){var a=this;return(0,u.Z)(function*(){a.loadData(a.entity,a.form)})()}saveData(t){var a=this;return(0,u.Z)(function*(){return new Promise((n,i)=>{let s=a.util.fill(new V,a.entity);s=a.util.fillForm(s,a.form.value),n(s)})})()}onPlanoEntregaChange(t){this.form.controls.plano_entrega_id.value&&(this.form.controls.nome.setValue(this.planoEntrega?.selectedEntity.nome),this.form.controls.data_inicio.setValue(this.planoEntrega?.selectedEntity.data_inicio),this.form.controls.data_fim.setValue(this.planoEntrega?.selectedEntity.data_fim),this.form.controls.planejamento_id.setValue(this.planoEntrega?.selectedEntity.planejamento_id),this.form.controls.cadeia_valor_id.setValue(this.planoEntrega?.selectedEntity.cadeia_valor_id),this.form.controls.programa_id.setValue(this.planoEntrega?.selectedEntity.programa_id))}static#e=this.\u0275fac=function(a){return new(a||o)(e.Y36(e.zs3))};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["plano-entrega-adesao"]],viewQuery:function(a,n){if(1&a&&(e.Gf(U.Q,5),e.Gf(f.M,7),e.Gf(J.V,7)),2&a){let i;e.iGM(i=e.CRH())&&(n.editableForm=i.first),e.iGM(i=e.CRH())&&(n.grid=i.first),e.iGM(i=e.CRH())&&(n.planoEntrega=i.first)}},features:[e.qOj],decls:21,vars:39,consts:[["initialFocus","plano_entrega_id",3,"form","disabled","title","submit","cancel"],[1,"row","mb-4"],["controlName","plano_entrega_id","label","Plano de Entregas da Unidade-pai","required","",3,"size","dao","selectRoute","where","change"],["planoEntrega",""],[1,"row"],["label","Nome deste Plano de Entregas","controlName","nome","required","",3,"size"],["disabled","","controlName","unidade_id",3,"size","label","dao"],["disabled","","label","Status","controlName","status",3,"size"],[1,"row","mt-4"],["title","Dados herdados do Plano de Entregas da Unidade-pai",3,"collapse"],["disabled","","label","Programa de Gest\xe3o","controlName","programa_id",3,"size","dao"],["disabled","","label","Planejamento Institucional","controlName","planejamento_id",3,"size","dao"],["disabled","","controlName","data_inicio","label","In\xedcio",3,"size","labelInfo"],["disabled","","label","Cadeia de Valor","controlName","cadeia_valor_id",3,"size","dao"],["disabled","","controlName","data_fim","label","Fim",3,"size","labelInfo"]],template:function(a,n){1&a&&(e.TgZ(0,"editable-form",0),e.NdJ("submit",function(){return n.onSaveData()})("cancel",function(){return n.onCancel()}),e.TgZ(1,"div")(2,"div",1)(3,"input-search",2,3),e.NdJ("change",function(s){return n.onPlanoEntregaChange(s)}),e.qZA(),e._UZ(5,"separator"),e.qZA(),e.TgZ(6,"div",4),e._UZ(7,"input-text",5),e.qZA(),e.TgZ(8,"div",4),e._UZ(9,"input-search",6)(10,"input-text",7),e.qZA(),e.TgZ(11,"div",8)(12,"separator",9)(13,"div",4),e._UZ(14,"input-search",10),e.qZA(),e.TgZ(15,"div",4),e._UZ(16,"input-search",11)(17,"input-datetime",12),e.qZA(),e.TgZ(18,"div",4),e._UZ(19,"input-search",13)(20,"input-datetime",14),e.qZA()()()()()),2&a&&(e.Q6J("form",n.form)("disabled",n.formDisabled)("title",n.isModal?"":n.title),e.xp6(3),e.Q6J("size",12)("dao",n.planoEntregaDao)("selectRoute",e.WLB(30,Kt,e.DdM(25,Yt),e.VKq(28,Wt,e.VKq(26,Ht,n.auth.unidade.unidade_pai_id))))("where",e.WLB(36,ea,e.VKq(33,Xt,n.auth.unidade.unidade_pai_id),e.DdM(35,$t))),e.xp6(4),e.Q6J("size",12),e.uIk("maxlength",250),e.xp6(2),e.Q6J("size",9)("label",n.lex.translate("Unidade"))("dao",n.unidadeDao),e.xp6(1),e.Q6J("size",3),e.uIk("maxlength",250),e.xp6(2),e.Q6J("collapse","collapse"),e.xp6(2),e.Q6J("size",12)("dao",n.programaDao),e.xp6(2),e.Q6J("size",9)("dao",n.planejamentoInstitucionalDao),e.xp6(1),e.Q6J("size",3)("labelInfo","In\xedcio "+n.lex.translate("Plano de Entrega")),e.xp6(2),e.Q6J("size",9)("dao",n.cadeiaValorDao),e.xp6(1),e.Q6J("size",3)("labelInfo","Fim "+n.lex.translate("Plano de Entrega")))},dependencies:[U.Q,J.V,j.m,q.k,B.N]})}return o})();var aa=r(2307),na=r(4508),_e=r(6384),pe=r(4978);const oa=["gridProcessos"],ia=["gridObjetivos"],la=["entregas"],sa=["planejamento"],ra=["cadeiaValor"],da=["inputObjetivo"],ca=["inputProcesso"],ua=["entrega"],ga=["unidade"],_a=["tabs"],pa=["etiqueta"];function ma(o,l){if(1&o&&(e.TgZ(0,"div",4),e._UZ(1,"plano-entrega-valor-meta-input",29)(2,"input-number",30),e.TgZ(3,"div",4),e._UZ(4,"plano-entrega-valor-meta-input",31)(5,"input-number",32),e.qZA()()),2&o){const t=e.oxw(),a=e.MAs(31);e.xp6(1),e.Q6J("entrega",null==a?null:a.selectedEntity)("size",6)("control",t.form.controls.meta),e.xp6(1),e.Q6J("size",6),e.xp6(2),e.Q6J("entrega",null==a?null:a.selectedEntity)("size",6)("control",t.form.controls.realizado)("change",t.onRealizadoChange.bind(t)),e.xp6(1),e.Q6J("size",6)("stepValue",.01)}}function ha(o,l){1&o&&(e.TgZ(0,"div",4),e._UZ(1,"input-number",30)(2,"input-number",32),e.qZA()),2&o&&(e.xp6(1),e.Q6J("size",6),e.xp6(1),e.Q6J("size",6)("stepValue",.01))}function fa(o,l){1&o&&(e.TgZ(0,"order",42),e._uU(1,"Objetivos"),e.qZA()),2&o&&e.Q6J("header",l.header)}function ba(o,l){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=l.row;e.xp6(1),e.Oqu(null==t.objetivo?null:t.objetivo.nome)}}const va=function(o){return["planejamento_id","==",o]},me=function(o){return[o]},Ea=function(){return["gestao","planejamento","objetivoList"]},Aa=function(o){return{planejamento_id:o}},he=function(o){return{filter:o}},fe=function(o,l){return{route:o,params:l}};function Ta(o,l){if(1&o&&e._UZ(0,"input-search",43,44),2&o){const t=e.oxw(2);e.Q6J("size",12)("where",e.VKq(6,me,e.VKq(4,va,t.planejamentoId)))("dao",t.planejamentoObjetivoDao)("selectRoute",e.WLB(13,fe,e.DdM(8,Ea),e.VKq(11,he,e.VKq(9,Aa,t.planejamentoId))))}}function Oa(o,l){if(1&o&&(e.TgZ(0,"tab",33),e._UZ(1,"input-search",34,35),e.TgZ(3,"grid",36,37)(5,"columns")(6,"column",38),e.YNc(7,fa,2,1,"ng-template",null,39,e.W1O),e.YNc(9,ba,2,1,"ng-template",null,40,e.W1O),e.YNc(11,Ta,2,16,"ng-template",null,41,e.W1O),e.qZA(),e._UZ(13,"column",12),e.qZA()()()),2&o){const t=e.MAs(8),a=e.MAs(10),n=e.MAs(12),i=e.oxw();e.xp6(1),e.Q6J("size",12)("dao",i.planejamentoDao),e.xp6(2),e.Q6J("control",i.form.controls.objetivos)("form",i.formObjetivos)("orderBy",i.orderBy)("hasDelete",!0)("hasEdit",!0)("add",i.addObjetivo.bind(i))("remove",i.removeObjetivo.bind(i))("save",i.saveObjetivo.bind(i)),e.xp6(3),e.Q6J("titleTemplate",t)("template",a)("editTemplate",n)}}function Ca(o,l){1&o&&(e.TgZ(0,"order",53),e._uU(1,"Processos"),e.qZA()),2&o&&e.Q6J("header",l.header)}function Ia(o,l){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=l.row;e.xp6(1),e.Oqu(null==t.processo?null:t.processo.nome)}}const Pa=function(o){return["cadeia_valor_id","==",o]},Za=function(){return["gestao","cadeia-valor","processoList"]},Da=function(o){return{cadeia_valor_id:o}};function xa(o,l){if(1&o&&e._UZ(0,"input-search",54,55),2&o){const t=e.oxw(2);e.Q6J("size",12)("where",e.VKq(6,me,e.VKq(4,Pa,t.cadeiaValorId)))("dao",t.cadeiaValorProcessoDao)("selectRoute",e.WLB(13,fe,e.DdM(8,Za),e.VKq(11,he,e.VKq(9,Da,t.cadeiaValorId))))}}function Na(o,l){if(1&o&&(e.TgZ(0,"tab",45),e._UZ(1,"input-search",46,47),e.TgZ(3,"grid",36,48)(5,"columns")(6,"column",38),e.YNc(7,Ca,2,1,"ng-template",null,49,e.W1O),e.YNc(9,Ia,2,1,"ng-template",null,50,e.W1O),e.YNc(11,xa,2,16,"ng-template",null,51,e.W1O),e.qZA(),e._UZ(13,"column",52),e.qZA()()()),2&o){const t=e.MAs(8),a=e.MAs(10),n=e.MAs(12),i=e.oxw();e.xp6(1),e.Q6J("size",12)("dao",i.cadeiaValorDao),e.xp6(2),e.Q6J("control",i.form.controls.processos)("form",i.formProcessos)("orderBy",i.orderBy)("hasDelete",!0)("hasEdit",!0)("add",i.addProcesso.bind(i))("remove",i.removeProcesso.bind(i))("save",i.saveProcesso.bind(i)),e.xp6(3),e.Q6J("titleTemplate",t)("template",a)("editTemplate",n),e.xp6(7),e.Q6J("dynamicButtons",i.dynamicButtonsProcessos.bind(i))}}const ya=function(o){return["plano_entrega.unidade_id","in",o]},Ua=function(){return["gestao","plano-entrega","entrega-list"]},La=function(o){return{route:o}},wa=function(o){return{idsUnidadesAscendentes:o}};let be=(()=>{class o extends W.F{constructor(t){super(t,F.O,L.K),this.injector=t,this.itensQualitativo=[],this.idsUnidadesAscendentes=[],this.checklist=[],this.etiquetas=[],this.etiquetasAscendentes=[],this.validate=(a,n)=>{let i=null;return["descricao","destinatario"].indexOf(n)>=0?a.value?.length?this.entrega.selectedEntity&&this.entrega.selectedEntity.descricao==a.value&&(i="\xc9 necess\xe1rio incrementar ou modificar a descri\xe7\xe3o da entrega"):i="Obrigat\xf3rio":["progresso_realizado","realizado"].indexOf(n)>=0&&!(a.value>=0||a.value?.length>0)||["progresso_esperado","meta"].indexOf(n)>=0&&!(a.value>0||a.value?.length>0)?i="Obrigat\xf3rio":["unidade_id"].indexOf(n)>=0&&!a.value?.length?i="A unidade demandante \xe9 obrigat\xf3ria":["entrega_id"].indexOf(n)>=0&&!a.value?.length?i="A entrega \xe9 obrigat\xf3ria":["data_inicio"].indexOf(n)>=0&&!this.dao?.validDateTime(a.value)||["data_fim"].indexOf(n)>=0&&!this.dao?.validDateTime(a.value)?i="Inv\xe1lido":["planejamento_objetivo_id"].indexOf(n)>=0?(a.value?.length||(i="O objetivo do planejamento \xe9 obrigat\xf3rio"),a.value?.length&&this.gridObjetivos?.items.filter(s=>"ADD"==s._status).map(s=>s.planejamento_objetivo_id).includes(this.formObjetivos.controls.planejamento_objetivo_id.value)&&(i="Este objetivo est\xe1 em duplicidade!")):["cadeia_processo_id"].indexOf(n)>=0&&(a.value?.length||(i="O processo da cadeia de valor \xe9 obrigat\xf3rio"),a.value?.length&&this.gridProcessos?.items.map(s=>s.cadeia_processo_id).includes(this.formProcessos.controls.cadeia_processo_id.value)&&(i="Este processo est\xe1 em duplicidade!")),i},this.formValidation=a=>{let n=this.form?.controls.data_inicio.value,i=this.form?.controls.data_fim.value;return this.gridObjetivos?.editing?(this.tabs.active="OBJETIVOS","Salve ou cancele o registro atual em edi\xe7\xe3o"):this.gridProcessos?.editing?(this.tabs.active="PROCESSOS","Salve ou cancele o registro atual em edi\xe7\xe3o"):this.dao?.validDateTime(n)?this.dao?.validDateTime(i)?n>i?"A data do fim n\xe3o pode ser anterior \xe0 data do in\xedcio!":!this.auth.hasPermissionTo("MOD_PENT_ENTR_EXTRPL")&&this.planoEntrega&&n<this.planoEntrega.data_inicio?"Data de inicio menor que a data de inicio "+this.lex.translate("do Plano de Entrega")+": "+this.util.getDateFormatted(this.planoEntrega.data_inicio):!this.auth.hasPermissionTo("MOD_PENT_ENTR_EXTRPL")&&this.planoEntrega&&this.planoEntrega.data_fim&&i>this.planoEntrega.data_fim?"Data de fim maior que a data de fim "+this.lex.translate("do Plano de Entrega")+": "+this.util.getDateFormatted(this.planoEntrega.data_fim):void 0:"Data de fim inv\xe1lida":"Data de in\xedcio inv\xe1lida"},this.planejamentoDao=t.get(I.U),this.unidadeDao=t.get(N.J),this.entregaDao=t.get(de.y),this.planoEntregaDao=t.get(Z.r),this.planejamentoInstitucionalDao=t.get(I.U),this.planoEntregaEntregaDao=t.get(L.K),this.cadeiaValorDao=t.get(D.m),this.cadeiaValorProcessoDao=t.get(ue.k),this.planejamentoObjetivoDao=t.get(ce.e),this.planoEntregaService=t.get(c.f),this.modalWidth=700,this.join=["entrega","objetivos.objetivo","processos.processo"],this.form=this.fh.FormBuilder({descricao:{default:""},descricao_entrega:{default:""},data_inicio:{default:new Date},data_fim:{default:new Date},meta:{default:100},descricao_meta:{default:""},realizado:{default:null},plano_entrega_id:{default:""},entrega_pai_id:{default:null},entrega_id:{default:null},progresso_esperado:{default:100},progresso_realizado:{default:null},unidade_id:{default:null},destinatario:{default:null},objetivos:{default:[]},processos:{default:[]},listaQualitativo:{default:[]},planejamento_id:{default:null},cadeia_valor_id:{default:null},objetivo_id:{default:null},objetivo:{default:null},checklist:{default:[]},etiquetas:{default:[]},etiqueta:{default:""}},this.cdRef,this.validate),this.formObjetivos=this.fh.FormBuilder({planejamento_objetivo_id:{default:null}},this.cdRef,this.validate),this.formProcessos=this.fh.FormBuilder({cadeia_processo_id:{default:null}},this.cdRef,this.validate),this.formChecklist=this.fh.FormBuilder({id:{default:""},texto:{default:""},checked:{default:!1}},this.cdRef)}ngOnInit(){super.ngOnInit(),this.planoEntrega=this.metadata?.plano_entrega,this.planejamentoId=this.metadata?.planejamento_id,this.cadeiaValorId=this.metadata?.cadeia_valor_id,this.unidadeId=this.metadata?.unidade_id,this.metadata?.data_fim&&(this.dataFim=this.metadata?.data_fim),this.entity=this.metadata?.entrega}loadData(t,a){var n=this;return(0,u.Z)(function*(){""==t.unidade_id&&(t.unidade_id=n.unidadeId??"");let i=Object.assign({},a.value);n.onEntregaChange(a.value);let{meta:s,realizado:g,..._}=t;yield n.entrega?.loadSearch(t.entrega||i.entrega_id,!1),yield n.unidade?.loadSearch(n.unidadeId),yield n.planejamento?.loadSearch(n.planejamentoId),yield n.cadeiaValor?.loadSearch(n.cadeiaValorId);let h=n.unidadeId?.length?yield n.unidadeDao.getById(n.unidadeId):null;n.idsUnidadesAscendentes=h?.path?.split("/").slice(1)||[],h&&n.idsUnidadesAscendentes.push(h.id),a.patchValue(n.util.fillForm(i,_)),a.controls.meta.setValue(n.planoEntregaService.getValor(t.meta)),a.controls.realizado.setValue(n.planoEntregaService.getValor(t.realizado)),a.controls.objetivos.setValue(t.objetivos),a.controls.processos.setValue(t.processos),n.dataFim&&a.controls.data_fim.setValue(n.dataFim),yield n.loadEtiquetas()})()}initializeData(t){var a=this;return(0,u.Z)(function*(){yield a.loadData(a.entity,t)})()}onSaveEntrega(){var t=this;return(0,u.Z)(function*(){let a,n=!0;if(t.formValidation)try{a=yield t.formValidation(t.form)}catch(i){a=i}if(t.form.valid&&!a){if("edit"==t.action){let i=(yield t.saveData(t.form.value)).modalResult,s=[];i._status="EDIT",t.loading=!0;try{s=yield t.planoEntregaDao.planosImpactadosPorAlteracaoEntrega(i)}finally{t.loading=!1}if(s.length){let g=s.map(_=>t.util.getDateFormatted(_.data_inicio)+" - "+t.util.getDateFormatted(_.data_fim)+" - "+_.unidade?.sigla+": "+_.usuario?.nome+"\n");n=yield t.dialog.confirm("Altera assim mesmo?","Caso prossiga com essa modifica\xe7\xe3o os seguintes planos de trabalho ser\xe3o repactuados automaticamente:\n\n"+g+"\nDeseja prosseguir?")}}n&&(yield t.onSaveData())}else t.form.markAllAsTouched(),a&&t.error(a)})()}saveData(t){return new Promise((a,n)=>{let i=this.util.fill(new F.O,this.entity);this.gridObjetivos?.confirm(),this.gridProcessos?.confirm();let{meta:s,realizado:g,..._}=this.form.value;i=this.util.fillForm(i,_),i.unidade=this.unidade?.selectedEntity,i.entrega=this.entrega?.selectedEntity,i.meta=this.planoEntregaService.getEntregaValor(i.entrega,s),i.realizado=this.planoEntregaService.getEntregaValor(i.entrega,g),a(new aa.R(i))})}onRealizadoChange(t,a){this.calculaRealizado()}calculaRealizado(){const t=this.form?.controls.meta.value,a=this.form?.controls.realizado.value;if(t&&a){let n=isNaN(a)?0:(a/t*100).toFixed(0)||0;this.form?.controls.progresso_realizado.setValue(n)}}dynamicOptionsObjetivos(t){let a=[];return a.push({label:"Excluir",icon:"bi bi-trash",color:"btn-outline-danger",onClick:i=>{this.removeObjetivo(i)}}),a}dynamicButtonsObjetivos(t){return[]}dynamicButtonsProcessos(t){return[]}addObjetivo(){var t=this;return(0,u.Z)(function*(){return{id:t.dao.generateUuid(),_status:"ADD"}})()}removeObjetivo(t){var a=this;return(0,u.Z)(function*(){return(yield a.dialog.confirm("Exclui ?","Deseja realmente excluir?"))&&(t._status="DELETE"),!1})()}saveObjetivo(t,a){var n=this;return(0,u.Z)(function*(){let i=a;if(t.controls.planejamento_objetivo_id.value.length&&n.inputObjetivo.selectedItem)return i.planejamento_objetivo_id=t.controls.planejamento_objetivo_id.value,i.objetivo=n.inputObjetivo.selectedItem.entity,i})()}addProcesso(){var t=this;return(0,u.Z)(function*(){return{id:t.dao.generateUuid(),_status:"ADD"}})()}removeProcesso(t){var a=this;return(0,u.Z)(function*(){return(yield a.dialog.confirm("Exclui ?","Deseja realmente excluir?"))&&(t._status="DELETE"),!1})()}saveProcesso(t,a){var n=this;return(0,u.Z)(function*(){let i=a;if(t.controls.cadeia_processo_id.value.length&&n.inputProcesso.selectedItem)return i.cadeia_processo_id=t.controls.cadeia_processo_id.value,i.processo=n.inputProcesso.selectedItem.entity,i})()}onEntregaChange(t){var a=this;return(0,u.Z)(function*(){if(a.entrega&&a.entrega.selectedItem){const n=a.entrega?.selectedEntity;switch(n.tipo_indicador){case"QUALITATIVO":a.itensQualitativo=n.lista_qualitativos||[],a.form?.controls.meta.setValue(a.itensQualitativo.length?a.itensQualitativo[0].key:null),a.form?.controls.realizado.setValue(a.itensQualitativo.length?a.itensQualitativo[0].key:null);break;case"VALOR":case"QUANTIDADE":a.form?.controls.meta.setValue(""),a.form?.controls.realizado.setValue(0);break;case"PORCENTAGEM":a.form?.controls.meta.setValue(100),a.form?.controls.realizado.setValue(0)}yield a.loadEtiquetas(),n.checklist&&a.loadChecklist(),a.calculaRealizado()}})()}loadEtiquetas(){var t=this;return(0,u.Z)(function*(){if(!t.etiquetasAscendentes.filter(a=>a.data==t.unidade?.selectedEntity?.id).length){let a=yield t.carregaEtiquetasUnidadesAscendentes(t.unidade?.selectedEntity);t.etiquetasAscendentes.push(...a)}t.etiquetas=t.util.merge(t.entrega?.selectedEntity?.etiquetas,t.unidade?.selectedEntity?.etiquetas,(a,n)=>a.key==n.key),t.etiquetas=t.util.merge(t.etiquetas,t.auth.usuario.config?.etiquetas,(a,n)=>a.key==n.key),t.etiquetas=t.util.merge(t.etiquetas,t.etiquetasAscendentes.filter(a=>a.data==t.unidade?.selectedEntity?.id),(a,n)=>a.key==n.key)})()}carregaEtiquetasUnidadesAscendentes(t){var a=this;return(0,u.Z)(function*(){let n=[],i=(t=t||a.auth.unidade).path.split("/");return(yield a.unidadeDao.query({where:[["id","in",i]]}).asPromise()).forEach(g=>{n=a.util.merge(n,g.etiquetas,(_,h)=>_.key==h.key)}),n.forEach(g=>g.data=t.id),n})()}loadChecklist(){let a=(this.entrega?.selectedEntity).checklist.map(n=>({id:n.id,texto:n.texto,checked:!1}));this.checklist=a||[],this.form.controls.checklist.setValue(a)}addItemHandleEtiquetas(){let t;if(this.etiqueta&&this.etiqueta.selectedItem){const a=this.etiqueta.selectedItem,n=a.key?.length?a.key:this.util.textHash(a.value);this.util.validateLookupItem(this.form.controls.etiquetas.value,n)&&(t={key:n,value:a.value,color:a.color,icon:a.icon},this.form.controls.etiqueta.setValue(""))}return t}static#e=this.\u0275fac=function(a){return new(a||o)(e.Y36(e.zs3))};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["plano-entrega-form-entrega"]],viewQuery:function(a,n){if(1&a&&(e.Gf(U.Q,5),e.Gf(oa,5),e.Gf(ia,5),e.Gf(la,5),e.Gf(sa,5),e.Gf(ra,5),e.Gf(da,5),e.Gf(ca,5),e.Gf(ua,5),e.Gf(ga,5),e.Gf(_a,5),e.Gf(pa,5)),2&a){let i;e.iGM(i=e.CRH())&&(n.editableForm=i.first),e.iGM(i=e.CRH())&&(n.gridProcessos=i.first),e.iGM(i=e.CRH())&&(n.gridObjetivos=i.first),e.iGM(i=e.CRH())&&(n.entregas=i.first),e.iGM(i=e.CRH())&&(n.planejamento=i.first),e.iGM(i=e.CRH())&&(n.cadeiaValor=i.first),e.iGM(i=e.CRH())&&(n.inputObjetivo=i.first),e.iGM(i=e.CRH())&&(n.inputProcesso=i.first),e.iGM(i=e.CRH())&&(n.entrega=i.first),e.iGM(i=e.CRH())&&(n.unidade=i.first),e.iGM(i=e.CRH())&&(n.tabs=i.first),e.iGM(i=e.CRH())&&(n.etiqueta=i.first)}},features:[e.qOj],decls:44,vars:57,consts:[["initialFocus","descricao",3,"form","disabled","title","submit","cancel"],["display","","right","",3,"title"],["tabs",""],["key","ENTREGAS","label","Entregas"],[1,"row"],["collapse","",3,"title","collapsed"],["label","T\xedtulo","controlName","descricao","required","",3,"size","placeholder"],["controlName","descricao_entrega",3,"size","label","placeholder"],["controlName","entrega_pai_id",3,"size","label","dao","where","selectRoute","metadata"],[1,"row","mt-4"],["editable","",3,"control","form","hasAdd","hasDelete"],["type","text","title","Texto","field","texto"],["type","options"],["date","","label","In\xedcio","controlName","data_inicio","required","",3,"size","labelInfo"],["date","","label","Fim","controlName","data_fim","required","",3,"size","labelInfo"],["label","Demandante","controlName","unidade_id","required","",3,"size","dao"],["unidade",""],["label","Destinat\xe1rio","controlName","destinatario","required","",3,"size"],["title","Planejamento"],["controlName","entrega_id","placeholder","Selecione ou cadastre uma meta do cat\xe1logo usando a lupa","required","",3,"size","label","dao","change"],["entrega",""],["label","Descri\xe7\xe3o da meta","controlName","descricao_meta","placeholder","Descreva a meta",3,"size"],["class","row",4,"ngIf","ngIfElse"],["naoSelecionou",""],["label","Etiquetas","controlName","etiquetas",3,"size","control","addItemHandle"],["controlName","etiqueta",3,"size","control","items"],["etiqueta",""],["key","OBJETIVOS","label","Objetivos",4,"ngIf"],["key","PROCESSOS","label","Processos",4,"ngIf"],["icon","bi bi-graph-up-arrow","label","Meta","labelInfo","Onde quero chegar ao final da entrega. Evolu\xe7\xe3o total da entrega, podendo ultrapassar o per\xedodo do plano de entregas",3,"entrega","size","control"],["label","Parcela da entrega no plano","controlName","progresso_esperado","sufix","%","labelInfo","Quanto vou caminhar nesse plano de entregas. Percentual do total da entrega que ser\xe1 realizado durante a vig\xeancia desse plano",3,"size"],["icon","bi bi-check-lg","label","Progresso ao in\xedcio do plano","labelInfo","De onde estou saindo nesse plano. Valor correspondente ao progresso verificado no planejamento do plano de entregas",3,"entrega","size","control","change"],["label","Progresso j\xe1 realizado","controlName","progresso_realizado","sufix","%","disabled","","labelInfo","Quanto caminhei no plano atual Evolu\xe7\xe3o j\xe1 realizada para a meta. No ato da cria\xe7\xe3o do plano, \xe9 o percentual de progresso ao in\xedcio do plano em rela\xe7\xe3o \xe0 meta",3,"size","stepValue"],["key","OBJETIVOS","label","Objetivos"],["controlName","planejamento_id","disabled","",3,"size","dao"],["planejamento",""],["editable","",3,"control","form","orderBy","hasDelete","hasEdit","add","remove","save"],["gridObjetivos",""],[3,"titleTemplate","template","editTemplate"],["titleObjetivo",""],["columnObjetivo",""],["editObjetivo",""],["by","objetivo.nome",3,"header"],["controlName","planejamento_objetivo_id",3,"size","where","dao","selectRoute"],["inputObjetivo",""],["key","PROCESSOS","label","Processos"],["controlName","cadeia_valor_id","disabled","",3,"size","dao"],["cadeiaValor",""],["gridProcessos",""],["titleProcessos",""],["processo",""],["editProcesso",""],["type","options",3,"dynamicButtons"],["by","processo.nome",3,"header"],["label","","icon","","controlName","cadeia_processo_id","label","",3,"size","where","dao","selectRoute"],["inputProcesso",""]],template:function(a,n){if(1&a&&(e.TgZ(0,"editable-form",0),e.NdJ("submit",function(){return n.onSaveEntrega()})("cancel",function(){return n.onCancel()}),e.TgZ(1,"tabs",1,2)(3,"tab",3)(4,"div",4)(5,"separator",5)(6,"div",4),e._UZ(7,"input-text",6),e.qZA(),e.TgZ(8,"div",4),e._UZ(9,"input-textarea",7),e.qZA(),e.TgZ(10,"div",4),e._UZ(11,"input-search",8),e.qZA(),e.TgZ(12,"separator",5)(13,"div",9)(14,"h5"),e._uU(15,"Etapas"),e.qZA(),e.TgZ(16,"grid",10)(17,"columns"),e._UZ(18,"column",11)(19,"column",12),e.qZA()()()()(),e.TgZ(20,"separator",5)(21,"div",4),e._UZ(22,"input-datetime",13)(23,"input-datetime",14),e.qZA(),e.TgZ(24,"div",4),e._UZ(25,"input-search",15,16)(27,"input-text",17),e.qZA()(),e._UZ(28,"separator",18),e.TgZ(29,"div",4)(30,"input-search",19,20),e.NdJ("change",function(s){return n.onEntregaChange(s)}),e.qZA()(),e.TgZ(32,"div",4),e._UZ(33,"input-textarea",21),e.qZA(),e.YNc(34,ma,6,10,"div",22),e.YNc(35,ha,3,3,"ng-template",null,23,e.W1O),e.TgZ(37,"separator",5)(38,"div",4)(39,"input-multiselect",24),e._UZ(40,"input-select",25,26),e.qZA()()()()(),e.YNc(42,Oa,14,13,"tab",27),e.YNc(43,Na,14,14,"tab",28),e.qZA()()),2&a){const i=e.MAs(31),s=e.MAs(36);e.Q6J("form",n.form)("disabled",n.formDisabled)("title",n.isModal?"":n.title),e.xp6(1),e.Q6J("title",n.isModal?"":n.title),e.xp6(4),e.Q6J("title","Informa\xe7\xf5es gerais da "+n.lex.translate("entrega"))("collapsed",!1),e.xp6(2),e.Q6J("size",12)("placeholder","T\xedtulo da "+n.lex.translate("entrega")),e.uIk("maxlength",250),e.xp6(2),e.Q6J("size",12)("label","Descri\xe7\xe3o da "+n.lex.translate("entrega"))("placeholder","Descreva a "+n.lex.translate("entrega")),e.xp6(2),e.Q6J("size",12)("label","V\xednculo com "+n.lex.translate("entrega")+" de "+n.lex.translate("plano de entrega")+" superior")("dao",n.planoEntregaEntregaDao)("where",e.VKq(50,ya,n.idsUnidadesAscendentes))("selectRoute",e.VKq(53,La,e.DdM(52,Ua)))("metadata",e.VKq(55,wa,n.idsUnidadesAscendentes)),e.xp6(1),e.Q6J("title","Etapas da "+n.lex.translate("entrega"))("collapsed",!0),e.xp6(4),e.Q6J("control",n.form.controls.checklist)("form",n.formChecklist)("hasAdd",!0)("hasDelete",!0),e.xp6(4),e.Q6J("title","Especifica\xe7\xf5es da "+n.lex.translate("entrega"))("collapsed",!1),e.xp6(2),e.Q6J("size",6)("labelInfo","In\xedcio "+n.lex.translate("Plano de Entregas")),e.xp6(1),e.Q6J("size",6)("labelInfo","Fim "+n.lex.translate("Plano de Entregas")+"(Estimativa Inicial)"),e.xp6(2),e.Q6J("size",6)("dao",n.unidadeDao),e.xp6(2),e.Q6J("size",6),e.uIk("maxlength",250),e.xp6(3),e.Q6J("size",12)("label",n.lex.translate("Tipo de Meta"))("dao",n.entregaDao),e.xp6(3),e.Q6J("size",12),e.xp6(1),e.Q6J("ngIf",null==i?null:i.selectedEntity)("ngIfElse",s),e.xp6(3),e.Q6J("title","Caracteriza\xe7\xe3o da "+n.lex.translate("entrega"))("collapsed",!1),e.xp6(2),e.Q6J("size",12)("control",n.form.controls.etiquetas)("addItemHandle",n.addItemHandleEtiquetas.bind(n)),e.xp6(1),e.Q6J("size",12)("control",n.form.controls.etiqueta)("items",n.etiquetas),e.xp6(2),e.Q6J("ngIf",null==n.planejamentoId?null:n.planejamentoId.length),e.xp6(1),e.Q6J("ngIf",null==n.cadeiaValorId?null:n.cadeiaValorId.length)}},dependencies:[O.O5,f.M,b.a,A.b,U.Q,J.V,j.m,na.Q,q.k,G.p,ie.p,_e.n,pe.i,B.N,X.l,H.l,$]})}return o})();var ve=r(8958),qa=r(39);const Qa=["selectResponsaveis"];function Ra(o,l){1&o&&(e.TgZ(0,"strong"),e._uU(1,"Respons\xe1vel"),e.qZA())}function Ja(o,l){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=l.row;e.xp6(1),e.hij(" ",t.responsavel," ")}}function Ma(o,l){1&o&&(e.TgZ(0,"strong"),e._uU(1,"Criado em"),e.qZA())}function Sa(o,l){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=l.row,a=e.oxw();e.xp6(1),e.Oqu(a.util.getDateTimeFormatted(t.date_time))}}function Va(o,l){1&o&&(e.TgZ(0,"div",2)(1,"div",17)(2,"strong"),e._uU(3,"Atributos"),e.qZA()(),e.TgZ(4,"div",18)(5,"strong"),e._uU(6,"Valores"),e._UZ(7,"br"),e._uU(8,"Atuais"),e.qZA()(),e.TgZ(9,"div",18)(10,"strong"),e._uU(11,"Valores"),e._UZ(12,"br"),e._uU(13,"Anteriores"),e.qZA()()())}function za(o,l){if(1&o&&(e.TgZ(0,"tr")(1,"td",21),e._uU(2),e.qZA(),e.TgZ(3,"td",22),e._uU(4),e.qZA(),e.TgZ(5,"td",22),e._uU(6),e.qZA()()),2&o){const t=l.$implicit,a=e.oxw(2);e.xp6(2),e.Oqu(t[0]),e.xp6(2),e.Oqu("EDIT"==a.action||"ADD"==a.action?t[1]:""),e.xp6(2),e.Oqu("EDIT"==a.action?t[2]:"ADD"==a.action?"":t[1])}}function ja(o,l){if(1&o&&(e.TgZ(0,"separator",19)(1,"table")(2,"tbody"),e.YNc(3,za,7,3,"tr",20),e.qZA()()()),2&o){const t=l.row,a=e.oxw();e.Q6J("collapse","collapse")("collapsed",!0),e.xp6(3),e.Q6J("ngForOf",a.preparaDelta(t))}}let Ga=(()=>{class o extends d.E{constructor(t,a){super(t,qa.R,ve.D),this.injector=t,this.responsaveis=[],this.planoId="",this.action="",this.filterWhere=n=>{let i=[],s=n.value;return i.push(["table_name","==","planos_entregas"]),i.push(["row_id","==",this.planoId]),s.responsavel_id?.length&&i.push(["user_id","==","null"==s.responsavel_id?null:s.responsavel_id]),s.data_inicio&&i.push(["date_time",">=",s.data_inicio]),s.data_fim&&i.push(["date_time","<=",s.data_fim]),s.tipo?.length&&i.push(["type","==",s.tipo]),i},this.planoEntregaDao=t.get(Z.r),this.title="Logs de Planos de Entregas",this.filter=this.fh.FormBuilder({responsavel_id:{default:""},data_inicio:{default:""},data_fim:{default:""},tipo:{default:""}}),this.orderBy=[["id","desc"]]}ngOnInit(){super.ngOnInit(),this.planoId=this.urlParams?.get("id")||"",this.planoEntregaDao.getById(this.planoId).then(t=>this.planoEntrega=t)}ngAfterViewInit(){super.ngAfterViewInit()}filterClear(t){t.controls.responsavel_id.setValue(""),t.controls.data_inicio.setValue(""),t.controls.data_fim.setValue(""),t.controls.tipo.setValue(""),super.filterClear(t)}preparaDelta(t){this.action=t.type;let a=t.delta instanceof Array?t.delta:Object.entries(t.delta);return a.forEach(n=>{n[1]instanceof Date&&(n[1]=new Date(n[1]).toUTCString()),n.length>2&&n[2]instanceof Date&&(n[2]=new Date(n[2]).toUTCString())}),a}static#e=this.\u0275fac=function(a){return new(a||o)(e.Y36(e.zs3),e.Y36(ve.D))};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["plano-entrega-list-logs"]],viewQuery:function(a,n){if(1&a&&(e.Gf(f.M,5),e.Gf(Qa,5)),2&a){let i;e.iGM(i=e.CRH())&&(n.grid=i.first),e.iGM(i=e.CRH())&&(n.selectResponsaveis=i.first)}},features:[e.qOj],decls:31,vars:30,consts:[[3,"dao","hasEdit","title","orderBy","groupBy","join"],[3,"deleted","form","where","submit","clear","collapseChange","collapsed"],[1,"row"],["label","Respons\xe1vel pelo registro","controlName","responsavel_id",3,"control","items"],["selectResponsaveis",""],["datetime","","label","In\xedcio","controlName","data_inicio","labelInfo","In\xedcio dos registros",3,"size","control"],["datetime","","label","Fim","controlName","data_fim","labelInfo","Fim dos registros",3,"size","control"],["label","Tipo","icon","bi bi-arrow-up-right-circle","controlName","tipo","itemTodos","Todos","valueTodos","",3,"size","control","items"],[3,"titleTemplate","template"],["titleResponsavel",""],["columnResponsavel",""],["titleDataCriacao",""],["columnDataCriacao",""],["titleDiferenca",""],["columnDiferenca",""],["title","Tipo de Opera\xe7\xe3o","field","type"],[3,"rows"],["width","150",1,"col","align-bottom"],["width","250",1,"col"],["title","(ver detalhes)",3,"collapse","collapsed"],[4,"ngFor","ngForOf"],["width","150"],["width","250"]],template:function(a,n){if(1&a&&(e.TgZ(0,"grid",0)(1,"span")(2,"strong"),e._uU(3),e.qZA()(),e._UZ(4,"toolbar"),e.TgZ(5,"filter",1)(6,"div",2),e._UZ(7,"input-select",3,4),e.qZA(),e.TgZ(9,"div",2),e._UZ(10,"input-datetime",5)(11,"input-datetime",6)(12,"input-select",7),e.qZA()(),e.TgZ(13,"columns")(14,"column",8),e.YNc(15,Ra,2,0,"ng-template",null,9,e.W1O),e.YNc(17,Ja,2,1,"ng-template",null,10,e.W1O),e.qZA(),e.TgZ(19,"column",8),e.YNc(20,Ma,2,0,"ng-template",null,11,e.W1O),e.YNc(22,Sa,2,1,"ng-template",null,12,e.W1O),e.qZA(),e.TgZ(24,"column",8),e.YNc(25,Va,14,0,"ng-template",null,13,e.W1O),e.YNc(27,ja,4,3,"ng-template",null,14,e.W1O),e.qZA(),e._UZ(29,"column",15),e.qZA(),e._UZ(30,"pagination",16),e.qZA()),2&a){const i=e.MAs(16),s=e.MAs(18),g=e.MAs(21),_=e.MAs(23),h=e.MAs(26),v=e.MAs(28);e.Q6J("dao",n.dao)("hasEdit",!1)("title",n.isModal?"":n.title)("orderBy",n.orderBy)("groupBy",n.groupBy)("join",n.join),e.xp6(3),e.Oqu((null==n.planoEntrega?null:n.planoEntrega.numero)+" - "+(null==n.planoEntrega?null:n.planoEntrega.nome)),e.xp6(2),e.Q6J("deleted",n.auth.hasPermissionTo("MOD_AUDIT_DEL"))("form",n.filter)("where",n.filterWhere)("submit",n.filterSubmit.bind(n))("clear",n.filterClear.bind(n))("collapseChange",n.filterCollapseChange.bind(n))("collapsed",!n.selectable&&n.filterCollapsed),e.xp6(2),e.Q6J("control",n.filter.controls.responsavel_id)("items",n.responsaveis),e.xp6(3),e.Q6J("size",4)("control",n.filter.controls.data_inicio),e.xp6(1),e.Q6J("size",4)("control",n.filter.controls.data_fim),e.xp6(1),e.Q6J("size",4)("control",n.filter.controls.tipo)("items",n.lookup.TIPO_LOG_CHANGE),e.xp6(2),e.Q6J("titleTemplate",i)("template",s),e.xp6(5),e.Q6J("titleTemplate",g)("template",_),e.xp6(5),e.Q6J("titleTemplate",h)("template",v),e.xp6(6),e.Q6J("rows",n.rowsLimit)}},dependencies:[O.sg,f.M,b.a,A.b,m.z,x.n,z.Q,q.k,G.p,B.N]})}return o})();function Fa(o,l){if(1&o&&(e.TgZ(0,"h3",18),e._uU(1),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Oqu(t.title)}}function ka(o,l){if(1&o&&e._UZ(0,"toolbar",19),2&o){const t=e.oxw();e.Q6J("buttons",t.buttons)}}function Ba(o,l){if(1&o&&e._UZ(0,"badge",20)(1,"br")(2,"badge",21)(3,"br")(4,"badge",22),2&o){const t=l.row,a=e.oxw();e.Q6J("label",t.descricao||"(n\xe3o informado)"),e.xp6(2),e.Q6J("icon",a.entityService.getIcon("Unidade"))("label",t.unidade.sigla||"(n\xe3o informado)"),e.xp6(2),e.Q6J("label",t.destinatario||"(n\xe3o informado)")}}function Ya(o,l){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e._UZ(2,"br"),e._uU(3),e.qZA()),2&o){const t=l.row,a=e.oxw();e.xp6(1),e.Oqu(a.dao.getDateFormatted(t.data_inicio)),e.xp6(2),e.Oqu(a.dao.getDateFormatted(t.data_fim))}}function Ha(o,l){if(1&o&&(e.TgZ(0,"span",24),e._UZ(1,"i",25),e._uU(2),e.qZA()),2&o){const t=e.oxw().row;e.xp6(2),e.hij(" ",t.entrega.nome||t.entrega_pai.descricao," ")}}function Wa(o,l){1&o&&e.YNc(0,Ha,3,1,"span",23),2&o&&e.Q6J("ngIf",l.row.entrega)}function Ka(o,l){if(1&o&&e._UZ(0,"badge",26)(1,"br")(2,"badge",26),2&o){const t=l.row,a=e.oxw();e.Q6J("label",a.planoEntregaService.getValorMeta(t)),e.xp6(2),e.Q6J("label",a.planoEntregaService.getValorRealizado(t))}}function Xa(o,l){1&o&&e._UZ(0,"progress-bar",27),2&o&&e.Q6J("value",l.row.progresso_realizado)}let $a=(()=>{class o extends d.E{constructor(t){super(t,F.O,L.K),this.injector=t,this.buttons=[],this.idsUnidadesAscendentes=[],this.filterWhere=a=>{let n=a.value,i=[];return this.idsUnidadesAscendentes.length&&i.push(["plano_entrega.unidade_id","in",this.idsUnidadesAscendentes]),n.unidade_id?.length&&i.push(["unidade_id","==",n.unidade_id]),n.descricao?.length&&i.push(["descricao","like","%"+n.descricao.trim().replace(" ","%")+"%"]),n.descricao?.length&&i.push(["descricao_entrega","like","%"+n.descricao_entrega.trim().replace(" ","%")+"%"]),n.destinatario?.length&&i.push(["destinatario","like","%"+n.destinatario.trim().replace(" ","%")+"%"]),i},this.planoEntregaDao=t.get(L.K),this.unidadeDao=t.get(N.J),this.planoEntregaService=t.get(c.f),this.title=this.lex.translate("Entregas"),this.filter=this.fh.FormBuilder({descricao:{default:""},descricao_entrega:{default:""},unidade_id:{default:""},destinatario:{default:""}}),this.join=["entrega:id,nome","entrega_pai:id,descricao","unidade:id,sigla"]}ngOnInit(){super.ngOnInit(),this.idsUnidadesAscendentes=this.metadata?.idsUnidadesAscendentes||this.idsUnidadesAscendentes,this.filter?.controls.unidade_id.setValue(this.idsUnidadesAscendentes[0])}dynamicOptions(t){let a=[];return a.push({label:"Informa\xe7\xf5es",icon:"bi bi-info-circle",onClick:n=>this.go.navigate({route:["gestao","planejamento","objetivo",n.id,"consult"]},{modal:!0})}),a}filterClear(t){super.filterClear(t)}static#e=this.\u0275fac=function(a){return new(a||o)(e.Y36(e.zs3))};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["app-plano-entrega-list-entrega-list"]],viewQuery:function(a,n){if(1&a&&e.Gf(f.M,5),2&a){let i;e.iGM(i=e.CRH())&&(n.grid=i.first)}},features:[e.qOj],decls:26,vars:32,consts:[["class","my-2",4,"ngIf"],[3,"dao","orderBy","groupBy","join","selectable","select"],[3,"buttons",4,"ngIf"],[3,"deleted","form","where","submit","clear","collapseChange","collapsed"],[1,"row"],["label","Unidade","controlName","unidade_id",3,"size","control","dao"],["label","T\xedtulo da entrega","controlName","descricao","placeholder","T\xedtulo",3,"size","control"],["label","Descri\xe7\xe3o da entrega","controlName","descricao_entrega","placeholder","Descri\xe7\xe3o",3,"size","control"],[3,"title","template"],["columnEntregaCliente",""],["columnDatas",""],["title","Entrega",3,"template"],["columnIndicador",""],["columnMetaRealizado",""],["title","Progresso",3,"template"],["columnProgresso",""],["type","options"],[3,"rows"],[1,"my-2"],[3,"buttons"],["icon","bi bi-textarea-t","color","light",3,"label"],["color","success",3,"icon","label"],["icon","bi bi-mailbox","color","light",3,"label"],["class","badge bg-light text-dark",4,"ngIf"],[1,"badge","bg-light","text-dark"],[1,"bi","bi-list-check"],["color","light",3,"label"],["color","success",3,"value"]],template:function(a,n){if(1&a&&(e.YNc(0,Fa,2,1,"h3",0),e.TgZ(1,"grid",1),e.NdJ("select",function(s){return n.onSelect(s)}),e.YNc(2,ka,1,1,"toolbar",2),e.TgZ(3,"filter",3)(4,"div",4),e._UZ(5,"input-search",5)(6,"input-text",6)(7,"input-text",7),e.qZA()(),e.TgZ(8,"columns")(9,"column",8),e.YNc(10,Ba,5,4,"ng-template",null,9,e.W1O),e.qZA(),e.TgZ(12,"column",8),e.YNc(13,Ya,4,2,"ng-template",null,10,e.W1O),e.qZA(),e.TgZ(15,"column",11),e.YNc(16,Wa,1,1,"ng-template",null,12,e.W1O),e.qZA(),e.TgZ(18,"column",8),e.YNc(19,Ka,3,2,"ng-template",null,13,e.W1O),e.qZA(),e.TgZ(21,"column",14),e.YNc(22,Xa,1,1,"ng-template",null,15,e.W1O),e.qZA(),e._UZ(24,"column",16),e.qZA(),e._UZ(25,"pagination",17),e.qZA()),2&a){const i=e.MAs(11),s=e.MAs(14),g=e.MAs(17),_=e.MAs(20),h=e.MAs(23);e.Q6J("ngIf",!n.isModal),e.xp6(1),e.Q6J("dao",n.dao)("orderBy",n.orderBy)("groupBy",n.groupBy)("join",n.join)("selectable",n.selectable),e.xp6(1),e.Q6J("ngIf",!n.selectable),e.xp6(1),e.Q6J("deleted",n.auth.hasPermissionTo("MOD_AUDIT_DEL"))("form",n.filter)("where",n.filterWhere)("submit",n.filterSubmit.bind(n))("clear",n.filterClear.bind(n))("collapseChange",n.filterCollapseChange.bind(n))("collapsed",!n.selectable&&n.filterCollapsed),e.xp6(2),e.Q6J("size",4)("control",n.filter.controls.unidade_id)("dao",n.unidadeDao),e.xp6(1),e.Q6J("size",4)("control",n.filter.controls.descricao),e.uIk("maxlength",250),e.xp6(1),e.Q6J("size",4)("control",n.filter.controls.descricao_entrega),e.uIk("maxlength",250),e.xp6(2),e.Q6J("title","Entrega\nDemandante\nDestinat\xe1rio")("template",i),e.xp6(3),e.Q6J("title","Data In\xedcio\nData Fim")("template",s),e.xp6(3),e.Q6J("template",g),e.xp6(3),e.Q6J("title","Meta\nRealizado")("template",_),e.xp6(3),e.Q6J("template",h),e.xp6(4),e.Q6J("rows",n.rowsLimit)}},dependencies:[O.O5,f.M,b.a,A.b,m.z,x.n,z.Q,J.V,j.m,y.F,Y.R]})}return o})();var en=r(38),tn=r(6976);let Ee=(()=>{class o extends tn.B{constructor(t){super("PlanoEntregaEntregaProgresso",t),this.injector=t,this.inputSearchConfig.searchFields=["data_progresso"]}static#e=this.\u0275fac=function(a){return new(a||o)(e.LFG(e.zs3))};static#t=this.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();class K extends w.X{constructor(l){super(),this.data_inicio=new Date,this.data_fim=null,this.data_progresso=null,this.homologado=!1,this.meta={},this.realizado={},this.progresso_esperado=100,this.progresso_realizado=0,this.plano_entrega_entrega_id="",this.usuario_id="",this.initialization(l)}}function an(o,l){1&o&&e._UZ(0,"toolbar")}function nn(o,l){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=e.oxw().row,a=e.oxw();e.xp6(1),e.hij(" ",a.dao.getDateFormatted(t.data_progresso),"")}}function on(o,l){1&o&&e.YNc(0,nn,2,1,"span",1),2&o&&e.Q6J("ngIf",l.row.data_progresso)}function ln(o,l){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=e.oxw().row,a=e.oxw();e.xp6(1),e.hij(" ",a.dao.getDateFormatted(t.data_inicio),"")}}function sn(o,l){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=e.oxw().row,a=e.oxw();e.xp6(1),e.hij(" ",a.dao.getDateFormatted(t.data_fim),"")}}function rn(o,l){if(1&o&&(e.YNc(0,ln,2,1,"span",1),e._UZ(1,"br"),e.YNc(2,sn,2,1,"span",1)),2&o){const t=l.row;e.Q6J("ngIf",t.data_inicio),e.xp6(2),e.Q6J("ngIf",t.data_fim)}}function dn(o,l){if(1&o&&e._UZ(0,"badge",15)(1,"br")(2,"badge",16),2&o){const t=l.row,a=e.oxw();e.Q6J("textValue",a.planoEntregaService.getValorMeta(t.plano_entrega_entrega)),e.xp6(2),e.Q6J("textValue",a.planoEntregaService.getValorRealizado(t.plano_entrega_entrega))}}function cn(o,l){if(1&o&&e._UZ(0,"progress-bar",17),2&o){const t=l.row;e.Q6J("value",t.progresso_realizado)("goal",t.progresso_esperado)}}let un=(()=>{class o extends d.E{constructor(t){super(t,K,Ee),this.injector=t,this.planoEntregaEntregaId="",this.filterWhere=a=>{let n=[],i=a.value;return i.data_inicial_progresso&&n.push(["data_progresso",">=",i.data_inicial_progresso]),i.data_final_progresso&&n.push(["data_progresso","<=",i.data_final_progresso]),n.push(["plano_entrega_entrega_id","==",this.planoEntregaEntregaId]),n},this.planoEntregaService=t.get(c.f),this.title=this.lex.translate("Hist\xf3rico de execu\xe7\xe3o"),this.orderBy=[["data_progresso","desc"]],this.join=["plano_entrega_entrega.entrega"],this.filter=this.fh.FormBuilder({data_inicial_progresso:{default:null},data_final_progresso:{default:null}}),this.addOption(Object.assign({onClick:this.delete.bind(this)},this.OPTION_EXCLUIR),"MOD_PENT_ENTR_PRO_EXCL")}onGridLoad(t){t?.forEach(a=>a.entrega=a.plano_entrega_entrega?.entrega)}ngOnInit(){super.ngOnInit(),this.planoEntregaEntregaId=this.urlParams.get("entrega_id")||""}static#e=this.\u0275fac=function(a){return new(a||o)(e.Y36(e.zs3))};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["app-plano-entrega-list-progresso"]],viewQuery:function(a,n){if(1&a&&e.Gf(f.M,5),2&a){let i;e.iGM(i=e.CRH())&&(n.grid=i.first)}},features:[e.qOj],decls:21,vars:38,consts:[[3,"dao","add","title","orderBy","groupBy","join","selectable","hasAdd","hasEdit","loadList","select"],[4,"ngIf"],[3,"deleted","form","where","submit","collapseChange","collapsed"],[1,"row"],["noIcon","","label","Data inical do progresso","controlName","data_inicial_progresso","labelInfo","Data que foi registrado o progresso",3,"size","control"],["noIcon","","label","Data final do progresso","controlName","data_final_progresso","labelInfo","Data que foi registrado o progresso",3,"size","control"],[3,"title","template","editTemplate"],["columnProgressoData",""],["columnDatas",""],[3,"title","width","template"],["columnMetaRealizado",""],[3,"title","width","template","editTemplate","columnEditTemplate"],["columnProgresso",""],["type","options",3,"onEdit","options"],[3,"rows"],["icon","bi bi-graph-up-arrow","color","light","hint","Planejada",3,"textValue"],["icon","bi bi-check-lg","color","light","hint","Realizada",3,"textValue"],["color","success",3,"value","goal"]],template:function(a,n){if(1&a&&(e.TgZ(0,"grid",0),e.NdJ("select",function(s){return n.onSelect(s)}),e.YNc(1,an,1,0,"toolbar",1),e.TgZ(2,"filter",2)(3,"div",3),e._UZ(4,"input-datetime",4)(5,"input-datetime",5),e.qZA()(),e.TgZ(6,"columns")(7,"column",6),e.YNc(8,on,1,1,"ng-template",null,7,e.W1O),e.qZA(),e.TgZ(10,"column",6),e.YNc(11,rn,3,2,"ng-template",null,8,e.W1O),e.qZA(),e.TgZ(13,"column",9),e.YNc(14,dn,3,2,"ng-template",null,10,e.W1O),e.qZA(),e.TgZ(16,"column",11),e.YNc(17,cn,1,2,"ng-template",null,12,e.W1O),e.qZA(),e._UZ(19,"column",13),e.qZA(),e._UZ(20,"pagination",14),e.qZA()),2&a){const i=e.MAs(9),s=e.MAs(12),g=e.MAs(15),_=e.MAs(18);e.Q6J("dao",n.dao)("add",n.add)("title",n.isModal?"":n.title)("orderBy",n.orderBy)("groupBy",n.groupBy)("join",n.join)("selectable",n.selectable)("hasAdd",n.auth.hasPermissionTo("MOD_PENT_ENTR_PRO_INCL"))("hasEdit",n.auth.hasPermissionTo("MOD_PENT_ENTR_PRO_EDT"))("loadList",n.onGridLoad.bind(n)),e.xp6(1),e.Q6J("ngIf",!n.selectable),e.xp6(1),e.Q6J("deleted",n.auth.hasPermissionTo("MOD_AUDIT_DEL"))("form",n.filter)("where",n.filterWhere)("submit",n.filterSubmit.bind(n))("collapseChange",n.filterCollapseChange.bind(n))("collapsed",!n.selectable&&n.filterCollapsed),e.xp6(2),e.Q6J("size",3)("control",n.filter.controls.data_inicial_progresso),e.xp6(1),e.Q6J("size",3)("control",n.filter.controls.data_final_progresso),e.xp6(2),e.Q6J("title","Data progresso")("template",i)("editTemplate",i),e.xp6(3),e.Q6J("title","Data In\xedcio\nData Fim")("template",s)("editTemplate",s),e.xp6(3),e.Q6J("title","Meta")("width",100)("template",g),e.xp6(3),e.Q6J("title","Progresso")("width",200)("template",_)("editTemplate",_)("columnEditTemplate",n.selectable?void 0:_),e.xp6(3),e.Q6J("onEdit",n.edit)("options",n.options),e.xp6(1),e.Q6J("rows",n.rowsLimit)}},dependencies:[O.O5,f.M,b.a,A.b,m.z,x.n,z.Q,q.k,y.F,Y.R]})}return o})(),Ae=(()=>{class o extends W.F{constructor(t){super(t,K,Ee),this.injector=t,this.validate=(a,n)=>{let i=null;return["progresso_realizado","realizado"].indexOf(n)>=0&&!(a.value>=0||a.value?.length>0)||["progresso_esperado","meta"].indexOf(n)>=0&&!(a.value>0||a.value?.length>0)?i="Obrigat\xf3rio":(["data_inicio"].indexOf(n)>=0&&!this.dao?.validDateTime(a.value)||["data_fim"].indexOf(n)>=0&&!this.dao?.validDateTime(a.value))&&(i="Inv\xe1lido"),i},this.titleEdit=a=>"Editando "+this.lex.translate("Progresso da entrega")+": "+(a?.entrega?.descricao||""),this.planoEntregaService=t.get(c.f),this.planoEntregaEntregaDao=t.get(L.K),this.join=["plano_entrega_entrega.entrega"],this.form=this.fh.FormBuilder({data_progresso:{default:new Date},data_inicio:{default:new Date},data_fim:{default:new Date},meta:{default:100},realizado:{default:null},progresso_esperado:{default:100},progresso_realizado:{default:null},usuario_id:{default:null},plano_entrega_entrega_id:{default:null}},this.cdRef,this.validate)}ngOnInit(){super.ngOnInit(),this.planoEntregaEntregaId=this.urlParams.get("entrega_id")}loadData(t,a){var n=this;return(0,u.Z)(function*(){let i=Object.assign({},a.value),{meta:s,realizado:g,..._}=t;a.patchValue(n.util.fillForm(i,_)),a.controls.meta.setValue(n.planoEntregaService.getValor(t.meta)),a.controls.realizado.setValue(n.planoEntregaService.getValor(t.realizado))})()}initializeData(t){var a=this;return(0,u.Z)(function*(){a.entity=new K,a.planoEntregaEntrega=a.planoEntregaEntregaId?yield a.planoEntregaEntregaDao.getById(a.planoEntregaEntregaId,["entrega"]):void 0,a.entity.usuario_id=a.auth.usuario.id,a.entity.plano_entrega_entrega_id=a.planoEntregaEntrega?.id,a.entity.plano_entrega_entrega=a.planoEntregaEntrega,a.entity.meta=a.planoEntregaEntrega?.meta,a.entity.realizado=a.planoEntregaEntrega?.realizado,a.entity.progresso_esperado=a.planoEntregaEntrega?.progresso_esperado,a.entity.progresso_realizado=a.planoEntregaEntrega?.progresso_realizado,a.entity.data_inicio=a.planoEntregaEntrega?.data_inicio,a.entity.data_fim=a.planoEntregaEntrega?.data_fim,yield a.loadData(a.entity,t)})()}saveData(t){return new Promise((a,n)=>{let i=this.util.fill(new K,this.entity),{meta:s,realizado:g,..._}=this.form.value;i=this.util.fillForm(i,_),i.meta=this.planoEntregaService.getEntregaValor(this.entity.plano_entrega_entrega?.entrega,s),i.realizado=this.planoEntregaService.getEntregaValor(this.entity.plano_entrega_entrega?.entrega,g),a(i)})}static#e=this.\u0275fac=function(a){return new(a||o)(e.Y36(e.zs3))};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["plano-entrega-form-progresso"]],viewQuery:function(a,n){if(1&a&&e.Gf(U.Q,5),2&a){let i;e.iGM(i=e.CRH())&&(n.editableForm=i.first)}},features:[e.qOj],decls:11,vars:16,consts:[["initialFocus","data_progresso",3,"form","disabled","title","submit","cancel"],[1,"row"],["date","","label","Data do progresso","controlName","data_progresso","required","",3,"size"],["date","","label","In\xedcio","controlName","data_inicio","required","",3,"size","labelInfo"],["date","","label","Fim","controlName","data_fim","required","",3,"size","labelInfo"],["icon","bi bi-graph-up-arrow","label","Meta",3,"entrega","size","control"],["icon","bi bi-check-lg","label","Valor Inicial","labelInfo","Valor da meta verificado no in\xedcio do plano de entrega",3,"entrega","size","control"],["label","Progresso Esperado","controlName","progresso_esperado","sufix","%",3,"size"],["label","Progresso Realizado","controlName","progresso_realizado","sufix","%",3,"size"]],template:function(a,n){1&a&&(e.TgZ(0,"editable-form",0),e.NdJ("submit",function(){return n.onSaveData()})("cancel",function(){return n.onCancel()}),e.TgZ(1,"div",1),e._UZ(2,"input-datetime",2)(3,"input-datetime",3)(4,"input-datetime",4),e.qZA(),e.TgZ(5,"div",1),e._UZ(6,"plano-entrega-valor-meta-input",5)(7,"plano-entrega-valor-meta-input",6),e.qZA(),e.TgZ(8,"div",1),e._UZ(9,"input-number",7)(10,"input-number",8),e.qZA()()),2&a&&(e.Q6J("form",n.form)("disabled",n.formDisabled)("title",n.isModal?"":n.title),e.xp6(2),e.Q6J("size",4),e.xp6(1),e.Q6J("size",4)("labelInfo","In\xedcio "+n.lex.translate("Plano de Entregas")),e.xp6(1),e.Q6J("size",4)("labelInfo","Fim "+n.lex.translate("Plano de Entregas")+"(Estimativa Inicial)"),e.xp6(2),e.Q6J("entrega",null==n.entity||null==n.entity.plano_entrega_entrega?null:n.entity.plano_entrega_entrega.entrega)("size",6)("control",n.form.controls.meta),e.xp6(1),e.Q6J("entrega",null==n.entity||null==n.entity.plano_entrega_entrega?null:n.entity.plano_entrega_entrega.entrega)("size",6)("control",n.form.controls.realizado),e.xp6(2),e.Q6J("size",6),e.xp6(1),e.Q6J("size",6))},dependencies:[U.Q,q.k,H.l,$]})}return o})();var gn=r(7744),_n=r(9173),pn=r(684),mn=r(4971);const hn=["listaAtividades"];function fn(o,l){1&o&&(e.TgZ(0,"b"),e._uU(1,"Descri\xe7\xe3o"),e.qZA())}function bn(o,l){if(1&o&&(e.TgZ(0,"span",8),e._uU(1),e.qZA(),e._UZ(2,"reaction",9)),2&o){const t=l.row;e.xp6(1),e.Oqu(t.descricao),e.xp6(1),e.Q6J("entity",t)}}function vn(o,l){if(1&o&&(e._uU(0," Un./"),e.TgZ(1,"order",10),e._uU(2,"Respons\xe1vel"),e.qZA(),e._UZ(3,"br"),e.TgZ(4,"order",11),e._uU(5,"Demandante"),e.qZA()),2&o){const t=l.header;e.xp6(1),e.Q6J("header",t),e.xp6(3),e.Q6J("header",t)}}function En(o,l){if(1&o&&(e.TgZ(0,"div",12),e._UZ(1,"badge",13)(2,"badge",14),e.qZA(),e._UZ(3,"badge",15)),2&o){const t=l.row,a=e.oxw();e.xp6(1),e.Q6J("label",t.unidade.sigla),e.xp6(1),e.Q6J("icon","bi "+(null!=t.usuario&&null!=t.usuario.nome&&t.usuario.nome.length?"bi-person-check":"bi-person-x"))("label",a.util.apelidoOuNome(t.usuario,!0)||"(N\xe3o atribu\xeddo)")("hint","Respons\xe1vel: "+((null==t.usuario?null:t.usuario.nome)||"N\xe3o atribuido a nenhum usu\xe1rio")),e.xp6(1),e.Q6J("label",a.util.apelidoOuNome(t.demandante,!0)||"Desconhecido")("hint","Demandante: "+((null==t.demandante?null:t.demandante.nome)||"Desconhecido"))}}function An(o,l){1&o&&e._UZ(0,"progress-bar",16),2&o&&e.Q6J("value",l.row.progresso)}let Tn=(()=>{class o extends k.D{set entregaId(t){this._entregaId!=t&&(this._entregaId=t)}get entregaId(){return this._entregaId}constructor(t){super(t),this.injector=t,this.items=[],this.loader=!1,this.AtividadeDao=t.get(mn.P),this.join=["unidade","usuario","demandante","reacoes.usuario:id,nome,apelido"]}ngOnInit(){super.ngOnInit(),this.loadData()}loadData(){this.loader=!0,this.AtividadeDao.query({where:[["plano_trabalho_entrega_id","==",this._entregaId],["unidades_subordinadas","==",!0]],join:this.join}).asPromise().then(t=>{this.items=t}).finally(()=>{this.loader=!1})}static#e=this.\u0275fac=function(a){return new(a||o)(e.Y36(e.zs3))};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["plano-trabalho-entrega-atividades"]],viewQuery:function(a,n){if(1&a&&e.Gf(hn,5),2&a){let i;e.iGM(i=e.CRH())&&(n.listaAtividades=i.first)}},inputs:{entregaId:"entregaId"},features:[e.qOj],decls:17,vars:10,consts:[[3,"items","loading"],[3,"titleTemplate","template"],["titleIdAtividadeDescricao",""],["columnAtividadeDescricao",""],["titleUnResponsavelDemandante",""],["columnPessoas",""],[3,"title","width","template"],["columnProgressoEtiquetasChecklist",""],[1,"micro-text","fw-ligh","atividade-descricao"],["origem","ATIVIDADE",3,"entity"],["by","usuario.nome",3,"header"],["by","demandante.nome",3,"header"],[1,"text-nowrap"],["icon","bi bi-briefcase","color","light",3,"label"],["color","light",3,"icon","label","hint"],["icon","bi bi-cursor","color","light",3,"label","hint"],["color","success",3,"value"]],template:function(a,n){if(1&a&&(e.TgZ(0,"h5"),e._uU(1),e.qZA(),e.TgZ(2,"grid",0)(3,"columns")(4,"column",1),e.YNc(5,fn,2,0,"ng-template",null,2,e.W1O),e.YNc(7,bn,3,2,"ng-template",null,3,e.W1O),e.qZA(),e.TgZ(9,"column",1),e.YNc(10,vn,6,2,"ng-template",null,4,e.W1O),e.YNc(12,En,4,6,"ng-template",null,5,e.W1O),e.qZA(),e.TgZ(14,"column",6),e.YNc(15,An,1,1,"ng-template",null,7,e.W1O),e.qZA()()()),2&a){const i=e.MAs(6),s=e.MAs(8),g=e.MAs(11),_=e.MAs(13),h=e.MAs(16);e.xp6(1),e.hij("",n.lex.translate("Atividades"),":"),e.xp6(1),e.Q6J("items",n.items)("loading",n.loader),e.xp6(2),e.Q6J("titleTemplate",i)("template",s),e.xp6(5),e.Q6J("titleTemplate",g)("template",_),e.xp6(5),e.Q6J("title","Progresso")("width",200)("template",h)}},dependencies:[f.M,b.a,A.b,X.l,y.F,Y.R,le.C]})}return o})();const On=["accordionUser"];function Cn(o,l){}function In(o,l){1&o&&e._UZ(0,"plano-trabalho-entrega-atividades",29),2&o&&e.Q6J("entregaId",l.row.id)}function Pn(o,l){1&o&&(e.TgZ(0,"div",30)(1,"span")(2,"strong"),e._uU(3,"Plano de trabalho"),e.qZA()()())}function Zn(o,l){if(1&o&&(e.TgZ(0,"span",31),e._uU(1),e._UZ(2,"br"),e._uU(3),e.qZA()),2&o){const t=e.oxw().$implicit,a=e.oxw(2);e.xp6(1),e.hij("",a.PlanoTrabalhoDao.getDateFormatted(t.data_inicio)," "),e.xp6(2),e.Oqu(" at\xe9 "+a.PlanoTrabalhoDao.getDateFormatted(t.data_fim))}}function Dn(o,l){1&o&&(e.TgZ(0,"div",30)(1,"span")(2,"strong"),e._uU(3,"Origem"),e.qZA()()())}function xn(o,l){if(1&o&&e._UZ(0,"badge",37),2&o){const t=e.oxw().row,a=e.oxw(3);e.Q6J("label",(null==t.plano_entrega_entrega||null==t.plano_entrega_entrega.plano_entrega||null==t.plano_entrega_entrega.plano_entrega.unidade?null:t.plano_entrega_entrega.plano_entrega.unidade.sigla)||"Desconhecido")("icon",a.entityService.getIcon("Unidade"))}}function Nn(o,l){if(1&o&&e._UZ(0,"badge",38),2&o){const t=e.oxw().row;e.Q6J("label",t.orgao)}}function yn(o,l){if(1&o&&(e.TgZ(0,"div",32)(1,"div",33),e._UZ(2,"badge",34),e.YNc(3,xn,1,2,"badge",35),e.YNc(4,Nn,1,1,"badge",36),e.qZA()()),2&o){const t=l.row,a=e.oxw(3);e.xp6(2),e.Q6J("label",a.planoTrabalhoService.tipoEntrega(t,a.entity).titulo)("color",a.planoTrabalhoService.tipoEntrega(t,a.entity).cor),e.xp6(1),e.Q6J("ngIf",null==t.plano_entrega_entrega_id?null:t.plano_entrega_entrega_id.length),e.xp6(1),e.Q6J("ngIf",null==t.orgao?null:t.orgao.length)}}function Un(o,l){if(1&o&&(e.TgZ(0,"div",30)(1,"small"),e._UZ(2,"badge",39),e.qZA()()),2&o){const t=e.oxw().$implicit,a=e.oxw(2);e.xp6(2),e.Q6J("color",100==a.totalForcaTrabalho(t.entregas)?"success":"warning")("label",a.totalForcaTrabalho(t.entregas)+"%")}}function Ln(o,l){if(1&o&&(e.TgZ(0,"small"),e._uU(1),e.qZA()),2&o){const t=l.row;e.xp6(1),e.Oqu(t.forca_trabalho+"%")}}function wn(o,l){1&o&&(e.TgZ(0,"div",30)(1,"span")(2,"strong"),e._uU(3,"Detalhamento/Descri\xe7\xe3o dos Trabalhos"),e.qZA()()())}function qn(o,l){if(1&o&&(e.TgZ(0,"small",30),e._uU(1),e.qZA()),2&o){const t=l.row;e.xp6(1),e.Oqu(t.descricao)}}function Qn(o,l){if(1&o&&e._UZ(0,"badge",40),2&o){const t=e.oxw().$implicit,a=e.oxw(2);e.Q6J("color",a.lookup.getColor(a.lookup.PLANO_TRABALHO_STATUS,t.status))("icon",a.lookup.getIcon(a.lookup.PLANO_TRABALHO_STATUS,t.status))("label",a.lookup.getValue(a.lookup.PLANO_TRABALHO_STATUS,t.status))}}function Rn(o,l){if(1&o&&(e.TgZ(0,"div",12)(1,"div",13)(2,"grid",14)(3,"columns")(4,"column",15),e.YNc(5,In,1,1,"ng-template",null,16,e.W1O),e.qZA(),e.TgZ(7,"column",17),e.YNc(8,Pn,4,0,"ng-template",null,18,e.W1O),e.YNc(10,Zn,4,2,"ng-template",null,19,e.W1O),e.qZA(),e.TgZ(12,"column",20),e.YNc(13,Dn,4,0,"ng-template",null,21,e.W1O),e.YNc(15,yn,5,4,"ng-template",null,22,e.W1O),e.qZA(),e.TgZ(17,"column",23),e.YNc(18,Un,3,2,"ng-template",null,9,e.W1O),e.YNc(20,Ln,2,1,"ng-template",null,10,e.W1O),e.qZA(),e.TgZ(22,"column",24),e.YNc(23,wn,4,0,"ng-template",null,25,e.W1O),e.YNc(25,qn,2,1,"ng-template",null,26,e.W1O),e.qZA(),e.TgZ(27,"column",27),e.YNc(28,Qn,1,3,"ng-template",null,28,e.W1O),e.qZA()()()()()),2&o){const t=l.$implicit,a=e.MAs(6),n=e.MAs(9),i=e.MAs(11),s=e.MAs(14),g=e.MAs(16),_=e.MAs(19),h=e.MAs(21),v=e.MAs(24),M=e.MAs(26),Q=e.MAs(29);e.xp6(2),e.Q6J("items",t.entregas),e.xp6(2),e.Akn("vertical-align:middle"),e.Q6J("expandTemplate",a),e.xp6(3),e.Q6J("template",i)("titleTemplate",n),e.xp6(5),e.Q6J("titleTemplate",s)("template",g)("verticalAlign","middle")("width",300)("align","center"),e.xp6(5),e.Q6J("titleTemplate",_)("title","% CHD")("template",h)("width",125)("align","center")("titleHint","% Carga Hor\xe1ria Dispon\xedvel"),e.xp6(5),e.Q6J("maxWidth",250)("titleTemplate",v)("template",M)("verticalAlign","middle")("align","center"),e.xp6(5),e.Q6J("template",Q)}}function Jn(o,l){if(1&o&&(e.TgZ(0,"h5"),e._uU(1,"Entregas do plano:"),e.qZA(),e._UZ(2,"hr"),e.YNc(3,Rn,30,23,"div",11)),2&o){const t=l.row;e.xp6(3),e.Q6J("ngForOf",t.planos_trabalho)}}function Mn(o,l){1&o&&(e.TgZ(0,"b"),e._uU(1,"Participante"),e.qZA())}function Sn(o,l){if(1&o&&(e.TgZ(0,"b"),e._uU(1),e.qZA(),e._UZ(2,"br"),e.TgZ(3,"small"),e._uU(4),e.qZA()),2&o){const t=l.row;e.xp6(1),e.Oqu(t.nome),e.xp6(3),e.Oqu(t.apelido||"")}}function Vn(o,l){}function zn(o,l){if(1&o&&(e.TgZ(0,"small"),e._UZ(1,"badge",39),e.qZA()),2&o){const t=l.row,a=e.oxw();e.xp6(1),e.Q6J("color",100==a.totalForcaTrabalho(a.planoAtivo(t.planos_trabalho).entregas)?"success":"warning")("label",a.totalForcaTrabalho(a.planoAtivo(t.planos_trabalho).entregas)+"%")}}let jn=(()=>{class o extends k.D{set entregaId(t){this._entregaId!=t&&(this._entregaId=t)}get entregaId(){return this._entregaId}constructor(t){super(t),this.injector=t,this.items=[],this.loader=!1,this.PlanoTrabalhoDao=t.get(gn.t),this.PlanoTrabalhoEntregaDao=t.get(_n.w),this.planoTrabalhoService=t.get(pn.p),this.join=["plano_trabalho.usuario","plano_entrega_entrega.plano_entrega.unidade"],this.groupBy=[{field:"plano_trabalho.usuario",label:"Usu\xe1rio"}]}ngOnInit(){super.ngOnInit(),this.loadData()}loadData(){this.loader=!0,this.cdRef.detectChanges();try{this.PlanoTrabalhoEntregaDao.query({where:[["plano_entrega_entrega_id","==",this._entregaId],["planoTrabalho.status","in",["ATIVO","CONCLUIDO","AVALIADO"]]],join:this.join}).asPromise().then(t=>{t.forEach(a=>{const n=a.plano_trabalho.usuario;if(n){const i=n.id;let s=this.items.find(v=>v.id===i);s||(s={...n,planos_trabalho:[],initialization(v){}},this.items.push(s));const g=a.plano_trabalho.id;let _=s.planos_trabalho.find(v=>v.id===g);_||(_={...a.plano_trabalho,entregas:[],initialization(v){}},s.planos_trabalho.push(_));const h={...a,initialization(v){}};_.entregas.push(h)}})}).finally(()=>{this.loader=!1,this.cdRef.detectChanges()})}catch{console.log("Erro")}}totalForcaTrabalho(t=[]){const a=t.map(n=>1*n.forca_trabalho).reduce((n,i)=>n+i,0);return Math.round(100*a)/100}planoAtivo(t){return t.find(n=>"ATIVO"===n.status)||{}}static#e=this.\u0275fac=function(a){return new(a||o)(e.Y36(e.zs3))};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["plano-entrega-entregas-plano-trabalho"]],viewQuery:function(a,n){if(1&a&&e.Gf(On,5),2&a){let i;e.iGM(i=e.CRH())&&(n.accordionUser=i.first)}},inputs:{entregaId:"entregaId"},features:[e.qOj],decls:18,vars:11,consts:[[3,"items","loading"],["accordionUser",""],["type","expand",3,"expandTemplate","template","width"],["usuarioSectionTitle",""],["columnExpandeEntregas",""],[3,"titleTemplate","template"],["titleParticipante",""],["columnParticipante",""],[3,"titleTemplate","template","title","titleHint"],["titleForcaTrabalho",""],["columnForcaTrabalho",""],["class","card mb-2",4,"ngFor","ngForOf"],[1,"card","mb-2"],[1,"card-body"],[3,"items"],["type","expand",3,"expandTemplate"],["columnExpandedAtividades",""],[3,"template","titleTemplate"],["titlePlano",""],["columnPlano",""],[3,"titleTemplate","template","verticalAlign","width","align"],["titleOrigem",""],["columnOrigem",""],[3,"titleTemplate","title","template","width","align","titleHint"],[3,"maxWidth","titleTemplate","template","verticalAlign","align"],["titleDescricao",""],["columnDescricao",""],["title","Status",3,"template"],["columnStatus",""],[3,"entregaId"],[1,"text-center"],[1,"d-block","text-center"],[1,"w-100","d-flex","justify-content-center"],[1,"one-per-line"],[3,"label","color"],["color","primary",3,"label","icon",4,"ngIf"],["icon","bi bi-box-arrow-down-left","color","warning",3,"label",4,"ngIf"],["color","primary",3,"label","icon"],["icon","bi bi-box-arrow-down-left","color","warning",3,"label"],["icon","bi bi-calculator",3,"color","label"],[3,"color","icon","label"]],template:function(a,n){if(1&a&&(e.TgZ(0,"grid",0,1)(2,"columns")(3,"column",2),e.YNc(4,Cn,0,0,"ng-template",null,3,e.W1O),e.YNc(6,Jn,4,1,"ng-template",null,4,e.W1O),e.qZA(),e.TgZ(8,"column",5),e.YNc(9,Mn,2,0,"ng-template",null,6,e.W1O),e.YNc(11,Sn,5,2,"ng-template",null,7,e.W1O),e.qZA(),e.TgZ(13,"column",8),e.YNc(14,Vn,0,0,"ng-template",null,9,e.W1O),e.YNc(16,zn,2,2,"ng-template",null,10,e.W1O),e.qZA()()()),2&a){const i=e.MAs(5),s=e.MAs(7),g=e.MAs(10),_=e.MAs(12),h=e.MAs(15),v=e.MAs(17);e.Q6J("items",n.items)("loading",n.loader),e.xp6(3),e.Q6J("expandTemplate",s)("template",i)("width",40),e.xp6(5),e.Q6J("titleTemplate",g)("template",_),e.xp6(5),e.Q6J("titleTemplate",h)("template",v)("title","% CHD")("titleHint","% Carga Hor\xe1ria Dispon\xedvel")}},dependencies:[O.sg,O.O5,f.M,b.a,A.b,y.F,Tn]})}return o})();var Te=r(5471),Gn=r(9838);function Fn(o,l){if(1&o&&e._UZ(0,"badge",8),2&o){const t=e.oxw().$implicit,a=e.oxw(2);e.Q6J("icon",a.entityService.getIcon("Unidade"))("label",null==t.data||null==t.data.unidade?null:t.data.unidade.sigla)}}function kn(o,l){if(1&o){const t=e.EpF();e.TgZ(0,"div",4),e._uU(1),e.qZA(),e.YNc(2,Fn,1,2,"badge",5),e._UZ(3,"br"),e.TgZ(4,"button",6),e.NdJ("click",function(){const i=e.CHM(t).$implicit,s=e.oxw(2);return e.KtG(s.showDetalhes(i.data))}),e._UZ(5,"i",7),e.qZA()}if(2&o){const t=l.$implicit;e.xp6(1),e.Oqu(t.label),e.xp6(1),e.Q6J("ngIf",null==t.data?null:t.data.unidade)}}function Bn(o,l){if(1&o&&(e.TgZ(0,"p-organizationChart",2),e.YNc(1,kn,6,2,"ng-template",3),e.qZA()),2&o){const t=e.oxw();e.Q6J("value",t.entregasVinculadas)}}function Yn(o,l){1&o&&(e.TgZ(0,"div",9)(1,"div",10),e._UZ(2,"span",11),e.qZA()())}let Hn=(()=>{class o extends k.D{set entregaId(t){this._entregaId!=t&&(this._entregaId=t)}get entregaId(){return this._entregaId}constructor(t){super(t),this.injector=t,this.loader=!1,this.entregasVinculadas=[],this.planoEntregaEntregaDao=t.get(L.K),this.join=["unidade"]}ngOnInit(){super.ngOnInit(),this.loadData()}loadData(){var t=this;return(0,u.Z)(function*(){t.loader=!0;try{t.entregasVinculadas=yield t.planoEntregaEntregaDao.hierarquia(t._entregaId),t.cdRef.detectChanges(),t.loader=!1}catch{console.log("Erro")}})()}showDetalhes(t){var a=this;return(0,u.Z)(function*(){a.go.navigate({route:["gestao","plano-entrega","entrega",t.id,"detalhes"]},{metadata:{entrega:t}})})()}static#e=this.\u0275fac=function(a){return new(a||o)(e.Y36(e.zs3))};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["plano-entrega-entregas-vinculadas"]],inputs:{entregaId:"entregaId"},features:[e.qOj],decls:2,vars:2,consts:[[3,"value",4,"ngIf"],["class","d-flex justify-content-center my-2",4,"ngIf"],[3,"value"],["pTemplate","default"],[1,"p-2"],["color","light",3,"icon","label",4,"ngIf"],["title","Detalhes da entrega",1,"btn","btn-sm",3,"click"],[1,"bi","bi-eye"],["color","light",3,"icon","label"],[1,"d-flex","justify-content-center","my-2"],["role","status",1,"spinner-border"],[1,"visually-hidden"]],template:function(a,n){1&a&&(e.YNc(0,Bn,2,1,"p-organizationChart",0),e.YNc(1,Yn,3,0,"div",1)),2&a&&(e.Q6J("ngIf",n.entregasVinculadas.length),e.xp6(1),e.Q6J("ngIf",n.loader))},dependencies:[O.O5,y.F,Te.OE,Gn.jx]})}return o})();function Wn(o,l){1&o&&e._UZ(0,"badge",19),2&o&&e.Q6J("lookup",l.$implicit)}function Kn(o,l){if(1&o&&e._UZ(0,"badge",20),2&o){const t=e.oxw(2);e.Q6J("icon",t.entityService.getIcon("Unidade"))("label",null==t.entrega||null==t.entrega.unidade?null:t.entrega.unidade.sigla)}}function Xn(o,l){if(1&o&&e._UZ(0,"badge",21),2&o){const t=e.oxw(2);e.Q6J("label",null==t.entrega?null:t.entrega.destinatario)}}function $n(o,l){if(1&o&&(e.TgZ(0,"div",22)(1,"div")(2,"b"),e._uU(3,"Planejada"),e.qZA(),e._UZ(4,"br")(5,"badge",23),e.qZA(),e._UZ(6,"div",24),e.TgZ(7,"div")(8,"b"),e._uU(9,"Executada"),e.qZA(),e._UZ(10,"br")(11,"badge",25),e.qZA()()),2&o){const t=e.oxw(2);e.xp6(5),e.Q6J("textValue",t.planoEntregaService.getValorMeta(t.entrega)),e.xp6(6),e.Q6J("textValue",t.planoEntregaService.getValorRealizado(t.entrega))}}function eo(o,l){if(1&o){const t=e.EpF();e.TgZ(0,"div",33)(1,"small"),e._uU(2),e.qZA(),e.TgZ(3,"button",34),e.NdJ("click",function(){e.CHM(t);const n=e.oxw().$implicit,i=e.oxw(3);return e.KtG(i.showPlanejamento(n.objetivo.id))}),e._UZ(4,"i",35),e.qZA()()}if(2&o){const t=e.oxw().$implicit;e.xp6(2),e.Oqu(t.objetivo.nome)}}function to(o,l){if(1&o&&(e.TgZ(0,"li",31),e.YNc(1,eo,5,1,"div",32),e.qZA()),2&o){const t=l.$implicit;e.xp6(1),e.Q6J("ngIf",t.objetivo)}}function ao(o,l){if(1&o&&(e.TgZ(0,"div",26)(1,"h5",27),e._uU(2),e.qZA(),e.TgZ(3,"div",28)(4,"ul",29),e.YNc(5,to,2,1,"li",30),e.qZA()()()),2&o){const t=e.oxw(2);e.xp6(2),e.Oqu(t.lex.translate("Objetivos")),e.xp6(3),e.Q6J("ngForOf",null==t.entrega?null:t.entrega.objetivos)}}function no(o,l){if(1&o){const t=e.EpF();e.TgZ(0,"div",33)(1,"small"),e._uU(2),e.qZA(),e.TgZ(3,"button",34),e.NdJ("click",function(){e.CHM(t);const n=e.oxw().$implicit,i=e.oxw(3);return e.KtG(i.showCadeiaValor(n.processo.id))}),e._UZ(4,"i",35),e.qZA()()}if(2&o){const t=e.oxw().$implicit;e.xp6(2),e.Oqu(t.processo.nome)}}function oo(o,l){if(1&o&&(e.TgZ(0,"li",31),e.YNc(1,no,5,1,"div",32),e.qZA()),2&o){const t=l.$implicit;e.xp6(1),e.Q6J("ngIf",t.processo)}}function io(o,l){if(1&o&&(e.TgZ(0,"div",26)(1,"h5",27),e._uU(2),e.qZA(),e.TgZ(3,"div",28)(4,"ul",29),e.YNc(5,oo,2,1,"li",30),e.qZA()()()),2&o){const t=e.oxw(2);e.xp6(2),e.Oqu(t.lex.translate("Processos")),e.xp6(3),e.Q6J("ngForOf",null==t.entrega?null:t.entrega.processos)}}function lo(o,l){if(1&o&&(e.TgZ(0,"div",8)(1,"div",9),e.YNc(2,Wn,1,1,"badge",10),e.qZA(),e.TgZ(3,"h5"),e._uU(4),e.qZA(),e.TgZ(5,"small"),e._uU(6),e.qZA(),e._UZ(7,"hr"),e.TgZ(8,"p"),e._uU(9,"Per\xedodo: "),e.TgZ(10,"small"),e._uU(11),e.qZA()(),e.TgZ(12,"div",11)(13,"p",12),e._uU(14,"Demandante: "),e.YNc(15,Kn,1,2,"badge",13),e.qZA(),e.TgZ(16,"p"),e._uU(17,"Destinat\xe1rio: "),e.YNc(18,Xn,1,1,"badge",14),e.qZA()(),e.TgZ(19,"h5",15),e._uU(20),e.qZA(),e.TgZ(21,"small",16),e._uU(22),e.qZA(),e.YNc(23,$n,12,2,"div",17),e.YNc(24,ao,6,2,"div",18),e.YNc(25,io,6,2,"div",18),e.qZA()),2&o){const t=e.oxw();e.xp6(2),e.Q6J("ngForOf",null==t.entrega?null:t.entrega.etiquetas),e.xp6(2),e.Oqu(null==t.entrega?null:t.entrega.descricao),e.xp6(2),e.Oqu(null==t.entrega?null:t.entrega.descricao_entrega),e.xp6(5),e.AsE("",t.planoEntregaEntregaDao.getDateFormatted(null==t.entrega?null:t.entrega.data_inicio)," at\xe9 ",t.planoEntregaEntregaDao.getDateFormatted(null==t.entrega?null:t.entrega.data_fim),""),e.xp6(4),e.Q6J("ngIf",null==t.entrega?null:t.entrega.unidade),e.xp6(3),e.Q6J("ngIf",null==t.entrega||null==t.entrega.destinatario?null:t.entrega.destinatario.length),e.xp6(2),e.Oqu(t.lex.translate("Meta")),e.xp6(2),e.Oqu(null==t.entrega?null:t.entrega.descricao_meta),e.xp6(1),e.Q6J("ngIf",t.entrega),e.xp6(1),e.Q6J("ngIf",null==t.entrega||null==t.entrega.objetivos?null:t.entrega.objetivos.length),e.xp6(1),e.Q6J("ngIf",null==t.entrega||null==t.entrega.processos?null:t.entrega.processos.length)}}function so(o,l){if(1&o&&(e.TgZ(0,"div",36),e._UZ(1,"plano-entrega-entregas-vinculadas",37),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("entregaId",t.entrega.id)}}function ro(o,l){if(1&o&&(e.TgZ(0,"div",38),e._UZ(1,"plano-entrega-entregas-plano-trabalho",37),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("entregaId",t.entrega.id)}}const uo=[{path:"",component:Nt,canActivate:[E.a],resolve:{config:C.o},runGuardsAndResolvers:"always",data:{title:"Plano de Entregas"}},{path:"new",component:ee,canActivate:[E.a],resolve:{config:C.o},runGuardsAndResolvers:"always",data:{title:"Inclus\xe3o de Plano de Entregas",modal:!0}},{path:":id/edit",component:ee,canActivate:[E.a],resolve:{config:C.o},runGuardsAndResolvers:"always",data:{title:"Edi\xe7\xe3o de Plano de Entregas",modal:!0}},{path:":id/consult",component:ee,canActivate:[E.a],resolve:{config:C.o},runGuardsAndResolvers:"always",data:{title:"Consulta a Plano de Entregas",modal:!0}},{path:":id/logs",component:Ga,canActivate:[E.a],resolve:{config:C.o},runGuardsAndResolvers:"always",data:{title:"Logs de Altera\xe7\xf5es em Planos de Entregas",modal:!0}},{path:":planoEntregaId/avaliar",component:en.w,canActivate:[E.a],resolve:{config:C.o},runGuardsAndResolvers:"always",data:{title:"Avaliar Plano de Entrega"}},{path:"entrega",component:be,canActivate:[E.a],resolve:{config:C.o},runGuardsAndResolvers:"always",data:{title:"Entregas do Plano de Entregas",modal:!0}},{path:"entrega/:id/consult",component:be,canActivate:[E.a],resolve:{config:C.o},runGuardsAndResolvers:"always",data:{title:"Consulta entrega do Plano de Entregas",modal:!0}},{path:"entrega/:id/detalhes",component:(()=>{class o extends k.D{constructor(t){super(t),this.injector=t,this.planoEntregaEntregaDao=t.get(L.K),this.planoEntregaService=t.get(c.f)}ngOnInit(){super.ngOnInit(),this.entrega=this.metadata?.entrega}showPlanejamento(t){var a=this;return(0,u.Z)(function*(){a.go.navigate({route:["gestao","plano-entrega","entrega","objetivos",t]},{modal:!0})})()}showCadeiaValor(t){var a=this;return(0,u.Z)(function*(){a.go.navigate({route:["gestao","plano-entrega","entrega","processos",t]},{modal:!0})})()}static#e=this.\u0275fac=function(a){return new(a||o)(e.Y36(e.zs3))};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["plano-entrega-entrega-detalhes"]],features:[e.qOj],decls:8,vars:4,consts:[["right","",3,"title"],["detalhesEntrega",""],["key","INFOS","icon","bi bi-info-lg","label","Informa\xe7\xf5es"],["key","VINCULOS","icon","bi bi-arrow-down-up","label","V\xednculos"],["key","PARTICIPANTES","icon","bi bi-people","label","Participantes"],["class","","style","min-height: 400px;",4,"ngIf"],["style","min-height: 400px;",4,"ngIf"],["class","row","style","min-height: 400px;",4,"ngIf"],[1,"",2,"min-height","400px"],[1,"mb-2"],[3,"lookup",4,"ngFor","ngForOf"],[1,"d-flex"],[1,"me-2"],["color","light",3,"icon","label",4,"ngIf"],["color","light","icon","bi bi-mailbox",3,"label",4,"ngIf"],[1,"text-center"],[1,"d-block","text-center","mb-2"],["class","d-flex justify-content-center",4,"ngIf"],["class","mt-3",4,"ngIf"],[3,"lookup"],["color","light",3,"icon","label"],["color","light","icon","bi bi-mailbox",3,"label"],[1,"d-flex","justify-content-center"],["icon","bi bi-graph-up-arrow","color","light","hint","Planejada",3,"textValue"],[1,"vr","mx-5"],["icon","bi bi-check-lg","color","light","hint","Realizada",3,"textValue"],[1,"mt-3"],[1,"text-center","mb-2"],[1,"card"],[1,"list-group","list-group-flush"],["class","list-group-item",4,"ngFor","ngForOf"],[1,"list-group-item"],["class","d-flex justify-content-between align-items-center",4,"ngIf"],[1,"d-flex","justify-content-between","align-items-center"],[1,"btn","btn-sm","btn-outline-info","me-2",3,"click"],[1,"bi","bi-eye"],[2,"min-height","400px"],[3,"entregaId"],[1,"row",2,"min-height","400px"]],template:function(a,n){if(1&a&&(e.TgZ(0,"tabs",0,1),e._UZ(2,"tab",2)(3,"tab",3)(4,"tab",4),e.qZA(),e.YNc(5,lo,26,12,"div",5),e.YNc(6,so,2,1,"div",6),e.YNc(7,ro,2,1,"div",7)),2&a){const i=e.MAs(1);e.Q6J("title",n.isModal?"":n.title),e.xp6(5),e.Q6J("ngIf","INFOS"==i.active),e.xp6(1),e.Q6J("ngIf","VINCULOS"==i.active&&n.entrega),e.xp6(1),e.Q6J("ngIf","PARTICIPANTES"==i.active&&n.entrega)}},dependencies:[O.sg,O.O5,_e.n,pe.i,y.F,jn,Hn]})}return o})(),canActivate:[E.a],resolve:{config:C.o},runGuardsAndResolvers:"always",data:{title:"Detalhes da entrega do Plano de Entregas",modal:!0}},{path:"entrega-list",component:$a,canActivate:[E.a],resolve:{config:C.o},runGuardsAndResolvers:"always",data:{title:"Entregas do Plano de Entregas",modal:!0}},{path:"entrega/objetivos/:objetivo_id",component:ge,canActivate:[E.a],resolve:{config:C.o},runGuardsAndResolvers:"always",data:{title:"Entregas do Plano de Entregas",modal:!0}},{path:"entrega/processos/:processo_id",component:ge,canActivate:[E.a],resolve:{config:C.o},runGuardsAndResolvers:"always",data:{title:"Entregas do Plano de Entregas",modal:!0}},{path:"adesao",component:ta,canActivate:[E.a],resolve:{config:C.o},runGuardsAndResolvers:"always",data:{title:"Ades\xe3o a Plano de Entregas",modal:!0}},{path:"entrega/progresso/:entrega_id",component:un,canActivate:[E.a],resolve:{config:C.o},runGuardsAndResolvers:"always",data:{title:"Progressos da entrega do Plano de Entregas",modal:!0}},{path:"entrega/progresso/:entrega_id/new",component:Ae,canActivate:[E.a],resolve:{config:C.o},runGuardsAndResolvers:"always",data:{title:"Inclus\xe3o de Progresso entrega do Plano de Entregas",modal:!0}},{path:"entrega/progresso/:entrega_id/:id/edit",component:Ae,canActivate:[E.a],resolve:{config:C.o},runGuardsAndResolvers:"always",data:{title:"Inclus\xe3o de Progresso entrega do Plano de Entregas",modal:!0}}];let go=(()=>{class o{static#e=this.\u0275fac=function(a){return new(a||o)};static#t=this.\u0275mod=e.oAB({type:o});static#a=this.\u0275inj=e.cJS({imports:[P.Bz.forChild(uo),P.Bz]})}return o})();var _o=r(7024),po=r(588),mo=r(2864);let ho=(()=>{class o{static#e=this.\u0275fac=function(a){return new(a||o)};static#t=this.\u0275mod=e.oAB({type:o});static#a=this.\u0275inj=e.cJS({imports:[O.ez,R.K,go,_o.PlanejamentoModule,po.CadeiaValorModule,Te.lC,mo.UteisModule]})}return o})()},684:(ne,S,r)=>{r.d(S,{p:()=>N});var O=r(8239),R=r(3972),P=r(755),E=r(2333),C=r(9193),u=r(2307),f=r(9702),D=r(7744),I=r(1095),Z=r(9367);let N=(()=>{class w{constructor(d,c,p,T,e,b,A,m){this.auth=d,this.util=c,this.go=p,this.lookup=T,this.dao=e,this.avaliacaoDao=b,this.templateService=A,this.planoTrabalhoDao=m}template(d){return d.programa?.template_tcr}metadados(d){return{needSign:this.needSign.bind(this),extraTags:this.extraTags.bind(this),especie:"TCR",titulo:"Termo de Ci\xeancia e Responsabilidade",dataset:this.planoTrabalhoDao.dataset(),datasource:this.planoTrabalhoDao.datasource(d),template:d.programa?.template_tcr,template_id:d.programa?.template_tcr_id}}needSign(d,c){const p=d,T=c||(p?.documentos||[]).find(e=>p?.documento_id?.length&&e.id==p?.documento_id)||p?.documento;if(d&&T&&!T.assinaturas?.find(e=>e.usuario_id==this.auth.usuario.id)){const e=p.tipo_modalidade,b=p.programa,A=this.auth.entidade;let m=[];return b?.plano_trabalho_assinatura_participante&&m.push(p.usuario_id),b?.plano_trabalho_assinatura_gestor_lotacao&&m.push(...this.auth.gestoresLotacao.map(x=>x.id)),b?.plano_trabalho_assinatura_gestor_unidade&&m.push(p.unidade?.gestor?.id||"",...p.unidade?.gestores_substitutos?.map(x=>x.id)||""),b?.plano_trabalho_assinatura_gestor_entidade&&m.push(A.gestor_id||"",A.gestor_substituto_id||""),!!e&&m.includes(this.auth.usuario.id)}return!1}extraTags(d,c,p){const T=d;let e=[];return T?.documento_id==c.id&&e.push({key:c.id,value:"Vigente",icon:"bi bi-check-all",color:"primary"}),JSON.stringify(p.tags)!=JSON.stringify(e)&&(p.tags=e),p.tags}tipoEntrega(d,c){let p=c||d.plano_trabalho,T=d.plano_entrega_entrega?.plano_entrega?.unidade_id==p.unidade_id?"PROPRIA_UNIDADE":d.plano_entrega_entrega?"OUTRA_UNIDADE":d.orgao?.length?"OUTRO_ORGAO":"SEM_ENTREGA",e=this.lookup.ORIGENS_ENTREGAS_PLANO_TRABALHO.find(m=>m.key==T)||{key:"",value:"Desconhecido1"};return{titulo:e.value,cor:e.color||"danger",nome:p?._metadata?.novaEntrega?.plano_entrega_entrega?.entrega?.nome||d.plano_entrega_entrega?.entrega?.nome||"Desconhecido2",tipo:T,descricao:p?._metadata?.novaEntrega?.plano_entrega_entrega?.descricao||d.plano_entrega_entrega?.descricao||""}}atualizarTcr(d,c,p,T){if(c.usuario&&c.unidade){let e=this.dao.datasource(d),b=this.dao.datasource(c),A=c.programa;if(b.usuario.texto_complementar_plano=p||c.usuario?.texto_complementar_plano||"",b.unidade.texto_complementar_plano=T||c.unidade?.texto_complementar_plano||"",(A?.termo_obrigatorio||c.documento_id?.length)&&JSON.stringify(b)!=JSON.stringify(e)&&A?.template_tcr){let m=c.documentos?.find(x=>x.id==c.documento_id);c.documento_id?.length&&m&&!m.assinaturas?.length&&"LINK"!=m.tipo?(m.conteudo=this.templateService.renderTemplate(A?.template_tcr?.conteudo||"",b),m.dataset=this.dao.dataset(),m.datasource=b,m._status="ADD"==m._status?"ADD":"EDIT"):(m=new R.U({id:this.dao?.generateUuid(),tipo:"HTML",especie:"TCR",titulo:"Termo de Ci\xeancia e Responsabilidade",conteudo:this.templateService.renderTemplate(A?.template_tcr?.conteudo||"",b),status:"GERADO",_status:"ADD",template:A?.template_tcr?.conteudo,dataset:this.dao.dataset(),datasource:b,entidade_id:this.auth.entidade?.id,plano_trabalho_id:c.id,template_id:A?.template_tcr_id}),c.documentos.push(m)),c.documento=m,c.documento_id=m?.id||null}}return c.documento}situacaoPlano(d){return d.deleted_at?"EXCLUIDO":d.data_arquivamento?"ARQUIVADO":d.status}isValido(d){return!d.deleted_at&&"CANCELADO"!=d.status&&!d.data_arquivamento}estaVigente(d){let c=new Date;return"ATIVO"==d.status&&d.data_inicio<=c&&d.data_fim>=c}diasParaConcluirConsolidacao(d,c){return d&&c?this.util.daystamp(d.data_fim)+c.dias_tolerancia_avaliacao-this.util.daystamp(this.auth.hora):-1}avaliar(d,c,p){this.go.navigate({route:["gestao","plano-trabalho","consolidacao",d.id,"avaliar"]},{modal:!0,metadata:{consolidacao:d,programa:c},modalClose:T=>{T&&(d.status="AVALIADO",d.avaliacao_id=T.id,d.avaliacao=T,p(d))}})}visualizarAvaliacao(d){this.go.navigate({route:["gestao","plano-trabalho","consolidacao",d.id,"verAvaliacoes"]},{modal:!0,metadata:{consolidacao:d}})}fazerRecurso(d,c,p){this.go.navigate({route:["gestao","plano-trabalho","consolidacao",d.id,"recurso"]},{modal:!0,metadata:{recurso:!0,consolidacao:d,programa:c},modalClose:T=>{T&&(d.avaliacao=T,p(d))}})}cancelarAvaliacao(d,c,p){var T=this;return(0,O.Z)(function*(){c.submitting=!0;try{(yield T.avaliacaoDao.cancelarAvaliacao(d.avaliacao.id))&&(d.status="CONCLUIDO",d.avaliacao_id=null,d.avaliacao=void 0,p(d))}catch(e){c.error(e.message||e)}finally{c.submitting=!1}})()}usuarioAssinou(d,c){return c=c||this.auth.usuario.id,Object.values(d).some(p=>(p||[]).includes(c))}assinaturasFaltantes(d,c){return{participante:d.participante.filter(p=>!c.participante.includes(p)),gestores_unidade_executora:d.gestores_unidade_executora.length?d.gestores_unidade_executora.filter(p=>c.gestores_unidade_executora.includes(p)).length?[]:d.gestores_unidade_executora:[],gestores_unidade_lotacao:d.gestores_unidade_lotacao.length?d.gestores_unidade_lotacao.filter(p=>c.gestores_unidade_lotacao.includes(p)).length?[]:d.gestores_unidade_lotacao:[],gestores_entidade:d.gestores_entidade.length?d.gestores_entidade.filter(p=>c.gestores_entidade.includes(p)).length?[]:d.gestores_entidade:[]}}static#e=this.\u0275fac=function(c){return new(c||w)(P.LFG(E.e),P.LFG(C.f),P.LFG(u.o),P.LFG(f.W),P.LFG(D.t),P.LFG(I.w),P.LFG(Z.E),P.LFG(D.t))};static#t=this.\u0275prov=P.Yz7({token:w,factory:w.\u0275fac,providedIn:"root"})}return w})()}}]);
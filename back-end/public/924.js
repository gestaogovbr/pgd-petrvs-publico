"use strict";(self.webpackChunkpetrvs=self.webpackChunkpetrvs||[]).push([[924],{9036:(oe,$,r)=>{r.d($,{l:()=>D});var A=r(4423),V=r(3279);let D=(()=>{class b extends A.F{constructor(m){super("Avaliacao",m),this.injector=m,this.inputSearchConfig.searchFields=[]}cancelarAvaliacao(m){return new Promise((f,R)=>{this.server.post("api/"+this.collection+"/cancelar-avaliacao",{id:m}).subscribe(I=>{I?.error?R(I?.error):f(!0)},I=>R(I))})}recorrer(m,f){return new Promise((R,I)=>{this.server.post("api/"+this.collection+"/recorrer",{id:m.id,recurso:f}).subscribe(P=>{P?.error?I(P?.error):(m.recurso=f,R(!0))},P=>I(P))})}static{this.\u0275fac=function(f){return new(f||b)(V.KVO(V.zZn))}}static{this.\u0275prov=V.jDH({token:b,factory:b.\u0275fac,providedIn:"root"})}}return b})()},924:(oe,$,r)=>{r.r($),r.d($,{PlanoEntregaModule:()=>bo});var A=r(6610),V=r(8425),D=r(1260),b=r(1620),C=r(6819),m=r(3308),f=r(5611),R=r(8467),I=r(6149),P=r(9416),j=r(3535),S=r(291);class w extends S.C{constructor(l){super(),this.entregas=[],this.status_historico=[],this.data_inicio=new Date,this.data_fim=null,this.nome="",this.metadados=void 0,this.arquivar=!1,this.status="INCLUIDO",this.avaliacoes=[],this.unidade_id="",this.avaliacao_id=null,this.plano_entrega_id=null,this.planejamento_id=null,this.cadeia_valor_id=null,this.programa_id=null,this.initialization(l)}}var d=r(9062),u=r(1928),_=r(9036),v=r(976),T=r(8790),e=r(3279),O=r(2034),p=r(5852),G=r(7772),B=r(2305),U=r(6764),ie=r(114),Y=r(9226),M=r(16),k=r(5524),q=r(3678),ee=r(9898),y=r(5201),Ie=r(3400),N=r(1641),L=r(8717),X=r(418),x=r(4795),le=r(1230),H=r(8857),Q=r(3881),J=r(368),se=r(8311),De=r(7072);const Pe=()=>["PORCENTAGEM"],Re=()=>["QUANTIDADE","VALOR"],Ge=()=>["QUALITATIVO"],je=()=>[];function ye(o,l){if(1&o){const t=e.RV6();e.j41(0,"input-number",3),e.bIt("change",function(n){e.eBV(t);const i=e.XpG();return e.Njj(i.onValueChange(n))}),e.k0s()}if(2&o){const t=e.XpG();e.Y8G("disabled",t.disabled)("icon",t.icon)("label",t.label||"Porcentagem")("control",t.control)("labelInfo",t.labelInfo)}}function Ne(o,l){if(1&o){const t=e.RV6();e.j41(0,"input-number",4),e.bIt("change",function(n){e.eBV(t);const i=e.XpG();return e.Njj(i.onValueChange(n))}),e.k0s()}if(2&o){const t=e.XpG();e.Y8G("disabled",t.disabled)("icon",t.icon)("label",t.label||"Num\xe9rico")("control",t.control)("labelInfo",t.labelInfo)}}function Le(o,l){if(1&o){const t=e.RV6();e.j41(0,"input-select",5),e.bIt("change",function(n){e.eBV(t);const i=e.XpG();return e.Njj(i.onValueChange(n))}),e.k0s()}if(2&o){const t=e.XpG();e.Y8G("disabled",t.disabled)("icon",t.icon)("label",t.label||"Qualitativo")("control",t.control)("items",(null==t.entrega?null:t.entrega.lista_qualitativos)||e.lJ4(6,je))("labelInfo",t.labelInfo)}}let te=(()=>{class o{constructor(){this.class="form-group",this.icon="",this.labelInfo="",this._size=0}set size(t){t!=this._size&&(this._size=t,this.class=this.class.replace(/\scol\-md\-[0-9]+/g,"")+" col-md-"+t)}get size(){return this._size||12}checkTipoIndicador(t){return t.includes(this.entrega?.tipo_indicador||"")}onValueChange(t){this.change&&this.change(this.control?.value,this.entrega)}static{this.\u0275fac=function(a){return new(a||o)}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["plano-entrega-valor-meta-input"]],hostVars:2,hostBindings:function(a,n){2&a&&e.HbH(n.class)},inputs:{entrega:"entrega",icon:"icon",label:"label",labelInfo:"labelInfo",disabled:"disabled",control:"control",change:"change",size:"size"},decls:3,vars:6,consts:[["sufix","%","required","",3,"disabled","icon","label","control","labelInfo","change",4,"ngIf"],["required","",3,"disabled","icon","label","control","labelInfo","change",4,"ngIf"],["required","",3,"disabled","icon","label","control","items","labelInfo","change",4,"ngIf"],["sufix","%","required","",3,"change","disabled","icon","label","control","labelInfo"],["required","",3,"change","disabled","icon","label","control","labelInfo"],["required","",3,"change","disabled","icon","label","control","items","labelInfo"]],template:function(a,n){1&a&&e.DNE(0,ye,1,5,"input-number",0)(1,Ne,1,5,"input-number",1)(2,Le,1,7,"input-select",2),2&a&&(e.Y8G("ngIf",n.checkTipoIndicador(e.lJ4(3,Pe))),e.R7$(),e.Y8G("ngIf",n.checkTipoIndicador(e.lJ4(4,Re))),e.R7$(),e.Y8G("ngIf",n.checkTipoIndicador(e.lJ4(5,Ge))))},dependencies:[A.bT,q.K,J.n]})}}return o})();const Se=["etiqueta"];function ke(o,l){if(1&o&&(e.j41(0,"strong",17),e.EFF(1,"Entregas: "),e.k0s(),e.j41(2,"span",18),e.nrm(3,"badge",19),e.k0s()),2&o){const t=l.separator;e.R7$(3),e.Y8G("label",null==t?null:t.text)}}function Fe(o,l){if(1&o&&e.nrm(0,"badge",24),2&o){const t=e.XpG().row,a=e.XpG();e.Y8G("icon",a.entityService.getIcon("Unidade"))("label",t.unidade.sigla)}}function Ve(o,l){if(1&o&&e.nrm(0,"badge",25),2&o){const t=e.XpG().row;e.Y8G("label",t.destinatario)}}function Ye(o,l){if(1&o&&e.nrm(0,"reaction",26),2&o){const t=e.XpG().row;e.Y8G("entity",t)}}function ze(o,l){if(1&o&&(e.j41(0,"h6"),e.EFF(1),e.k0s(),e.j41(2,"span",20),e.DNE(3,Fe,1,2,"badge",21)(4,Ve,1,1,"badge",22),e.k0s(),e.DNE(5,Ye,1,1,"reaction",23)),2&o){const t=l.row,a=e.XpG();e.R7$(),e.JRh(t.descricao),e.R7$(2),e.Y8G("ngIf",t.unidade),e.R7$(),e.Y8G("ngIf",null==t.destinatario?null:t.destinatario.length),e.R7$(),e.Y8G("ngIf",a.execucao)}}function $e(o,l){1&o&&e.nrm(0,"badge",28),2&o&&e.Y8G("lookup",l.$implicit)}function we(o,l){1&o&&e.DNE(0,$e,1,1,"badge",27),2&o&&e.Y8G("ngForOf",l.row.etiquetas)}function Be(o,l){if(1&o){const t=e.RV6();e.j41(0,"input-multiselect",29)(1,"input-select",30,8),e.bIt("details",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.onEtiquetaConfigClick())}),e.k0s()()}if(2&o){const t=e.XpG();e.Y8G("size",12)("control",t.formEdit.controls.etiquetas)("addItemHandle",t.addItemHandleEtiquetas.bind(t)),e.R7$(),e.Y8G("size",12)("control",t.formEdit.controls.etiqueta)("items",t.etiquetas)}}function Ue(o,l){if(1&o&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&o){const t=e.XpG().row,a=e.XpG();e.R7$(),e.SpI(" ",a.dao.getDateFormatted(t.data_inicio),"")}}function Me(o,l){if(1&o&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&o){const t=e.XpG().row,a=e.XpG();e.R7$(),e.SpI(" ",a.dao.getDateFormatted(t.data_fim),"")}}function qe(o,l){if(1&o&&(e.DNE(0,Ue,2,1,"span",31),e.nrm(1,"br"),e.DNE(2,Me,2,1,"span",31)),2&o){const t=l.row;e.Y8G("ngIf",t.data_inicio),e.R7$(2),e.Y8G("ngIf",t.data_fim)}}function Xe(o,l){if(1&o&&e.nrm(0,"badge",32)(1,"br")(2,"badge",33),2&o){const t=l.row,a=e.XpG();e.Y8G("textValue",a.planoEntregaService.getValorMeta(t)),e.R7$(2),e.Y8G("textValue",a.planoEntregaService.getValorRealizado(t))}}function xe(o,l){if(1&o&&e.nrm(0,"plano-entrega-valor-meta-input",34)(1,"plano-entrega-valor-meta-input",35),2&o){const t=l.row,a=e.XpG();e.Y8G("entrega",t.entrega)("size",6)("control",a.form.controls.meta),e.R7$(),e.Y8G("entrega",t.entrega)("size",6)("control",a.form.controls.realizado)("change",a.onRealizadaChange.bind(a))}}function He(o,l){1&o&&e.nrm(0,"i",42)}function Qe(o,l){if(1&o&&(e.j41(0,"tr")(1,"td"),e.DNE(2,He,1,0,"i",40),e.k0s(),e.j41(3,"td",41),e.EFF(4),e.k0s()()),2&o){const t=l.$implicit;e.R7$(2),e.Y8G("ngIf",t.checked),e.R7$(2),e.JRh(t.texto)}}function Je(o,l){if(1&o&&(e.j41(0,"table"),e.DNE(1,Qe,5,2,"tr",39),e.k0s()),2&o){const t=e.XpG(2).row;e.R7$(),e.Y8G("ngForOf",t.checklist)}}function We(o,l){if(1&o&&(e.j41(0,"separator",38),e.DNE(1,Je,2,1,"table",31),e.k0s()),2&o){const t=e.XpG().row;e.Y8G("collapsed",!0),e.R7$(),e.Y8G("ngIf",null==t.checklist?null:t.checklist.length)}}function Ke(o,l){if(1&o&&(e.nrm(0,"progress-bar",36),e.DNE(1,We,2,2,"separator",37)),2&o){const t=l.row;e.Y8G("value",t.progresso_realizado)("goal",t.progresso_esperado),e.R7$(),e.Y8G("ngIf",null==t.checklist?null:t.checklist.length)}}function Ze(o,l){1&o&&e.nrm(0,"separator",45)}function et(o,l){if(1&o&&(e.j41(0,"tr")(1,"td"),e.nrm(2,"input-switch",46),e.k0s(),e.j41(3,"td",41),e.EFF(4),e.k0s()()),2&o){const t=l.$implicit,a=l.index,n=e.XpG(4);e.R7$(2),e.Y8G("size",12)("source",n.checklist)("path",a+".checked"),e.R7$(2),e.JRh(t.texto)}}function tt(o,l){if(1&o&&(e.j41(0,"table"),e.DNE(1,et,5,4,"tr",39),e.k0s()),2&o){const t=e.XpG(3);e.R7$(),e.Y8G("ngForOf",t.checklist)}}function at(o,l){if(1&o&&(e.nrm(0,"input-number",43),e.DNE(1,Ze,1,0,"separator",44)(2,tt,2,1,"table",31)),2&o){const t=l.row,a=e.XpG(2);e.Y8G("size",12)("control",a.formEdit.controls.progresso_realizado),e.R7$(),e.Y8G("ngIf",null==t.checklist?null:t.checklist.length),e.R7$(),e.Y8G("ngIf",null==t.checklist?null:t.checklist.length)}}function nt(o,l){if(1&o&&(e.j41(0,"column",13),e.DNE(1,Ke,2,3,"ng-template",null,9,e.C5r)(3,at,3,4,"ng-template",null,10,e.C5r),e.k0s()),2&o){const t=e.sdS(2),a=e.sdS(4),n=e.XpG();e.Y8G("title","Progresso\nChecklist")("width",200)("template",t)("editTemplate",t)("columnEditTemplate",n.selectable?void 0:a)("edit",n.selectable?void 0:n.onColumnChecklistEdit.bind(n))("save",n.selectable?void 0:n.onColumnChecklistSave.bind(n))}}function ot(o,l){if(1&o&&e.nrm(0,"badge",49),2&o){const t=e.XpG().row;e.Y8G("label",null==t.entrega?null:t.entrega.nome)}}function it(o,l){if(1&o&&(e.DNE(0,ot,1,1,"badge",47),e.nrm(1,"comentarios-widget",48)),2&o){const t=l.row,a=e.XpG();e.Y8G("ngIf",t.entrega),e.R7$(),e.Y8G("entity",t)("selectable",!a.execucao||!(null==a.grid||!a.grid.editing))("grid",a.grid)("save",a.refreshComentarios.bind(a))}}let re=(()=>{class o extends x.g{set noPersist(t){super.noPersist=t}get noPersist(){return super.noPersist}set control(t){super.control=t}get control(){return super.control}set entity(t){super.entity=t}get entity(){return super.entity}set planejamentoId(t){this._planejamentoId!=t&&(this._planejamentoId=t)}get planejamentoId(){return this._planejamentoId}set cadeiaValorId(t){this._cadeiaValorId!=t&&(this._cadeiaValorId=t)}get cadeiaValorId(){return this._cadeiaValorId}set unidadeId(t){this._unidadeId!=t&&(this._unidadeId=t)}get unidadeId(){return this._unidadeId}set dataFim(t){this._dataFim!=t&&(this._dataFim=t)}get dataFim(){return this._dataFim}get items(){return this.gridControl.value||this.gridControl.setValue([]),this.gridControl.value}constructor(t){super(t),this.injector=t,this.disabled=!1,this.execucao=!1,this.entityToControl=a=>a.entregas||[],this.options=[],this.planoEntregaId="",this.etiquetas=[],this.etiquetasAscendentes=[],this.selectable=!1,this.validate=(a,n)=>{let i=null;return["nome"].indexOf(n)>=0&&!a.value?.length&&(i="Obrigat\xf3rio"),i},this.filterWhere=a=>{let n=[];return n.push(["plano_entrega_id","==",this.planoEntregaId]),n},this.title=this.lex.translate("Entregas"),this.join=["unidade","entrega","reacoes.usuario:id,nome,apelido","produtos"],this.code="MOD_PENT",this.cdRef=t.get(e.gRc),this.dao=t.get(L.o),this.unidadeDao=t.get(j.s),this.planoEntregaService=t.get(u.C),this.form=this.fh.FormBuilder({descricao:{default:""},data_inicio:{default:new Date},data_fim:{default:new Date},meta:{default:""},realizado:{default:null},entrega_id:{default:null},unidade_id:{default:null},progresso_esperado:{default:null},progresso_realizado:{default:null},destinatario:{default:null},etiquetas:{default:[]}},this.cdRef,this.validate),this.formEdit=this.fh.FormBuilder({progresso_realizado:{default:0},etiquetas:{default:[]},etiqueta:{default:null}}),this.addOption(Object.assign({onClick:this.consult.bind(this)},this.OPTION_INFORMACOES),"MOD_PENT"),this.addOption(Object.assign({onClick:this.delete.bind(this)},this.OPTION_EXCLUIR),"MOD_PENT_ENTR_EXCL"),this.addOption(Object.assign({onClick:this.showLogs.bind(this)},this.OPTION_LOGS),"MOD_AUDIT_LOG")}ngOnInit(){super.ngOnInit(),this.planoEntregaId=this.urlParams.get("id")||""}get isDisabled(){return this.formDisabled||this.disabled}add(){var t=this;return(0,m.A)(function*(){let a=new X.j({_status:"ADD",id:t.dao.generateUuid(),plano_entrega_id:t.entity?.id});var n;t.go.navigate({route:["gestao","plano-entrega","entrega"]},{metadata:{plano_entrega:t.entity,planejamento_id:t.planejamentoId,cadeia_valor_id:t.cadeiaValorId,unidade_id:t.unidadeId,data_fim:t.dataFim,entrega:a},modalClose:(n=(0,m.A)(function*(i){if(i)try{t.items.push(t.isNoPersist?i:yield t.dao.save(i,t.join)),t.cdRef.detectChanges()}catch(s){t.error(s?.error||s?.message||s)}}),function(s){return n.apply(this,arguments)})})})()}dynamicOptions(t){return this.execucao||this.isDisabled?[]:this.options}dynamicButtons(t){const a=[];return this.isDisabled&&a.push(Object.assign({onClick:this.consult.bind(this)},this.OPTION_INFORMACOES)),this.execucao&&a.push({label:"Hist\xf3rico de execu\xe7\xe3o",icon:"bi bi-activity",color:"btn-outline-info",onClick:this.showProgresso.bind(this)}),t._status||a.push({label:"Detalhes",icon:"bi bi-eye",color:"btn-outline-success",onClick:this.showDetalhes.bind(this)}),a}edit(t){var a=this;return(0,m.A)(function*(){if(a.execucao)a.grid.edit(t);else{t._status="ADD"==t._status?"ADD":"EDIT";let n=a.items.indexOf(t);a.go.navigate({route:["gestao","plano-entrega","entrega"]},{metadata:{plano_entrega:a.entity,planejamento_id:a.planejamentoId,cadeia_valor_id:a.cadeiaValorId,unidade_id:a.unidadeId,entrega:t},modalClose:(i=(0,m.A)(function*(s){s&&(a.isNoPersist||(yield a.dao?.save(s)),a.items[n]=s)}),function(c){return i.apply(this,arguments)})})}var i})()}load(t,a){var n=this;return(0,m.A)(function*(){n.form.patchValue(a),n.form.controls.meta.setValue(n.planoEntregaService.getValor(a.meta)),n.form.controls.realizado.setValue(n.planoEntregaService.getValor(a.realizado)),n.cdRef.detectChanges()})()}save(t,a){var n=this;return(0,m.A)(function*(){let i;if(n.form.markAllAsTouched(),t.valid){n.submitting=!0;try{i=yield n.dao?.update(a.id,{realizado:n.planoEntregaService.getEntregaValor(a.entrega,t.controls.realizado.value),progresso_realizado:t.controls.progresso_realizado.value},n.join)}finally{n.submitting=!1}}return i})()}delete(t){var a=this;return(0,m.A)(function*(){if(yield a.dialog.confirm("Exclui ?","Deseja realmente excluir?")){let i=a.items.indexOf(t);a.isNoPersist?t._status="DELETE":a.dao.delete(t).then(()=>{a.items.splice(i,1),a.cdRef.detectChanges(),a.dialog.topAlert("Registro exclu\xeddo com sucesso!",5e3)}).catch(s=>{a.dialog.alert("Erro","Erro ao excluir: "+(s?.message?s?.message:s))})}})()}consult(t){var a=this;return(0,m.A)(function*(){a.go.navigate({route:["gestao","plano-entrega","entrega",t.id,"consult"]},{metadata:{plano_entrega:a.entity,planejamento_id:a.planejamentoId,cadeia_valor_id:a.cadeiaValorId,unidade_id:a.unidadeId,entrega:t}})})()}showLogs(t){var a=this;return(0,m.A)(function*(){a.go.navigate({route:["logs","change",t.id,"consult"]})})()}showPlanejamento(t){var a=this;return(0,m.A)(function*(){a.go.navigate({route:["gestao","plano-entrega","entrega","objetivos",t]},{modal:!0})})()}showCadeiaValor(t){var a=this;return(0,m.A)(function*(){a.go.navigate({route:["gestao","plano-entrega","entrega","processos",t]},{modal:!0})})()}showProgresso(t){var a=this;return(0,m.A)(function*(){a.go.navigate({route:["gestao","plano-entrega","entrega","progresso",t.id]},{modal:!0,modalClose:n=>{a.parent?.refresh(a.entity?.id)}})})()}showDetalhes(t){var a=this;return(0,m.A)(function*(){a.go.navigate({route:["gestao","plano-entrega","entrega",t.id,"detalhes"]},{metadata:{plano_entrega:a.entity,planejamento_id:a.planejamentoId,cadeia_valor_id:a.cadeiaValorId,unidade_id:a.unidadeId,entrega:t}})})()}refreshComentarios(t){let a=this.items.find(n=>n.id==t.id);a&&(a.comentarios=t.comentarios||[])}onRealizadaChange(){const t=this.form?.controls.meta.value,a=this.form?.controls.realizado.value;if(t&&a){let n=isNaN(a)?0:(a/t*100).toFixed(0)||0;this.form?.controls.progresso_realizado.setValue(n)}}addItemHandleEtiquetas(){let t;if(this.etiqueta&&this.etiqueta.selectedItem){const a=this.etiqueta.selectedItem,n=a.key?.length?a.key:this.util.textHash(a.value);this.util.validateLookupItem(this.formEdit.controls.etiqueta.value,n)&&(t={key:n,value:a.value,color:a.color,icon:a.icon},this.formEdit.controls.etiqueta.setValue(null))}return t}onColumnEtiquetasEdit(t){var a=this;return(0,m.A)(function*(){if(!a.etiquetasAscendentes.filter(n=>n.data==t.unidade.id).length){let n=yield a.carregaEtiquetasUnidadesAscendentes(t.unidade);a.etiquetasAscendentes.push(...n)}a.formEdit.controls.etiquetas.setValue(t.etiquetas),a.formEdit.controls.etiqueta.setValue(null),a.etiquetas=a.util.merge(t.tipo_atividade?.etiquetas,t.unidade?.etiquetas,(n,i)=>n.key==i.key),a.etiquetas=a.util.merge(a.etiquetas,a.auth.usuario.config?.etiquetas,(n,i)=>n.key==i.key),a.etiquetas=a.util.merge(a.etiquetas,a.etiquetasAscendentes.filter(n=>n.data==t.unidade.id),(n,i)=>n.key==i.key)})()}carregaEtiquetasUnidadesAscendentes(t){var a=this;return(0,m.A)(function*(){let n=[],i=t.path.split("/");return(yield a.unidadeDao.query({where:[["id","in",i]]}).asPromise()).forEach(c=>{n=a.util.merge(n,c.etiquetas,(g,h)=>g.key==h.key)}),n.forEach(c=>c.data=t.id),n})()}onColumnEtiquetasSave(t){var a=this;return(0,m.A)(function*(){try{const n=yield a.dao.update(t.id,{etiquetas:a.formEdit.controls.etiquetas.value});return t.etiquetas=a.formEdit.controls.etiquetas.value,!!n}catch{return!1}})()}onEtiquetaConfigClick(){this.go.navigate({route:["configuracoes","preferencia","usuario",this.auth.usuario.id],params:{etiquetas:!0}},{modal:!0,modalClose:t=>{this.etiquetas=this.util.merge(this.etiquetas,this.auth.usuario.config?.etiquetas,(a,n)=>a.key==n.key),this.cdRef.detectChanges()}})}onColumnChecklistEdit(t){var a=this;return(0,m.A)(function*(){a.formEdit.controls.progresso_realizado.setValue(t.progresso_realizado),a.checklist=a.util.clone(t.checklist)})()}onColumnChecklistSave(t){var a=this;return(0,m.A)(function*(){let n=Math.round(parseInt(a.planoEntregaService.getValorMeta(t))*a.formEdit.controls.progresso_realizado.value/100);try{const i=yield a.dao.update(t.id,{progresso_realizado:a.formEdit.controls.progresso_realizado.value,realizado:a.planoEntregaService.getEntregaValor(t.entrega,n),checklist:a.checklist});return t.progresso_realizado=a.formEdit.controls.progresso_realizado.value,t.checklist=a.checklist,typeof t.realizado.porcentagem<"u"?t.realizado.porcentagem=n:typeof t.realizado.quantitativo<"u"?t.realizado.quantitativo=n:typeof t.realizado.valor<"u"&&(t.realizado.valor=n),!!i}catch{return!1}})()}getObjetivos(t){return t.objetivos.filter(a=>"DELETE"!=a._status)}static{this.\u0275fac=function(a){return new(a||o)(e.rXU(e.zZn))}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["plano-entrega-list-entrega"]],viewQuery:function(a,n){if(1&a&&(e.GBs(N.Q,5),e.GBs(f._,5),e.GBs(Se,5)),2&a){let i;e.mGM(i=e.lsd())&&(n.editableForm=i.first),e.mGM(i=e.lsd())&&(n.grid=i.first),e.mGM(i=e.lsd())&&(n.etiqueta=i.first)}},inputs:{cdRef:"cdRef",disabled:"disabled",parent:"parent",noPersist:"noPersist",control:"control",entity:"entity",planejamentoId:"planejamentoId",cadeiaValorId:"cadeiaValorId",unidadeId:"unidadeId",dataFim:"dataFim",execucao:"execucao"},features:[e.Vt3],decls:25,vars:35,consts:[["groupEntregas",""],["columnEntregaCliente",""],["columnEtiquetas",""],["columnEtiquetasEdit",""],["columnDatas",""],["columnMetaRealizado",""],["editMetaRealizado",""],["columnEntregaCometario",""],["etiqueta",""],["columnProgChecklist",""],["columnChecklistEdit",""],[3,"items","form","groupTemplate","minHeight","editable","hasAdd","add","hasEdit","load","save","selectable"],[3,"title","template","editTemplate"],[3,"title","width","template","editTemplate","columnEditTemplate","edit","save"],[3,"title","width","template","editTemplate"],[3,"title","width","template","editTemplate","columnEditTemplate","edit","save",4,"ngIf"],["type","options",3,"onEdit","dynamicButtons","dynamicOptions"],[1,"grid-group-text"],[1,"text-wrap"],["color","primary",3,"label"],[1,"d-block"],["color","light",3,"icon","label",4,"ngIf"],["color","light","icon","bi bi-mailbox",3,"label",4,"ngIf"],["origem","PLANO_ENTREGA_ENTREGA",3,"entity",4,"ngIf"],["color","light",3,"icon","label"],["color","light","icon","bi bi-mailbox",3,"label"],["origem","PLANO_ENTREGA_ENTREGA",3,"entity"],[3,"lookup",4,"ngFor","ngForOf"],[3,"lookup"],["controlName","etiquetas",3,"size","control","addItemHandle"],["controlName","etiqueta","nullable","","itemNull","- Selecione -","detailsButton","","detailsButtonIcon","bi bi-tools",3,"details","size","control","items"],[4,"ngIf"],["icon","bi bi-graph-up-arrow","color","light","hint","Planejada",3,"textValue"],["icon","bi bi-check-lg","color","light","hint","Realizada",3,"textValue"],["icon","bi bi-graph-up-arrow","disabled","","label","Meta",3,"entrega","size","control"],["icon","bi bi-check-lg","label","Realizada",3,"entrega","size","control","change"],["color","success",3,"value","goal"],["small","","title","Checklist","collapse","",3,"collapsed",4,"ngIf"],["small","","title","Checklist","collapse","",3,"collapsed"],[4,"ngFor","ngForOf"],["class","bi bi-check-circle",4,"ngIf"],[1,"micro-text","fw-ligh"],[1,"bi","bi-check-circle"],["label","Realizado","sufix","%","icon","bi bi-clock","controlName","progresso_realizado","labelInfo","Progresso de execu\xe7\xe3o (% Conclu\xeddo)",3,"size","control"],["small","","title","Checklist",4,"ngIf"],["small","","title","Checklist"],["scale","small",3,"size","source","path"],["color","light","icon","bi bi-list-check",3,"label",4,"ngIf"],["origem","PLANO_ENTREGA_ENTREGA",3,"entity","selectable","grid","save"],["color","light","icon","bi bi-list-check",3,"label"]],template:function(a,n){if(1&a&&(e.j41(0,"grid",11),e.DNE(1,ke,4,1,"ng-template",null,0,e.C5r),e.j41(3,"columns")(4,"column",12),e.DNE(5,ze,6,4,"ng-template",null,1,e.C5r),e.k0s(),e.j41(7,"column",13),e.DNE(8,we,1,1,"ng-template",null,2,e.C5r)(10,Be,3,6,"ng-template",null,3,e.C5r),e.k0s(),e.j41(12,"column",12),e.DNE(13,qe,3,2,"ng-template",null,4,e.C5r),e.k0s(),e.j41(15,"column",14),e.DNE(16,Xe,3,2,"ng-template",null,5,e.C5r)(18,xe,2,7,"ng-template",null,6,e.C5r),e.k0s(),e.DNE(20,nt,5,7,"column",15),e.j41(21,"column",12),e.DNE(22,it,2,5,"ng-template",null,7,e.C5r),e.k0s(),e.nrm(24,"column",16),e.k0s()()),2&a){const i=e.sdS(2),s=e.sdS(6),c=e.sdS(9),g=e.sdS(11),h=e.sdS(14),E=e.sdS(17),z=e.sdS(19),F=e.sdS(23);e.Y8G("items",n.items)("form",n.form)("groupTemplate",i)("minHeight",300)("editable",n.isDisabled?void 0:"true")("hasAdd",!n.isDisabled&&n.auth.hasPermissionTo("MOD_PENT_ENTR_INCL")&&!n.execucao)("add",n.add.bind(n))("hasEdit",!n.isDisabled&&n.auth.hasPermissionTo("MOD_PENT_ENTR_EDT"))("load",n.load.bind(n))("save",n.save.bind(n))("selectable",n.selectable),e.R7$(4),e.Y8G("title","Entrega\nDemandante/Destinat\xe1rio")("template",s)("editTemplate",s),e.R7$(3),e.Y8G("title","Etiquetas")("width",100)("template",c)("editTemplate",c)("columnEditTemplate",n.selectable?void 0:g)("edit",n.selectable?void 0:n.onColumnEtiquetasEdit.bind(n))("save",n.selectable?void 0:n.onColumnEtiquetasSave.bind(n)),e.R7$(5),e.Y8G("title","Data In\xedcio\nData Fim")("template",h)("editTemplate",h),e.R7$(3),e.Y8G("title","Meta")("width",100)("template",E)("editTemplate",z),e.R7$(5),e.Y8G("ngIf",n.execucao),e.R7$(),e.Y8G("title",n.lex.translate("Modelo de Entrega")+"\nComent\xe1rios")("template",F)("editTemplate",F),e.R7$(3),e.Y8G("onEdit",n.edit.bind(n))("dynamicButtons",n.dynamicButtons.bind(n))("dynamicOptions",n.dynamicOptions.bind(n))}},dependencies:[A.Sq,A.bT,f._,O.T,p.I,ie.S,q.K,le.b,H.F,y.n,Q.a,J.n,se.T,De.c,te],styles:[".objetivo[_ngcontent-%COMP%]{border-bottom:1px solid #ddd;padding:2px 0}"]})}}return o})();const lt=()=>["CONCLUIDO","AVALIADO"];function st(o,l){if(1&o){const t=e.RV6();e.j41(0,"input-switch",29),e.bIt("change",function(n){e.eBV(t);const i=e.XpG(2);return e.Njj(i.onPrincipaisChange(n))}),e.k0s()}if(2&o){const t=e.XpG(2);e.Y8G("size",2)("control",t.filter.controls.principais)("labelInfo",t.lex.translate("Unidades")+" onde o "+t.lex.translate("usuario")+" \xe9 integrante, incluindo unidades superiores sob sua ger\xeancia.")}}function rt(o,l){if(1&o){const t=e.RV6();e.j41(0,"toolbar",26)(1,"input-switch",27),e.bIt("change",function(n){e.eBV(t);const i=e.XpG();return e.Njj(i.onAgruparChange(n))}),e.k0s(),e.DNE(2,st,1,3,"input-switch",28),e.k0s()}if(2&o){const t=e.XpG();e.Y8G("buttons",t.toolbarButtons),e.R7$(),e.Y8G("size",3)("control",t.filter.controls.agrupar),e.R7$(),e.Y8G("ngIf",!t.avaliacao)}}function dt(o,l){if(1&o&&(e.j41(0,"div")(1,"div",30),e.nrm(2,"input-switch",31)(3,"input-search",32,10)(5,"input-select",33)(6,"input-datetime",34)(7,"input-datetime",35),e.k0s()()),2&o){const t=e.XpG();e.R7$(2),e.Y8G("size",1)("control",t.filter.controls.meus_planos),e.R7$(),e.Y8G("size",5)("control",t.filter.controls.unidade_id)("dao",t.unidadeDao),e.R7$(2),e.Y8G("size",2)("valueTodos",null)("control",t.filter.controls.data_filtro)("items",t.DATAS_FILTRO),e.R7$(),e.Y8G("size",2)("disabled",null==t.filter.controls.data_filtro.value?"true":void 0)("control",t.filter.controls.data_filtro_inicio),e.R7$(),e.Y8G("size",2)("disabled",null==t.filter.controls.data_filtro.value?"true":void 0)("control",t.filter.controls.data_filtro_fim)}}function ct(o,l){if(1&o&&(e.j41(0,"div",30),e.nrm(1,"input-switch",31)(2,"input-text",36)(3,"input-search",32,10)(5,"input-select",37)(6,"input-switch",38),e.k0s(),e.j41(7,"div",30),e.nrm(8,"input-search",39,11)(10,"input-search",40,12)(12,"input-select",33)(13,"input-datetime",34)(14,"input-datetime",35),e.k0s()),2&o){const t=e.XpG();e.R7$(),e.Y8G("size",1)("control",t.filter.controls.meus_planos),e.R7$(),e.Y8G("size",3)("control",t.filter.controls.nome)("placeholder","Nome do "+t.lex.translate("plano de entrega")),e.BMQ("maxlength",250),e.R7$(),e.Y8G("size",4)("control",t.filter.controls.unidade_id)("dao",t.unidadeDao),e.R7$(2),e.Y8G("size",3)("control",t.filter.controls.status)("items",t.lookup.PLANO_ENTREGA_STATUS)("filter",t.avaliacao?e.lJ4(32,lt):void 0)("valueTodos",null),e.R7$(),e.Y8G("size",1)("control",t.filter.controls.arquivadas),e.R7$(2),e.Y8G("size",3)("control",t.filter.controls.planejamento_id)("dao",t.planejamentoDao),e.R7$(2),e.Y8G("size",3)("control",t.filter.controls.cadeia_valor_id)("dao",t.cadeiaValorDao),e.R7$(2),e.Y8G("size",2)("valueTodos",null)("control",t.filter.controls.data_filtro)("items",t.DATAS_FILTRO),e.R7$(),e.Y8G("size",2)("disabled",null==t.filter.controls.data_filtro.value?"true":void 0)("control",t.filter.controls.data_filtro_inicio),e.R7$(),e.Y8G("size",2)("disabled",null==t.filter.controls.data_filtro.value?"true":void 0)("control",t.filter.controls.data_filtro_fim)}}function ut(o,l){if(1&o&&(e.j41(0,"span",43),e.nrm(1,"i",44),e.EFF(2),e.k0s()),2&o){const t=e.XpG().row;e.R7$(2),e.SpI(" ",null==t.entregas?null:t.entregas.length,"")}}function mt(o,l){if(1&o&&e.DNE(0,ut,3,1,"span",42),2&o){const t=l.row;e.Y8G("ngIf",null==t.entregas?null:t.entregas.length)}}function gt(o,l){if(1&o&&e.nrm(0,"plano-entrega-list-entrega",45),2&o){const t=l.row,a=e.XpG(2);e.Y8G("parent",a)("disabled",a.avaliacao||!a.botaoAtendeCondicoes(a.BOTAO_ALTERAR,t))("entity",t)("execucao",a.execucao)("cdRef",a.cdRef)("planejamentoId",t.planejamento_id)("cadeiaValorId",t.cadeia_valor_id)("unidadeId",t.unidade_id)}}function _t(o,l){if(1&o&&(e.j41(0,"column",41),e.DNE(1,mt,1,1,"ng-template",null,13,e.C5r)(3,gt,1,8,"ng-template",null,14,e.C5r),e.k0s()),2&o){const t=e.sdS(2),a=e.sdS(4),n=e.XpG();e.Y8G("align","center")("hint",n.lex.translate("Entrega"))("template",t)("expandTemplate",a)}}function pt(o,l){1&o&&(e.j41(0,"order",46),e.EFF(1,"#ID"),e.k0s()),2&o&&e.Y8G("header",l.header)}function ht(o,l){if(1&o&&(e.j41(0,"small",47),e.EFF(1),e.k0s()),2&o){const t=l.row;e.R7$(),e.SpI("#",t.numero,"")}}function ft(o,l){if(1&o&&(e.j41(0,"order",48),e.EFF(1,"Nome"),e.k0s(),e.nrm(2,"br"),e.EFF(3)),2&o){const t=l.header,a=e.XpG();e.Y8G("header",t),e.R7$(3),e.SpI(" Programa",a.filter.controls.agrupar.value?"":" - Unidade"," ")}}function Et(o,l){if(1&o&&e.nrm(0,"badge",52),2&o){const t=e.XpG().row,a=e.XpG();e.Y8G("icon",a.entityService.getIcon("Programa"))("label",t.programa.nome)}}function bt(o,l){if(1&o&&e.nrm(0,"badge",53),2&o){const t=e.XpG().row,a=e.XpG();e.Y8G("icon",a.entityService.getIcon(a.lex.translate("unidade")))("label",t.unidade.sigla)}}function vt(o,l){if(1&o&&(e.j41(0,"span",49),e.EFF(1),e.k0s(),e.nrm(2,"br"),e.DNE(3,Et,1,2,"badge",50)(4,bt,1,2,"badge",51)),2&o){const t=l.row,a=e.XpG();e.xc7("max-width",400,"px"),e.R7$(),e.JRh(t.nome||""),e.R7$(2),e.Y8G("ngIf",t.programa),e.R7$(),e.Y8G("ngIf",!a.filter.controls.agrupar.value&&t.unidade)}}function Tt(o,l){if(1&o&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&o){const t=l.row,a=e.XpG();e.R7$(),e.SpI(" ",a.dao.getDateFormatted(t.data_inicio),"")}}function Ot(o,l){if(1&o&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&o){const t=l.row,a=e.XpG();e.R7$(),e.SpI(" ",a.dao.getDateFormatted(t.data_fim),"")}}function At(o,l){1&o&&(e.EFF(0," Planejamento Institucional"),e.nrm(1,"br"),e.EFF(2," Cadeia de Valor "))}function Ct(o,l){if(1&o&&e.nrm(0,"badge",55),2&o){const t=e.XpG().row,a=e.XpG();e.Y8G("maxWidth",300)("icon",a.entityService.getIcon("Planejamento"))("label",null==t.planejamento?null:t.planejamento.nome)}}function It(o,l){if(1&o&&e.nrm(0,"badge",55),2&o){const t=e.XpG().row,a=e.XpG();e.Y8G("maxWidth",300)("icon",a.entityService.getIcon("CadeiaValor"))("label",null==t.cadeia_valor?null:t.cadeia_valor.nome)}}function Dt(o,l){if(1&o&&e.DNE(0,Ct,1,3,"badge",54)(1,It,1,3,"badge",54),2&o){const t=l.row;e.Y8G("ngIf",t.planejamento),e.R7$(),e.Y8G("ngIf",t.cadeia_valor)}}function Pt(o,l){1&o&&e.nrm(0,"badge",60)}function Rt(o,l){1&o&&e.nrm(0,"badge",61)}function Gt(o,l){if(1&o&&e.nrm(0,"avaliar-nota-badge",62),2&o){const t=e.XpG().row;e.Y8G("align","left")("tipoAvaliacao",t.avaliacao.tipo_avaliacao)("nota",t.avaliacao.nota)}}function jt(o,l){if(1&o&&(e.nrm(0,"badge",56)(1,"br"),e.DNE(2,Pt,1,0,"badge",57)(3,Rt,1,0,"badge",58)(4,Gt,1,3,"avaliar-nota-badge",59)),2&o){const t=l.row,a=e.XpG();e.Y8G("color",a.lookup.getColor(a.lookup.PLANO_ENTREGA_STATUS,t.status))("icon",a.lookup.getIcon(a.lookup.PLANO_ENTREGA_STATUS,t.status))("label",a.lookup.getValue(a.lookup.PLANO_ENTREGA_STATUS,t.status)),e.R7$(2),e.Y8G("ngIf",t.data_arquivamento),e.R7$(),e.Y8G("ngIf",t.deleted_at),e.R7$(),e.Y8G("ngIf",t.avaliacao)}}let yt=(()=>{class o extends d.P{constructor(t){super(t,w,P.m),this.injector=t,this.showFilter=!0,this.avaliacao=!1,this.execucao=!1,this.habilitarAdesaoToolbar=!1,this.toolbarButtons=[],this.botoes=[],this.routeStatus={route:["uteis","status"]},this.DATAS_FILTRO=[{key:"VIGENTE",value:"Vigente"},{key:"NAOVIGENTE",value:"N\xe3o vigente"},{key:"INICIAM",value:"Iniciam"},{key:"FINALIZAM",value:"Finalizam"}],this.storeFilter=a=>{const n=a?.value;return{meus_planos:n.meus_planos,arquivadas:n.arquivadas,unidade_id:n.unidade_id}},this.filterValidate=(a,n)=>{let i=null;return"data_filtro_inicio"==n&&a.value>this.filter?.controls.data_filtro_fim.value?i="Maior que fim":"data_filtro_fim"==n&&a.value<this.filter?.controls.data_filtro_inicio.value&&(i="Menor que in\xedcio"),i},this.filterWhere=a=>{let n=[],i=a.value;if(this.filter?.controls.principais.value){let s=["unidade_id","in",(this.auth.unidades||[]).map(c=>c.id)];if(this.auth.isGestorAlgumaAreaTrabalho()){let c=this.auth.unidades?.filter(E=>this.unidadeService.isGestorUnidade(E)),g=c?.map(E=>E.unidade_pai?.id||"").filter(E=>E.length);g?.length&&s[2].push(...g);let h=["unidade.unidade_pai_id","in",c?.map(E=>E.id)];n.push(["or",s,h])}else n.push(s)}if(this.filter?.controls.meus_planos.value){let s=["unidade_id","in",(this.auth.unidades||[]).map(c=>c.id)];n.push(s)}return i.nome?.length&&n.push(["nome","like","%"+i.nome.trim().replace(" ","%")+"%"]),i.data_filtro&&(n.push(["data_filtro","==",i.data_filtro]),n.push(["data_filtro_inicio","==",i.data_filtro_inicio]),n.push(["data_filtro_fim","==",i.data_filtro_fim])),i.unidade_id&&n.push(["unidade_id","==",i.unidade_id]),i.unidade_id||n.push(["unidades_vinculadas","==",this.auth.unidade?.id]),i.planejamento_id&&n.push(["planejamento_id","==",i.planejamento_id]),i.cadeia_valor_id&&n.push(["cadeia_valor_id","==",i.cadeia_valor_id]),this.isModal?n.push(["status","==","ATIVO"]):(i.status||this.avaliacao)&&n.push(["status","in",i.status?[i.status]:["CONCLUIDO","AVALIADO"]]),n.push(["incluir_arquivados","==",this.filter.controls.arquivadas.value]),n},this.avaliacaoDao=t.get(_.l),this.unidadeDao=t.get(j.s),this.planejamentoDao=t.get(I.Y),this.cadeiaValorDao=t.get(R.X),this.planoEntregaService=t.get(u.C),this.unidadeService=t.get(v.S),this.programaService=t.get(T.t),this.unidadeSelecionada=this.auth.unidade,this.code="MOD_PLANE",this.title=this.lex.translate("Planos de Entregas"),this.filter=this.fh.FormBuilder({agrupar:{default:!0},principais:{default:!1},arquivadas:{default:!1},nome:{default:""},data_filtro:{default:null},data_filtro_inicio:{default:new Date},data_filtro_fim:{default:new Date},status:{default:""},unidade_id:{default:null},unidades_filhas:{default:!1},planejamento_id:{default:null},cadeia_valor_id:{default:null},meus_planos:{default:!0}},this.cdRef,this.filterValidate),this.join=["planejamento:id,nome","programa:id,nome","cadeia_valor:id,nome","unidade:id,sigla,path","entregas.entrega","entregas.objetivos.objetivo","entregas.processos.processo","entregas.unidade","entregas.comentarios.usuario:id,nome,apelido","entregas.reacoes.usuario:id,nome,apelido","entregas.produtos.produto","unidade.gestor:id","unidade.gestores_substitutos:id","unidade.unidade_pai","avaliacao"],this.groupBy=[{field:"unidade.sigla",label:"Unidade"}],this.BOTAO_ADERIR_OPTION={label:"Aderir",icon:this.entityService.getIcon("Adesao"),onClick:(()=>{this.go.navigate({route:["gestao","plano-entrega","adesao"]},{metadata:{planoEntrega:this.linha},modalClose:a=>{this.refresh()}})}).bind(this)},this.BOTAO_ADERIR_TOOLBAR={label:"Aderir",disabled:!this.habilitarAdesaoToolbar,icon:this.entityService.getIcon("Adesao"),onClick:(()=>{this.go.navigate({route:["gestao","plano-entrega","adesao"]},{modalClose:a=>{this.refresh()}})}).bind(this)},this.BOTAO_ALTERAR={label:"Alterar",icon:"bi bi-pencil-square",color:"btn-outline-info",onClick:a=>this.go.navigate({route:["gestao","plano-entrega",a.id,"edit"]},this.modalRefreshId(a))},this.BOTAO_CLONAR={label:"Clonar",icon:"bi bi-copy",color:"btn-outline-primary",onClick:a=>this.go.navigate({route:["gestao","plano-entrega",a.id,"clone"]},this.modalRefreshId(a))},this.BOTAO_ARQUIVAR={label:"Arquivar",icon:"bi bi-inboxes",onClick:this.arquivar.bind(this)},this.BOTAO_AVALIAR={label:"Avaliar",icon:this.lookup.getIcon(this.lookup.PLANO_ENTREGA_STATUS,"AVALIADO"),color:this.lookup.getColor(this.lookup.PLANO_ENTREGA_STATUS,"AVALIADO"),onClick:this.avaliar.bind(this)},this.BOTAO_CANCELAR_PLANO={label:"Cancelar plano",icon:this.lookup.getIcon(this.lookup.PLANO_ENTREGA_STATUS,"CANCELADO"),color:this.lookup.getColor(this.lookup.PLANO_ENTREGA_STATUS,"CANCELADO"),onClick:this.cancelarPlano.bind(this)},this.BOTAO_CANCELAR_AVALIACAO={label:"Cancelar avalia\xe7\xe3o",icon:this.lookup.getIcon(this.lookup.PLANO_ENTREGA_STATUS,"CONCLUIDO"),color:this.lookup.getColor(this.lookup.PLANO_ENTREGA_STATUS,"CANCELADO"),onClick:this.cancelarAvaliacao.bind(this)},this.BOTAO_CANCELAR_CONCLUSAO={label:"Cancelar conclus\xe3o",icon:this.lookup.getIcon(this.lookup.PLANO_ENTREGA_STATUS,"ATIVO"),color:this.lookup.getColor(this.lookup.PLANO_ENTREGA_STATUS,"ATIVO"),onClick:this.cancelarConclusao.bind(this)},this.BOTAO_CANCELAR_HOMOLOGACAO={label:"Cancelar homologa\xe7\xe3o",icon:this.lookup.getIcon(this.lookup.PLANO_ENTREGA_STATUS,"HOMOLOGANDO"),color:this.lookup.getColor(this.lookup.PLANO_ENTREGA_STATUS,"HOMOLOGANDO"),onClick:this.cancelarHomologacao.bind(this)},this.BOTAO_CONCLUIR={label:"Concluir",id:"CONCLUIDO",icon:this.lookup.getIcon(this.lookup.PLANO_ENTREGA_STATUS,"CONCLUIDO"),color:this.lookup.getColor(this.lookup.PLANO_ENTREGA_STATUS,"CONCLUIDO"),onClick:this.concluir.bind(this)},this.BOTAO_CONSULTAR={label:"Informa\xe7\xf5es",icon:"bi bi-info-circle",onClick:a=>this.go.navigate({route:["gestao","plano-entrega",a.id,"consult"]},{modal:!0})},this.BOTAO_DESARQUIVAR={label:"Desarquivar",icon:"bi bi-reply",onClick:this.desarquivar.bind(this)},this.BOTAO_EXCLUIR={label:"Excluir",icon:"bi bi-trash",onClick:this.delete.bind(this)},this.BOTAO_HOMOLOGAR={label:"Homologar",icon:this.lookup.getIcon(this.lookup.PLANO_ENTREGA_STATUS,"ATIVO"),color:this.lookup.getColor(this.lookup.PLANO_ENTREGA_STATUS,"ATIVO"),onClick:this.homologar.bind(this)},this.BOTAO_LIBERAR_HOMOLOGACAO={label:"Liberar para homologa\xe7\xe3o",icon:this.lookup.getIcon(this.lookup.PLANO_ENTREGA_STATUS,"HOMOLOGANDO"),color:this.lookup.getColor(this.lookup.PLANO_ENTREGA_STATUS,"HOMOLOGANDO"),onClick:this.liberarHomologacao.bind(this)},this.BOTAO_LOGS={label:"Logs",icon:this.lookup.getIcon(this.lookup.PLANO_ENTREGA_STATUS,"INCLUIDO"),color:this.lookup.getColor(this.lookup.PLANO_ENTREGA_STATUS,"INCLUIDO"),onClick:a=>this.go.navigate({route:["logs","change",a.id,"consult"]})},this.BOTAO_REATIVAR={label:"Reativar",icon:this.lookup.getIcon(this.lookup.PLANO_ENTREGA_STATUS,"ATIVO"),color:this.lookup.getColor(this.lookup.PLANO_ENTREGA_STATUS,"ATIVO"),onClick:this.reativar.bind(this)},this.BOTAO_RETIRAR_HOMOLOGACAO={label:"Retirar de homologa\xe7\xe3o",icon:this.lookup.getIcon(this.lookup.PLANO_ENTREGA_STATUS,"INCLUIDO"),color:this.lookup.getColor(this.lookup.PLANO_ENTREGA_STATUS,"INCLUIDO"),onClick:this.retirarHomologacao.bind(this)},this.BOTAO_SUSPENDER={label:"Suspender",id:"PAUSADO",icon:this.lookup.getIcon(this.lookup.PLANO_ENTREGA_STATUS,"SUSPENSO"),color:this.lookup.getColor(this.lookup.PLANO_ENTREGA_STATUS,"SUSPENSO"),onClick:this.suspender.bind(this)},this.botoes=[this.BOTAO_ALTERAR,this.BOTAO_ARQUIVAR,this.BOTAO_AVALIAR,this.BOTAO_CANCELAR_PLANO,this.BOTAO_CANCELAR_AVALIACAO,this.BOTAO_CANCELAR_CONCLUSAO,this.BOTAO_CANCELAR_HOMOLOGACAO,this.BOTAO_CONCLUIR,this.BOTAO_CONSULTAR,this.BOTAO_DESARQUIVAR,this.BOTAO_EXCLUIR,this.BOTAO_HOMOLOGAR,this.BOTAO_LIBERAR_HOMOLOGACAO,this.BOTAO_LOGS,this.BOTAO_REATIVAR,this.BOTAO_RETIRAR_HOMOLOGACAO,this.BOTAO_SUSPENDER,this.BOTAO_CLONAR]}ngOnInit(){super.ngOnInit(),this.execucao=!!this.queryParams?.execucao,this.avaliacao=!!this.queryParams?.avaliacao,this.showFilter=!(typeof this.queryParams?.showFilter<"u")||"true"==this.queryParams.showFilter,this.selectable=this.metadata?.selectable||this.selectable,this.execucao&&(this.title=this.title+" (Execu\xe7\xe3o)",this.filter.controls.unidade_id.setValue(this.auth.unidadeGestor()?.id||null),this.filter.controls.principais.setValue(!1)),this.avaliacao&&(this.title=this.title+" (Avalia\xe7\xe3o)",this.filter.controls.unidade_id.setValue(this.auth.unidadeGestor()?.id||null),this.filter.controls.unidades_filhas.setValue(!0),this.filter.controls.principais.setValue(!1)),this.checaBotaoAderirToolbar()}ngAfterContentChecked(){this.auth.unidade!=this.unidadeSelecionada&&(this.unidadeSelecionada=this.auth.unidade,this.checaBotaoAderirToolbar(),this.cdRef.detectChanges())}onGridLoad(t){const a=(this.grid?.query||this.query).extra;t?.forEach(n=>{let i=n;i.avaliacao&&(i.avaliacao.tipo_avaliacao=a?.tipos_avaliacoes?.find(s=>s.id==i.avaliacao.tipo_avaliacao_id))})}checaBotaoAderirToolbar(){}planosEntregasAtivosUnidadePai(){return this.auth.unidade?.unidade_pai?.planos_entrega?.filter(t=>this.planoEntregaService.isAtivo(t))||[]}planosEntregasAtivosUnidadeSelecionada(){return this.auth?.unidade?.planos_entrega?.filter(t=>this.planoEntregaService.isAtivo(t))||[]}filterClear(t){t.controls.nome.setValue(""),t.controls.data_filtro.setValue(null),t.controls.data_filtro_inicio.setValue(new Date),t.controls.data_filtro_fim.setValue(new Date),t.controls.unidade_id.setValue(null),t.controls.planejamento_id.setValue(null),t.controls.cadeia_valor_id.setValue(null),t.controls.status.setValue(null),t.controls.meus_planos.setValue(!1),super.filterClear(t)}onAgruparChange(t){const a=this.filter.controls.agrupar.value;(a&&!this.groupBy?.length||!a&&this.groupBy?.length)&&(this.groupBy=a?[{field:"unidade.sigla",label:"Unidade"}]:[],this.cdRef.detectChanges(),this.grid.reloadFilter())}onPrincipaisChange(t){this.filter.controls.principais.value?(this.filter.controls.unidade_id.setValue(null),this.filter.controls.meus_planos.setValue(!1)):this.filter.controls.meus_planos.setValue(!0),this.grid.reloadFilter()}dynamicButtons(t){let a=[];switch(this.planoEntregaService.situacaoPlano(t)){case"INCLUIDO":this.botaoAtendeCondicoes(this.BOTAO_LIBERAR_HOMOLOGACAO,t)?a.push(this.BOTAO_LIBERAR_HOMOLOGACAO):a.push(this.BOTAO_CONSULTAR);break;case"HOMOLOGANDO":this.botaoAtendeCondicoes(this.BOTAO_HOMOLOGAR,t)&&a.push(this.BOTAO_HOMOLOGAR);break;case"ATIVO":this.botaoAtendeCondicoes(this.BOTAO_CONCLUIR,t)&&a.push(this.BOTAO_CONCLUIR);break;case"CONCLUIDO":this.botaoAtendeCondicoes(this.BOTAO_AVALIAR,t)&&a.push(this.BOTAO_AVALIAR);break;case"SUSPENSO":this.botaoAtendeCondicoes(this.BOTAO_REATIVAR,t)&&a.push(this.BOTAO_REATIVAR);break;case"AVALIADO":this.botaoAtendeCondicoes(this.BOTAO_ARQUIVAR,t)&&a.push(this.BOTAO_ARQUIVAR);break;case"ARQUIVADO":this.botaoAtendeCondicoes(this.BOTAO_DESARQUIVAR,t)&&a.push(this.BOTAO_DESARQUIVAR)}return a.length||a.push(this.BOTAO_CONSULTAR),a}dynamicOptions(t){let a=[];return this.linha=t,this.botoes.forEach(n=>{this.botaoAtendeCondicoes(n,t)&&a.push(n)}),a}botaoAtendeCondicoes(t,a){switch(t){case this.BOTAO_ADERIR_OPTION:return!this.execucao&&"ATIVO"==this.planoEntregaService.situacaoPlano(a)&&a.unidade_id==this.auth.unidade?.unidade_pai_id&&(this.unidadeService.isGestorUnidade()||this.auth.isLotacaoUsuario(this.auth.unidade)&&this.auth.hasPermissionTo("MOD_PENT_ADR"))&&0==this.planosEntregasAtivosUnidadeSelecionada().filter(Ce=>this.util.intersection([{start:Ce.data_inicio,end:Ce.data_fim},{start:a.data_inicio,end:a.data_fim}])).length;case this.BOTAO_ALTERAR:let n=["INCLUIDO","HOMOLOGANDO","ATIVO"].includes(this.planoEntregaService.situacaoPlano(a)),i=["INCLUIDO","HOMOLOGANDO"].includes(this.planoEntregaService.situacaoPlano(a))&&(this.unidadeService.isGestorUnidade(a.unidade)||this.auth.isLotacaoUsuario(a.unidade)),s=this.unidadeService.isGestorUnidade(1==a.unidade?.instituidora?a.unidade?.id:a.unidade?.unidade_pai_id)&&this.auth.hasPermissionTo("MOD_PENT_EDT_FLH"),c=this.auth.isIntegrante("HOMOLOGADOR_PLANO_ENTREGA",a.unidade.unidade_pai_id),g="ATIVO"==this.planoEntregaService.situacaoPlano(a)&&this.auth.isLotacaoUsuario(a.unidade)&&this.auth.hasPermissionTo(["MOD_PENT_EDT_ATV_HOMOL","MOD_PENT_EDT_ATV_ATV"]),h=this.auth.hasPermissionTo("MOD_PENT_QQR_UND");return!this.execucao&&this.auth.hasPermissionTo("MOD_PENT_EDT")&&n&&this.planoEntregaService.isValido(a)&&(i||s||c||g||h);case this.BOTAO_ARQUIVAR:return["CONCLUIDO","AVALIADO"].includes(this.planoEntregaService.situacaoPlano(a))&&(this.unidadeService.isGestorUnidade(a.unidade)||this.auth.isLotacaoUsuario(a.unidade)&&this.auth.hasPermissionTo("MOD_PENT_ARQ"));case this.BOTAO_AVALIAR:let E=this.unidadeService.isGestorUnidade(1==a.unidade?.instituidora?a.unidade?.id:a.unidade?.unidade_pai_id),z=this.auth.isLotacaoUsuario(a.unidade?.unidade_pai)&&this.auth.hasPermissionTo("MOD_PENT_AVAL"),F=this.auth.isGestorLinhaAscendente(a.unidade)&&this.auth.hasPermissionTo("MOD_PENT_AVAL_SUBORD");return"CONCLUIDO"==this.planoEntregaService.situacaoPlano(a)&&(E||z||F);case this.BOTAO_CANCELAR_AVALIACAO:return"AVALIADO"==this.planoEntregaService.situacaoPlano(a)&&(1==a.unidade?.instituidora?this.unidadeService.isGestorUnidade(a.unidade?.id):this.unidadeService.isGestorUnidade(a.unidade?.unidade_pai_id)||this.auth.isIntegrante("AVALIADOR_PLANO_ENTREGA",a.unidade.id));case this.BOTAO_CANCELAR_CONCLUSAO:return"CONCLUIDO"==this.planoEntregaService.situacaoPlano(a)&&this.programaService.programaVigente(a.programa)&&(this.unidadeService.isGestorUnidade(a.unidade)||this.auth.isLotacaoUsuario(a.unidade)&&this.auth.hasPermissionTo("MOD_PENT_CANC_CONCL"));case this.BOTAO_CANCELAR_HOMOLOGACAO:return!this.execucao&&"ATIVO"==this.planoEntregaService.situacaoPlano(a)&&(1==a.unidade?.instituidora?this.unidadeService.isGestorUnidade(a.unidade?.id):this.unidadeService.isGestorUnidade(a.unidade?.unidade_pai_id)||this.auth.isLotacaoUsuario(a.unidade?.unidade_pai)&&this.auth.hasPermissionTo("MOD_PENT_CANC_HOMOL")||this.auth.isIntegrante("HOMOLOGADOR_PLANO_ENTREGA",a.unidade.unidade_pai_id));case this.BOTAO_CANCELAR_PLANO:return this.auth.hasPermissionTo("MOD_PENT_CNC")&&["INCLUIDO","HOMOLOGANDO","ATIVO"].includes(this.planoEntregaService.situacaoPlano(a))&&(this.unidadeService.isGestorUnidade(a.unidade?.id)||this.unidadeService.isGestorUnidade(a.unidade?.unidade_pai_id));case this.BOTAO_CONCLUIR:return"ATIVO"==this.planoEntregaService.situacaoPlano(a)&&(this.unidadeService.isGestorUnidade(a.unidade)||this.auth.isLotacaoUsuario(a.unidade)&&this.auth.hasPermissionTo("MOD_PENT_CONC"));case this.BOTAO_CONSULTAR:return this.auth.hasPermissionTo("MOD_PENT");case this.BOTAO_DESARQUIVAR:return"ARQUIVADO"==this.planoEntregaService.situacaoPlano(a)&&(this.unidadeService.isGestorUnidade(a.unidade)||this.auth.isLotacaoUsuario(a.unidade)&&this.auth.hasPermissionTo("MOD_PENT_ARQ"));case this.BOTAO_EXCLUIR:return!this.execucao&&this.auth.hasPermissionTo("MOD_PENT_EXCL")&&["INCLUIDO","HOMOLOGANDO"].includes(this.planoEntregaService.situacaoPlano(a))&&(this.unidadeService.isGestorUnidade(a.unidade)||this.auth.isLotacaoUsuario(a.unidade));case this.BOTAO_HOMOLOGAR:let ae="HOMOLOGANDO"==this.planoEntregaService.situacaoPlano(a),ne=this.unidadeService.isGestorUnidade(1==a.unidade?.instituidora?a.unidade?.id:a.unidade?.unidade_pai_id),vo=this.auth.isLotacaoUsuario(a.unidade.unidade_pai)&&this.auth.hasPermissionTo("MOD_PENT_HOMOL"),To=this.auth.isIntegrante("HOMOLOGADOR_PLANO_ENTREGA",a.unidade.unidade_pai_id);return!this.execucao&&ae&&(ne||vo||To);case this.BOTAO_LIBERAR_HOMOLOGACAO:return!this.execucao&&"INCLUIDO"==this.planoEntregaService.situacaoPlano(a)&&a.entregas.length>0&&(this.unidadeService.isGestorUnidade(a.unidade)||this.auth.isLotacaoUsuario(a.unidade)&&this.auth.hasPermissionTo("MOD_PENT_LIB_HOMOL"));case this.BOTAO_LOGS:return this.unidadeService.isGestorUnidade(a.unidade)&&this.auth.hasPermissionTo("MOD_PENT_AVAL_SUBORD");case this.BOTAO_REATIVAR:return"SUSPENSO"==this.planoEntregaService.situacaoPlano(a)&&(this.unidadeService.isGestorUnidade(a.unidade)||this.auth.isLotacaoUsuario(a.unidade)&&this.auth.hasPermissionTo("MOD_PENT_RTV")||this.auth.isGestorLinhaAscendente(a.unidade));case this.BOTAO_RETIRAR_HOMOLOGACAO:return!this.execucao&&"HOMOLOGANDO"==this.planoEntregaService.situacaoPlano(a)&&(this.unidadeService.isGestorUnidade(a.unidade)||this.auth.isLotacaoUsuario(a.unidade)&&this.auth.hasPermissionTo("MOD_PENT_RET_HOMOL"));case this.BOTAO_SUSPENDER:return"ATIVO"==this.planoEntregaService.situacaoPlano(a)&&(this.unidadeService.isGestorUnidade(a.unidade)||this.auth.isLotacaoUsuario(a.unidade)&&this.auth.hasPermissionTo("MOD_PENT_SUSP")||this.auth.isGestorLinhaAscendente(a.unidade));case this.BOTAO_CLONAR:return this.auth.hasPermissionTo("MOD_PENT_INCL")}return!1}arquivar(t){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoEntrega",entity:Object.assign({},t,{arquivar:!0}),novoStatus:t.status,onClick:this.dao.arquivar.bind(this.dao)},title:"Arquivar Plano de Entregas",modalClose:a=>{a&&(this.grid?.query||this.query).refreshId(t.id).then(()=>{this.checaBotaoAderirToolbar()})}})}avaliar(t){this.go.navigate({route:["gestao","plano-entrega",t.id,"avaliar"]},{modal:!0,metadata:{planoEntrega:t},modalClose:a=>{a&&(this.grid?.query||this.query).refreshId(t.id,["avaliacao.tipo_avaliacao.notas"]).then(()=>{this.checaBotaoAderirToolbar()})}})}cancelarAvaliacao(t){var a=this;return(0,m.A)(function*(){a.submitting=!0;try{(yield a.avaliacaoDao.cancelarAvaliacao(t.avaliacao.id))&&(a.grid?.query||a.query).refreshId(t.id).then(()=>{a.checaBotaoAderirToolbar()})}catch(n){a.error(n.message||n)}finally{a.submitting=!1}})()}cancelarConclusao(t){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoEntrega",entity:t,novoStatus:"ATIVO",onClick:this.dao.cancelarConclusao.bind(this.dao)},title:"Cancelar Conclus\xe3o",modalClose:a=>{a&&(this.grid?.query||this.query).refreshId(t.id).then(()=>{this.checaBotaoAderirToolbar()})}})}cancelarHomologacao(t){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoEntrega",entity:t,novoStatus:"HOMOLOGANDO",onClick:this.dao.cancelarHomologacao.bind(this.dao)},title:"Cancelar Homologa\xe7\xe3o",modalClose:a=>{a&&(this.grid?.query||this.query).refreshId(t.id).then(()=>{this.checaBotaoAderirToolbar()})}})}cancelarPlano(t){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoEntrega",entity:Object.assign({},t,{arquivar:!0}),novoStatus:"CANCELADO",onClick:this.dao.cancelarPlano.bind(this.dao)},title:"Cancelar Plano de Entregas",modalClose:a=>{a&&(this.grid?.query||this.query).refreshId(t.id).then(()=>{this.checaBotaoAderirToolbar()})}})}concluir(t){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoEntrega",entity:t,novoStatus:"CONCLUIDO",onClick:this.dao.concluir.bind(this.dao)},title:"Concluir Plano de Entregas",modalClose:a=>{a&&(this.grid?.query||this.query).refreshId(t.id).then(()=>{this.checaBotaoAderirToolbar()})}})}desarquivar(t){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoEntrega",entity:Object.assign({},t,{arquivar:!1}),novoStatus:t.status,onClick:this.dao.arquivar.bind(this.dao)},title:"Desarquivar Plano de Entregas",modalClose:a=>{a&&(this.grid?.query||this.query).refreshId(t.id).then(()=>{this.checaBotaoAderirToolbar()})}})}homologar(t){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoEntrega",entity:t,novoStatus:"ATIVO",onClick:this.dao.homologar.bind(this.dao)},title:"Homologar Plano de Entregas",modalClose:a=>{a&&(this.grid?.query||this.query).refreshId(t.id).then(()=>{this.checaBotaoAderirToolbar()})}})}liberarHomologacao(t){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoEntrega",entity:t,novoStatus:"HOMOLOGANDO",onClick:this.dao.liberarHomologacao.bind(this.dao)},title:"Liberar para Homologa\xe7\xe3o",modalClose:a=>{a&&(this.grid?.query||this.query).refreshId(t.id).then(()=>{this.checaBotaoAderirToolbar()})}})}reativar(t){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoEntrega",entity:t,novoStatus:"ATIVO",onClick:this.dao.reativar.bind(this.dao)},title:"Reativar Plano de Entregas",modalClose:a=>{a&&(this.grid?.query||this.query).refreshId(t.id).then(()=>{this.checaBotaoAderirToolbar()})}})}retirarHomologacao(t){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoEntrega",entity:t,novoStatus:"INCLUIDO",onClick:this.dao.retirarHomologacao.bind(this.dao)},title:"Retirar de Homologa\xe7\xe3o",modalClose:a=>{a&&(this.grid?.query||this.query).refreshId(t.id).then(()=>{this.checaBotaoAderirToolbar()})}})}suspender(t){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoEntrega",entity:t,novoStatus:"SUSPENSO",onClick:this.dao.suspender.bind(this.dao)},title:"Suspender Plano de Entregas",modalClose:a=>{a&&(this.grid?.query||this.query).refreshId(t.id).then(()=>{this.checaBotaoAderirToolbar()})}})}canAdd(){return this.auth.hasPermissionTo("MOD_PENT_INCL")}static{this.\u0275fac=function(a){return new(a||o)(e.rXU(e.zZn))}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["plano-entrega-list"]],viewQuery:function(a,n){if(1&a&&e.GBs(f._,5),2&a){let i;e.mGM(i=e.lsd())&&(n.grid=i.first)}},features:[e.Vt3],decls:34,vars:35,consts:[["naoEModal",""],["titleIdNumeroStatus",""],["columnNumero",""],["titleNomeProgramaUnidade",""],["columnNome",""],["columnInicio",""],["columnFim",""],["titlePlanoCadeia",""],["columnPlanoCadeia",""],["columnStatus",""],["unidade",""],["planejamento",""],["cadeiaValor",""],["columnEntregas",""],["columnExpandedEntregas",""],[3,"select","dao","add","title","orderBy","groupBy","join","selectable","hasAdd","hasEdit","loadList"],[3,"buttons",4,"ngIf"],[3,"deleted","form","where","submit","clear","collapseChange","collapsed","visible"],[4,"ngIf","ngIfElse"],["type","expand","icon","bi bi-list-check",3,"align","hint","template","expandTemplate",4,"ngIf"],[3,"titleTemplate","template"],["title","In\xedcio","orderBy","data_inicio",3,"template"],["title","Fim","orderBy","data_fim",3,"template"],[3,"title","template"],["type","options",3,"dynamicOptions","dynamicButtons"],[3,"rows"],[3,"buttons"],["labelPosition","left","label","Agrupar por unidade","controlName","agrupar",3,"change","size","control"],["labelPosition","left","label","Vinculados","controlName","principais",3,"size","control","labelInfo","change",4,"ngIf"],["labelPosition","left","label","Vinculados","controlName","principais",3,"change","size","control","labelInfo"],[1,"row"],["label","Meus","controlName","meus_planos","labelInfo","Planos de entrega das unidade da qual sou integrante (\xc1reas de trabalho)",3,"size","control"],["controlName","unidade_id",3,"size","control","dao"],["label","Data","itemTodos","- Nenhum -","controlName","data_filtro",3,"size","valueTodos","control","items"],["date","","label","In\xedcio","controlName","data_filtro_inicio","labelInfo","Data in\xedcio do per\xedodo",3,"size","disabled","control"],["date","","label","Fim","controlName","data_filtro_fim","labelInfo","Data fim do per\xedodo",3,"size","disabled","control"],["label","Nome","controlName","nome",3,"size","control","placeholder"],["label","Status","controlName","status","itemTodos","- Todos -",3,"size","control","items","filter","valueTodos"],["label","Arquivados","controlName","arquivadas","labelInfo","Listar tamb\xe9m os planos de entregas arquivados",3,"size","control"],["controlName","planejamento_id",3,"size","control","dao"],["controlName","cadeia_valor_id",3,"size","control","dao"],["type","expand","icon","bi bi-list-check",3,"align","hint","template","expandTemplate"],["class","badge rounded-pill bg-light text-dark",4,"ngIf"],[1,"badge","rounded-pill","bg-light","text-dark"],[1,"bi","bi-list-check"],[3,"parent","disabled","entity","execucao","cdRef","planejamentoId","cadeiaValorId","unidadeId"],["by","numero",3,"header"],[1,"micro-text","fw-ligh"],["by","nome",3,"header"],[1,"text-break","text-wrap"],["color","light",3,"icon","label",4,"ngIf"],["color","secondary",3,"icon","label",4,"ngIf"],["color","light",3,"icon","label"],["color","secondary",3,"icon","label"],["color","light",3,"maxWidth","icon","label",4,"ngIf"],["color","light",3,"maxWidth","icon","label"],[3,"color","icon","label"],["color","warning","icon","bi bi-inboxes","label","Arquivado",4,"ngIf"],["color","danger","icon","bi bi-trash3","label","Exclu\xeddo",4,"ngIf"],[3,"align","tipoAvaliacao","nota",4,"ngIf"],["color","warning","icon","bi bi-inboxes","label","Arquivado"],["color","danger","icon","bi bi-trash3","label","Exclu\xeddo"],[3,"align","tipoAvaliacao","nota"]],template:function(a,n){if(1&a){const i=e.RV6();e.j41(0,"grid",15),e.bIt("select",function(c){return e.eBV(i),e.Njj(n.onSelect(c))}),e.DNE(1,rt,3,4,"toolbar",16),e.j41(2,"filter",17),e.DNE(3,dt,8,15,"div",18)(4,ct,15,33,"ng-template",null,0,e.C5r),e.k0s(),e.j41(6,"columns"),e.DNE(7,_t,5,4,"column",19),e.j41(8,"column",20),e.DNE(9,pt,2,1,"ng-template",null,1,e.C5r)(11,ht,2,1,"ng-template",null,2,e.C5r),e.k0s(),e.j41(13,"column",20),e.DNE(14,ft,4,2,"ng-template",null,3,e.C5r)(16,vt,5,5,"ng-template",null,4,e.C5r),e.k0s(),e.j41(18,"column",21),e.DNE(19,Tt,2,1,"ng-template",null,5,e.C5r),e.k0s(),e.j41(21,"column",22),e.DNE(22,Ot,2,1,"ng-template",null,6,e.C5r),e.k0s(),e.j41(24,"column",20),e.DNE(25,At,3,0,"ng-template",null,7,e.C5r)(27,Dt,2,2,"ng-template",null,8,e.C5r),e.k0s(),e.j41(29,"column",23),e.DNE(30,jt,5,6,"ng-template",null,9,e.C5r),e.k0s(),e.nrm(32,"column",24),e.k0s(),e.nrm(33,"pagination",25),e.k0s()}if(2&a){const i=e.sdS(5),s=e.sdS(10),c=e.sdS(12),g=e.sdS(15),h=e.sdS(17),E=e.sdS(20),z=e.sdS(23),F=e.sdS(26),ae=e.sdS(28),ne=e.sdS(31);e.Y8G("dao",n.dao)("add",n.add)("title",n.isModal?"":n.title)("orderBy",n.orderBy)("groupBy",n.groupBy)("join",n.join)("selectable",n.selectable)("hasAdd",n.canAdd())("hasEdit",!1)("loadList",n.onGridLoad.bind(n)),e.R7$(),e.Y8G("ngIf",!n.selectable),e.R7$(),e.Y8G("deleted",n.auth.hasPermissionTo("MOD_AUDIT_DEL"))("form",n.filter)("where",n.filterWhere)("submit",n.filterSubmit.bind(n))("clear",n.filterClear.bind(n))("collapseChange",n.filterCollapseChange.bind(n))("collapsed",!n.selectable&&n.filterCollapsed)("visible",n.showFilter),e.R7$(),e.Y8G("ngIf",n.isModal)("ngIfElse",i),e.R7$(4),e.Y8G("ngIf",!n.selectable),e.R7$(),e.Y8G("titleTemplate",s)("template",c),e.R7$(5),e.Y8G("titleTemplate",g)("template",h),e.R7$(5),e.Y8G("template",E),e.R7$(3),e.Y8G("template",z),e.R7$(3),e.Y8G("titleTemplate",F)("template",ae),e.R7$(5),e.Y8G("title","Status\nAvalia\xe7\xe3o")("template",ne),e.R7$(3),e.Y8G("dynamicOptions",n.dynamicOptions.bind(n))("dynamicButtons",n.dynamicButtons.bind(n)),e.R7$(),e.Y8G("rows",n.rowsLimit)}},dependencies:[A.bT,f._,O.T,p.I,G.i,B.H,U.e,ie.S,Y.O,M.H,k.r,q.K,ee.Y,y.n,Ie.R,re]})}}return o})();var de=r(5374),W=r(24);const Nt=["programa"],Lt=["unidade"],St=["nome"],kt=["data_fim"];let K=(()=>{class o extends W.n{constructor(t){super(t,w,P.m),this.injector=t,this.validate=(a,n)=>{let i=null;return["nome","unidade_id","programa_id"].indexOf(n)>=0&&!a.value?.length&&(i="Obrigat\xf3rio"),["data_inicio"].indexOf(n)>=0&&!this.dao?.validDateTime(a.value)&&(i="Inv\xe1lido"),["data_fim"].indexOf(n)>=0&&!this.dao?.validDateTime(a.value)&&(i="Inv\xe1lido"),i},this.formValidation=a=>{const n=this.form?.controls.data_inicio.value,i=this.form?.controls.data_fim.value;if(!this.programa?.selectedEntity)return"Obrigat\xf3rio selecionar o programa";if(!this.dao?.validDateTime(n))return"Data de in\xedcio inv\xe1lida";if(!this.dao?.validDateTime(i))return"Data de fim inv\xe1lida";if(n>i)return"A data do fim n\xe3o pode ser menor que a data do in\xedcio!";{const c=this.form.controls.entregas.value||[];for(let g of c){if(!this.auth.hasPermissionTo("MOD_PENT_ENTR_EXTRPL")&&g.data_inicio<n)return"A "+this.lex.translate("entrega")+" '"+g.descricao+"' possui data inicial anterior \xe0 "+this.lex.translate("do Plano de Entrega")+": "+this.util.getDateFormatted(n);if(!this.auth.hasPermissionTo("MOD_PENT_ENTR_EXTRPL")&&g.data_fim>i)return"A "+this.lex.translate("entrega")+" '"+g.descricao+"' possui data fim posterior \xe0 "+this.lex.translate("do Plano de Entrega")+": "+this.util.getDateFormatted(i)}}},this.titleEdit=a=>"Editando "+this.lex.translate("Plano de Entregas")+": "+(a?.nome||""),this.unidadeDao=t.get(j.s),this.programaDao=t.get(de.X),this.cadeiaValorDao=t.get(R.X),this.planoEntregaDao=t.get(P.m),this.planejamentoInstitucionalDao=t.get(I.Y),this.join=["entregas.entrega","entregas.objetivos.objetivo","entregas.processos.processo","entregas.produtos.produto","entregas.unidade","unidade","entregas.reacoes.usuario:id,nome,apelido"],this.modalWidth=1200,this.form=this.fh.FormBuilder({nome:{default:""},data_inicio:{default:new Date},data_fim:{default:new Date},unidade_id:{default:""},plano_entrega_id:{default:null},planejamento_id:{default:null},cadeia_valor_id:{default:null},programa_id:{default:null},entregas:{default:[]}},this.cdRef,this.validate),this.programaMetadata={todosUnidadeExecutora:!1,vigentesUnidadeExecutora:!0}}loadData(t,a,n){var i=this;return(0,m.A)(function*(){"clone"==n&&(t.id="",t.data_inicio=new Date,t.data_fim=new Date,t.entregas=t.entregas.map(c=>(c.id=i.planoEntregaDao.generateUuid(),c.plano_entrega_id=null,c._status="ADD",c.progresso_realizado=0,c)));let s=Object.assign({},a.value);a.patchValue(i.util.fillForm(s,t)),"clone"==n&&(a.controls.data_inicio.setValue(""),a.controls.data_fim.setValue("")),i.cdRef.detectChanges()})()}initializeData(t){var a=this;return(0,m.A)(function*(){a.entity=new w,a.entity.unidade_id=a.auth.unidade?.id||"",a.entity.unidade=a.auth.unidade;let i=(yield a.programaDao.query({where:[["vigentesUnidadeExecutora","==",a.auth.unidade.id]],orderBy:[["unidade.path","desc"]]}).asPromise())[0];i&&(a.entity.programa=i,a.entity.programa_id=i.id);const s=new Date(a.entity.data_inicio).toLocaleDateString(),c=a.entity.data_fim?new Date(a.entity.data_fim).toLocaleDateString():(new Date).toLocaleDateString();a.entity.nome=a.auth.unidade.sigla+" - "+s+" - "+c,a.loadData(a.entity,a.form)})()}saveData(t){var a=this;return(0,m.A)(function*(){return new Promise((n,i)=>{let s=a.util.fill(new w,a.entity);s=a.util.fillForm(s,a.form.value),s.entregas=s.entregas?.filter(c=>c._status)||[],n(s)})})()}dynamicButtons(t){return[]}onDataChange(){this.sugereNome()}onUnidadeChange(){var t=this;return(0,m.A)(function*(){let n=t.form.controls.unidade_id.value||t.auth.unidade?.id;if(n)try{yield t.planoEntregaDao.permissaoIncluir(n)}catch(i){t.error(i)}t.sugereNome()})()}sugereNome(){const t=this.unidade?.selectedItem?this.unidade?.selectedItem?.entity.sigla:this.auth.unidade?.sigla,a=new Date(this.form.controls.data_inicio.value).toLocaleDateString(),n=this.form.controls.data_fim.value?" - "+new Date(this.form.controls.data_fim.value).toLocaleDateString():"";this.form.controls.nome.setValue(t+" - "+a+n)}somaDia(t,a){let n=new Date(t);return n.setDate(n.getDate()+a),n}onProgramaChange(){const t=this.programa?.selectedEntity?.prazo_max_plano_entrega,a=this.somaDia(this.entity.data_inicio,t);this.entity?.data_fim||(this.form.controls.data_fim.setValue(new Date(a)),this.dataFim?.change.emit())}static{this.\u0275fac=function(a){return new(a||o)(e.rXU(e.zZn))}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["app-plano-entrega-form"]],viewQuery:function(a,n){if(1&a&&(e.GBs(N.Q,5),e.GBs(f._,7),e.GBs(Nt,7),e.GBs(Lt,7),e.GBs(St,7),e.GBs(kt,7)),2&a){let i;e.mGM(i=e.lsd())&&(n.editableForm=i.first),e.mGM(i=e.lsd())&&(n.grid=i.first),e.mGM(i=e.lsd())&&(n.programa=i.first),e.mGM(i=e.lsd())&&(n.unidade=i.first),e.mGM(i=e.lsd())&&(n.nomePE=i.first),e.mGM(i=e.lsd())&&(n.dataFim=i.first)}},features:[e.Vt3],decls:20,vars:28,consts:[["unidade",""],["programa",""],["data_fim",""],["nome",""],["planejamento",""],["cadeiaValor",""],["entregas",""],["initialFocus","entregas",3,"submit","cancel","form","disabled","title"],[1,"row"],["controlName","unidade_id","required","",3,"change","size","disabled","dao"],["controlName","programa_id","required","",3,"change","size","disabled","dao","metadata"],["date","","label","In\xedcio","controlName","data_inicio","required","",3,"change","size","labelInfo"],["date","","label","Fim","controlName","data_fim","required","",3,"change","size","labelInfo"],["label","Nome","controlName","nome","required","",3,"size"],["controlName","planejamento_id","label","Planejamento Institucional",3,"size","emptyValue","dao"],["controlName","cadeia_valor_id","label","Cadeia de Valor",3,"size","emptyValue","dao"],["title","Entregas"],["noPersist","",3,"disabled","control","planejamentoId","cadeiaValorId","unidadeId","dataFim"]],template:function(a,n){if(1&a){const i=e.RV6();e.j41(0,"editable-form",7),e.bIt("submit",function(){return e.eBV(i),e.Njj(n.onSaveData())})("cancel",function(){return e.eBV(i),e.Njj(n.onCancel())}),e.j41(1,"div")(2,"div",8)(3,"input-search",9,0),e.bIt("change",function(){return e.eBV(i),e.Njj(n.onUnidadeChange())}),e.k0s(),e.j41(5,"input-search",10,1),e.bIt("change",function(){return e.eBV(i),e.Njj(n.onProgramaChange())}),e.k0s(),e.j41(7,"input-datetime",11),e.bIt("change",function(){return e.eBV(i),e.Njj(n.onDataChange())}),e.k0s(),e.j41(8,"input-datetime",12,2),e.bIt("change",function(){return e.eBV(i),e.Njj(n.onDataChange())}),e.k0s()(),e.j41(10,"div",8),e.nrm(11,"input-text",13,3)(13,"input-search",14,4)(15,"input-search",15,5),e.k0s(),e.nrm(17,"separator",16)(18,"plano-entrega-list-entrega",17,6),e.k0s()()}2&a&&(e.Y8G("form",n.form)("disabled",n.formDisabled)("title",n.isModal?"":n.title),e.R7$(3),e.Y8G("size",4)("disabled",null!=n.entity&&n.entity.id?"disabled":void 0)("dao",n.unidadeDao),e.R7$(2),e.Y8G("size",4)("disabled",null!=n.entity&&n.entity.id?"disabled":void 0)("dao",n.programaDao)("metadata",n.programaMetadata),e.R7$(2),e.Y8G("size",2)("labelInfo","In\xedcio "+n.lex.translate("Plano de Entrega")),e.R7$(),e.Y8G("size",2)("labelInfo","Fim "+n.lex.translate("Plano de Entrega")),e.R7$(3),e.Y8G("size",4),e.BMQ("maxlength",250),e.R7$(2),e.Y8G("size",4)("emptyValue",null)("dao",n.planejamentoInstitucionalDao),e.R7$(2),e.Y8G("size",4)("emptyValue",null)("dao",n.cadeiaValorDao),e.R7$(3),e.Y8G("disabled",n.formDisabled)("control",n.form.controls.entregas)("planejamentoId",n.form.controls.planejamento_id.value)("cadeiaValorId",n.form.controls.cadeia_valor_id.value)("unidadeId",n.form.controls.unidade_id.value)("dataFim",n.form.controls.data_fim.value))},dependencies:[N.Q,Y.O,M.H,k.r,H.F,re]})}}return o})();var ce=r(1385),ue=r(9970),me=r(242),Ft=r(3292);const Vt=["unidade"];function Yt(o,l){if(1&o&&e.nrm(0,"planejamento-show",18),2&o){const t=e.XpG(2);e.Y8G("planejamento",t.objetivo.planejamento)}}function zt(o,l){if(1&o&&(e.qex(0),e.DNE(1,Yt,1,1,"planejamento-show",16),e.j41(2,"div",17)(3,"h5"),e.EFF(4,"Objetivo:"),e.k0s(),e.j41(5,"h6"),e.EFF(6),e.k0s()(),e.bVm()),2&o){const t=e.XpG();e.R7$(),e.Y8G("ngIf",t.objetivo.planejamento),e.R7$(5),e.JRh(t.objetivo.nome)}}function $t(o,l){if(1&o&&(e.j41(0,"div",21)(1,"h6"),e.EFF(2,"Cadeia de valor:"),e.k0s(),e.j41(3,"h4"),e.EFF(4),e.k0s()()),2&o){const t=e.XpG(2);e.R7$(4),e.JRh(t.processo.cadeia_valor.nome)}}function wt(o,l){if(1&o&&(e.qex(0),e.DNE(1,$t,5,1,"div",19),e.j41(2,"div",20)(3,"h5"),e.EFF(4,"Processo:"),e.k0s(),e.j41(5,"h6"),e.EFF(6),e.k0s()(),e.bVm()),2&o){const t=e.XpG();e.R7$(),e.Y8G("ngIf",t.processo.cadeia_valor),e.R7$(5),e.JRh(t.processo.nome)}}function Bt(o,l){if(1&o&&e.nrm(0,"badge",25),2&o){const t=e.XpG().row,a=e.XpG();e.Y8G("icon",a.entityService.getIcon("Unidade"))("label",t.plano_entrega.unidade.sigla)}}function Ut(o,l){if(1&o&&e.nrm(0,"badge",26),2&o){const t=e.XpG().row;e.Y8G("label",t.destinatario)}}function Mt(o,l){if(1&o&&(e.EFF(0),e.nrm(1,"br"),e.j41(2,"span",22),e.DNE(3,Bt,1,2,"badge",23)(4,Ut,1,1,"badge",24),e.k0s()),2&o){const t=l.row;e.SpI(" ",t.descricao,""),e.R7$(3),e.Y8G("ngIf",t.plano_entrega&&t.plano_entrega.unidade),e.R7$(),e.Y8G("ngIf",null==t.destinatario?null:t.destinatario.length)}}function qt(o,l){if(1&o&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&o){const t=e.XpG().row,a=e.XpG();e.R7$(),e.SpI(" ",a.dao.getDateFormatted(t.data_inicio),"")}}function Xt(o,l){if(1&o&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&o){const t=e.XpG().row,a=e.XpG();e.R7$(),e.SpI(" ",a.dao.getDateFormatted(t.data_fim),"")}}function xt(o,l){if(1&o&&(e.DNE(0,qt,2,1,"span",5),e.nrm(1,"br"),e.DNE(2,Xt,2,1,"span",5)),2&o){const t=l.row;e.Y8G("ngIf",t.data_inicio),e.R7$(2),e.Y8G("ngIf",t.data_fim)}}function Ht(o,l){if(1&o&&e.nrm(0,"progress-bar",27),2&o){const t=l.row;e.Y8G("value",t.progresso_realizado)("goal",t.progresso_esperado)}}let ge=(()=>{class o extends d.P{constructor(t){super(t,X.j,L.o),this.injector=t,this.filterWhere=a=>{let n=[],i=a.value;return this.objetivoId&&n.push(["objetivos.objetivo_id","==",this.objetivoId]),this.processoId&&n.push(["processos.processo_id","==",this.processoId]),i.unidade_id&&n.push(["plano_entrega.unidade_id","==",i.unidade_id]),i.entrega_id&&n.push(["entrega_id","==",i.entrega_id]),i.data_inicio&&n.push(["data_inicio",">=",i.data_inicio]),i.data_fim&&n.push(["data_fim","<=",i.data_fim]),n},this.unidadeDao=t.get(j.s),this.entregaDao=t.get(ce.u),this.entregaService=t.get(u.C),this.objetivoDao=t.get(ue.O),this.processoDao=t.get(me.p),this.join=["plano_entrega.unidade"],this.title=this.lex.translate("Entregas"),this.filter=this.fh.FormBuilder({unidade_id:{default:null},entrega_id:{default:null},data_inicio:{default:null},data_fim:{default:null}})}ngOnInit(){super.ngOnInit(),this.objetivoId=this.urlParams.get("objetivo_id")||void 0,this.processoId=this.urlParams.get("processo_id")||void 0,this.objetivoId&&this.objetivoDao?.getById(this.objetivoId,["planejamento"]).then(t=>{this.objetivo=t}),this.processoId&&this.processoDao?.getById(this.processoId,["cadeia_valor"]).then(t=>{this.processo=t})}filterClear(t){t.controls.unidade_id.setValue(null),t.controls.entrega_id.setValue(null),t.controls.data_inicio.setValue(null),t.controls.data_fim.setValue(null),super.filterClear(t)}static{this.\u0275fac=function(a){return new(a||o)(e.rXU(e.zZn))}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["plano-entrega-mapa-entregas"]],viewQuery:function(a,n){if(1&a&&(e.GBs(f._,5),e.GBs(Vt,5)),2&a){let i;e.mGM(i=e.lsd())&&(n.grid=i.first),e.mGM(i=e.lsd())&&(n.unidade=i.first)}},features:[e.Vt3],decls:23,vars:31,consts:[["unidade",""],["entrega",""],["columnEntregaCliente",""],["columnDatas",""],["columnProgresso",""],[4,"ngIf"],[3,"dao","title","orderBy","join"],[3,"deleted","form","where","submit","clear","collapseChange","collapsed"],[1,"row"],["controlName","unidade_id",3,"size","control","dao"],["controlName","entrega_id",3,"size","control","dao"],["date","","noIcon","","label","In\xedcio","controlName","data_inicio","labelInfo","Data de in\xedcio do planejamento institucional",3,"size","control"],["date","","noIcon","","label","Fim","controlName","data_fim","labelInfo","Data do fim do planejamento institucional",3,"size","control"],[3,"title","template"],[3,"title","width","template"],[3,"rows"],[3,"planejamento",4,"ngIf"],[1,"objetivos","arrow_box","w-100"],[3,"planejamento"],["class","planejamento arrow_box first-box w-100",4,"ngIf"],[1,"procesos","arrow_box","w-100"],[1,"planejamento","arrow_box","first-box","w-100"],[1,"d-block"],["color","light",3,"icon","label",4,"ngIf"],["color","light","icon","bi bi-mailbox",3,"label",4,"ngIf"],["color","light",3,"icon","label"],["color","light","icon","bi bi-mailbox",3,"label"],["color","success",3,"value","goal"]],template:function(a,n){if(1&a&&(e.DNE(0,zt,7,2,"ng-container",5)(1,wt,7,2,"ng-container",5),e.j41(2,"grid",6),e.nrm(3,"toolbar"),e.j41(4,"filter",7)(5,"div",8),e.nrm(6,"input-search",9,0)(8,"input-search",10,1)(10,"input-datetime",11)(11,"input-datetime",12),e.k0s()(),e.j41(12,"columns")(13,"column",13),e.DNE(14,Mt,5,3,"ng-template",null,2,e.C5r),e.k0s(),e.j41(16,"column",13),e.DNE(17,xt,3,2,"ng-template",null,3,e.C5r),e.k0s(),e.j41(19,"column",14),e.DNE(20,Ht,1,2,"ng-template",null,4,e.C5r),e.k0s()(),e.nrm(22,"pagination",15),e.k0s()),2&a){const i=e.sdS(15),s=e.sdS(18),c=e.sdS(21);e.Y8G("ngIf",n.objetivo),e.R7$(),e.Y8G("ngIf",n.processo),e.R7$(),e.Y8G("dao",n.dao)("title",n.isModal?"":n.title)("orderBy",n.orderBy)("join",n.join),e.R7$(2),e.Y8G("deleted",n.auth.hasPermissionTo("MOD_AUDIT_DEL"))("form",n.filter)("where",n.filterWhere)("submit",n.filterSubmit.bind(n))("clear",n.filterClear.bind(n))("collapseChange",n.filterCollapseChange.bind(n))("collapsed",!n.selectable&&n.filterCollapsed),e.R7$(2),e.Y8G("size",4)("control",n.filter.controls.unidade_id)("dao",n.unidadeDao),e.R7$(2),e.Y8G("size",4)("control",n.filter.controls.entrega_id)("dao",n.entregaDao),e.R7$(2),e.Y8G("size",2)("control",n.filter.controls.data_inicio),e.R7$(),e.Y8G("size",2)("control",n.filter.controls.data_fim),e.R7$(2),e.Y8G("title","Entrega\nDemandante/Destinat\xe1rio")("template",i),e.R7$(3),e.Y8G("title","Data In\xedcio\nData Fim")("template",s),e.R7$(3),e.Y8G("title","Progresso")("width",200)("template",c),e.R7$(3),e.Y8G("rows",n.rowsLimit)}},dependencies:[A.bT,f._,O.T,p.I,G.i,B.H,U.e,Y.O,k.r,y.n,Q.a,Ft.r]})}}return o})();const Qt=()=>["gestao","plano-entrega"],Jt=o=>({unidade_id:o,status:"ATIVO"}),Wt=o=>({showFilter:!1,filter:o}),Kt=(o,l)=>({route:o,params:l}),Zt=o=>["unidade_id","=",o],ea=()=>["status","=","ATIVO"],ta=(o,l)=>[o,l];let aa=(()=>{class o extends W.n{constructor(t){super(t,w,P.m),this.injector=t,this.validate=(a,n)=>{let i=null;return["nome","plano_entrega_id"].indexOf(n)>=0&&!a.value?.length&&(i="Obrigat\xf3rio"),i},this.titleEdit=a=>"Editando "+this.lex.translate("Plano de Entregas")+": "+(a?.nome||""),this.unidadeDao=t.get(j.s),this.programaDao=t.get(de.X),this.planoEntregaDao=t.get(P.m),this.cadeiaValorDao=t.get(R.X),this.planejamentoInstitucionalDao=t.get(I.Y),this.join=[],this.modalWidth=1e3,this.form=this.fh.FormBuilder({nome:{default:""},data_inicio:{default:""},data_fim:{default:""},planejamento_id:{default:null},cadeia_valor_id:{default:null},unidade_id:{default:this.auth.unidade?.id},plano_entrega_id:{default:null},programa_id:{default:null},status:{default:"HOMOLOGANDO"}},this.cdRef,this.validate)}ngOnInit(){super.ngOnInit();let t=this.metadata?.planoEntrega?this.metadata?.planoEntrega:null;t&&(this.form.controls.plano_entrega_id.setValue(t.id),this.form.controls.nome.setValue(t.nome),this.form.controls.data_inicio.setValue(t.data_inicio),this.form.controls.data_fim.setValue(t.data_fim),this.form.controls.planejamento_id.setValue(t.planejamento_id),this.form.controls.cadeia_valor_id.setValue(t.cadeia_valor_id))}loadData(t,a){var n=this;return(0,m.A)(function*(){let i=Object.assign({},a.value);a.patchValue(n.util.fillForm(i,t)),n.cdRef.detectChanges()})()}initializeData(t){var a=this;return(0,m.A)(function*(){a.loadData(a.entity,a.form)})()}saveData(t){var a=this;return(0,m.A)(function*(){return new Promise((n,i)=>{let s=a.util.fill(new w,a.entity);s=a.util.fillForm(s,a.form.value),n(s)})})()}onPlanoEntregaChange(t){this.form.controls.plano_entrega_id.value&&(this.form.controls.nome.setValue(this.planoEntrega?.selectedEntity.nome),this.form.controls.data_inicio.setValue(this.planoEntrega?.selectedEntity.data_inicio),this.form.controls.data_fim.setValue(this.planoEntrega?.selectedEntity.data_fim),this.form.controls.planejamento_id.setValue(this.planoEntrega?.selectedEntity.planejamento_id),this.form.controls.cadeia_valor_id.setValue(this.planoEntrega?.selectedEntity.cadeia_valor_id),this.form.controls.programa_id.setValue(this.planoEntrega?.selectedEntity.programa_id))}static{this.\u0275fac=function(a){return new(a||o)(e.rXU(e.zZn))}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["plano-entrega-adesao"]],viewQuery:function(a,n){if(1&a&&(e.GBs(N.Q,5),e.GBs(f._,7),e.GBs(Y.O,7)),2&a){let i;e.mGM(i=e.lsd())&&(n.editableForm=i.first),e.mGM(i=e.lsd())&&(n.grid=i.first),e.mGM(i=e.lsd())&&(n.planoEntrega=i.first)}},features:[e.Vt3],decls:21,vars:39,consts:[["planoEntrega",""],["initialFocus","plano_entrega_id",3,"submit","cancel","form","disabled","title"],[1,"row","mb-4"],["controlName","plano_entrega_id","label","Plano de Entregas da Unidade-pai","required","",3,"change","size","dao","selectRoute","where"],[1,"row"],["label","Nome deste Plano de Entregas","controlName","nome","required","",3,"size"],["disabled","","controlName","unidade_id",3,"size","label","dao"],["disabled","","label","Status","controlName","status",3,"size"],[1,"row","mt-4"],["title","Dados herdados do Plano de Entregas da Unidade-pai",3,"collapse"],["disabled","","label","Programa de Gest\xe3o","controlName","programa_id",3,"size","dao"],["disabled","","label","Planejamento Institucional","controlName","planejamento_id",3,"size","dao"],["disabled","","controlName","data_inicio","label","In\xedcio",3,"size","labelInfo"],["disabled","","label","Cadeia de Valor","controlName","cadeia_valor_id",3,"size","dao"],["disabled","","controlName","data_fim","label","Fim",3,"size","labelInfo"]],template:function(a,n){if(1&a){const i=e.RV6();e.j41(0,"editable-form",1),e.bIt("submit",function(){return e.eBV(i),e.Njj(n.onSaveData())})("cancel",function(){return e.eBV(i),e.Njj(n.onCancel())}),e.j41(1,"div")(2,"div",2)(3,"input-search",3,0),e.bIt("change",function(c){return e.eBV(i),e.Njj(n.onPlanoEntregaChange(c))}),e.k0s(),e.nrm(5,"separator"),e.k0s(),e.j41(6,"div",4),e.nrm(7,"input-text",5),e.k0s(),e.j41(8,"div",4),e.nrm(9,"input-search",6)(10,"input-text",7),e.k0s(),e.j41(11,"div",8)(12,"separator",9)(13,"div",4),e.nrm(14,"input-search",10),e.k0s(),e.j41(15,"div",4),e.nrm(16,"input-search",11)(17,"input-datetime",12),e.k0s(),e.j41(18,"div",4),e.nrm(19,"input-search",13)(20,"input-datetime",14),e.k0s()()()()()}2&a&&(e.Y8G("form",n.form)("disabled",n.formDisabled)("title",n.isModal?"":n.title),e.R7$(3),e.Y8G("size",12)("dao",n.planoEntregaDao)("selectRoute",e.l_i(30,Kt,e.lJ4(25,Qt),e.eq3(28,Wt,e.eq3(26,Jt,n.auth.unidade.unidade_pai_id))))("where",e.l_i(36,ta,e.eq3(33,Zt,n.auth.unidade.unidade_pai_id),e.lJ4(35,ea))),e.R7$(4),e.Y8G("size",12),e.BMQ("maxlength",250),e.R7$(2),e.Y8G("size",9)("label",n.lex.translate("Unidade"))("dao",n.unidadeDao),e.R7$(),e.Y8G("size",3),e.BMQ("maxlength",250),e.R7$(2),e.Y8G("collapse","collapse"),e.R7$(2),e.Y8G("size",12)("dao",n.programaDao),e.R7$(2),e.Y8G("size",9)("dao",n.planejamentoInstitucionalDao),e.R7$(),e.Y8G("size",3)("labelInfo","In\xedcio "+n.lex.translate("Plano de Entrega")),e.R7$(2),e.Y8G("size",9)("dao",n.cadeiaValorDao),e.R7$(),e.Y8G("size",3)("labelInfo","Fim "+n.lex.translate("Plano de Entrega")))},dependencies:[N.Q,Y.O,M.H,k.r,H.F]})}}return o})();var na=r(3609),oa=r(158),_e=r(2075),pe=r(6774);const ia=["gridProcessos"],la=["gridObjetivos"],sa=["entregas"],ra=["planejamento"],da=["cadeiaValor"],ca=["inputObjetivo"],ua=["inputProcesso"],ma=["entrega"],ga=["unidade"],_a=["tabs"],pa=["etiqueta"],ha=o=>["plano_entrega.unidade_id","in",o],fa=()=>["gestao","plano-entrega","entrega-list"],Ea=o=>({route:o}),ba=o=>({idsUnidadesAscendentes:o}),va=o=>["planejamento_id","==",o],he=o=>[o],Ta=()=>["gestao","planejamento","objetivoList"],Oa=o=>({planejamento_id:o}),fe=o=>({filter:o}),Ee=(o,l)=>({route:o,params:l}),Aa=o=>["cadeia_valor_id","==",o],Ca=()=>["gestao","cadeia-valor","processoList"],Ia=o=>({cadeia_valor_id:o});function Da(o,l){if(1&o&&(e.j41(0,"div",20),e.nrm(1,"plano-entrega-valor-meta-input",41)(2,"input-number",42),e.j41(3,"div",20),e.nrm(4,"plano-entrega-valor-meta-input",43)(5,"input-number",44),e.k0s()()),2&o){const t=e.XpG(),a=e.sdS(31);e.R7$(),e.Y8G("entrega",null==a?null:a.selectedEntity)("size",6)("control",t.form.controls.meta),e.R7$(),e.Y8G("size",6),e.R7$(2),e.Y8G("entrega",null==a?null:a.selectedEntity)("size",6)("control",t.form.controls.realizado)("change",t.onRealizadoChange.bind(t)),e.R7$(),e.Y8G("size",6)("stepValue",.01)}}function Pa(o,l){1&o&&(e.j41(0,"div",20),e.nrm(1,"input-number",42)(2,"input-number",44),e.k0s()),2&o&&(e.R7$(),e.Y8G("size",6),e.R7$(),e.Y8G("size",6)("stepValue",.01))}function Ra(o,l){1&o&&(e.j41(0,"order",49),e.EFF(1,"Objetivos"),e.k0s()),2&o&&e.Y8G("header",l.header)}function Ga(o,l){if(1&o&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&o){const t=l.row;e.R7$(),e.JRh(null==t.objetivo?null:t.objetivo.nome)}}function ja(o,l){if(1&o&&e.nrm(0,"input-search",50,10),2&o){const t=e.XpG(2);e.Y8G("size",12)("where",e.eq3(6,he,e.eq3(4,va,t.planejamentoId)))("dao",t.planejamentoObjetivoDao)("selectRoute",e.l_i(13,Ee,e.lJ4(8,Ta),e.eq3(11,fe,e.eq3(9,Oa,t.planejamentoId))))}}function ya(o,l){if(1&o&&(e.j41(0,"tab",45),e.nrm(1,"input-search",46,5),e.j41(3,"grid",47,6)(5,"columns")(6,"column",48),e.DNE(7,Ra,2,1,"ng-template",null,7,e.C5r)(9,Ga,2,1,"ng-template",null,8,e.C5r)(11,ja,2,16,"ng-template",null,9,e.C5r),e.k0s(),e.nrm(13,"column",28),e.k0s()()()),2&o){const t=e.sdS(8),a=e.sdS(10),n=e.sdS(12),i=e.XpG();e.R7$(),e.Y8G("size",12)("dao",i.planejamentoDao),e.R7$(2),e.Y8G("control",i.form.controls.objetivos)("form",i.formObjetivos)("orderBy",i.orderBy)("hasDelete",!0)("hasEdit",!0)("add",i.addObjetivo.bind(i))("remove",i.removeObjetivo.bind(i))("save",i.saveObjetivo.bind(i)),e.R7$(3),e.Y8G("titleTemplate",t)("template",a)("editTemplate",n)}}function Na(o,l){1&o&&(e.j41(0,"order",54),e.EFF(1,"Processos"),e.k0s()),2&o&&e.Y8G("header",l.header)}function La(o,l){if(1&o&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&o){const t=l.row;e.R7$(),e.JRh(null==t.processo?null:t.processo.nome)}}function Sa(o,l){if(1&o&&e.nrm(0,"input-search",55,16),2&o){const t=e.XpG(2);e.Y8G("size",12)("where",e.eq3(6,he,e.eq3(4,Aa,t.cadeiaValorId)))("dao",t.cadeiaValorProcessoDao)("selectRoute",e.l_i(13,Ee,e.lJ4(8,Ca),e.eq3(11,fe,e.eq3(9,Ia,t.cadeiaValorId))))}}function ka(o,l){if(1&o&&(e.j41(0,"tab",51),e.nrm(1,"input-search",52,11),e.j41(3,"grid",47,12)(5,"columns")(6,"column",48),e.DNE(7,Na,2,1,"ng-template",null,13,e.C5r)(9,La,2,1,"ng-template",null,14,e.C5r)(11,Sa,2,16,"ng-template",null,15,e.C5r),e.k0s(),e.nrm(13,"column",53),e.k0s()()()),2&o){const t=e.sdS(8),a=e.sdS(10),n=e.sdS(12),i=e.XpG();e.R7$(),e.Y8G("size",12)("dao",i.cadeiaValorDao),e.R7$(2),e.Y8G("control",i.form.controls.processos)("form",i.formProcessos)("orderBy",i.orderBy)("hasDelete",!0)("hasEdit",!0)("add",i.addProcesso.bind(i))("remove",i.removeProcesso.bind(i))("save",i.saveProcesso.bind(i)),e.R7$(3),e.Y8G("titleTemplate",t)("template",a)("editTemplate",n),e.R7$(7),e.Y8G("dynamicButtons",i.dynamicButtonsProcessos.bind(i))}}let be=(()=>{class o extends W.n{constructor(t){super(t,X.j,L.o),this.injector=t,this.itensQualitativo=[],this.idsUnidadesAscendentes=[],this.checklist=[],this.etiquetas=[],this.etiquetasAscendentes=[],this.validate=(a,n)=>{let i=null;return["descricao","destinatario"].indexOf(n)>=0?a.value?.length?this.entrega.selectedEntity&&this.entrega.selectedEntity.descricao==a.value&&(i="\xc9 necess\xe1rio incrementar ou modificar a descri\xe7\xe3o da entrega"):i="Obrigat\xf3rio":["progresso_realizado","realizado"].indexOf(n)>=0&&!(a.value>=0||a.value?.length>0)||["progresso_esperado","meta"].indexOf(n)>=0&&!(a.value>0||a.value?.length>0)?i="Obrigat\xf3rio":["unidade_id"].indexOf(n)>=0&&!a.value?.length?i="A unidade demandante \xe9 obrigat\xf3ria":["entrega_id"].indexOf(n)>=0&&!a.value?.length?i="A entrega \xe9 obrigat\xf3ria":["data_inicio"].indexOf(n)>=0&&!this.dao?.validDateTime(a.value)||["data_fim"].indexOf(n)>=0&&!this.dao?.validDateTime(a.value)?i="Inv\xe1lido":["planejamento_objetivo_id"].indexOf(n)>=0?(a.value?.length||(i="O objetivo do planejamento \xe9 obrigat\xf3rio"),a.value?.length&&this.gridObjetivos?.items.filter(s=>"ADD"==s._status).map(s=>s.planejamento_objetivo_id).includes(this.formObjetivos.controls.planejamento_objetivo_id.value)&&(i="Este objetivo est\xe1 em duplicidade!")):["cadeia_processo_id"].indexOf(n)>=0&&(a.value?.length||(i="O processo da cadeia de valor \xe9 obrigat\xf3rio"),a.value?.length&&this.gridProcessos?.items.map(s=>s.cadeia_processo_id).includes(this.formProcessos.controls.cadeia_processo_id.value)&&(i="Este processo est\xe1 em duplicidade!")),i},this.formValidation=a=>{let n=this.form?.controls.data_inicio.value,i=this.form?.controls.data_fim.value;return this.gridObjetivos?.editing?(this.tabs.active="OBJETIVOS","Salve ou cancele o registro atual em edi\xe7\xe3o"):this.gridProcessos?.editing?(this.tabs.active="PROCESSOS","Salve ou cancele o registro atual em edi\xe7\xe3o"):this.dao?.validDateTime(n)?this.dao?.validDateTime(i)?n>i?"A data do fim n\xe3o pode ser anterior \xe0 data do in\xedcio!":!this.auth.hasPermissionTo("MOD_PENT_ENTR_EXTRPL")&&this.planoEntrega&&n<this.planoEntrega.data_inicio?"Data de inicio menor que a data de inicio "+this.lex.translate("do Plano de Entrega")+": "+this.util.getDateFormatted(this.planoEntrega.data_inicio):!this.auth.hasPermissionTo("MOD_PENT_ENTR_EXTRPL")&&this.planoEntrega&&this.planoEntrega.data_fim&&i>this.planoEntrega.data_fim?"Data de fim maior que a data de fim "+this.lex.translate("do Plano de Entrega")+": "+this.util.getDateFormatted(this.planoEntrega.data_fim):void 0:"Data de fim inv\xe1lida":"Data de in\xedcio inv\xe1lida"},this.planejamentoDao=t.get(I.Y),this.unidadeDao=t.get(j.s),this.entregaDao=t.get(ce.u),this.planoEntregaDao=t.get(P.m),this.planejamentoInstitucionalDao=t.get(I.Y),this.planoEntregaEntregaDao=t.get(L.o),this.cadeiaValorDao=t.get(R.X),this.cadeiaValorProcessoDao=t.get(me.p),this.planejamentoObjetivoDao=t.get(ue.O),this.planoEntregaService=t.get(u.C),this.modalWidth=700,this.join=["entrega","objetivos.objetivo","processos.processo","produtos.produto"],this.form=this.fh.FormBuilder({descricao:{default:""},descricao_entrega:{default:""},data_inicio:{default:new Date},data_fim:{default:new Date},meta:{default:100},descricao_meta:{default:""},realizado:{default:null},plano_entrega_id:{default:""},entrega_pai_id:{default:null},entrega_id:{default:null},progresso_esperado:{default:100},progresso_realizado:{default:null},unidade_id:{default:null},destinatario:{default:null},objetivos:{default:[]},processos:{default:[]},produtos:{default:[]},listaQualitativo:{default:[]},planejamento_id:{default:null},cadeia_valor_id:{default:null},objetivo_id:{default:null},objetivo:{default:null},checklist:{default:[]},etiquetas:{default:[]},etiqueta:{default:""}},this.cdRef,this.validate),this.formObjetivos=this.fh.FormBuilder({planejamento_objetivo_id:{default:null}},this.cdRef,this.validate),this.formProcessos=this.fh.FormBuilder({cadeia_processo_id:{default:null}},this.cdRef,this.validate),this.formChecklist=this.fh.FormBuilder({id:{default:""},texto:{default:""},checked:{default:!1}},this.cdRef)}ngOnInit(){super.ngOnInit(),this.planoEntrega=this.metadata?.plano_entrega,this.planejamentoId=this.metadata?.planejamento_id,this.cadeiaValorId=this.metadata?.cadeia_valor_id,this.unidadeId=this.metadata?.unidade_id,this.metadata?.data_fim&&(this.dataFim=this.metadata?.data_fim),this.entity=this.metadata?.entrega}loadData(t,a){var n=this;return(0,m.A)(function*(){""==t.unidade_id&&(t.unidade_id=n.unidadeId??"");let i=Object.assign({},a.value);n.onEntregaChange(a.value);let{meta:s,realizado:c,...g}=t;yield n.entrega?.loadSearch(t.entrega||i.entrega_id,!1),yield n.unidade?.loadSearch(n.unidadeId),yield n.planejamento?.loadSearch(n.planejamentoId),yield n.cadeiaValor?.loadSearch(n.cadeiaValorId);let h=n.unidadeId?.length?yield n.unidadeDao.getById(n.unidadeId):null;n.idsUnidadesAscendentes=h?.path?.split("/").slice(1)||[],h&&n.idsUnidadesAscendentes.push(h.id),a.patchValue(n.util.fillForm(i,g)),a.controls.meta.setValue(n.planoEntregaService.getValor(t.meta)),a.controls.realizado.setValue(n.planoEntregaService.getValor(t.realizado)),a.controls.objetivos.setValue(t.objetivos),a.controls.processos.setValue(t.processos),a.controls.produtos.setValue(t.produtos),n.dataFim&&a.controls.data_fim.setValue(n.dataFim),yield n.loadEtiquetas()})()}initializeData(t){var a=this;return(0,m.A)(function*(){yield a.loadData(a.entity,t)})()}onSaveEntrega(){var t=this;return(0,m.A)(function*(){let a,n=!0;if(t.formValidation)try{a=yield t.formValidation(t.form)}catch(i){a=i}if(t.form.valid&&!a){if("edit"==t.action){let i=(yield t.saveData(t.form.value)).modalResult,s=[];i._status="EDIT",t.loading=!0;try{s=yield t.planoEntregaDao.planosImpactadosPorAlteracaoEntrega(i)}finally{t.loading=!1}if(s.length){let c=s.map(g=>t.util.getDateFormatted(g.data_inicio)+" - "+t.util.getDateFormatted(g.data_fim)+" - "+g.unidade?.sigla+": "+g.usuario?.nome+"\n");n=yield t.dialog.confirm("Altera assim mesmo?","Caso prossiga com essa modifica\xe7\xe3o os seguintes planos de trabalho ser\xe3o repactuados automaticamente:\n\n"+c+"\nDeseja prosseguir?")}}n&&(yield t.onSaveData())}else t.form.markAllAsTouched(),a&&t.error(a)})()}saveData(t){return new Promise((a,n)=>{let i=this.util.fill(new X.j,this.entity);this.gridObjetivos?.confirm(),this.gridProcessos?.confirm();let{meta:s,realizado:c,...g}=this.form.value;i=this.util.fillForm(i,g),i.unidade=this.unidade?.selectedEntity,i.entrega=this.entrega?.selectedEntity,i.meta=this.planoEntregaService.getEntregaValor(i.entrega,s),i.realizado=this.planoEntregaService.getEntregaValor(i.entrega,c),a(new na.p(i))})}onRealizadoChange(t,a){this.calculaRealizado()}calculaRealizado(){const t=this.form?.controls.meta.value,a=this.form?.controls.realizado.value;if(t&&a){let n=isNaN(a)?0:(a/t*100).toFixed(0)||0;this.form?.controls.progresso_realizado.setValue(n)}}dynamicOptionsObjetivos(t){let a=[];return a.push({label:"Excluir",icon:"bi bi-trash",color:"btn-outline-danger",onClick:i=>{this.removeObjetivo(i)}}),a}dynamicButtonsObjetivos(t){return[]}dynamicButtonsProcessos(t){return[]}addObjetivo(){var t=this;return(0,m.A)(function*(){return{id:t.dao.generateUuid(),_status:"ADD"}})()}removeObjetivo(t){var a=this;return(0,m.A)(function*(){return(yield a.dialog.confirm("Exclui ?","Deseja realmente excluir?"))&&(t._status="DELETE"),!1})()}saveObjetivo(t,a){var n=this;return(0,m.A)(function*(){let i=a;if(t.controls.planejamento_objetivo_id.value.length&&n.inputObjetivo.selectedItem)return i.planejamento_objetivo_id=t.controls.planejamento_objetivo_id.value,i.objetivo=n.inputObjetivo.selectedItem.entity,i})()}addProcesso(){var t=this;return(0,m.A)(function*(){return{id:t.dao.generateUuid(),_status:"ADD"}})()}removeProcesso(t){var a=this;return(0,m.A)(function*(){return(yield a.dialog.confirm("Exclui ?","Deseja realmente excluir?"))&&(t._status="DELETE"),!1})()}saveProcesso(t,a){var n=this;return(0,m.A)(function*(){let i=a;if(t.controls.cadeia_processo_id.value.length&&n.inputProcesso.selectedItem)return i.cadeia_processo_id=t.controls.cadeia_processo_id.value,i.processo=n.inputProcesso.selectedItem.entity,i})()}onEntregaChange(t){var a=this;return(0,m.A)(function*(){if(a.entrega&&a.entrega.selectedItem){const n=a.entrega?.selectedEntity;switch(n.tipo_indicador){case"QUALITATIVO":a.itensQualitativo=n.lista_qualitativos||[],a.form?.controls.meta.setValue(a.itensQualitativo.length?a.itensQualitativo[0].key:null),a.form?.controls.realizado.setValue(a.itensQualitativo.length?a.itensQualitativo[0].key:null);break;case"VALOR":case"QUANTIDADE":a.form?.controls.meta.setValue(""),a.form?.controls.realizado.setValue(0);break;case"PORCENTAGEM":a.form?.controls.meta.setValue(100),a.form?.controls.realizado.setValue(0)}yield a.loadEtiquetas(),n.checklist&&a.loadChecklist(),a.calculaRealizado()}})()}loadEtiquetas(){var t=this;return(0,m.A)(function*(){if(!t.etiquetasAscendentes.filter(a=>a.data==t.unidade?.selectedEntity?.id).length){let a=yield t.carregaEtiquetasUnidadesAscendentes(t.unidade?.selectedEntity);t.etiquetasAscendentes.push(...a)}t.etiquetas=t.util.merge(t.entrega?.selectedEntity?.etiquetas,t.unidade?.selectedEntity?.etiquetas,(a,n)=>a.key==n.key),t.etiquetas=t.util.merge(t.etiquetas,t.auth.usuario.config?.etiquetas,(a,n)=>a.key==n.key),t.etiquetas=t.util.merge(t.etiquetas,t.etiquetasAscendentes.filter(a=>a.data==t.unidade?.selectedEntity?.id),(a,n)=>a.key==n.key)})()}carregaEtiquetasUnidadesAscendentes(t){var a=this;return(0,m.A)(function*(){let n=[],i=(t=t||a.auth.unidade).path.split("/");return(yield a.unidadeDao.query({where:[["id","in",i]]}).asPromise()).forEach(c=>{n=a.util.merge(n,c.etiquetas,(g,h)=>g.key==h.key)}),n.forEach(c=>c.data=t.id),n})()}loadChecklist(){let a=(this.entrega?.selectedEntity).checklist.map(n=>({id:n.id,texto:n.texto,checked:!1}));this.checklist=a||[],this.form.controls.checklist.setValue(a)}addItemHandleEtiquetas(){let t;if(this.etiqueta&&this.etiqueta.selectedItem){const a=this.etiqueta.selectedItem,n=a.key?.length?a.key:this.util.textHash(a.value);this.util.validateLookupItem(this.form.controls.etiquetas.value,n)&&(t={key:n,value:a.value,color:a.color,icon:a.icon},this.form.controls.etiqueta.setValue(""))}return t}static{this.\u0275fac=function(a){return new(a||o)(e.rXU(e.zZn))}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["plano-entrega-form-entrega"]],viewQuery:function(a,n){if(1&a&&(e.GBs(N.Q,5),e.GBs(ia,5),e.GBs(la,5),e.GBs(sa,5),e.GBs(ra,5),e.GBs(da,5),e.GBs(ca,5),e.GBs(ua,5),e.GBs(ma,5),e.GBs(ga,5),e.GBs(_a,5),e.GBs(pa,5)),2&a){let i;e.mGM(i=e.lsd())&&(n.editableForm=i.first),e.mGM(i=e.lsd())&&(n.gridProcessos=i.first),e.mGM(i=e.lsd())&&(n.gridObjetivos=i.first),e.mGM(i=e.lsd())&&(n.entregas=i.first),e.mGM(i=e.lsd())&&(n.planejamento=i.first),e.mGM(i=e.lsd())&&(n.cadeiaValor=i.first),e.mGM(i=e.lsd())&&(n.inputObjetivo=i.first),e.mGM(i=e.lsd())&&(n.inputProcesso=i.first),e.mGM(i=e.lsd())&&(n.entrega=i.first),e.mGM(i=e.lsd())&&(n.unidade=i.first),e.mGM(i=e.lsd())&&(n.tabs=i.first),e.mGM(i=e.lsd())&&(n.etiqueta=i.first)}},features:[e.Vt3],decls:44,vars:57,consts:[["tabs",""],["unidade",""],["entrega",""],["naoSelecionou",""],["etiqueta",""],["planejamento",""],["gridObjetivos",""],["titleObjetivo",""],["columnObjetivo",""],["editObjetivo",""],["inputObjetivo",""],["cadeiaValor",""],["gridProcessos",""],["titleProcessos",""],["processo",""],["editProcesso",""],["inputProcesso",""],["initialFocus","descricao",3,"submit","cancel","form","disabled","title"],["display","","right","",3,"title"],["key","ENTREGAS","label","Entregas"],[1,"row"],["collapse","",3,"title","collapsed"],["label","T\xedtulo","controlName","descricao","required","",3,"size","placeholder"],["controlName","descricao_entrega",3,"size","label","placeholder"],["controlName","entrega_pai_id",3,"size","label","dao","where","selectRoute","metadata"],[1,"row","mt-4"],["editable","",3,"control","form","hasAdd","hasDelete"],["type","text","title","Texto","field","texto"],["type","options"],["date","","label","In\xedcio","controlName","data_inicio","required","",3,"size","labelInfo"],["date","","label","Fim","controlName","data_fim","required","",3,"size","labelInfo"],["label","Demandante","controlName","unidade_id","required","",3,"size","dao"],["label","Destinat\xe1rio","controlName","destinatario","required","",3,"size"],["title","Planejamento"],["controlName","entrega_id","placeholder","Selecione ou cadastre uma meta do cat\xe1logo usando a lupa","required","",3,"change","size","label","dao"],["label","Descri\xe7\xe3o da meta","controlName","descricao_meta","placeholder","Descreva a meta",3,"size"],["class","row",4,"ngIf","ngIfElse"],["label","Etiquetas","controlName","etiquetas",3,"size","control","addItemHandle"],["controlName","etiqueta",3,"size","control","items"],["key","OBJETIVOS","label","Objetivos",4,"ngIf"],["key","PROCESSOS","label","Processos",4,"ngIf"],["icon","bi bi-graph-up-arrow","label","Meta","labelInfo","Onde quero chegar ao final da entrega. Evolu\xe7\xe3o total da entrega, podendo ultrapassar o per\xedodo do plano de entregas",3,"entrega","size","control"],["label","Parcela da entrega no plano","controlName","progresso_esperado","sufix","%","labelInfo","Quanto vou caminhar nesse plano de entregas. Percentual do total da entrega que ser\xe1 realizado durante a vig\xeancia desse plano",3,"size"],["icon","bi bi-check-lg","label","Progresso ao in\xedcio do plano","labelInfo","De onde estou saindo nesse plano. Valor correspondente ao progresso verificado no planejamento do plano de entregas",3,"entrega","size","control","change"],["label","Progresso j\xe1 realizado","controlName","progresso_realizado","sufix","%","disabled","","labelInfo","Quanto caminhei no plano atual Evolu\xe7\xe3o j\xe1 realizada para a meta. No ato da cria\xe7\xe3o do plano, \xe9 o percentual de progresso ao in\xedcio do plano em rela\xe7\xe3o \xe0 meta",3,"size","stepValue"],["key","OBJETIVOS","label","Objetivos"],["controlName","planejamento_id","disabled","",3,"size","dao"],["editable","",3,"control","form","orderBy","hasDelete","hasEdit","add","remove","save"],[3,"titleTemplate","template","editTemplate"],["by","objetivo.nome",3,"header"],["controlName","planejamento_objetivo_id",3,"size","where","dao","selectRoute"],["key","PROCESSOS","label","Processos"],["controlName","cadeia_valor_id","disabled","",3,"size","dao"],["type","options",3,"dynamicButtons"],["by","processo.nome",3,"header"],["label","","icon","","controlName","cadeia_processo_id","label","",3,"size","where","dao","selectRoute"]],template:function(a,n){if(1&a){const i=e.RV6();e.j41(0,"editable-form",17),e.bIt("submit",function(){return e.eBV(i),e.Njj(n.onSaveEntrega())})("cancel",function(){return e.eBV(i),e.Njj(n.onCancel())}),e.j41(1,"tabs",18,0)(3,"tab",19)(4,"div",20)(5,"separator",21)(6,"div",20),e.nrm(7,"input-text",22),e.k0s(),e.j41(8,"div",20),e.nrm(9,"input-textarea",23),e.k0s(),e.j41(10,"div",20),e.nrm(11,"input-search",24),e.k0s(),e.j41(12,"separator",21)(13,"div",25)(14,"h5"),e.EFF(15,"Etapas"),e.k0s(),e.j41(16,"grid",26)(17,"columns"),e.nrm(18,"column",27)(19,"column",28),e.k0s()()()()(),e.j41(20,"separator",21)(21,"div",20),e.nrm(22,"input-datetime",29)(23,"input-datetime",30),e.k0s(),e.j41(24,"div",20),e.nrm(25,"input-search",31,1)(27,"input-text",32),e.k0s()(),e.nrm(28,"separator",33),e.j41(29,"div",20)(30,"input-search",34,2),e.bIt("change",function(c){return e.eBV(i),e.Njj(n.onEntregaChange(c))}),e.k0s()(),e.j41(32,"div",20),e.nrm(33,"input-textarea",35),e.k0s(),e.DNE(34,Da,6,10,"div",36)(35,Pa,3,3,"ng-template",null,3,e.C5r),e.j41(37,"separator",21)(38,"div",20)(39,"input-multiselect",37),e.nrm(40,"input-select",38,4),e.k0s()()()()(),e.DNE(42,ya,14,13,"tab",39)(43,ka,14,14,"tab",40),e.k0s()()}if(2&a){const i=e.sdS(31),s=e.sdS(36);e.Y8G("form",n.form)("disabled",n.formDisabled)("title",n.isModal?"":n.title),e.R7$(),e.Y8G("title",n.isModal?"":n.title),e.R7$(4),e.Y8G("title","Informa\xe7\xf5es gerais da "+n.lex.translate("entrega"))("collapsed",!1),e.R7$(2),e.Y8G("size",12)("placeholder","T\xedtulo da "+n.lex.translate("entrega")),e.BMQ("maxlength",250),e.R7$(2),e.Y8G("size",12)("label","Descri\xe7\xe3o da "+n.lex.translate("entrega"))("placeholder","Descreva a "+n.lex.translate("entrega")),e.R7$(2),e.Y8G("size",12)("label","V\xednculo com "+n.lex.translate("entrega")+" de "+n.lex.translate("plano de entrega")+" superior")("dao",n.planoEntregaEntregaDao)("where",e.eq3(50,ha,n.idsUnidadesAscendentes))("selectRoute",e.eq3(53,Ea,e.lJ4(52,fa)))("metadata",e.eq3(55,ba,n.idsUnidadesAscendentes)),e.R7$(),e.Y8G("title","Etapas da "+n.lex.translate("entrega"))("collapsed",!0),e.R7$(4),e.Y8G("control",n.form.controls.checklist)("form",n.formChecklist)("hasAdd",!0)("hasDelete",!0),e.R7$(4),e.Y8G("title","Especifica\xe7\xf5es da "+n.lex.translate("entrega"))("collapsed",!1),e.R7$(2),e.Y8G("size",6)("labelInfo","In\xedcio "+n.lex.translate("Plano de Entregas")),e.R7$(),e.Y8G("size",6)("labelInfo","Fim "+n.lex.translate("Plano de Entregas")+"(Estimativa Inicial)"),e.R7$(2),e.Y8G("size",6)("dao",n.unidadeDao),e.R7$(2),e.Y8G("size",6),e.BMQ("maxlength",250),e.R7$(3),e.Y8G("size",12)("label",n.lex.translate("Tipo de Meta"))("dao",n.entregaDao),e.R7$(3),e.Y8G("size",12),e.R7$(),e.Y8G("ngIf",null==i?null:i.selectedEntity)("ngIfElse",s),e.R7$(3),e.Y8G("title","Caracteriza\xe7\xe3o da "+n.lex.translate("entrega"))("collapsed",!1),e.R7$(2),e.Y8G("size",12)("control",n.form.controls.etiquetas)("addItemHandle",n.addItemHandleEtiquetas.bind(n)),e.R7$(),e.Y8G("size",12)("control",n.form.controls.etiqueta)("items",n.etiquetas),e.R7$(2),e.Y8G("ngIf",null==n.planejamentoId?null:n.planejamentoId.length),e.R7$(),e.Y8G("ngIf",null==n.cadeiaValorId?null:n.cadeiaValorId.length)}},dependencies:[A.bT,f._,O.T,p.I,N.Q,Y.O,M.H,oa.S,k.r,q.K,le.b,_e.O,pe.j,H.F,ee.Y,J.n,te]})}}return o})();var ve=r(2805),Fa=r(4762);const Va=["selectResponsaveis"];function Ya(o,l){1&o&&(e.j41(0,"strong"),e.EFF(1,"Respons\xe1vel"),e.k0s())}function za(o,l){if(1&o&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&o){const t=l.row;e.R7$(),e.SpI(" ",t.responsavel," ")}}function $a(o,l){1&o&&(e.j41(0,"strong"),e.EFF(1,"Criado em"),e.k0s())}function wa(o,l){if(1&o&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&o){const t=l.row,a=e.XpG();e.R7$(),e.JRh(a.util.getDateTimeFormatted(t.date_time))}}function Ba(o,l){1&o&&(e.j41(0,"div",9)(1,"div",17)(2,"strong"),e.EFF(3,"Atributos"),e.k0s()(),e.j41(4,"div",18)(5,"strong"),e.EFF(6,"Valores"),e.nrm(7,"br"),e.EFF(8,"Atuais"),e.k0s()(),e.j41(9,"div",18)(10,"strong"),e.EFF(11,"Valores"),e.nrm(12,"br"),e.EFF(13,"Anteriores"),e.k0s()()())}function Ua(o,l){if(1&o&&(e.j41(0,"tr")(1,"td",21),e.EFF(2),e.k0s(),e.j41(3,"td",22),e.EFF(4),e.k0s(),e.j41(5,"td",22),e.EFF(6),e.k0s()()),2&o){const t=l.$implicit,a=e.XpG(2);e.R7$(2),e.JRh(t[0]),e.R7$(2),e.JRh("EDIT"==a.action||"ADD"==a.action?t[1]:""),e.R7$(2),e.JRh("EDIT"==a.action?t[2]:"ADD"==a.action?"":t[1])}}function Ma(o,l){if(1&o&&(e.j41(0,"separator",19)(1,"table")(2,"tbody"),e.DNE(3,Ua,7,3,"tr",20),e.k0s()()()),2&o){const t=l.row,a=e.XpG();e.Y8G("collapse","collapse")("collapsed",!0),e.R7$(3),e.Y8G("ngForOf",a.preparaDelta(t))}}let qa=(()=>{class o extends d.P{constructor(t,a){super(t,Fa.l,ve.m),this.injector=t,this.responsaveis=[],this.planoId="",this.action="",this.filterWhere=n=>{let i=[],s=n.value;return i.push(["table_name","==","planos_entregas"]),i.push(["row_id","==",this.planoId]),s.responsavel_id?.length&&i.push(["user_id","==","null"==s.responsavel_id?null:s.responsavel_id]),s.data_inicio&&i.push(["date_time",">=",s.data_inicio]),s.data_fim&&i.push(["date_time","<=",s.data_fim]),s.tipo?.length&&i.push(["type","==",s.tipo]),i},this.planoEntregaDao=t.get(P.m),this.title="Logs de Planos de Entregas",this.filter=this.fh.FormBuilder({responsavel_id:{default:""},data_inicio:{default:""},data_fim:{default:""},tipo:{default:""}}),this.orderBy=[["id","desc"]]}ngOnInit(){super.ngOnInit(),this.planoId=this.urlParams?.get("id")||"",this.planoEntregaDao.getById(this.planoId).then(t=>this.planoEntrega=t)}ngAfterViewInit(){super.ngAfterViewInit()}filterClear(t){t.controls.responsavel_id.setValue(""),t.controls.data_inicio.setValue(""),t.controls.data_fim.setValue(""),t.controls.tipo.setValue(""),super.filterClear(t)}preparaDelta(t){this.action=t.type;let a=t.delta instanceof Array?t.delta:Object.entries(t.delta);return a.forEach(n=>{n[1]instanceof Date&&(n[1]=new Date(n[1]).toUTCString()),n.length>2&&n[2]instanceof Date&&(n[2]=new Date(n[2]).toUTCString())}),a}static{this.\u0275fac=function(a){return new(a||o)(e.rXU(e.zZn),e.rXU(ve.m))}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["plano-entrega-list-logs"]],viewQuery:function(a,n){if(1&a&&(e.GBs(f._,5),e.GBs(Va,5)),2&a){let i;e.mGM(i=e.lsd())&&(n.grid=i.first),e.mGM(i=e.lsd())&&(n.selectResponsaveis=i.first)}},features:[e.Vt3],decls:31,vars:30,consts:[["selectResponsaveis",""],["titleResponsavel",""],["columnResponsavel",""],["titleDataCriacao",""],["columnDataCriacao",""],["titleDiferenca",""],["columnDiferenca",""],[3,"dao","hasEdit","title","orderBy","groupBy","join"],[3,"deleted","form","where","submit","clear","collapseChange","collapsed"],[1,"row"],["label","Respons\xe1vel pelo registro","controlName","responsavel_id",3,"control","items"],["datetime","","label","In\xedcio","controlName","data_inicio","labelInfo","In\xedcio dos registros",3,"size","control"],["datetime","","label","Fim","controlName","data_fim","labelInfo","Fim dos registros",3,"size","control"],["label","Tipo","icon","bi bi-arrow-up-right-circle","controlName","tipo","itemTodos","Todos","valueTodos","",3,"size","control","items"],[3,"titleTemplate","template"],["title","Tipo de Opera\xe7\xe3o","field","type"],[3,"rows"],["width","150",1,"col","align-bottom"],["width","250",1,"col"],["title","(ver detalhes)",3,"collapse","collapsed"],[4,"ngFor","ngForOf"],["width","150"],["width","250"]],template:function(a,n){if(1&a&&(e.j41(0,"grid",7)(1,"span")(2,"strong"),e.EFF(3),e.k0s()(),e.nrm(4,"toolbar"),e.j41(5,"filter",8)(6,"div",9),e.nrm(7,"input-select",10,0),e.k0s(),e.j41(9,"div",9),e.nrm(10,"input-datetime",11)(11,"input-datetime",12)(12,"input-select",13),e.k0s()(),e.j41(13,"columns")(14,"column",14),e.DNE(15,Ya,2,0,"ng-template",null,1,e.C5r)(17,za,2,1,"ng-template",null,2,e.C5r),e.k0s(),e.j41(19,"column",14),e.DNE(20,$a,2,0,"ng-template",null,3,e.C5r)(22,wa,2,1,"ng-template",null,4,e.C5r),e.k0s(),e.j41(24,"column",14),e.DNE(25,Ba,14,0,"ng-template",null,5,e.C5r)(27,Ma,4,3,"ng-template",null,6,e.C5r),e.k0s(),e.nrm(29,"column",15),e.k0s(),e.nrm(30,"pagination",16),e.k0s()),2&a){const i=e.sdS(16),s=e.sdS(18),c=e.sdS(21),g=e.sdS(23),h=e.sdS(26),E=e.sdS(28);e.Y8G("dao",n.dao)("hasEdit",!1)("title",n.isModal?"":n.title)("orderBy",n.orderBy)("groupBy",n.groupBy)("join",n.join),e.R7$(3),e.JRh((null==n.planoEntrega?null:n.planoEntrega.numero)+" - "+(null==n.planoEntrega?null:n.planoEntrega.nome)),e.R7$(2),e.Y8G("deleted",n.auth.hasPermissionTo("MOD_AUDIT_DEL"))("form",n.filter)("where",n.filterWhere)("submit",n.filterSubmit.bind(n))("clear",n.filterClear.bind(n))("collapseChange",n.filterCollapseChange.bind(n))("collapsed",!n.selectable&&n.filterCollapsed),e.R7$(2),e.Y8G("control",n.filter.controls.responsavel_id)("items",n.responsaveis),e.R7$(3),e.Y8G("size",4)("control",n.filter.controls.data_inicio),e.R7$(),e.Y8G("size",4)("control",n.filter.controls.data_fim),e.R7$(),e.Y8G("size",4)("control",n.filter.controls.tipo)("items",n.lookup.TIPO_LOG_CHANGE),e.R7$(2),e.Y8G("titleTemplate",i)("template",s),e.R7$(5),e.Y8G("titleTemplate",c)("template",g),e.R7$(5),e.Y8G("titleTemplate",h)("template",E),e.R7$(6),e.Y8G("rows",n.rowsLimit)}},dependencies:[A.Sq,f._,O.T,p.I,G.i,B.H,U.e,k.r,q.K,H.F]})}}return o})();function Xa(o,l){if(1&o&&(e.j41(0,"h3",18),e.EFF(1),e.k0s()),2&o){const t=e.XpG();e.R7$(),e.JRh(t.title)}}function xa(o,l){if(1&o&&e.nrm(0,"toolbar",19),2&o){const t=e.XpG();e.Y8G("buttons",t.buttons)}}function Ha(o,l){if(1&o&&(e.EFF(0),e.nrm(1,"br")(2,"badge",20)(3,"br")(4,"badge",21)),2&o){const t=l.row,a=e.XpG();e.SpI(" ",t.descricao||"(n\xe3o informado)",""),e.R7$(2),e.Y8G("icon",a.entityService.getIcon("Unidade"))("label",t.unidade.sigla||"(n\xe3o informado)"),e.R7$(2),e.Y8G("label",t.destinatario||"(n\xe3o informado)")}}function Qa(o,l){if(1&o&&(e.j41(0,"span"),e.EFF(1),e.nrm(2,"br"),e.EFF(3),e.k0s()),2&o){const t=l.row,a=e.XpG();e.R7$(),e.JRh(a.dao.getDateFormatted(t.data_inicio)),e.R7$(2),e.JRh(a.dao.getDateFormatted(t.data_fim))}}function Ja(o,l){if(1&o&&(e.j41(0,"span",23),e.nrm(1,"i",24),e.EFF(2),e.k0s()),2&o){const t=e.XpG().row;e.R7$(2),e.SpI(" ",t.entrega.nome||t.entrega_pai.descricao," ")}}function Wa(o,l){1&o&&e.DNE(0,Ja,3,1,"span",22),2&o&&e.Y8G("ngIf",l.row.entrega)}function Ka(o,l){if(1&o&&e.nrm(0,"badge",25)(1,"br")(2,"badge",25),2&o){const t=l.row,a=e.XpG();e.Y8G("label",a.planoEntregaService.getValorMeta(t)),e.R7$(2),e.Y8G("label",a.planoEntregaService.getValorRealizado(t))}}function Za(o,l){1&o&&e.nrm(0,"progress-bar",26),2&o&&e.Y8G("value",l.row.progresso_realizado)}let en=(()=>{class o extends d.P{constructor(t){super(t,X.j,L.o),this.injector=t,this.buttons=[],this.idsUnidadesAscendentes=[],this.filterWhere=a=>{let n=a.value,i=[];return this.idsUnidadesAscendentes.length&&i.push(["plano_entrega.unidade_id","in",this.idsUnidadesAscendentes]),n.unidade_id?.length&&i.push(["unidade_id","==",n.unidade_id]),n.descricao?.length&&i.push(["descricao","like","%"+n.descricao.trim().replace(" ","%")+"%"]),n.descricao?.length&&i.push(["descricao_entrega","like","%"+n.descricao_entrega.trim().replace(" ","%")+"%"]),n.destinatario?.length&&i.push(["destinatario","like","%"+n.destinatario.trim().replace(" ","%")+"%"]),i},this.planoEntregaDao=t.get(L.o),this.unidadeDao=t.get(j.s),this.planoEntregaService=t.get(u.C),this.title=this.lex.translate("Entregas"),this.filter=this.fh.FormBuilder({descricao:{default:""},descricao_entrega:{default:""},unidade_id:{default:""},destinatario:{default:""}}),this.join=["entrega:id,nome","entrega_pai:id,descricao","unidade:id,sigla","plano_entrega:id,nome"],this.groupBy=[{field:"plano_entrega.nome",label:"Unidade"}]}ngOnInit(){super.ngOnInit(),this.idsUnidadesAscendentes=this.metadata?.idsUnidadesAscendentes||this.idsUnidadesAscendentes,this.filter?.controls.unidade_id.setValue(this.idsUnidadesAscendentes[0])}dynamicOptions(t){let a=[];return a.push({label:"Informa\xe7\xf5es",icon:"bi bi-info-circle",onClick:n=>this.go.navigate({route:["gestao","planejamento","objetivo",n.id,"consult"]},{modal:!0})}),a}filterClear(t){super.filterClear(t)}static{this.\u0275fac=function(a){return new(a||o)(e.rXU(e.zZn))}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["app-plano-entrega-list-entrega-list"]],viewQuery:function(a,n){if(1&a&&e.GBs(f._,5),2&a){let i;e.mGM(i=e.lsd())&&(n.grid=i.first)}},features:[e.Vt3],decls:26,vars:32,consts:[["columnEntregaCliente",""],["columnDatas",""],["columnIndicador",""],["columnMetaRealizado",""],["columnProgresso",""],["class","my-2",4,"ngIf"],[3,"select","dao","orderBy","groupBy","join","selectable"],[3,"buttons",4,"ngIf"],[3,"deleted","form","where","submit","clear","collapseChange","collapsed"],[1,"row"],["label","Unidade","controlName","unidade_id",3,"size","control","dao"],["label","T\xedtulo da entrega","controlName","descricao","placeholder","T\xedtulo",3,"size","control"],["label","Descri\xe7\xe3o da entrega","controlName","descricao_entrega","placeholder","Descri\xe7\xe3o",3,"size","control"],[3,"title","template"],["title","Entrega",3,"template"],["title","Progresso",3,"template"],["type","options"],[3,"rows"],[1,"my-2"],[3,"buttons"],["color","success",3,"icon","label"],["icon","bi bi-mailbox","color","light",3,"label"],["class","badge bg-light text-dark",4,"ngIf"],[1,"badge","bg-light","text-dark"],[1,"bi","bi-list-check"],["color","light",3,"label"],["color","success",3,"value"]],template:function(a,n){if(1&a){const i=e.RV6();e.DNE(0,Xa,2,1,"h3",5),e.j41(1,"grid",6),e.bIt("select",function(c){return e.eBV(i),e.Njj(n.onSelect(c))}),e.DNE(2,xa,1,1,"toolbar",7),e.j41(3,"filter",8)(4,"div",9),e.nrm(5,"input-search",10)(6,"input-text",11)(7,"input-text",12),e.k0s()(),e.j41(8,"columns")(9,"column",13),e.DNE(10,Ha,5,4,"ng-template",null,0,e.C5r),e.k0s(),e.j41(12,"column",13),e.DNE(13,Qa,4,2,"ng-template",null,1,e.C5r),e.k0s(),e.j41(15,"column",14),e.DNE(16,Wa,1,1,"ng-template",null,2,e.C5r),e.k0s(),e.j41(18,"column",13),e.DNE(19,Ka,3,2,"ng-template",null,3,e.C5r),e.k0s(),e.j41(21,"column",15),e.DNE(22,Za,1,1,"ng-template",null,4,e.C5r),e.k0s(),e.nrm(24,"column",16),e.k0s(),e.nrm(25,"pagination",17),e.k0s()}if(2&a){const i=e.sdS(11),s=e.sdS(14),c=e.sdS(17),g=e.sdS(20),h=e.sdS(23);e.Y8G("ngIf",!n.isModal),e.R7$(),e.Y8G("dao",n.dao)("orderBy",n.orderBy)("groupBy",n.groupBy)("join",n.join)("selectable",n.selectable),e.R7$(),e.Y8G("ngIf",!n.selectable),e.R7$(),e.Y8G("deleted",n.auth.hasPermissionTo("MOD_AUDIT_DEL"))("form",n.filter)("where",n.filterWhere)("submit",n.filterSubmit.bind(n))("clear",n.filterClear.bind(n))("collapseChange",n.filterCollapseChange.bind(n))("collapsed",!n.selectable&&n.filterCollapsed),e.R7$(2),e.Y8G("size",4)("control",n.filter.controls.unidade_id)("dao",n.unidadeDao),e.R7$(),e.Y8G("size",4)("control",n.filter.controls.descricao),e.BMQ("maxlength",250),e.R7$(),e.Y8G("size",4)("control",n.filter.controls.descricao_entrega),e.BMQ("maxlength",250),e.R7$(2),e.Y8G("title","Entrega\nDemandante\nDestinat\xe1rio")("template",i),e.R7$(3),e.Y8G("title","Data In\xedcio\nData Fim")("template",s),e.R7$(3),e.Y8G("template",c),e.R7$(3),e.Y8G("title","Meta\nRealizado")("template",g),e.R7$(3),e.Y8G("template",h),e.R7$(4),e.Y8G("rows",n.rowsLimit)}},dependencies:[A.bT,f._,O.T,p.I,G.i,B.H,U.e,Y.O,M.H,y.n,Q.a]})}}return o})();var tn=r(3764),an=r(4423);let Te=(()=>{class o extends an.F{constructor(t){super("PlanoEntregaEntregaProgresso",t),this.injector=t,this.inputSearchConfig.searchFields=["data_progresso"]}static{this.\u0275fac=function(a){return new(a||o)(e.KVO(e.zZn))}}static{this.\u0275prov=e.jDH({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();class Z extends S.C{constructor(l){super(),this.data_inicio=new Date,this.data_fim=null,this.data_progresso=null,this.homologado=!1,this.meta={},this.realizado={},this.progresso_esperado=100,this.progresso_realizado=0,this.plano_entrega_entrega_id="",this.usuario_id="",this.initialization(l)}}function nn(o,l){1&o&&e.nrm(0,"toolbar")}function on(o,l){if(1&o&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&o){const t=e.XpG().row,a=e.XpG();e.R7$(),e.SpI(" ",a.dao.getDateFormatted(t.data_progresso),"")}}function ln(o,l){1&o&&e.DNE(0,on,2,1,"span",5),2&o&&e.Y8G("ngIf",l.row.data_progresso)}function sn(o,l){if(1&o&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&o){const t=e.XpG().row,a=e.XpG();e.R7$(),e.SpI(" ",a.dao.getDateFormatted(t.data_inicio),"")}}function rn(o,l){if(1&o&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&o){const t=e.XpG().row,a=e.XpG();e.R7$(),e.SpI(" ",a.dao.getDateFormatted(t.data_fim),"")}}function dn(o,l){if(1&o&&(e.DNE(0,sn,2,1,"span",5),e.nrm(1,"br"),e.DNE(2,rn,2,1,"span",5)),2&o){const t=l.row;e.Y8G("ngIf",t.data_inicio),e.R7$(2),e.Y8G("ngIf",t.data_fim)}}function cn(o,l){if(1&o&&e.nrm(0,"badge",15)(1,"br")(2,"badge",16),2&o){const t=l.row,a=e.XpG();e.Y8G("textValue",a.planoEntregaService.getValorMeta(t.plano_entrega_entrega)),e.R7$(2),e.Y8G("textValue",a.planoEntregaService.getValorRealizado(t.plano_entrega_entrega))}}function un(o,l){if(1&o&&e.nrm(0,"progress-bar",17),2&o){const t=l.row;e.Y8G("value",t.progresso_realizado)("goal",t.progresso_esperado)}}let mn=(()=>{class o extends d.P{constructor(t){super(t,Z,Te),this.injector=t,this.planoEntregaEntregaId="",this.filterWhere=a=>{let n=[],i=a.value;return i.data_inicial_progresso&&n.push(["data_progresso",">=",i.data_inicial_progresso]),i.data_final_progresso&&n.push(["data_progresso","<=",i.data_final_progresso]),n.push(["plano_entrega_entrega_id","==",this.planoEntregaEntregaId]),n},this.planoEntregaService=t.get(u.C),this.title=this.lex.translate("Hist\xf3rico de execu\xe7\xe3o"),this.orderBy=[["data_progresso","desc"]],this.join=["plano_entrega_entrega.entrega"],this.filter=this.fh.FormBuilder({data_inicial_progresso:{default:null},data_final_progresso:{default:null}}),this.addOption(Object.assign({onClick:this.delete.bind(this)},this.OPTION_EXCLUIR),"MOD_PENT_ENTR_PRO_EXCL")}onGridLoad(t){t?.forEach(a=>a.entrega=a.plano_entrega_entrega?.entrega)}ngOnInit(){super.ngOnInit(),this.planoEntregaEntregaId=this.urlParams.get("entrega_id")||""}static{this.\u0275fac=function(a){return new(a||o)(e.rXU(e.zZn))}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["app-plano-entrega-list-progresso"]],viewQuery:function(a,n){if(1&a&&e.GBs(f._,5),2&a){let i;e.mGM(i=e.lsd())&&(n.grid=i.first)}},features:[e.Vt3],decls:21,vars:38,consts:[["columnProgressoData",""],["columnDatas",""],["columnMetaRealizado",""],["columnProgresso",""],[3,"select","dao","add","title","orderBy","groupBy","join","selectable","hasAdd","hasEdit","loadList"],[4,"ngIf"],[3,"deleted","form","where","submit","collapseChange","collapsed"],[1,"row"],["noIcon","","label","Data inical do progresso","controlName","data_inicial_progresso","labelInfo","Data que foi registrado o progresso",3,"size","control"],["noIcon","","label","Data final do progresso","controlName","data_final_progresso","labelInfo","Data que foi registrado o progresso",3,"size","control"],[3,"title","template","editTemplate"],[3,"title","width","template"],[3,"title","width","template","editTemplate","columnEditTemplate"],["type","options",3,"onEdit","options"],[3,"rows"],["icon","bi bi-graph-up-arrow","color","light","hint","Planejada",3,"textValue"],["icon","bi bi-check-lg","color","light","hint","Realizada",3,"textValue"],["color","success",3,"value","goal"]],template:function(a,n){if(1&a){const i=e.RV6();e.j41(0,"grid",4),e.bIt("select",function(c){return e.eBV(i),e.Njj(n.onSelect(c))}),e.DNE(1,nn,1,0,"toolbar",5),e.j41(2,"filter",6)(3,"div",7),e.nrm(4,"input-datetime",8)(5,"input-datetime",9),e.k0s()(),e.j41(6,"columns")(7,"column",10),e.DNE(8,ln,1,1,"ng-template",null,0,e.C5r),e.k0s(),e.j41(10,"column",10),e.DNE(11,dn,3,2,"ng-template",null,1,e.C5r),e.k0s(),e.j41(13,"column",11),e.DNE(14,cn,3,2,"ng-template",null,2,e.C5r),e.k0s(),e.j41(16,"column",12),e.DNE(17,un,1,2,"ng-template",null,3,e.C5r),e.k0s(),e.nrm(19,"column",13),e.k0s(),e.nrm(20,"pagination",14),e.k0s()}if(2&a){const i=e.sdS(9),s=e.sdS(12),c=e.sdS(15),g=e.sdS(18);e.Y8G("dao",n.dao)("add",n.add)("title",n.isModal?"":n.title)("orderBy",n.orderBy)("groupBy",n.groupBy)("join",n.join)("selectable",n.selectable)("hasAdd",n.auth.hasPermissionTo("MOD_PENT_ENTR_PRO_INCL"))("hasEdit",n.auth.hasPermissionTo("MOD_PENT_ENTR_PRO_EDT"))("loadList",n.onGridLoad.bind(n)),e.R7$(),e.Y8G("ngIf",!n.selectable),e.R7$(),e.Y8G("deleted",n.auth.hasPermissionTo("MOD_AUDIT_DEL"))("form",n.filter)("where",n.filterWhere)("submit",n.filterSubmit.bind(n))("collapseChange",n.filterCollapseChange.bind(n))("collapsed",!n.selectable&&n.filterCollapsed),e.R7$(2),e.Y8G("size",3)("control",n.filter.controls.data_inicial_progresso),e.R7$(),e.Y8G("size",3)("control",n.filter.controls.data_final_progresso),e.R7$(2),e.Y8G("title","Data progresso")("template",i)("editTemplate",i),e.R7$(3),e.Y8G("title","Data In\xedcio\nData Fim")("template",s)("editTemplate",s),e.R7$(3),e.Y8G("title","Meta")("width",100)("template",c),e.R7$(3),e.Y8G("title","Progresso")("width",200)("template",g)("editTemplate",g)("columnEditTemplate",n.selectable?void 0:g),e.R7$(3),e.Y8G("onEdit",n.edit)("options",n.options),e.R7$(),e.Y8G("rows",n.rowsLimit)}},dependencies:[A.bT,f._,O.T,p.I,G.i,B.H,U.e,k.r,y.n,Q.a]})}}return o})(),Oe=(()=>{class o extends W.n{constructor(t){super(t,Z,Te),this.injector=t,this.validate=(a,n)=>{let i=null;return["progresso_realizado","realizado"].indexOf(n)>=0&&!(a.value>=0||a.value?.length>0)||["progresso_esperado","meta"].indexOf(n)>=0&&!(a.value>0||a.value?.length>0)?i="Obrigat\xf3rio":(["data_inicio"].indexOf(n)>=0&&!this.dao?.validDateTime(a.value)||["data_fim"].indexOf(n)>=0&&!this.dao?.validDateTime(a.value))&&(i="Inv\xe1lido"),i},this.titleEdit=a=>"Editando "+this.lex.translate("Progresso da entrega")+": "+(a?.entrega?.descricao||""),this.planoEntregaService=t.get(u.C),this.planoEntregaEntregaDao=t.get(L.o),this.join=["plano_entrega_entrega.entrega"],this.form=this.fh.FormBuilder({data_progresso:{default:new Date},data_inicio:{default:new Date},data_fim:{default:new Date},meta:{default:100},realizado:{default:null},progresso_esperado:{default:100},progresso_realizado:{default:null},usuario_id:{default:null},plano_entrega_entrega_id:{default:null}},this.cdRef,this.validate)}ngOnInit(){super.ngOnInit(),this.planoEntregaEntregaId=this.urlParams.get("entrega_id")}loadData(t,a){var n=this;return(0,m.A)(function*(){let i=Object.assign({},a.value),{meta:s,realizado:c,...g}=t;a.patchValue(n.util.fillForm(i,g)),a.controls.meta.setValue(n.planoEntregaService.getValor(t.meta)),a.controls.realizado.setValue(n.planoEntregaService.getValor(t.realizado))})()}initializeData(t){var a=this;return(0,m.A)(function*(){a.entity=new Z,a.planoEntregaEntrega=a.planoEntregaEntregaId?yield a.planoEntregaEntregaDao.getById(a.planoEntregaEntregaId,["entrega"]):void 0,a.entity.usuario_id=a.auth.usuario.id,a.entity.plano_entrega_entrega_id=a.planoEntregaEntrega?.id,a.entity.plano_entrega_entrega=a.planoEntregaEntrega,a.entity.meta=a.planoEntregaEntrega?.meta,a.entity.realizado=a.planoEntregaEntrega?.realizado,a.entity.progresso_esperado=a.planoEntregaEntrega?.progresso_esperado,a.entity.progresso_realizado=a.planoEntregaEntrega?.progresso_realizado,a.entity.data_inicio=a.planoEntregaEntrega?.data_inicio,a.entity.data_fim=a.planoEntregaEntrega?.data_fim,yield a.loadData(a.entity,t)})()}saveData(t){return new Promise((a,n)=>{let i=this.util.fill(new Z,this.entity),{meta:s,realizado:c,...g}=this.form.value;i=this.util.fillForm(i,g),i.meta=this.planoEntregaService.getEntregaValor(this.entity.plano_entrega_entrega?.entrega,s),i.realizado=this.planoEntregaService.getEntregaValor(this.entity.plano_entrega_entrega?.entrega,c),a(i)})}static{this.\u0275fac=function(a){return new(a||o)(e.rXU(e.zZn))}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["plano-entrega-form-progresso"]],viewQuery:function(a,n){if(1&a&&e.GBs(N.Q,5),2&a){let i;e.mGM(i=e.lsd())&&(n.editableForm=i.first)}},features:[e.Vt3],decls:11,vars:16,consts:[["initialFocus","data_progresso",3,"submit","cancel","form","disabled","title"],[1,"row"],["date","","label","Data do progresso","controlName","data_progresso","required","",3,"size"],["date","","label","In\xedcio","controlName","data_inicio","required","",3,"size","labelInfo"],["date","","label","Fim","controlName","data_fim","required","",3,"size","labelInfo"],["icon","bi bi-graph-up-arrow","label","Meta",3,"entrega","size","control"],["icon","bi bi-check-lg","label","Valor Inicial","labelInfo","Valor da meta verificado no in\xedcio do plano de entrega",3,"entrega","size","control"],["label","Progresso Esperado","controlName","progresso_esperado","sufix","%",3,"size"],["label","Progresso Realizado","controlName","progresso_realizado","sufix","%",3,"size"]],template:function(a,n){1&a&&(e.j41(0,"editable-form",0),e.bIt("submit",function(){return n.onSaveData()})("cancel",function(){return n.onCancel()}),e.j41(1,"div",1),e.nrm(2,"input-datetime",2)(3,"input-datetime",3)(4,"input-datetime",4),e.k0s(),e.j41(5,"div",1),e.nrm(6,"plano-entrega-valor-meta-input",5)(7,"plano-entrega-valor-meta-input",6),e.k0s(),e.j41(8,"div",1),e.nrm(9,"input-number",7)(10,"input-number",8),e.k0s()()),2&a&&(e.Y8G("form",n.form)("disabled",n.formDisabled)("title",n.isModal?"":n.title),e.R7$(2),e.Y8G("size",4),e.R7$(),e.Y8G("size",4)("labelInfo","In\xedcio "+n.lex.translate("Plano de Entregas")),e.R7$(),e.Y8G("size",4)("labelInfo","Fim "+n.lex.translate("Plano de Entregas")+"(Estimativa Inicial)"),e.R7$(2),e.Y8G("entrega",null==n.entity||null==n.entity.plano_entrega_entrega?null:n.entity.plano_entrega_entrega.entrega)("size",6)("control",n.form.controls.meta),e.R7$(),e.Y8G("entrega",null==n.entity||null==n.entity.plano_entrega_entrega?null:n.entity.plano_entrega_entrega.entrega)("size",6)("control",n.form.controls.realizado),e.R7$(2),e.Y8G("size",6),e.R7$(),e.Y8G("size",6))},dependencies:[N.Q,k.r,J.n,te]})}}return o})();var gn=r(6867),_n=r(6190),pn=r(4450),hn=r(336);const fn=["listaAtividades"];function En(o,l){1&o&&(e.j41(0,"b"),e.EFF(1,"Descri\xe7\xe3o"),e.k0s())}function bn(o,l){if(1&o&&(e.j41(0,"span",8),e.EFF(1),e.k0s(),e.nrm(2,"reaction",9)),2&o){const t=l.row;e.R7$(),e.JRh(t.descricao),e.R7$(),e.Y8G("entity",t)}}function vn(o,l){if(1&o&&(e.EFF(0," Un./"),e.j41(1,"order",10),e.EFF(2,"Respons\xe1vel"),e.k0s(),e.nrm(3,"br"),e.j41(4,"order",11),e.EFF(5,"Demandante"),e.k0s()),2&o){const t=l.header;e.R7$(),e.Y8G("header",t),e.R7$(3),e.Y8G("header",t)}}function Tn(o,l){if(1&o&&(e.j41(0,"div",12),e.nrm(1,"badge",13)(2,"badge",14),e.k0s(),e.nrm(3,"badge",15)),2&o){const t=l.row,a=e.XpG();e.R7$(),e.Y8G("label",t.unidade.sigla),e.R7$(),e.Y8G("icon","bi "+(null!=t.usuario&&null!=t.usuario.nome&&t.usuario.nome.length?"bi-person-check":"bi-person-x"))("label",a.util.apelidoOuNome(t.usuario,!0)||"(N\xe3o atribu\xeddo)")("hint","Respons\xe1vel: "+((null==t.usuario?null:t.usuario.nome)||"N\xe3o atribuido a nenhum usu\xe1rio")),e.R7$(),e.Y8G("label",a.util.apelidoOuNome(t.demandante,!0)||"Desconhecido")("hint","Demandante: "+((null==t.demandante?null:t.demandante.nome)||"Desconhecido"))}}function On(o,l){1&o&&e.nrm(0,"progress-bar",16),2&o&&e.Y8G("value",l.row.progresso)}let An=(()=>{class o extends x.g{set entregaId(t){this._entregaId!=t&&(this._entregaId=t)}get entregaId(){return this._entregaId}constructor(t){super(t),this.injector=t,this.items=[],this.loader=!1,this.AtividadeDao=t.get(hn.R),this.join=["unidade","usuario","demandante","reacoes.usuario:id,nome,apelido"]}ngOnInit(){super.ngOnInit(),this.loadData()}loadData(){this.loader=!0,this.AtividadeDao.query({where:[["plano_trabalho_entrega_id","==",this._entregaId],["unidades_subordinadas","==",!0]],join:this.join}).asPromise().then(t=>{this.items=t}).finally(()=>{this.loader=!1})}static{this.\u0275fac=function(a){return new(a||o)(e.rXU(e.zZn))}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["plano-trabalho-entrega-atividades"]],viewQuery:function(a,n){if(1&a&&e.GBs(fn,5),2&a){let i;e.mGM(i=e.lsd())&&(n.listaAtividades=i.first)}},inputs:{entregaId:"entregaId"},features:[e.Vt3],decls:17,vars:10,consts:[["titleIdAtividadeDescricao",""],["columnAtividadeDescricao",""],["titleUnResponsavelDemandante",""],["columnPessoas",""],["columnProgressoEtiquetasChecklist",""],[3,"items","loading"],[3,"titleTemplate","template"],[3,"title","width","template"],[1,"micro-text","fw-ligh","atividade-descricao"],["origem","ATIVIDADE",3,"entity"],["by","usuario.nome",3,"header"],["by","demandante.nome",3,"header"],[1,"text-nowrap"],["icon","bi bi-briefcase","color","light",3,"label"],["color","light",3,"icon","label","hint"],["icon","bi bi-cursor","color","light",3,"label","hint"],["color","success",3,"value"]],template:function(a,n){if(1&a&&(e.j41(0,"h5"),e.EFF(1),e.k0s(),e.j41(2,"grid",5)(3,"columns")(4,"column",6),e.DNE(5,En,2,0,"ng-template",null,0,e.C5r)(7,bn,3,2,"ng-template",null,1,e.C5r),e.k0s(),e.j41(9,"column",6),e.DNE(10,vn,6,2,"ng-template",null,2,e.C5r)(12,Tn,4,6,"ng-template",null,3,e.C5r),e.k0s(),e.j41(14,"column",7),e.DNE(15,On,1,1,"ng-template",null,4,e.C5r),e.k0s()()()),2&a){const i=e.sdS(6),s=e.sdS(8),c=e.sdS(11),g=e.sdS(13),h=e.sdS(16);e.R7$(),e.SpI("",n.lex.translate("Atividades"),":"),e.R7$(),e.Y8G("items",n.items)("loading",n.loader),e.R7$(2),e.Y8G("titleTemplate",i)("template",s),e.R7$(5),e.Y8G("titleTemplate",c)("template",g),e.R7$(5),e.Y8G("title","Progresso")("width",200)("template",h)}},dependencies:[f._,O.T,p.I,ee.Y,y.n,Q.a,se.T]})}}return o})();const Cn=["accordionUser"];function In(o,l){}function Dn(o,l){1&o&&e.nrm(0,"plano-trabalho-entrega-atividades",29),2&o&&e.Y8G("entregaId",l.row.id)}function Pn(o,l){1&o&&(e.j41(0,"div",30)(1,"span")(2,"strong"),e.EFF(3,"Plano de trabalho"),e.k0s()()())}function Rn(o,l){if(1&o&&(e.j41(0,"span",31),e.EFF(1),e.nrm(2,"br"),e.EFF(3),e.k0s()),2&o){const t=e.XpG().$implicit,a=e.XpG(2);e.R7$(),e.SpI("",a.PlanoTrabalhoDao.getDateFormatted(t.data_inicio)," "),e.R7$(2),e.JRh(" at\xe9 "+a.PlanoTrabalhoDao.getDateFormatted(t.data_fim))}}function Gn(o,l){1&o&&(e.j41(0,"div",30)(1,"span")(2,"strong"),e.EFF(3,"Origem"),e.k0s()()())}function jn(o,l){if(1&o&&e.nrm(0,"badge",37),2&o){const t=e.XpG().row,a=e.XpG(3);e.Y8G("label",(null==t.plano_entrega_entrega||null==t.plano_entrega_entrega.plano_entrega||null==t.plano_entrega_entrega.plano_entrega.unidade?null:t.plano_entrega_entrega.plano_entrega.unidade.sigla)||"Desconhecido")("icon",a.entityService.getIcon("Unidade"))}}function yn(o,l){if(1&o&&e.nrm(0,"badge",38),2&o){const t=e.XpG().row;e.Y8G("label",t.orgao)}}function Nn(o,l){if(1&o&&(e.j41(0,"div",32)(1,"div",33),e.nrm(2,"badge",34),e.DNE(3,jn,1,2,"badge",35)(4,yn,1,1,"badge",36),e.k0s()()),2&o){const t=l.row,a=e.XpG(3);e.R7$(2),e.Y8G("label",a.planoTrabalhoService.tipoEntrega(t,a.entity).titulo)("color",a.planoTrabalhoService.tipoEntrega(t,a.entity).cor),e.R7$(),e.Y8G("ngIf",null==t.plano_entrega_entrega_id?null:t.plano_entrega_entrega_id.length),e.R7$(),e.Y8G("ngIf",null==t.orgao?null:t.orgao.length)}}function Ln(o,l){if(1&o&&(e.j41(0,"div",30)(1,"small"),e.nrm(2,"badge",39),e.k0s()()),2&o){const t=e.XpG().$implicit,a=e.XpG(2);e.R7$(2),e.Y8G("color",100==a.totalForcaTrabalho(t.entregas)?"success":"warning")("label",a.totalForcaTrabalho(t.entregas)+"%")}}function Sn(o,l){if(1&o&&(e.j41(0,"small"),e.EFF(1),e.k0s()),2&o){const t=l.row;e.R7$(),e.JRh(t.forca_trabalho+"%")}}function kn(o,l){1&o&&(e.j41(0,"div",30)(1,"span")(2,"strong"),e.EFF(3,"Detalhamento/Descri\xe7\xe3o dos Trabalhos"),e.k0s()()())}function Fn(o,l){if(1&o&&(e.j41(0,"small",30),e.EFF(1),e.k0s()),2&o){const t=l.row;e.R7$(),e.JRh(t.descricao)}}function Vn(o,l){if(1&o&&e.nrm(0,"badge",40),2&o){const t=e.XpG().$implicit,a=e.XpG(2);e.Y8G("color",a.lookup.getColor(a.lookup.PLANO_TRABALHO_STATUS,t.status))("icon",a.lookup.getIcon(a.lookup.PLANO_TRABALHO_STATUS,t.status))("label",a.lookup.getValue(a.lookup.PLANO_TRABALHO_STATUS,t.status))}}function Yn(o,l){if(1&o&&(e.j41(0,"div",20)(1,"div",21)(2,"grid",22)(3,"columns")(4,"column",23),e.DNE(5,Dn,1,1,"ng-template",null,7,e.C5r),e.k0s(),e.j41(7,"column",24),e.DNE(8,Pn,4,0,"ng-template",null,8,e.C5r)(10,Rn,4,2,"ng-template",null,9,e.C5r),e.k0s(),e.j41(12,"column",25),e.DNE(13,Gn,4,0,"ng-template",null,10,e.C5r)(15,Nn,5,4,"ng-template",null,11,e.C5r),e.k0s(),e.j41(17,"column",26),e.DNE(18,Ln,3,2,"ng-template",null,5,e.C5r)(20,Sn,2,1,"ng-template",null,6,e.C5r),e.k0s(),e.j41(22,"column",27),e.DNE(23,kn,4,0,"ng-template",null,12,e.C5r)(25,Fn,2,1,"ng-template",null,13,e.C5r),e.k0s(),e.j41(27,"column",28),e.DNE(28,Vn,1,3,"ng-template",null,14,e.C5r),e.k0s()()()()()),2&o){const t=l.$implicit,a=e.sdS(6),n=e.sdS(9),i=e.sdS(11),s=e.sdS(14),c=e.sdS(16),g=e.sdS(19),h=e.sdS(21),E=e.sdS(24),z=e.sdS(26),F=e.sdS(29);e.R7$(2),e.Y8G("items",t.entregas),e.R7$(2),e.Aen("vertical-align:middle"),e.Y8G("expandTemplate",a),e.R7$(3),e.Y8G("template",i)("titleTemplate",n),e.R7$(5),e.Y8G("titleTemplate",s)("template",c)("verticalAlign","middle")("width",300)("align","center"),e.R7$(5),e.Y8G("titleTemplate",g)("title","% CHD")("template",h)("width",125)("align","center")("titleHint","% Carga Hor\xe1ria Dispon\xedvel"),e.R7$(5),e.Y8G("maxWidth",250)("titleTemplate",E)("template",z)("verticalAlign","middle")("align","center"),e.R7$(5),e.Y8G("template",F)}}function zn(o,l){if(1&o&&(e.j41(0,"h5"),e.EFF(1,"Entregas do plano:"),e.k0s(),e.nrm(2,"hr"),e.DNE(3,Yn,30,23,"div",19)),2&o){const t=l.row;e.R7$(3),e.Y8G("ngForOf",t.planos_trabalho)}}function $n(o,l){1&o&&(e.j41(0,"b"),e.EFF(1,"Participante"),e.k0s())}function wn(o,l){if(1&o&&(e.j41(0,"b"),e.EFF(1),e.k0s(),e.nrm(2,"br"),e.j41(3,"small"),e.EFF(4),e.k0s()),2&o){const t=l.row;e.R7$(),e.JRh(t.nome),e.R7$(3),e.JRh(t.apelido||"")}}function Bn(o,l){}function Un(o,l){if(1&o&&(e.j41(0,"small"),e.nrm(1,"badge",39),e.k0s()),2&o){const t=l.row,a=e.XpG();e.R7$(),e.Y8G("color",100==a.totalForcaTrabalho(a.planoAtivo(t.planos_trabalho).entregas)?"success":"warning")("label",a.totalForcaTrabalho(a.planoAtivo(t.planos_trabalho).entregas)+"%")}}let Mn=(()=>{class o extends x.g{set entregaId(t){this._entregaId!=t&&(this._entregaId=t)}get entregaId(){return this._entregaId}constructor(t){super(t),this.injector=t,this.items=[],this.loader=!1,this.PlanoTrabalhoDao=t.get(gn.x),this.PlanoTrabalhoEntregaDao=t.get(_n.R),this.planoTrabalhoService=t.get(pn.V),this.join=["plano_trabalho.usuario","plano_entrega_entrega.plano_entrega.unidade"],this.groupBy=[{field:"plano_trabalho.usuario",label:"Usu\xe1rio"}]}ngOnInit(){super.ngOnInit(),this.loadData()}loadData(){this.loader=!0,this.cdRef.detectChanges();try{this.PlanoTrabalhoEntregaDao.query({where:[["plano_entrega_entrega_id","==",this._entregaId],["planoTrabalho.status","in",["ATIVO","CONCLUIDO","AVALIADO"]]],join:this.join}).asPromise().then(t=>{t.forEach(a=>{const n=a.plano_trabalho.usuario;if(n){const i=n.id;let s=this.items.find(E=>E.id===i);s||(s={...n,planos_trabalho:[],initialization(E){}},this.items.push(s));const c=a.plano_trabalho.id;let g=s.planos_trabalho.find(E=>E.id===c);g||(g={...a.plano_trabalho,entregas:[],initialization(E){}},s.planos_trabalho.push(g));const h={...a,initialization(E){}};g.entregas.push(h)}})}).finally(()=>{this.loader=!1,this.cdRef.detectChanges()})}catch{console.log("Erro")}}totalForcaTrabalho(t=[]){const a=t.map(n=>1*n.forca_trabalho).reduce((n,i)=>n+i,0);return Math.round(100*a)/100}planoAtivo(t){return t.find(n=>"ATIVO"===n.status)||{}}static{this.\u0275fac=function(a){return new(a||o)(e.rXU(e.zZn))}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["plano-entrega-entregas-plano-trabalho"]],viewQuery:function(a,n){if(1&a&&e.GBs(Cn,5),2&a){let i;e.mGM(i=e.lsd())&&(n.accordionUser=i.first)}},inputs:{entregaId:"entregaId"},features:[e.Vt3],decls:18,vars:11,consts:[["accordionUser",""],["usuarioSectionTitle",""],["columnExpandeEntregas",""],["titleParticipante",""],["columnParticipante",""],["titleForcaTrabalho",""],["columnForcaTrabalho",""],["columnExpandedAtividades",""],["titlePlano",""],["columnPlano",""],["titleOrigem",""],["columnOrigem",""],["titleDescricao",""],["columnDescricao",""],["columnStatus",""],[3,"items","loading"],["type","expand",3,"expandTemplate","template","width"],[3,"titleTemplate","template"],[3,"titleTemplate","template","title","titleHint"],["class","card mb-2",4,"ngFor","ngForOf"],[1,"card","mb-2"],[1,"card-body"],[3,"items"],["type","expand",3,"expandTemplate"],[3,"template","titleTemplate"],[3,"titleTemplate","template","verticalAlign","width","align"],[3,"titleTemplate","title","template","width","align","titleHint"],[3,"maxWidth","titleTemplate","template","verticalAlign","align"],["title","Status",3,"template"],[3,"entregaId"],[1,"text-center"],[1,"d-block","text-center"],[1,"w-100","d-flex","justify-content-center"],[1,"one-per-line"],[3,"label","color"],["color","primary",3,"label","icon",4,"ngIf"],["icon","bi bi-box-arrow-down-left","color","warning",3,"label",4,"ngIf"],["color","primary",3,"label","icon"],["icon","bi bi-box-arrow-down-left","color","warning",3,"label"],["icon","bi bi-calculator",3,"color","label"],[3,"color","icon","label"]],template:function(a,n){if(1&a&&(e.j41(0,"grid",15,0)(2,"columns")(3,"column",16),e.DNE(4,In,0,0,"ng-template",null,1,e.C5r)(6,zn,4,1,"ng-template",null,2,e.C5r),e.k0s(),e.j41(8,"column",17),e.DNE(9,$n,2,0,"ng-template",null,3,e.C5r)(11,wn,5,2,"ng-template",null,4,e.C5r),e.k0s(),e.j41(13,"column",18),e.DNE(14,Bn,0,0,"ng-template",null,5,e.C5r)(16,Un,2,2,"ng-template",null,6,e.C5r),e.k0s()()()),2&a){const i=e.sdS(5),s=e.sdS(7),c=e.sdS(10),g=e.sdS(12),h=e.sdS(15),E=e.sdS(17);e.Y8G("items",n.items)("loading",n.loader),e.R7$(3),e.Y8G("expandTemplate",s)("template",i)("width",40),e.R7$(5),e.Y8G("titleTemplate",c)("template",g),e.R7$(5),e.Y8G("titleTemplate",h)("template",E)("title","% CHD")("titleHint","% Carga Hor\xe1ria Dispon\xedvel")}},dependencies:[A.Sq,A.bT,f._,O.T,p.I,y.n,An]})}}return o})();var Ae=r(4401),qn=r(7438);function Xn(o,l){if(1&o&&e.nrm(0,"badge",8),2&o){const t=e.XpG().$implicit,a=e.XpG(2);e.Y8G("icon",a.entityService.getIcon("Unidade"))("label",null==t.data||null==t.data.unidade?null:t.data.unidade.sigla)}}function xn(o,l){if(1&o){const t=e.RV6();e.j41(0,"div",4),e.EFF(1),e.k0s(),e.DNE(2,Xn,1,2,"badge",5),e.nrm(3,"br"),e.j41(4,"button",6),e.bIt("click",function(){const n=e.eBV(t).$implicit,i=e.XpG(2);return e.Njj(i.showDetalhes(n.data))}),e.nrm(5,"i",7),e.k0s()}if(2&o){const t=l.$implicit;e.R7$(),e.JRh(t.label),e.R7$(),e.Y8G("ngIf",null==t.data?null:t.data.unidade)}}function Hn(o,l){if(1&o&&(e.j41(0,"p-organizationChart",2),e.DNE(1,xn,6,2,"ng-template",3),e.k0s()),2&o){const t=e.XpG();e.Y8G("value",t.entregasVinculadas)}}function Qn(o,l){1&o&&(e.j41(0,"div",9)(1,"div",10),e.nrm(2,"span",11),e.k0s()())}let Jn=(()=>{class o extends x.g{set entregaId(t){this._entregaId!=t&&(this._entregaId=t)}get entregaId(){return this._entregaId}constructor(t){super(t),this.injector=t,this.loader=!1,this.entregasVinculadas=[],this.planoEntregaEntregaDao=t.get(L.o),this.join=["unidade"]}ngOnInit(){super.ngOnInit(),this.loadData()}loadData(){var t=this;return(0,m.A)(function*(){t.loader=!0;try{t.entregasVinculadas=yield t.planoEntregaEntregaDao.hierarquia(t._entregaId),t.cdRef.detectChanges(),t.loader=!1}catch{console.log("Erro")}})()}showDetalhes(t){var a=this;return(0,m.A)(function*(){a.go.navigate({route:["gestao","plano-entrega","entrega",t.id,"detalhes"]},{metadata:{entrega:t}})})()}static{this.\u0275fac=function(a){return new(a||o)(e.rXU(e.zZn))}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["plano-entrega-entregas-vinculadas"]],inputs:{entregaId:"entregaId"},features:[e.Vt3],decls:2,vars:2,consts:[[3,"value",4,"ngIf"],["class","d-flex justify-content-center my-2",4,"ngIf"],[3,"value"],["pTemplate","default"],[1,"p-2"],["color","light",3,"icon","label",4,"ngIf"],["title","Detalhes da entrega",1,"btn","btn-sm",3,"click"],[1,"bi","bi-eye"],["color","light",3,"icon","label"],[1,"d-flex","justify-content-center","my-2"],["role","status",1,"spinner-border"],[1,"visually-hidden"]],template:function(a,n){1&a&&e.DNE(0,Hn,2,1,"p-organizationChart",0)(1,Qn,3,0,"div",1),2&a&&(e.Y8G("ngIf",n.entregasVinculadas.length),e.R7$(),e.Y8G("ngIf",n.loader))},dependencies:[A.bT,y.n,Ae.a3,qn.Ei]})}}return o})();function Wn(o,l){1&o&&e.nrm(0,"badge",19),2&o&&e.Y8G("lookup",l.$implicit)}function Kn(o,l){if(1&o&&e.nrm(0,"badge",20),2&o){const t=e.XpG(2);e.Y8G("icon",t.entityService.getIcon("Unidade"))("label",null==t.entrega||null==t.entrega.unidade?null:t.entrega.unidade.sigla)}}function Zn(o,l){if(1&o&&e.nrm(0,"badge",21),2&o){const t=e.XpG(2);e.Y8G("label",null==t.entrega?null:t.entrega.destinatario)}}function eo(o,l){if(1&o&&(e.j41(0,"div",22)(1,"div")(2,"b"),e.EFF(3,"Planejada"),e.k0s(),e.nrm(4,"br")(5,"badge",23),e.k0s(),e.nrm(6,"div",24),e.j41(7,"div")(8,"b"),e.EFF(9,"Executada"),e.k0s(),e.nrm(10,"br")(11,"badge",25),e.k0s()()),2&o){const t=e.XpG(2);e.R7$(5),e.Y8G("textValue",t.planoEntregaService.getValorMeta(t.entrega)),e.R7$(6),e.Y8G("textValue",t.planoEntregaService.getValorRealizado(t.entrega))}}function to(o,l){if(1&o){const t=e.RV6();e.j41(0,"div",33)(1,"small"),e.EFF(2),e.k0s(),e.j41(3,"button",34),e.bIt("click",function(){e.eBV(t);const n=e.XpG().$implicit,i=e.XpG(3);return e.Njj(i.showPlanejamento(n.objetivo.id))}),e.nrm(4,"i",35),e.k0s()()}if(2&o){const t=e.XpG().$implicit;e.R7$(2),e.JRh(t.objetivo.nome)}}function ao(o,l){if(1&o&&(e.j41(0,"li",31),e.DNE(1,to,5,1,"div",32),e.k0s()),2&o){const t=l.$implicit;e.R7$(),e.Y8G("ngIf",t.objetivo)}}function no(o,l){if(1&o&&(e.j41(0,"div",26)(1,"h5",27),e.EFF(2),e.k0s(),e.j41(3,"div",28)(4,"ul",29),e.DNE(5,ao,2,1,"li",30),e.k0s()()()),2&o){const t=e.XpG(2);e.R7$(2),e.JRh(t.lex.translate("Objetivos")),e.R7$(3),e.Y8G("ngForOf",null==t.entrega?null:t.entrega.objetivos)}}function oo(o,l){if(1&o){const t=e.RV6();e.j41(0,"div",33)(1,"small"),e.EFF(2),e.k0s(),e.j41(3,"button",34),e.bIt("click",function(){e.eBV(t);const n=e.XpG().$implicit,i=e.XpG(3);return e.Njj(i.showCadeiaValor(n.processo.id))}),e.nrm(4,"i",35),e.k0s()()}if(2&o){const t=e.XpG().$implicit;e.R7$(2),e.JRh(t.processo.nome)}}function io(o,l){if(1&o&&(e.j41(0,"li",31),e.DNE(1,oo,5,1,"div",32),e.k0s()),2&o){const t=l.$implicit;e.R7$(),e.Y8G("ngIf",t.processo)}}function lo(o,l){if(1&o&&(e.j41(0,"div",26)(1,"h5",27),e.EFF(2),e.k0s(),e.j41(3,"div",28)(4,"ul",29),e.DNE(5,io,2,1,"li",30),e.k0s()()()),2&o){const t=e.XpG(2);e.R7$(2),e.JRh(t.lex.translate("Processos")),e.R7$(3),e.Y8G("ngForOf",null==t.entrega?null:t.entrega.processos)}}function so(o,l){if(1&o&&(e.j41(0,"li",31)(1,"div",33)(2,"small"),e.EFF(3),e.k0s()()()),2&o){const t=l.$implicit;e.R7$(3),e.JRh(null==t.produto?null:t.produto.nome)}}function ro(o,l){if(1&o&&(e.j41(0,"div",26)(1,"h5",27),e.EFF(2),e.k0s(),e.j41(3,"div",28)(4,"ul",29),e.DNE(5,so,4,1,"li",30),e.k0s()()()),2&o){const t=e.XpG(2);e.R7$(2),e.JRh(t.lex.translate("Produtos e Servi\xe7os")),e.R7$(3),e.Y8G("ngForOf",null==t.entrega?null:t.entrega.produtos)}}function co(o,l){if(1&o&&(e.j41(0,"div",8)(1,"div",9),e.DNE(2,Wn,1,1,"badge",10),e.k0s(),e.j41(3,"h5"),e.EFF(4),e.k0s(),e.j41(5,"small"),e.EFF(6),e.k0s(),e.nrm(7,"hr"),e.j41(8,"p"),e.EFF(9,"Per\xedodo: "),e.j41(10,"small"),e.EFF(11),e.k0s()(),e.j41(12,"div",11)(13,"p",12),e.EFF(14,"Demandante: "),e.DNE(15,Kn,1,2,"badge",13),e.k0s(),e.j41(16,"p"),e.EFF(17,"Destinat\xe1rio: "),e.DNE(18,Zn,1,1,"badge",14),e.k0s()(),e.j41(19,"h5",15),e.EFF(20),e.k0s(),e.j41(21,"small",16),e.EFF(22),e.k0s(),e.DNE(23,eo,12,2,"div",17)(24,no,6,2,"div",18)(25,lo,6,2,"div",18)(26,ro,6,2,"div",18),e.k0s()),2&o){const t=e.XpG();e.R7$(2),e.Y8G("ngForOf",null==t.entrega?null:t.entrega.etiquetas),e.R7$(2),e.JRh(null==t.entrega?null:t.entrega.descricao),e.R7$(2),e.JRh(null==t.entrega?null:t.entrega.descricao_entrega),e.R7$(5),e.Lme("",t.planoEntregaEntregaDao.getDateFormatted(null==t.entrega?null:t.entrega.data_inicio)," at\xe9 ",t.planoEntregaEntregaDao.getDateFormatted(null==t.entrega?null:t.entrega.data_fim),""),e.R7$(4),e.Y8G("ngIf",null==t.entrega?null:t.entrega.unidade),e.R7$(3),e.Y8G("ngIf",null==t.entrega||null==t.entrega.destinatario?null:t.entrega.destinatario.length),e.R7$(2),e.JRh(t.lex.translate("Meta")),e.R7$(2),e.JRh(null==t.entrega?null:t.entrega.descricao_meta),e.R7$(),e.Y8G("ngIf",t.entrega),e.R7$(),e.Y8G("ngIf",null==t.entrega||null==t.entrega.objetivos?null:t.entrega.objetivos.length),e.R7$(),e.Y8G("ngIf",null==t.entrega||null==t.entrega.processos?null:t.entrega.processos.length),e.R7$(),e.Y8G("ngIf",null==t.entrega||null==t.entrega.produtos?null:t.entrega.produtos.length)}}function uo(o,l){if(1&o&&(e.j41(0,"div",36),e.nrm(1,"plano-entrega-entregas-vinculadas",37),e.k0s()),2&o){const t=e.XpG();e.R7$(),e.Y8G("entregaId",t.entrega.id)}}function mo(o,l){if(1&o&&(e.j41(0,"div",38),e.nrm(1,"plano-entrega-entregas-plano-trabalho",37),e.k0s()),2&o){const t=e.XpG();e.R7$(),e.Y8G("entregaId",t.entrega.id)}}const _o=[{path:"",component:yt,canActivate:[b.q],resolve:{config:C.L},runGuardsAndResolvers:"always",data:{title:"Plano de Entregas"}},{path:"new",component:K,canActivate:[b.q],resolve:{config:C.L},runGuardsAndResolvers:"always",data:{title:"Inclus\xe3o de Plano de Entregas",modal:!0}},{path:":id/edit",component:K,canActivate:[b.q],resolve:{config:C.L},runGuardsAndResolvers:"always",data:{title:"Edi\xe7\xe3o de Plano de Entregas",modal:!0}},{path:":id/clone",component:K,canActivate:[b.q],resolve:{config:C.L},runGuardsAndResolvers:"always",data:{title:"Clone de Plano de Entregas",modal:!0,clone:!0}},{path:":id/consult",component:K,canActivate:[b.q],resolve:{config:C.L},runGuardsAndResolvers:"always",data:{title:"Consulta a Plano de Entregas",modal:!0}},{path:":id/logs",component:qa,canActivate:[b.q],resolve:{config:C.L},runGuardsAndResolvers:"always",data:{title:"Logs de Altera\xe7\xf5es em Planos de Entregas",modal:!0}},{path:":planoEntregaId/avaliar",component:tn.I,canActivate:[b.q],resolve:{config:C.L},runGuardsAndResolvers:"always",data:{title:"Avaliar Plano de Entrega"}},{path:"entrega",component:be,canActivate:[b.q],resolve:{config:C.L},runGuardsAndResolvers:"always",data:{title:"Entregas do Plano de Entregas",modal:!0}},{path:"entrega/:id/consult",component:be,canActivate:[b.q],resolve:{config:C.L},runGuardsAndResolvers:"always",data:{title:"Consulta entrega do Plano de Entregas",modal:!0}},{path:"entrega/:id/detalhes",component:(()=>{class o extends x.g{constructor(t){super(t),this.injector=t,this.planoEntregaEntregaDao=t.get(L.o),this.planoEntregaService=t.get(u.C)}ngOnInit(){super.ngOnInit(),this.entrega=this.metadata?.entrega}showPlanejamento(t){var a=this;return(0,m.A)(function*(){a.go.navigate({route:["gestao","plano-entrega","entrega","objetivos",t]},{modal:!0})})()}showCadeiaValor(t){var a=this;return(0,m.A)(function*(){a.go.navigate({route:["gestao","plano-entrega","entrega","processos",t]},{modal:!0})})()}static{this.\u0275fac=function(a){return new(a||o)(e.rXU(e.zZn))}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["plano-entrega-entrega-detalhes"]],features:[e.Vt3],decls:8,vars:4,consts:[["detalhesEntrega",""],["right","",3,"title"],["key","INFOS","icon","bi bi-info-lg","label","Informa\xe7\xf5es"],["key","VINCULOS","icon","bi bi-arrow-down-up","label","V\xednculos"],["key","PARTICIPANTES","icon","bi bi-people","label","Participantes"],["class","","style","min-height: 400px;",4,"ngIf"],["style","min-height: 400px;",4,"ngIf"],["class","row","style","min-height: 400px;",4,"ngIf"],[1,"",2,"min-height","400px"],[1,"mb-2"],[3,"lookup",4,"ngFor","ngForOf"],[1,"d-flex"],[1,"me-2"],["color","light",3,"icon","label",4,"ngIf"],["color","light","icon","bi bi-mailbox",3,"label",4,"ngIf"],[1,"text-center"],[1,"d-block","text-center","mb-2"],["class","d-flex justify-content-center",4,"ngIf"],["class","mt-3",4,"ngIf"],[3,"lookup"],["color","light",3,"icon","label"],["color","light","icon","bi bi-mailbox",3,"label"],[1,"d-flex","justify-content-center"],["icon","bi bi-graph-up-arrow","color","light","hint","Planejada",3,"textValue"],[1,"vr","mx-5"],["icon","bi bi-check-lg","color","light","hint","Realizada",3,"textValue"],[1,"mt-3"],[1,"text-center","mb-2"],[1,"card"],[1,"list-group","list-group-flush"],["class","list-group-item",4,"ngFor","ngForOf"],[1,"list-group-item"],["class","d-flex justify-content-between align-items-center",4,"ngIf"],[1,"d-flex","justify-content-between","align-items-center"],[1,"btn","btn-sm","btn-outline-info","me-2",3,"click"],[1,"bi","bi-eye"],[2,"min-height","400px"],[3,"entregaId"],[1,"row",2,"min-height","400px"]],template:function(a,n){if(1&a&&(e.j41(0,"tabs",1,0),e.nrm(2,"tab",2)(3,"tab",3)(4,"tab",4),e.k0s(),e.DNE(5,co,27,13,"div",5)(6,uo,2,1,"div",6)(7,mo,2,1,"div",7)),2&a){const i=e.sdS(1);e.Y8G("title",n.isModal?"":n.title),e.R7$(5),e.Y8G("ngIf","INFOS"==i.active),e.R7$(),e.Y8G("ngIf","VINCULOS"==i.active&&n.entrega),e.R7$(),e.Y8G("ngIf","PARTICIPANTES"==i.active&&n.entrega)}},dependencies:[A.Sq,A.bT,_e.O,pe.j,y.n,Mn,Jn]})}}return o})(),canActivate:[b.q],resolve:{config:C.L},runGuardsAndResolvers:"always",data:{title:"Detalhes da entrega do Plano de Entregas",modal:!0}},{path:"entrega-list",component:en,canActivate:[b.q],resolve:{config:C.L},runGuardsAndResolvers:"always",data:{title:"Entregas do Plano de Entregas",modal:!0}},{path:"entrega/objetivos/:objetivo_id",component:ge,canActivate:[b.q],resolve:{config:C.L},runGuardsAndResolvers:"always",data:{title:"Entregas do Plano de Entregas",modal:!0}},{path:"entrega/processos/:processo_id",component:ge,canActivate:[b.q],resolve:{config:C.L},runGuardsAndResolvers:"always",data:{title:"Entregas do Plano de Entregas",modal:!0}},{path:"adesao",component:aa,canActivate:[b.q],resolve:{config:C.L},runGuardsAndResolvers:"always",data:{title:"Ades\xe3o a Plano de Entregas",modal:!0}},{path:"entrega/progresso/:entrega_id",component:mn,canActivate:[b.q],resolve:{config:C.L},runGuardsAndResolvers:"always",data:{title:"Progressos da entrega do Plano de Entregas",modal:!0}},{path:"entrega/progresso/:entrega_id/new",component:Oe,canActivate:[b.q],resolve:{config:C.L},runGuardsAndResolvers:"always",data:{title:"Inclus\xe3o de Progresso entrega do Plano de Entregas",modal:!0}},{path:"entrega/progresso/:entrega_id/:id/edit",component:Oe,canActivate:[b.q],resolve:{config:C.L},runGuardsAndResolvers:"always",data:{title:"Inclus\xe3o de Progresso entrega do Plano de Entregas",modal:!0}}];let po=(()=>{class o{static{this.\u0275fac=function(a){return new(a||o)}}static{this.\u0275mod=e.$C({type:o})}static{this.\u0275inj=e.G2t({imports:[D.iI.forChild(_o),D.iI]})}}return o})();var ho=r(7991),fo=r(4016),Eo=r(3756);let bo=(()=>{class o{static{this.\u0275fac=function(a){return new(a||o)}}static{this.\u0275mod=e.$C({type:o})}static{this.\u0275inj=e.G2t({imports:[A.MD,V.h,po,ho.PlanejamentoModule,fo.CadeiaValorModule,Ae.ux,Eo.UteisModule]})}}return o})()},4450:(oe,$,r)=>{r.d($,{V:()=>j});var A=r(3308),V=r(2220),D=r(3279),b=r(4796),C=r(2342),m=r(3609),f=r(568),R=r(6867),I=r(9036),P=r(2736);let j=(()=>{class S{constructor(d,u,_,v,T,e,O,p){this.auth=d,this.util=u,this.go=_,this.lookup=v,this.dao=T,this.avaliacaoDao=e,this.templateService=O,this.planoTrabalhoDao=p}template(d){return d.programa?.template_tcr}metadados(d){return{needSign:this.needSign.bind(this),extraTags:this.extraTags.bind(this),especie:"TCR",titulo:"Termo de Ci\xeancia e Responsabilidade",dataset:this.planoTrabalhoDao.dataset(),datasource:this.planoTrabalhoDao.datasource(d),template:d.programa?.template_tcr,template_id:d.programa?.template_tcr_id}}needSign(d,u){const _=d,v=u||(_?.documentos||[]).find(T=>_?.documento_id?.length&&T.id==_?.documento_id)||_?.documento;if(d&&v&&!v.assinaturas?.find(T=>T.usuario_id==this.auth.usuario.id)){const T=_.tipo_modalidade,e=_.programa,O=this.auth.entidade;let p=[];return e?.plano_trabalho_assinatura_participante&&p.push(_.usuario_id),e?.plano_trabalho_assinatura_gestor_lotacao&&p.push(...this.auth.gestoresLotacao.map(G=>G.id)),e?.plano_trabalho_assinatura_gestor_unidade&&p.push(_.unidade?.gestor?.id||"",..._.unidade?.gestores_substitutos?.map(G=>G.id)||""),e?.plano_trabalho_assinatura_gestor_entidade&&p.push(O.gestor_id||"",O.gestor_substituto_id||""),!!T&&p.includes(this.auth.usuario.id)}return!1}extraTags(d,u,_){const v=d;let T=[];return v?.documento_id==u.id&&T.push({key:u.id,value:"Vigente",icon:"bi bi-check-all",color:"primary"}),JSON.stringify(_.tags)!=JSON.stringify(T)&&(_.tags=T),_.tags}tipoEntrega(d,u){let _=u||d.plano_trabalho,v=d.plano_entrega_entrega?.plano_entrega?.unidade_id==_.unidade_id?"PROPRIA_UNIDADE":d.plano_entrega_entrega?"OUTRA_UNIDADE":d.orgao?.length?"OUTRO_ORGAO":"SEM_ENTREGA",T=this.lookup.ORIGENS_ENTREGAS_PLANO_TRABALHO.find(p=>p.key==v)||{key:"",value:"Desconhecido1"};return{titulo:T.value,cor:T.color||"danger",nome:_?._metadata?.novaEntrega?.plano_entrega_entrega?.entrega?.nome||d.plano_entrega_entrega?.entrega?.nome||"Desconhecido2",tipo:v,descricao:_?._metadata?.novaEntrega?.plano_entrega_entrega?.descricao||d.plano_entrega_entrega?.descricao||""}}atualizarTcr(d,u,_,v){if(u.usuario&&u.unidade){let T=this.dao.datasource(d),e=this.dao.datasource(u),O=u.programa;if(e.usuario.texto_complementar_plano=_||u.usuario?.texto_complementar_plano||"",e.unidade.texto_complementar_plano=v||u.unidade?.texto_complementar_plano||"",(O?.termo_obrigatorio||u.documento_id?.length)&&JSON.stringify(e)!=JSON.stringify(T)&&O?.template_tcr){let p=u.documentos?.find(G=>G.id==u.documento_id);u.documento_id?.length&&p&&!p.assinaturas?.length&&"LINK"!=p.tipo?(p.conteudo=this.templateService.renderTemplate(d.documento?.conteudo||"",e),p.dataset=this.dao.dataset(),p.datasource=e,p._status="ADD"==p._status?"ADD":"EDIT"):(p=new V.j({id:this.dao?.generateUuid(),tipo:"HTML",especie:"TCR",titulo:"Termo de Ci\xeancia e Responsabilidade",conteudo:this.templateService.renderTemplate(d.documento?.conteudo||O?.template_tcr?.conteudo||"",e),status:"GERADO",_status:"ADD",template:O?.template_tcr?.conteudo,dataset:this.dao.dataset(),datasource:e,entidade_id:this.auth.entidade?.id,plano_trabalho_id:u.id,template_id:O?.template_tcr_id}),u.documentos.push(p)),u.documento=p,u.documento_id=p?.id||null}}return u.documento}situacaoPlano(d){return d.deleted_at?"EXCLUIDO":d.data_arquivamento?"ARQUIVADO":d.status}isValido(d){return!d.deleted_at&&"CANCELADO"!=d.status&&!d.data_arquivamento}estaVigente(d){let u=new Date;return"ATIVO"==d.status&&d.data_inicio<=u&&d.data_fim>=u}diasParaConcluirConsolidacao(d,u){return d&&u?this.util.daystamp(d.data_fim)+u.dias_tolerancia_avaliacao-this.util.daystamp(this.auth.hora):-1}avaliar(d,u,_){this.go.navigate({route:["gestao","plano-trabalho","consolidacao",d.id,"avaliar"]},{modal:!0,metadata:{consolidacao:d,programa:u},modalClose:v=>{v&&(d.status="AVALIADO",d.avaliacao_id=v.id,d.avaliacao=v,_(d))}})}visualizarAvaliacao(d){this.go.navigate({route:["gestao","plano-trabalho","consolidacao",d.id,"verAvaliacoes"]},{modal:!0,metadata:{consolidacao:d}})}fazerRecurso(d,u,_){this.go.navigate({route:["gestao","plano-trabalho","consolidacao",d.id,"recurso"]},{modal:!0,metadata:{recurso:["Inadequado","N\xe3o executado"].includes(d.avaliacao?.nota),consolidacao:d,programa:u},modalClose:v=>{v&&(d.avaliacao=v,_(d))}})}cancelarAvaliacao(d,u,_){var v=this;return(0,A.A)(function*(){u.submitting=!0;try{(yield v.avaliacaoDao.cancelarAvaliacao(d.avaliacao.id))&&(d.status="CONCLUIDO",d.avaliacao_id=null,d.avaliacao=void 0,_(d))}catch(T){u.error(T.message||T)}finally{u.submitting=!1}})()}usuarioAssinou(d,u){return u=u||this.auth.usuario.id,Object.values(d).some(_=>(_||[]).includes(u))}assinaturasFaltantes(d,u){return{participante:d.participante.filter(_=>!u.participante.includes(_)),gestores_unidade_executora:d.gestores_unidade_executora.length?d.gestores_unidade_executora.filter(_=>u.gestores_unidade_executora.includes(_)).length?[]:d.gestores_unidade_executora:[],gestores_unidade_lotacao:d.gestores_unidade_lotacao.length?d.gestores_unidade_lotacao.filter(_=>u.gestores_unidade_lotacao.includes(_)).length?[]:d.gestores_unidade_lotacao:[],gestores_entidade:d.gestores_entidade.length?d.gestores_entidade.filter(_=>u.gestores_entidade.includes(_)).length?[]:d.gestores_entidade:[]}}static{this.\u0275fac=function(u){return new(u||S)(D.KVO(b.u),D.KVO(C.a),D.KVO(m.T),D.KVO(f.s),D.KVO(R.x),D.KVO(I.l),D.KVO(P.I),D.KVO(R.x))}}static{this.\u0275prov=D.jDH({token:S,factory:S.\u0275fac,providedIn:"root"})}}return S})()}}]);
"use strict";(self.webpackChunkpetrvs=self.webpackChunkpetrvs||[]).push([[9923],{9923:(Ue,T,d)=>{d.r(T),d.d(T,{CadeiaValorModule:()=>ze});var f=d(6610),I=d(8832),y=d(6729),z=d(9455),O=d(8069),_=d(1620),v=d(6819),u=d(3308),E=d(9062),h=d(5611),g=d(5048),b=d(8467),A=d(2075),e=d(3279),q=d(6774),U=d(7509),L=d(3535),R=d(2034),j=d(5852),w=d(7772),B=d(2305),F=d(6764),$=d(9226),Y=d(5524),C=d(1641),D=d(242),V=d(3305),x=d(4795),P=d(16),Q=d(9328),J=d(3890);const W=["inputElement"],H=["newInputLevel"];function Z(a,l){if(1&a&&(e.j41(0,"span",7),e.EFF(1),e.k0s()),2&a){const t=e.XpG(2);e.R7$(),e.JRh(t.separator)}}function K(a,l){if(1&a){const t=e.RV6();e.j41(0,"input",8),e.bIt("change",function(o){e.eBV(t);const i=e.XpG().index,s=e.XpG();return e.Njj(s.onChange(o,i))}),e.k0s()}if(2&a){const t=e.XpG(),n=t.$implicit,o=t.index,i=e.XpG();e.xc7("width",i.inputWidth,"px"),e.AVh("input-level-invalid",!n.valid),e.Y8G("type",i.type)("id",i.generatedId(i.controlName)+"_"+o)("readonly",i.isDisabled),e.BMQ("min",n.min)("max",n.max)("value",n.value)}}function ee(a,l){if(1&a&&(e.qex(0),e.DNE(1,Z,2,1,"span",5)(2,K,1,10,"input",6),e.bVm()),2&a){const t=l.index,n=e.XpG();e.R7$(),e.Y8G("ngIf",t>0),e.R7$(),e.Y8G("ngIf",n.viewInit)}}function te(a,l){if(1&a&&(e.j41(0,"span",7),e.EFF(1),e.k0s()),2&a){const t=e.XpG(2);e.R7$(),e.JRh(t.separator)}}function oe(a,l){if(1&a){const t=e.RV6();e.j41(0,"input",8,0),e.bIt("change",function(o){e.eBV(t);const i=e.XpG(2);return e.Njj(i.onNewLevelChange(o))}),e.k0s()}if(2&a){const t=e.XpG(2);e.xc7("width",t.inputWidth,"px"),e.AVh("input-level-invalid",!t.newLevel.valid),e.Y8G("type",t.type)("id",t.generatedId(t.controlName)+"_new")("readonly",t.isDisabled),e.BMQ("min",t.newLevel.min)("max",t.newLevel.max)("value",t.newLevel.value)}}function ne(a,l){if(1&a&&(e.qex(0),e.DNE(1,te,2,1,"span",5)(2,oe,2,10,"input",6),e.bVm()),2&a){const t=e.XpG();e.R7$(),e.Y8G("ngIf",t.levels.length),e.R7$(),e.Y8G("ngIf",t.viewInit)}}let ie=(()=>{class a extends Q.O{set control(t){this._control=t}get control(){return this.getControl()}set size(t){this.setSize(t)}get size(){return this.getSize()}constructor(t){super(t),this.injector=t,this.class="form-group",this.change=new e.bkB,this.hostClass="",this.labelPosition="top",this.controlName=null,this.icon="",this.label="",this.labelInfo="",this.bold=!1,this.value="",this.inputWidth=50,this.loading=!1,this.type="number",this.separator=".",this.levels=[],this.newLevel={valid:!0}}controlChange(t){this.levels=(t||"").split(this.separator).filter(n=>!this.isEmpty(n)).map(n=>Object.assign({},{value:n,valid:!0})),this.checkValidate()}isEmpty(t){return[void 0,"0","",0].includes(t)}updateControl(){this.control&&this.control.setValue(this.levels.map(t=>t.value).join(this.separator))}get hasNewLevel(){return!0}checkValidate(){var t=this;(0,u.A)(function*(){for(let n=0;n<t.levels.length;n++){let o=t.levels.slice(0,n),i=t.levels.slice(n+1,t.levels.length);t.validate&&(t.levels[n].valid=yield t.validate(o,t.levels[n],i)),t.minValue&&(t.levels[n].min=yield t.minValue(o,t.levels[n],i)),t.maxValue&&(t.levels[n].max=yield t.maxValue(o,t.levels[n],i)),t.stepValue&&(t.levels[n].step=yield t.stepValue(o,t.levels[n],i))}t.cdRef.detectChanges()})()}ngAfterViewInit(){super.ngAfterViewInit(),this.control&&(this.control.valueChanges.subscribe(this.controlChange.bind(this)),this.controlChange(this.control.value))}onChange(t,n){this.levels[n].value=t.target.value,this.isEmpty(this.levels[n].value)&&(this.levels=this.levels.slice(0,n)),this.updateControl()}onNewLevelChange(t){if(this.newLevel.value=this.newInputLevel.nativeElement.value,!this.isEmpty(this.newLevel.value)){this.levels.push({value:this.newLevel.value,valid:!0}),this.newLevel.value="",this.newInputLevel.nativeElement.value="",this.updateControl(),this.cdRef.detectChanges();const n=this.generatedId(this.controlName)+"_"+(this.levels.length-1),o=document.getElementById(n);o&&o.focus()}}static{this.\u0275fac=function(n){return new(n||a)(e.rXU(e.zZn))}}static{this.\u0275cmp=e.VBU({type:a,selectors:[["input-level"]],viewQuery:function(n,o){if(1&n&&(e.GBs(W,5),e.GBs(H,5)),2&n){let i;e.mGM(i=e.lsd())&&(o.inputElement=i.first),e.mGM(i=e.lsd())&&(o.newInputLevel=i.first)}},hostVars:2,hostBindings:function(n,o){2&n&&e.HbH(o.class)},inputs:{hostClass:"hostClass",labelPosition:"labelPosition",controlName:"controlName",disabled:"disabled",icon:"icon",label:"label",labelInfo:"labelInfo",labelClass:"labelClass",bold:"bold",value:"value",inputWidth:"inputWidth",loading:"loading",minValue:"minValue",maxValue:"maxValue",stepValue:"stepValue",validate:"validate",prefix:"prefix",sufix:"sufix",form:"form",source:"source",path:"path",type:"type",separator:"separator",required:"required",control:"control",size:"size"},outputs:{change:"change"},features:[e.Jv_([],[{provide:I.ZU,useExisting:I.j4}]),e.Vt3],decls:4,vars:13,consts:[["newInputLevel",""],[3,"labelPosition","labelClass","controlName","required","control","loading","disabled","label","labelInfo","icon","bold"],[1,"input-group"],[4,"ngFor","ngForOf"],[4,"ngIf"],["class","input-group-text",4,"ngIf"],["class","form-control input-level",3,"type","width","id","input-level-invalid","readonly","change",4,"ngIf"],[1,"input-group-text"],[1,"form-control","input-level",3,"change","type","id","readonly"]],template:function(n,o){1&n&&(e.j41(0,"input-container",1)(1,"div",2),e.DNE(2,ee,3,2,"ng-container",3)(3,ne,3,2,"ng-container",4),e.k0s()()),2&n&&(e.Y8G("labelPosition",o.labelPosition)("labelClass",o.labelClass)("controlName",o.controlName)("required",o.required)("control",o.control)("loading",o.loading)("disabled",o.disabled)("label",o.label)("labelInfo",o.labelInfo)("icon",o.icon)("bold",o.bold),e.R7$(2),e.Y8G("ngForOf",o.levels),e.R7$(),e.Y8G("ngIf",o.hasNewLevel))},dependencies:[f.Sq,f.bT,J.t],styles:[".input-level[_ngcontent-%COMP%]{flex:none!important}.input-level-invalid[_ngcontent-%COMP%]{border-color:#dc3545}"]})}}return a})();function ae(a,l){if(1&a&&(e.j41(0,"small",10),e.EFF(1),e.k0s()),2&a){const t=l.row,n=l.metadata,o=e.XpG();e.R7$(),e.JRh(o.getSequencia(n,t))}}function se(a,l){if(1&a&&e.nrm(0,"input-level",11),2&a){const t=e.XpG();e.Y8G("size",6)("validate",t.validateLevel)}}function le(a,l){if(1&a&&(e.j41(0,"strong",12),e.EFF(1),e.k0s()),2&a){const t=l.row,n=l.metadata,o=e.XpG();e.xc7("margin-left",o.getNivelSequencia(n),"px"),e.R7$(),e.JRh(t.nome||"")}}function re(a,l){if(1&a&&e.nrm(0,"input-text",13),2&a){const t=e.XpG();e.Y8G("size",6)("control",t.form.controls.nome),e.BMQ("maxlength",250)}}let S=(()=>{class a extends x.g{set noPersist(t){super.noPersist=t}get noPersist(){return super.noPersist}set control(t){super.control=t}get control(){return super.control}set entity(t){super.entity=t}get entity(){return super.entity}get items(){return this.gridControl.value||this.gridControl.setValue(new g.S),this.gridControl.value.processos||(this.gridControl.value.processos=[]),this.gridControl.value.processos}constructor(t){super(t),this.injector=t,this.validate=(n,o)=>{let i=null;return["nome"].indexOf(o)>=0&&!n.value?.length&&(i="Obrigat\xf3rio"),["nivel"].indexOf(o)>=0&&(i=this.existePai(n)),i},this.validateLevel=(n,o,i)=>{if(i.length){let s=[...n.map(r=>r.value),o.value];return this.processos(s).length==s.length}{let s=this.processos(n.map(c=>c.value));return(s.length==n.length&&s.length?this.items.filter(c=>c.processo_pai_id==s[s.length-1].id):[]).length+1>=o.value}},this.processos=n=>{let o=[];return n.reduce((i,s)=>{let r=i.find(c=>c.sequencia==s);return r?(o.push(r),this.items.filter(c=>c.processo_pai_id==r?.id)):[]},this.items.filter(i=>!i.processo_pai_id)),o},this.cdRef=t.get(e.gRc),this.dao=t.get(b.X),this.processosDao=t.get(D.p),this.form=this.fh.FormBuilder({nome:{default:""},sequencia:{default:1},nivel:{default:""}},this.cdRef,this.validate)}existePai(t){let n=null,o=t.value.split("."),i=this.items;if(o.length>1){let s=i.reduce((c,m)=>c.created_at>m.created_at?c:m),r=this.processos(o.slice(0,o.length-1));if(s.processo_pai_id){let p,c=s.processo_pai_id,m="";for(;c;){let G=this.items.find(qe=>qe.id==c);m=(G?.sequencia||"")+"."+m,c=G?.processo_pai_id||null}p=m.split("."),p.pop(),p.push((s.sequencia-1).toString()),this.JSON.stringify(o)<=this.JSON.stringify(p)&&o[o.length-1].parseInt()<=p[p.length-1].parseInt()?n="N\xedvel j\xe1 existente":o.length>p.length&&(n=r.length+1==o.length?"Adicione o n\xedvel filho pelo bot\xe3o 'Adicionar filho'":"N\xe3o existe o n\xedvel pai")}else n=r[0].id==s.id?"N\xe3o existe o n\xedvel pai":r.length+1==o.length?"Adicione o n\xedvel filho pelo bot\xe3o 'Adicionar filho'":"N\xe3o existe o n\xedvel pai"}else if(i.length>0){let s=i.reduce((r,c)=>r.created_at>c.created_at?r:c);n=o[0]<s.sequencia?"N\xedvel j\xe1 existente":o[0]>s.sequencia?"Insira o n\xedvel em sequ\xeancia num\xe9rica":null==s.processo_pai_id?null:"Adicione este n\xedvel pelo bot\xe3o 'Adicionar n\xedvel'"}return n}loadData(t,n){this.cdRef.detectChanges(),this.sortProcessos()}addChildProcesso(t,n,o){var i=this;return(0,u.A)(function*(){let s=new V.g({id:i.dao.generateUuid(),processo_pai_id:t.id,sequencia:i.items.filter(r=>r.processo_pai_id==t.id).length+1,nome:""});i.items.push(s),i.grid.setMetadata(s,{nivel:i.getSequencia({},s)}),i.sortProcessos(),i.grid.adding=!0,yield i.grid.edit(s)})()}getSequencia(t,n){if(!t.nivel){let o=n.processo_pai_id,i="",s=[];for(;o;){s.push(o);let r=this.items.find(c=>c.id==o);i=(r?.sequencia||"")+"."+i,o=r?.processo_pai_id||null}i+=n.sequencia,t.nivel!=i&&(t.nivel=i,t.path=s),this.grid||this.sortProcessosItems()}return t.nivel}getNivelSequencia(t){return 10*(t.nivel.match(/\./g)||[]).length}sortProcessos(){this.items.sort((t,n)=>{const o=(this.grid.getMetadata(t)?.nivel||"").split(".").map(s=>("000"+s).substr(-3)).join("."),i=(this.grid.getMetadata(n)?.nivel||"").split(".").map(s=>("000"+s).substr(-3)).join(".");return o<i?-1:o>i?1:0})}sortProcessosItems(){this.items.sort((t,n)=>{let o=t.processo_pai_id?this.retornaNivel(t):t.sequencia.toString(),i=n.processo_pai_id?this.retornaNivel(n):n.sequencia.toString();const s=(o||"").split(".").map(c=>("000"+c).substr(-3)).join("."),r=(i||"").split(".").map(c=>("000"+c).substr(-3)).join(".");return s<r?-1:s>r?1:0})}retornaNivel(t){let n=t.processo_pai_id,o="";for(;n;){let i=this.items.find(s=>s.id==n);o=(i?.sequencia||"")+"."+o,n=i?.processo_pai_id||null}return o+=t.sequencia,o}addProcesso(){var t=this;return(0,u.A)(function*(){return new V.g({id:t.dao.generateUuid(),sequencia:t.items.filter(o=>!o.processo_pai_id).length+1,nome:""})})()}loadProcesso(t,n){var o=this;return(0,u.A)(function*(){t.controls.nivel.setValue(o.getSequencia(o.grid?.getMetadata(n),n)),t.controls.sequencia.setValue(n.sequencia),t.controls.nome.setValue(n.nome),o.cdRef.detectChanges()})()}removeProcesso(t){var n=this;return(0,u.A)(function*(){if(yield n.dialog.confirm("Exclui ?","Deseja realmente excluir o item ?")){let i=t;return(n.items.filter(r=>r.processo_pai_id==i.id)||[]).forEach(r=>n.removeProcesso(r)),n.items.splice(n.items.findIndex(r=>r.id==i.id),1),n.isNoPersist||(yield n.processosDao?.delete(t)),!0}return!1})()}saveProcesso(t,n){var o=this;return(0,u.A)(function*(){let i;if(o.form.markAllAsTouched(),o.form.valid){let s=t.controls.nivel.value.split("."),r=o.processos(s.slice(0,s.length-1)),c=r?.length?r[r.length-1].id:null,m=1*s[s.length-1];o.items.filter(p=>p.processo_pai_id==c&&p.sequencia>=m).forEach(p=>p.sequencia++),n.id="NEW"==n.id?o.dao.generateUuid():n.id,n.sequencia=m,n.cadeia_valor_id=o.entity?.id,n.processo_pai_id=c,n.nome=t.controls.nome.value,i=n,o.isNoPersist||(i=yield o.processosDao?.save(n))}return i})()}editEndProcesso(t){this.grid?.clearMetadata(),this.cdRef.detectChanges(),this.sortProcessos(),this.cdRef.detectChanges()}dynamicButtons(t){let n=[];return n.push({hint:"Adicionar filho",icon:"bi bi-plus-circle",onClick:this.addChildProcesso.bind(this)}),n}static{this.\u0275fac=function(n){return new(n||a)(e.rXU(e.zZn))}}static{this.\u0275cmp=e.VBU({type:a,selectors:[["cadeia-valor-list-processos"]],viewQuery:function(n,o){if(1&n&&(e.GBs(C.Q,5),e.GBs(h._,5)),2&n){let i;e.mGM(i=e.lsd())&&(o.editableForm=i.first),e.mGM(i=e.lsd())&&(o.grid=i.first)}},inputs:{cdRef:"cdRef",noPersist:"noPersist",control:"control",entity:"entity"},features:[e.Vt3],decls:15,vars:15,consts:[["nivel",""],["editNivel",""],["processo",""],["editProcesso",""],["noButtons","",3,"form","disabled"],[1,"row"],["editable","",3,"items","form","hasDelete","add","load","remove","save","editEnd"],["title","N\xedvel",3,"template","editTemplate"],["title","Processos",3,"template","editTemplate"],["type","options",3,"dynamicButtons"],[1,"d-block"],["controlName","nivel",3,"size","validate"],[1,"d-block","text-break","w-100"],["controlName","nome",3,"size","control"]],template:function(n,o){if(1&n&&(e.j41(0,"editable-form",4)(1,"div",5)(2,"grid",6)(3,"columns")(4,"column",7),e.DNE(5,ae,2,1,"ng-template",null,0,e.C5r)(7,se,1,2,"ng-template",null,1,e.C5r),e.k0s(),e.j41(9,"column",8),e.DNE(10,le,2,3,"ng-template",null,2,e.C5r)(12,re,1,3,"ng-template",null,3,e.C5r),e.k0s(),e.nrm(14,"column",9),e.k0s()()()()),2&n){const i=e.sdS(6),s=e.sdS(8),r=e.sdS(11),c=e.sdS(13);e.Y8G("form",o.form)("disabled",o.formDisabled),e.R7$(2),e.Y8G("items",o.items)("form",o.form)("hasDelete",!0)("add",o.addProcesso.bind(o))("load",o.loadProcesso.bind(o))("remove",o.removeProcesso.bind(o))("save",o.saveProcesso.bind(o))("editEnd",o.editEndProcesso.bind(o)),e.R7$(2),e.Y8G("template",i)("editTemplate",s),e.R7$(5),e.Y8G("template",r)("editTemplate",c),e.R7$(5),e.Y8G("dynamicButtons",o.dynamicButtons.bind(o))}},dependencies:[h._,R.T,j.I,C.Q,P.H,ie]})}}return a})();const de=["unidade"];function ce(a,l){1&a&&e.nrm(0,"toolbar")}function pe(a,l){if(1&a&&(e.j41(0,"span",22),e.nrm(1,"i",23),e.EFF(2),e.k0s()),2&a){const t=e.XpG().row;e.R7$(2),e.SpI(" ",null==t?null:t.length,"")}}function me(a,l){if(1&a&&e.DNE(0,pe,3,1,"span",21),2&a){const t=l.row;e.Y8G("ngIf",null==t?null:t.length)}}function ue(a,l){if(1&a&&e.nrm(0,"cadeia-valor-list-processos",24,6),2&a){const t=l.row,n=e.XpG(2);e.Y8G("entity",t)("cdRef",n.cdRef)}}function fe(a,l){if(1&a&&(e.j41(0,"column",20),e.DNE(1,me,1,1,"ng-template",null,4,e.C5r)(3,ue,2,2,"ng-template",null,5,e.C5r),e.k0s()),2&a){const t=e.sdS(2),n=e.sdS(4),o=e.XpG();e.Y8G("align","center")("hint",o.lex.translate("Processos"))("template",t)("expandTemplate",n)}}function he(a,l){if(1&a&&(e.j41(0,"span",25),e.EFF(1),e.k0s()),2&a){const t=l.row;e.R7$(),e.JRh(t.nome)}}function _e(a,l){if(1&a&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&a){const t=l.row,n=e.XpG();e.R7$(),e.JRh(n.dao.getDateFormatted(t.data_inicio))}}function ve(a,l){if(1&a&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&a){const t=l.row,n=e.XpG();e.R7$(),e.JRh(n.dao.getDateFormatted(t.data_fim))}}function ge(a,l){if(1&a&&e.nrm(0,"column",26),2&a){const t=e.XpG();e.Y8G("onEdit",t.edit)("options",t.options)}}let k=(()=>{class a extends E.P{constructor(t){super(t,g.S,b.X),this.injector=t,this.selectable=!1,this.filterWhere=n=>{let o=[],i=n.value;return i.unidade_id?.length&&o.push(["unidade_id","==",i.unidade_id]),i.data_inicio&&o.push(["data_fim",">=",i.data_inicio]),i.data_fim&&o.push(["data_inicio","<=",i.data_fim]),o},this.entidadeDao=t.get(U.M),this.unidadeDao=t.get(L.s),this.join=["processos"],this.code="MOD_CADV",this.filter=this.fh.FormBuilder({data_inicio:{default:null},data_fim:{default:null},unidade_id:{default:""},entidade_id:{default:null}}),this.addOption(this.OPTION_INFORMACOES),this.addOption(this.OPTION_EXCLUIR,"MOD_CADV_EXCL"),this.addOption(this.OPTION_LOGS,"MOD_AUDIT_LOG")}onChangeData(){const t=new Date(this.filter.controls.data_inicio.value).getTime();if(new Date(this.filter.controls.data_fim.value).getTime()<t){let o=new Date(t);o.setDate(o.getDate()+1),this.filter.controls.data_fim.setValue(o)}}static{this.\u0275fac=function(n){return new(n||a)(e.rXU(e.zZn))}}static{this.\u0275cmp=e.VBU({type:a,selectors:[["cadeia-valor-list-grid"]],viewQuery:function(n,o){if(1&n&&(e.GBs(h._,5),e.GBs(de,7)),2&n){let i;e.mGM(i=e.lsd())&&(o.grid=i.first),e.mGM(i=e.lsd())&&(o.unidade=i.first)}},inputs:{snapshot:"snapshot",fixedFilter:"fixedFilter",selectable:"selectable"},features:[e.Vt3],decls:21,vars:30,consts:[["unidade",""],["columnNome",""],["columnInicio",""],["columnFim",""],["columnProcessos",""],["columnExpandedProcessos",""],["processos",""],[3,"select","dao","add","orderBy","groupBy","join","selectable","hasAdd","hasEdit"],[4,"ngIf"],[3,"deleted","form","where","submit","collapseChange","collapsed"],[1,"row"],["controlName","unidade_id","label","Unidade","required","",3,"size","control","dao"],["date","","label","In\xedcio","icon","bi bi-calendar-date","controlName","data_inicio",3,"change","size","control","labelInfo"],["date","","label","Fim","icon","bi bi-calendar-date","controlName","data_fim",3,"change","size","control","labelInfo"],["type","expand","icon","bi bi-boxes",3,"align","hint","template","expandTemplate",4,"ngIf"],["title","Nome","orderBy","nome",3,"template"],["title","In\xedcio",3,"template"],["title","Fim",3,"template"],["type","options",3,"onEdit","options",4,"ngIf"],[3,"rows"],["type","expand","icon","bi bi-boxes",3,"align","hint","template","expandTemplate"],["class","badge rounded-pill bg-light text-dark",4,"ngIf"],[1,"badge","rounded-pill","bg-light","text-dark"],[1,"bi","bi-boxes"],[3,"entity","cdRef"],[1,"text-break","w-100"],["type","options",3,"onEdit","options"]],template:function(n,o){if(1&n){const i=e.RV6();e.j41(0,"grid",7),e.bIt("select",function(r){return e.eBV(i),e.Njj(o.onSelect(r))}),e.DNE(1,ce,1,0,"toolbar",8),e.j41(2,"filter",9)(3,"div",10),e.nrm(4,"input-search",11,0),e.j41(6,"input-datetime",12),e.bIt("change",function(){return e.eBV(i),e.Njj(o.onChangeData())}),e.k0s(),e.j41(7,"input-datetime",13),e.bIt("change",function(){return e.eBV(i),e.Njj(o.onChangeData())}),e.k0s()()(),e.j41(8,"columns"),e.DNE(9,fe,5,4,"column",14),e.j41(10,"column",15),e.DNE(11,he,2,1,"ng-template",null,1,e.C5r),e.k0s(),e.j41(13,"column",16),e.DNE(14,_e,2,1,"ng-template",null,2,e.C5r),e.k0s(),e.j41(16,"column",17),e.DNE(17,ve,2,1,"ng-template",null,3,e.C5r),e.k0s(),e.DNE(19,ge,1,2,"column",18),e.k0s(),e.nrm(20,"pagination",19),e.k0s()}if(2&n){const i=e.sdS(12),s=e.sdS(15),r=e.sdS(18);e.Y8G("dao",o.dao)("add",o.add)("orderBy",o.orderBy)("groupBy",o.groupBy)("join",o.join)("selectable",o.selectable)("hasAdd",o.auth.hasPermissionTo("MOD_CADV_INCL"))("hasEdit",o.auth.hasPermissionTo("MOD_CADV_EDT")),e.R7$(),e.Y8G("ngIf",!o.selectable),e.R7$(),e.Y8G("deleted",o.auth.hasPermissionTo("MOD_AUDIT_DEL"))("form",o.filter)("where",o.filterWhere)("submit",o.filterSubmit.bind(o))("collapseChange",o.filterCollapseChange.bind(o))("collapsed",!o.selectable&&o.filterCollapsed),e.R7$(2),e.Y8G("size",6)("control",o.filter.controls.unidade_id)("dao",o.unidadeDao),e.R7$(2),e.Y8G("size",3)("control",o.filter.controls.data_inicio)("labelInfo","In\xedcio "+o.lex.translate("cadeia de valor")),e.R7$(),e.Y8G("size",3)("control",o.filter.controls.data_fim)("labelInfo","Fim "+o.lex.translate("cadeia de valor")),e.R7$(2),e.Y8G("ngIf",!o.selectable),e.R7$(),e.Y8G("template",i),e.R7$(3),e.Y8G("template",s),e.R7$(3),e.Y8G("template",r),e.R7$(3),e.Y8G("ngIf",!o.selectable),e.R7$(),e.Y8G("rows",o.rowsLimit)}},dependencies:[f.bT,h._,R.T,j.I,w.i,B.H,F.e,$.O,Y.r,S]})}}return a})();var be=d(3678),Ce=d(8241);const Ve=["cadeiaValorInstitucional"],Ge=["editProcessoForm"],M=()=>["processo"],X=a=>({processo:a});function ye(a,l){if(1&a&&(e.j41(0,"editable-form",3)(1,"div",15),e.nrm(2,"input-text",16),e.k0s()()),2&a){const t=e.XpG();e.Y8G("form",t.form),e.R7$(2),e.Y8G("size",12)("label","Nome do "+t.lex.translate("processo"))("control",t.form.controls.nome),e.BMQ("maxlength",250)}}function De(a,l){if(1&a){const t=e.RV6();e.j41(0,"div",32),e.bIt("dndEnd",function(o){e.eBV(t);const i=e.XpG(4);return e.Njj(i.onDragEnd(o))})("dndMoved",function(){const o=e.eBV(t).$implicit,i=e.XpG().processo,s=e.XpG(3);return e.Njj(s.onDragged(o,i.children,"move"))})("dndStart",function(o){e.eBV(t);const i=e.XpG(4);return e.Njj(i.onDragStart(o))}),e.j41(1,"div",23)(2,"h5",18),e.EFF(3),e.k0s(),e.j41(4,"div",33),e.nrm(5,"action-button",20),e.k0s()(),e.eu8(6,28),e.k0s()}if(2&a){const t=l.$implicit;e.XpG(2);const n=e.sdS(8),o=e.XpG(2);e.Aen("--bg:"+t.cor+";--color:black;"),e.Y8G("dndDisableIf",!o.canEdit)("dndDraggable",t),e.R7$(3),e.Lme("",t.level,". ",t.nome,""),e.R7$(2),e.Y8G("data",t)("items",o.options),e.R7$(),e.Y8G("ngTemplateOutlet",n)("ngTemplateOutletContext",e.eq3(10,X,t))}}function Pe(a,l){if(1&a){const t=e.RV6();e.j41(0,"div",29),e.bIt("dndDrop",function(o){const i=e.eBV(t).processo,s=e.XpG(3);return e.Njj(s.onDrop(o,i.children))}),e.j41(1,"div",30)(2,"p",10),e.nrm(3,"span",24)(4,"span",25),e.k0s()(),e.DNE(5,De,7,12,"div",31),e.k0s()}if(2&a){const t=l.processo;e.Y8G("dndDropzone",e.lJ4(4,M)),e.R7$(),e.Aen("--bg:gray;--color:black;"),e.R7$(4),e.Y8G("ngForOf",t.children)}}function Ie(a,l){if(1&a){const t=e.RV6();e.j41(0,"div",27),e.bIt("dndEnd",function(o){e.eBV(t);const i=e.XpG(2);return e.Njj(i.onDragEnd(o))})("dndMoved",function(){const o=e.eBV(t).$implicit,i=e.XpG().$implicit,s=e.XpG();return e.Njj(s.onDragged(o,i.children,"move"))})("dndStart",function(o){e.eBV(t);const i=e.XpG(2);return e.Njj(i.onDragStart(o))}),e.j41(1,"div",23)(2,"h4",18),e.EFF(3),e.k0s(),e.j41(4,"div",19),e.nrm(5,"action-button",20),e.k0s()(),e.eu8(6,28),e.DNE(7,Pe,6,5,"ng-template",null,2,e.C5r),e.k0s()}if(2&a){const t=l.$implicit,n=e.sdS(8),o=e.XpG(2);e.Aen("--bg:"+t.cor+";--color:black;"),e.Y8G("dndDisableIf",!o.canEdit)("dndDraggable",t),e.R7$(3),e.Lme("",t.level,". ",t.nome,""),e.R7$(2),e.Y8G("data",t)("items",o.options),e.R7$(),e.Y8G("ngTemplateOutlet",n)("ngTemplateOutletContext",e.eq3(10,X,t))}}function Ee(a,l){if(1&a){const t=e.RV6();e.j41(0,"div",17),e.bIt("dndEnd",function(o){e.eBV(t);const i=e.XpG();return e.Njj(i.onDragEnd(o))})("dndMoved",function(){const o=e.eBV(t).$implicit,i=e.XpG();return e.Njj(i.onDragged(o,i.processos,"move"))})("dndStart",function(o){e.eBV(t);const i=e.XpG();return e.Njj(i.onDragStart(o))}),e.j41(1,"div",8)(2,"div",9)(3,"h3",18),e.EFF(4),e.k0s(),e.j41(5,"div",19),e.nrm(6,"action-button",20),e.k0s()(),e.j41(7,"div",21),e.bIt("dndDrop",function(o){const i=e.eBV(t).$implicit,s=e.XpG();return e.Njj(s.onDrop(o,i.children))}),e.j41(8,"div",22)(9,"div",23)(10,"p",10),e.nrm(11,"span",24)(12,"span",25),e.k0s()()(),e.DNE(13,Ie,9,12,"div",26),e.k0s()()()}if(2&a){const t=l.$implicit,n=e.XpG();e.Y8G("dndDisableIf",!n.canEdit)("dndDraggable",t),e.R7$(),e.Aen("--border-color:"+t.cor+";--bg:white;--color:black;"),e.R7$(3),e.Lme("",t.level,". ",t.nome,""),e.R7$(2),e.Y8G("data",t)("items",n.options),e.R7$(),e.Y8G("dndDropzone",e.lJ4(12,M)),e.R7$(),e.Aen("--bg:gray;--color:black;"),e.R7$(5),e.Y8G("ngForOf",t.children)}}class Re extends V.g{constructor(l){super(),this.children=[],this.cor="#010101",this.level="",this.initialization(l)}}let je=(()=>{class a extends x.g{constructor(t){super(t),this.injector=t,this.cadeiasValor=[],this.processos=[],this.canEdit=!0,this.options=[{icon:"bi bi-file-earmark-bar-graph",label:"Entregas",onClick:this.consultProcesso.bind(this)},{divider:!0},{icon:"bi bi-plus-circle",label:"Incluir subprocesso",onClick:this.addProcesso.bind(this)},{icon:"bi bi-pencil-square",label:"Alterar",onClick:this.editProcesso.bind(this)},{divider:!0},{icon:"bi bi-trash",label:"Excluir",onClick:this.deleteProcesso.bind(this)}],this.validate=(n,o)=>{let i=null;return"nome"==o&&!n.value?.length&&(i="Obrigat\xf3rio"),i},this.dao=t.get(b.X),this.cadeiaValorProcessoDao=t.get(D.p),this.join=["processos"],this.title=this.lex.translate("Cadeias de Valores"),this.form=this.fh.FormBuilder({cadeia_valor_id:{default:null},nome:{default:""}},this.cdRef,this.validate)}ngAfterViewInit(){super.ngAfterViewInit(),this.loadData(this.entity)}consultProcesso(t){this.go.navigate({route:["gestao","plano-entrega","entrega","processos",t.id]})}addProcesso(t){var n=this;return(0,u.A)(function*(){let o=new V.g({path:t.path+"/"+t.id,cadeia_valor_id:t.cadeia_valor_id,processo_pai_id:t.id,nome:"",sequencia:1});yield n.editProcesso(o)})()}editProcesso(t){var n=this;return(0,u.A)(function*(){n.entity=t,n.form.controls.nome.setValue(t.nome),n.form.controls.nome.setErrors(null);let o=yield n.dialog.template({title:"Processo",modalWidth:500},n.editProcessoForm,[{label:"Gravar",icon:"bi bi-check-circle",color:"btn-outline-success",value:"GRAVAR"},{label:"Cancelar",icon:"bi bi-dash-circle",color:"btn btn-outline-danger",value:"CANCELAR"}]).asPromise();if("GRAVAR"==o.button.value)if(n.form.valid){n.entity.nome=n.form.controls.nome.value,n.submitting=!0;try{(yield n.cadeiaValorProcessoDao.save(n.entity))&&o.dialog.close(),yield n.refreshCadeiaValor()}catch(i){n.dialog.alert("Error",i.message?i.message:i||"Erro desconhecido")}finally{n.submitting=!1}}else n.form.markAllAsTouched();else o.dialog.close()})()}deleteProcesso(t){var n=this;return(0,u.A)(function*(){if(yield n.dialog.confirm("Exclui ?","Deseja realmente excluir?"))try{yield n.cadeiaValorProcessoDao.delete(t.id),yield n.refreshCadeiaValor()}catch(i){n.dialog.alert("Erro","Erro ao excluir: "+(i?.message?i?.message:i||"Erro desconhecido"))}})()}loadData(t,n){var o=this;return(0,u.A)(function*(){o.query=o.dao.query({where:[["data_arquivamento","==",null]],orderBy:[["data_inicio","desc"]],join:o.join}),o.query.asPromise().then(i=>{let s=o.form.controls.cadeia_valor_id.value;o.form.controls.cadeia_valor_id.setValue(null),o.cadeiasValor=i.map(r=>Object.assign({},{key:r.id,value:r.nome,data:r})),o.cdRef.detectChanges(),o.form.controls.cadeia_valor_id.setValue(s||(o.cadeiasValor.length?o.cadeiasValor[0].key:null))})})()}onCadeiaValorChange(){const t=(n,o)=>o.sort((i,s)=>i.sequencia-s.sequencia).map(i=>Object.assign(new Re({children:t(n+i.sequencia+".",this.cadeiaValor.processos.filter(s=>s.processo_pai_id==i.id)),level:n+i.sequencia,cor:this.lookup.CORES_BACKGROUND[Math.floor(Math.random()*this.lookup.CORES_BACKGROUND.length)].color}),i));this.cadeiaValor=this.cadeiaValorInstitucional?.selectedItem?.data,this.cadeiaValor&&(this.processos=t("",this.cadeiaValor.processos.filter(n=>!n.processo_pai_id)))}refreshCadeiaValor(){var t=this;return(0,u.A)(function*(){yield t.loadData(t.entity,t.form)})()}onProcessoClick(t){let n=t;this.go.navigate({route:["gestao","cadeiaValor",this.cadeiaValor?.id,"objetivos",n.id]})}onObjetivoDeleteClick(t){}onObjetivoEditClick(t){}onDrop(t,n){console.log("Drop",t),n?.splice(typeof t.index>"u"?n.length:t.index,0,t.data)}onDragEnd(t){console.log("DragEnd",t)}onDragged(t,n,o){console.log("Dragged",t,n),n.splice(n.indexOf(t),1)}onDragStart(t){console.log("DragStart",t)}static{this.\u0275fac=function(n){return new(n||a)(e.rXU(e.zZn))}}static{this.\u0275cmp=e.VBU({type:a,selectors:[["cadeia-valor-mapa"]],viewQuery:function(n,o){if(1&n&&(e.GBs(C.Q,5),e.GBs(Ve,5),e.GBs(Ge,5)),2&n){let i;e.mGM(i=e.lsd())&&(o.editableForm=i.first),e.mGM(i=e.lsd())&&(o.cadeiaValorInstitucional=i.first),e.mGM(i=e.lsd())&&(o.editProcessoForm=i.first)}},features:[e.Vt3],decls:15,vars:9,consts:[["editProcessoForm",""],["cadeiaValorInstitucional",""],["innerProcessos",""],["noButtons","",3,"form"],[1,"row","my-2"],["controlName","cadeia_valor_id",3,"change","size","control","items"],[1,"row","my-2",3,"dndDrop","dndDropzone"],["dndPlaceholderRef","",1,"row","cadeia-valor"],[1,"nivel-1"],[1,"d-flex","justify-content-between"],[1,"card-text","placeholder-glow"],[1,"placeholder","col-2"],[1,"placeholder","col-4"],[1,"placeholder","col-6"],["class","row cadeia-valor","dndType","processo","dndEffectAllowed","move",3,"dndDisableIf","dndDraggable","dndEnd","dndMoved","dndStart",4,"ngFor","ngForOf"],[1,"row"],["icon","bi bi-textarea-t","controlName","nome",3,"size","label","control"],["dndType","processo","dndEffectAllowed","move",1,"row","cadeia-valor",3,"dndEnd","dndMoved","dndStart","dndDisableIf","dndDraggable"],[1,"texto","text-break"],[1,"btn-group","dropstart","dropdown-menu-button","ms-2"],["noArrow","","icon","bi bi-wrench-adjustable-circle","color","transparent-black p-1 py-0",3,"data","items"],[1,"d-flex","align-content-stretch","flex-wrap",3,"dndDrop","dndDropzone"],["dndPlaceholderRef","",1,"nivel-2"],[1,"d-flex","justify-content-between","mb-2"],[1,"placeholder","col-5"],[1,"placeholder","col-7"],["class","nivel-2","dndType","processo","dndEffectAllowed","move",3,"style","dndDisableIf","dndDraggable","dndEnd","dndMoved","dndStart",4,"ngFor","ngForOf"],["dndType","processo","dndEffectAllowed","move",1,"nivel-2",3,"dndEnd","dndMoved","dndStart","dndDisableIf","dndDraggable"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"dndDrop","dndDropzone"],["dndPlaceholderRef","",1,"nivel-3"],["class","nivel-3","dndType","processo","dndEffectAllowed","move",3,"style","dndDisableIf","dndDraggable","dndEnd","dndMoved","dndStart",4,"ngFor","ngForOf"],["dndType","processo","dndEffectAllowed","move",1,"nivel-3",3,"dndEnd","dndMoved","dndStart","dndDisableIf","dndDraggable"],[1,"btn-group","dropstart","dropdown-menu-button","ms-2","align-button"]],template:function(n,o){if(1&n){const i=e.RV6();e.DNE(0,ye,3,5,"ng-template",null,0,e.C5r),e.j41(2,"editable-form",3)(3,"div",4)(4,"input-select",5,1),e.bIt("change",function(){return e.eBV(i),e.Njj(o.onCadeiaValorChange())}),e.k0s()()(),e.j41(6,"div",6),e.bIt("dndDrop",function(r){return e.eBV(i),e.Njj(o.onDrop(r,o.processos))}),e.j41(7,"div",7)(8,"div",8)(9,"div",9)(10,"p",10),e.nrm(11,"span",11)(12,"span",12)(13,"span",13),e.k0s()()()(),e.DNE(14,Ee,14,13,"div",14),e.k0s()}2&n&&(e.R7$(2),e.Y8G("form",o.form),e.R7$(2),e.Y8G("size",12)("control",o.form.controls.cadeia_valor_id)("items",o.cadeiasValor),e.R7$(2),e.Y8G("dndDropzone",e.lJ4(8,M)),e.R7$(2),e.Aen("--border-color:gray;--bg:white;--color:black;"),e.R7$(6),e.Y8G("ngForOf",o.processos))},dependencies:[f.Sq,f.T3,C.Q,P.H,be.K,Ce.C,y.zr,y.hN,y.GI],styles:['.cadeia-valor[_ngcontent-%COMP%]   .dropdown-menu[_ngcontent-%COMP%]{border:0;padding:0;background:none}.cadeia-valor[_ngcontent-%COMP%]   .dropdown-menu-button[_ngcontent-%COMP%]{margin-top:-5px}.cadeia-valor[_ngcontent-%COMP%]   .align-button[_ngcontent-%COMP%]{margin-top:-10px}.cadeia-valor[_ngcontent-%COMP%]   .texto[_ngcontent-%COMP%]{max-width:200px}.nivel-1[_ngcontent-%COMP%]{border:2px solid var(--border-color);padding:5px;background:var(--bg);position:relative;margin-bottom:15px;color:var(--color)}.nivel-1[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{text-align:center;font-size:18px}.nivel-1[_ngcontent-%COMP%]:after, .nivel-1[_ngcontent-%COMP%]:before{top:100%;left:95%;border:solid #fff;content:"";height:0;width:0;position:absolute;pointer-events:none}.nivel-1[_ngcontent-%COMP%]:after{border-width:20px;margin-left:-20px;border-color:#88b7d500;border-top-color:var(--bg)}.nivel-1[_ngcontent-%COMP%]:before{border-width:23px;margin-left:-23px;border-color:#c2e1f500;border-top-color:var(--border-color)}.nivel-2[_ngcontent-%COMP%]{position:relative;padding:10px;color:var(--color);background-color:var(--bg);margin-bottom:10px;margin-right:40px}.nivel-2[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:16px;text-align:center}.nivel-2[_ngcontent-%COMP%]:before, .nivel-2[_ngcontent-%COMP%]:after{width:20px;height:50%;position:absolute;left:100%;content:""}.nivel-2[_ngcontent-%COMP%]:before{top:0;background:linear-gradient(to right top,var(--bg) 50%,transparent 50%)}.nivel-2[_ngcontent-%COMP%]:after{top:50%;background:linear-gradient(to right bottom,var(--bg) 50%,transparent 50%)}.nivel-3[_ngcontent-%COMP%]{background-color:var(--bg);color:var(--color);padding:5px;margin-bottom:10px}.nivel-3[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{font-size:14px;font-weight:400;margin:0}.nivel-3[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{margin-left:10px;margin-top:5px;padding:5px;font-size:13px;background-color:var(--bg);color:var(--color)}']})}}return a})();function Me(a,l){if(1&a&&e.nrm(0,"cadeia-valor-list-grid",5),2&a){const t=e.XpG();e.Y8G("selectable",t.selectable)("snapshot",t.snapshot||t.modalRoute||t.route.snapshot)}}function Ne(a,l){1&a&&e.nrm(0,"cadeia-valor-mapa")}function Te(a,l){if(1&a&&(e.j41(0,"tab",6),e.DNE(1,Ne,1,0,"ng-template",null,1,e.C5r),e.k0s()),2&a){const t=e.sdS(2);e.Y8G("template",t)}}let Oe=(()=>{class a extends E.P{constructor(t){super(t,g.S,b.X),this.injector=t,this.filterWhere=n=>[],this.code="MOD_CADV",this.title=this.lex.translate("Cadeias de Valores"),this.filter=this.fh.FormBuilder({})}ngAfterViewInit(){super.ngAfterViewInit(),this.tabs.active=["TABELA","MAPA"].includes(this.usuarioConfig.active_tab)?this.usuarioConfig.active_tab:"TABELA"}onSelectTab(t){var n=this;return(0,u.A)(function*(){n.viewInit&&n.saveUsuarioConfig({active_tab:t.key})})()}filterClear(t){t.controls.nome.setValue(""),super.filterClear(t)}static{this.\u0275fac=function(n){return new(n||a)(e.rXU(e.zZn))}}static{this.\u0275cmp=e.VBU({type:a,selectors:[["app-cadeia-valor-list"]],viewQuery:function(n,o){if(1&n&&(e.GBs(h._,5),e.GBs(A.O,5)),2&n){let i;e.mGM(i=e.lsd())&&(o.grid=i.first),e.mGM(i=e.lsd())&&(o.tabs=i.first)}},features:[e.Vt3],decls:5,vars:4,consts:[["grid",""],["mapa",""],["right","",3,"title","select"],["key","TABELA","icon","bi bi-table","label","Lista",3,"template"],["key","MAPA","icon","bi bi-card-heading","label","Mapa",3,"template",4,"ngIf"],[3,"selectable","snapshot"],["key","MAPA","icon","bi bi-card-heading","label","Mapa",3,"template"]],template:function(n,o){if(1&n&&(e.j41(0,"tabs",2)(1,"tab",3),e.DNE(2,Me,1,2,"ng-template",null,0,e.C5r),e.k0s(),e.DNE(4,Te,3,1,"tab",4),e.k0s()),2&n){const i=e.sdS(3);e.Y8G("title",o.isModal?"":o.title)("select",o.onSelectTab.bind(o)),e.R7$(),e.Y8G("template",i),e.R7$(3),e.Y8G("ngIf",!o.selectable)}},dependencies:[f.bT,A.O,q.j,k,je]})}}return a})();var Ae=d(24),Le=d(8857);const we=["processos"],Be=["unidade"];let N=(()=>{class a extends Ae.n{constructor(t){super(t,g.S,b.X),this.injector=t,this.validate=(n,o)=>{let i=null;return["nome","unidade_id"].indexOf(o)>=0&&!n.value?.length&&(i="Obrigat\xf3rio"),["data_inicio"].indexOf(o)>=0&&!this.dao?.validDateTime(n.value)&&(i="Inv\xe1lido"),"data_fim"==o&&n.value&&!this.dao?.validDateTime(n.value)&&(i="Inv\xe1lido"),i},this.formValidation=n=>this.form.controls.data_fim.value&&this.form.controls.data_inicio.value>this.form.controls.data_fim.value?"A data do in\xedcio n\xe3o pode ser maior que a data do fim!":null,this.titleEdit=n=>"Editando "+this.lex.translate("Cadeia de Valor")+": "+(n?.nome||""),this.unidadeDao=t.get(L.s),this.join=["processos"],this.form=this.fh.FormBuilder({nome:{default:""},data_inicio:{default:new Date},data_fim:{default:null},unidade_id:{default:""},moveFilhos:{default:!1}},this.cdRef,this.validate)}loadData(t,n){let o=Object.assign({},n.value);n.patchValue(this.util.fillForm(o,t))}initializeData(t){this.entity=new g.S,this.loadData(this.entity,t)}saveData(t){var n=this;return(0,u.A)(function*(){return new Promise((o,i)=>{n.processos.grid.confirm();let s=n.util.fill(new g.S,n.entity);n.form.value.entidade_id=n.auth.entidade?.id,s=n.util.fillForm(s,n.form.value),s.processos=n.processos.items,o(s)})})()}static{this.\u0275fac=function(n){return new(n||a)(e.rXU(e.zZn))}}static{this.\u0275cmp=e.VBU({type:a,selectors:[["app-cadeia-valor-form"]],viewQuery:function(n,o){if(1&n&&(e.GBs(C.Q,5),e.GBs(we,5),e.GBs(Be,5)),2&n){let i;e.mGM(i=e.lsd())&&(o.editableForm=i.first),e.mGM(i=e.lsd())&&(o.processos=i.first),e.mGM(i=e.lsd())&&(o.unidade=i.first)}},features:[e.Vt3],decls:12,vars:17,consts:[["unidade",""],["processos",""],["initialFocus","nome",3,"submit","cancel","form","disabled","title"],[1,"row"],["icon","bi bi-textarea-t","controlName","nome","required","",3,"size","label","control"],["date","","label","In\xedcio","icon","bi bi-calendar-date","controlName","data_inicio","required","",3,"size","control","labelInfo"],["date","","label","Fim","icon","bi bi-calendar-date","controlName","data_fim","required","",3,"size","control","labelInfo"],["controlName","unidade_id","label","Unidade",3,"size","dao"],["noPersist","",3,"entity","cdRef"]],template:function(n,o){if(1&n){const i=e.RV6();e.j41(0,"editable-form",2),e.bIt("submit",function(){return e.eBV(i),e.Njj(o.onSaveData())})("cancel",function(){return e.eBV(i),e.Njj(o.onCancel())}),e.j41(1,"div",3)(2,"div",3),e.nrm(3,"input-text",4),e.k0s(),e.j41(4,"div",3),e.nrm(5,"input-datetime",5)(6,"input-datetime",6)(7,"input-search",7,0),e.k0s()(),e.nrm(9,"separator")(10,"cadeia-valor-list-processos",8,1),e.k0s()}2&n&&(e.Y8G("form",o.form)("disabled",o.formDisabled)("title",o.isModal?"":o.title),e.R7$(3),e.Y8G("size",12)("label","Nome da "+o.lex.translate("cadeia de valor"))("control",o.form.controls.nome),e.BMQ("maxlength",250),e.R7$(2),e.Y8G("size",4)("control",o.form.controls.data_inicio)("labelInfo","In\xedcio da "+o.lex.translate("cadeia de valor")),e.R7$(),e.Y8G("size",4)("control",o.form.controls.data_fim)("labelInfo","Fim da "+o.lex.translate("cadeia de valor")),e.R7$(),e.Y8G("size",4)("dao",o.unidadeDao),e.R7$(3),e.Y8G("entity",o.entity)("cdRef",o.cdRef))},dependencies:[C.Q,$.O,P.H,Y.r,Le.F,S]})}}return a})();function Fe(a,l){if(1&a&&(e.j41(0,"h3",12),e.EFF(1),e.k0s()),2&a){const t=e.XpG();e.R7$(),e.JRh(t.title)}}function $e(a,l){if(1&a&&e.nrm(0,"toolbar",13),2&a){const t=e.XpG();e.Y8G("buttons",t.buttons)}}function Ye(a,l){if(1&a&&(e.j41(0,"span",14),e.EFF(1),e.k0s()),2&a){const t=l.row,n=l.metadata,o=e.XpG();e.R7$(),e.JRh(o.getSequencia(n,t))}}function xe(a,l){if(1&a&&(e.j41(0,"span",14),e.EFF(1),e.k0s()),2&a){const t=l.row;e.R7$(),e.JRh(t.nome)}}const ke=[{path:"",component:Oe,canActivate:[_.q],resolve:{config:v.L},runGuardsAndResolvers:"always",data:{title:"Cadeia de Valor"}},{path:"grid",component:k,canActivate:[_.q],resolve:{config:v.L},data:{title:"Cadeia de Valor"}},{path:"new",component:N,canActivate:[_.q],resolve:{config:v.L},runGuardsAndResolvers:"always",data:{title:"Inclus\xe3o de Cadeia de Valor",modal:!0}},{path:":id/edit",component:N,canActivate:[_.q],resolve:{config:v.L},runGuardsAndResolvers:"always",data:{title:"Edi\xe7\xe3o de Cadeia de Valor",modal:!0}},{path:":id/consult",component:N,canActivate:[_.q],resolve:{config:v.L},runGuardsAndResolvers:"always",data:{title:"Consulta a Cadeia de Valor",modal:!0}},{path:"processoList",component:(()=>{class a extends E.P{constructor(t){super(t,V.g,D.p),this.injector=t,this.buttons=[],this.filterWhere=n=>{let o=n.value,i=[];return o.planejamento_id?.length&&i.push(["cadeia_valor_id","==",o.cadeia_valor_id]),o.nome?.length&&i.push(["or",["nome","like","%"+o.nome.trim().replace(" ","%")+"%"],["sigla","like","%"+o.nome.trim().replace(" ","%")+"%"]]),i},this.cadeiaValorDao=t.get(b.X),this.cadeiaValorProcessoDao=t.get(D.p),this.title=this.lex.translate("Processos"),this.filter=this.fh.FormBuilder({nome:{default:""},cadeia_valor_id:{default:null}}),this.OPTION_INFORMACOES.onClick=n=>this.go.navigate({route:["gestao","cadeia-valor","processo",n.id,"consult"]},{modal:!0}),this.addOption(this.OPTION_INFORMACOES)}filterClear(t){super.filterClear(t)}getSequencia(t,n){return t.nivel=n.sequencia_completa||n.sequencia,this.sortProcessos(),t.nivel}sortProcessos(){this.grid?.items.sort((t,n)=>{const o=this.grid.getMetadata(t),i=this.grid.getMetadata(n),s=(o?.nivel||"").split(".").map(Number),r=(i?.nivel||"").split(".").map(Number),c=Math.max(s.length,r.length);for(let m=0;m<c;m++){const p=s[m]||0,G=r[m]||0;if(p!==G)return p-G}return 0})}static{this.\u0275fac=function(n){return new(n||a)(e.rXU(e.zZn))}}static{this.\u0275cmp=e.VBU({type:a,selectors:[["cadeia-valor-list-processos-entregas"]],viewQuery:function(n,o){if(1&n&&e.GBs(h._,5),2&n){let i;e.mGM(i=e.lsd())&&(o.grid=i.first)}},features:[e.Vt3],decls:15,vars:23,consts:[["columnNivel",""],["columnNome",""],["class","my-2",4,"ngIf"],[3,"select","dao","add","orderBy","groupBy","join","selectable"],[3,"buttons",4,"ngIf"],[3,"deleted","form","where","submit","clear","collapseChange","collapsed"],[1,"row"],["label","Nome","controlName","nome","placeholder","Nome",3,"size","control"],["title","N\xedvel",3,"template"],["title","Nome","orderBy","nome",3,"template"],["type","options",3,"onEdit","options"],[3,"rows"],[1,"my-2"],[3,"buttons"],[1,"d-block"]],template:function(n,o){if(1&n){const i=e.RV6();e.DNE(0,Fe,2,1,"h3",2),e.j41(1,"grid",3),e.bIt("select",function(r){return e.eBV(i),e.Njj(o.onSelect(r))}),e.DNE(2,$e,1,1,"toolbar",4),e.j41(3,"filter",5)(4,"div",6),e.nrm(5,"input-text",7),e.k0s()(),e.j41(6,"columns")(7,"column",8),e.DNE(8,Ye,2,1,"ng-template",null,0,e.C5r),e.k0s(),e.j41(10,"column",9),e.DNE(11,xe,2,1,"ng-template",null,1,e.C5r),e.k0s(),e.nrm(13,"column",10),e.k0s(),e.nrm(14,"pagination",11),e.k0s()}if(2&n){const i=e.sdS(9),s=e.sdS(12);e.Y8G("ngIf",!o.isModal),e.R7$(),e.Y8G("dao",o.dao)("add",o.add)("orderBy",o.orderBy)("groupBy",o.groupBy)("join",o.join)("selectable",o.selectable),e.R7$(),e.Y8G("ngIf",!o.selectable),e.R7$(),e.Y8G("deleted",o.auth.hasPermissionTo("MOD_AUDIT_DEL"))("form",o.filter)("where",o.filterWhere)("submit",o.filterSubmit.bind(o))("clear",o.filterClear.bind(o))("collapseChange",o.filterCollapseChange.bind(o))("collapsed",!o.selectable&&o.filterCollapsed),e.R7$(2),e.Y8G("size",7)("control",o.filter.controls.nome),e.BMQ("maxlength",250),e.R7$(2),e.Y8G("template",i),e.R7$(3),e.Y8G("template",s),e.R7$(3),e.Y8G("onEdit",o.edit)("options",o.options),e.R7$(),e.Y8G("rows",o.rowsLimit)}},dependencies:[f.bT,h._,R.T,j.I,w.i,B.H,F.e,P.H]})}}return a})(),canActivate:[_.q],resolve:{config:v.L},runGuardsAndResolvers:"always",data:{title:"Lista de Processos da Cadeia de Valor",modal:!0}}];let Xe=(()=>{class a{static{this.\u0275fac=function(n){return new(n||a)}}static{this.\u0275mod=e.$C({type:a})}static{this.\u0275inj=e.G2t({imports:[O.iI.forChild(ke),O.iI]})}}return a})(),ze=(()=>{class a{static{this.\u0275fac=function(n){return new(n||a)}}static{this.\u0275mod=e.$C({type:a})}static{this.\u0275inj=e.G2t({imports:[f.MD,z.h,I.X1,y.JG,Xe]})}}return a})()}}]);
<h3>Indicadores de Gestão</h3>
<toolbar *ngIf="!selectable"></toolbar>
<filter 
    [form]="filter" 
    [where]="filterWhere" 
    [submit]="filterSubmit.bind(this)" 
    [filter]="onButtonFilterClick"
    filterLabel="Consultar"
>
    <div class="row">   
        <input-search 
            #unidade 
            [size]="6" 
            label="Unidade de Consulta"
            [control]="filter!.controls.unidade_id" 
            controlName="unidade_id" 
            [dao]="unidadeDao"
            [selectRoute]="{
                route: ['configuracoes', 'unidade'],
                params: { unidades: (auth.hasPermissionTo('MOD_IND_TODAS_UNIDADES') ? null : this.unidades) }
            }"
            [where]="auth.hasPermissionTo('MOD_IND_TODAS_UNIDADES')
                ? []
                : [['id', 'in', this.unidades]]"
        >
        </input-search>
        <input-datetime
            [size]="2"
            date
            label="Período para consulta: início"
            controlName="this.filter.data_inicial"
            [control]="filter!.controls.data_inicial"
            labelInfo="Data início de consulta"
        ></input-datetime>
        <input-datetime
            [size]="2"
            date
            label="Período para consulta: fim"
            controlName="data_final"
            [control]="filter!.controls.data_final"
            labelInfo="Data fim da consulta"
        ></input-datetime>
        <input-switch
            [size]="1"
            label="Somente vigentes"
            controlName="somente_vigentes"
            [control]="filter!.controls.somente_vigentes"
        ></input-switch>
        <input-switch
            [size]="1"
            label="Unidades Subordinadas"
            controlName="incluir_unidades_subordinadas"
            [control]="filter!.controls.incluir_unidades_subordinadas"
        ></input-switch>
    </div>
</filter>
<div class="graficos">
    <div class="grafico">
        <div class="titulo">Taxa de cobertura do PGD entre os agentes públicos
            <i  class="bi bi-info-circle label-info text-muted"
                data-bs-toggle="tooltip"
                data-bs-placement="top"
                title="Indica a proporção de participantes do PGD informados no Siape em relação ao total de de agentes públicos."
            ></i>
        </div>
        <p *ngIf="!pieChartData.labels?.length" class="no-data">Sem dados para exibir</p>
        <div *ngIf="loading; else grafico" class="d-flex justify-content-center my-2">
            <div class="spinner-border" role="status">
                <span class="visually-hidden"></span>
            </div>
        </div>
        <ng-template #grafico>
            <div class="grafico-wrapper">
                <canvas
                    baseChart
                    [data]="pieChartData"
                    [type]="'pie'"
                    [options]="pieChartOptions"
                ></canvas>
            </div>
        </ng-template>
    </div>

    
    <div class="grafico" *ngIf="pieChartUnidadesData.labels?.length">
        <div class="titulo">Taxa de cobertura do PGD nas unidades
            <i  class="bi bi-info-circle label-info text-muted"
                data-bs-toggle="tooltip"
                data-bs-placement="top"
                title="Indica a proporção de unidades que têm Plano de Entregas cadastrados em relação ao total de Unidades Organizacionais."
            ></i>
        </div>
        <p *ngIf="!pieChartUnidadesData.labels?.length" class="no-data">Sem dados para exibir</p>
        <div *ngIf="loading; else graficoUnidades" class="d-flex justify-content-center my-2">
            <div class="spinner-border" role="status">
                <span class="visually-hidden"></span>
            </div>
        </div>
        <ng-template #graficoUnidades>
            <div class="grafico-wrapper">
                <canvas
                    baseChart
                    [data]="pieChartUnidadesData"
                    [type]="'pie'"
                    [options]="pieChartUnidadesOptions"
                ></canvas>
            </div>
        </ng-template>
    </div>
</div>

